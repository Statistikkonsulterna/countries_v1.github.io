// undefined v1.0.0 Copyright 2025 Gapminder Foundation
(function () {
'use strict';
var ge,me,be,ve;ge=window,me=function(he,ge){function invariant(he,ge){void 0===ge&&(ge="Illegal state"),he||function fail$1(he){throw new Error("[mobx-utils] "+he)}(ge)}var deepFields=function(he){return he&&he!==Object.prototype&&Object.getOwnPropertyNames(he).concat(deepFields(Object.getPrototypeOf(he))||[])},getAllMethodsAndProperties=function(he){return function(he){var ge=deepFields(he);return ge.filter((function(he,me){return ge.indexOf(he)===me}))}(he).filter((function(he){return"constructor"!==he&&!~he.indexOf("__")}))},me="pending",be="fulfilled",ve="rejected";function caseImpl(he){switch(this.state){case me:return he.pending&&he.pending(this.value);case ve:return he.rejected&&he.rejected(this.value);case be:return he.fulfilled?he.fulfilled(this.value):this.value}}function fromPromise(ge,_e){if(invariant(arguments.length<=2,"fromPromise expects up to two arguments"),invariant("function"==typeof ge||"object"==typeof ge&&ge&&"function"==typeof ge.then,"Please pass a promise or function to fromPromise"),!0===ge.isPromiseBasedObservable)return ge;"function"==typeof ge&&(ge=new Promise(ge));var xe=ge;ge.then(he.action("observableFromPromise-resolve",(function(he){xe.value=he,xe.state=be})),he.action("observableFromPromise-reject",(function(he){xe.value=he,xe.state=ve}))),xe.isPromiseBasedObservable=!0,xe.case=caseImpl;var we=_e&&_e.state===be?_e.value:void 0;return he.extendObservable(xe,{value:we,state:me},{},{deep:!1}),xe}!function(ge){ge.reject=he.action("fromPromise.reject",(function(he){var me=ge(Promise.reject(he));return me.state=ve,me.value=he,me})),ge.resolve=he.action("fromPromise.resolve",(function resolveBase(he){void 0===he&&(he=void 0);var me=ge(Promise.resolve(he));return me.state=be,me.value=he,me}))}(fromPromise||(fromPromise={}));var __decorate=function(he,ge,me,be){var ve,_e=arguments.length,xe=_e<3?ge:null===be?be=Object.getOwnPropertyDescriptor(ge,me):be;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)xe=Reflect.decorate(he,ge,me,be);else for(var we=he.length-1;we>=0;we--)(ve=he[we])&&(xe=(_e<3?ve(xe):_e>3?ve(ge,me,xe):ve(ge,me))||xe);return _e>3&&xe&&Object.defineProperty(ge,me,xe),xe};!function(){function StreamListener(ge,me){var be=this;he.runInAction((function(){be.current=me,be.subscription=ge.subscribe(be)}))}StreamListener.prototype.dispose=function(){this.subscription&&this.subscription.unsubscribe()},StreamListener.prototype.next=function(he){this.current=he},StreamListener.prototype.complete=function(){this.dispose()},StreamListener.prototype.error=function(he){this.current=he,this.dispose()},__decorate([he.observable.ref],StreamListener.prototype,"current",void 0),__decorate([he.action.bound],StreamListener.prototype,"next",null),__decorate([he.action.bound],StreamListener.prototype,"complete",null),__decorate([he.action.bound],StreamListener.prototype,"error",null)}();var __assign=function(){return __assign=Object.assign||function(he){for(var ge,me=1,be=arguments.length;me<be;me++)for(var ve in ge=arguments[me])Object.prototype.hasOwnProperty.call(ge,ve)&&(he[ve]=ge[ve]);return he},__assign.apply(this,arguments)},__decorate$1=function(he,ge,me,be){var ve,_e=arguments.length,xe=_e<3?ge:null===be?be=Object.getOwnPropertyDescriptor(ge,me):be;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)xe=Reflect.decorate(he,ge,me,be);else for(var we=he.length-1;we>=0;we--)(ve=he[we])&&(xe=(_e<3?ve(xe):_e>3?ve(ge,me,xe):ve(ge,me))||xe);return _e>3&&xe&&Object.defineProperty(ge,me,xe),xe},_e=["model","reset","submit","isDirty","isPropertyDirty","resetProperty"];!function(){function ViewModel(ge){var me=this;this.model=ge,this.localValues=he.observable.map({}),this.localComputedValues=he.observable.map({}),this.isPropertyDirty=function(he){return me.localValues.has(he)},invariant(he.isObservableObject(ge),"createViewModel expects an observable object"),getAllMethodsAndProperties(ge).forEach((function(be){if(be!==he.$mobx&&"__mobxDidRunLazyInitializers"!==be){if(invariant(-1===_e.indexOf(be),"The propertyname "+be+" is reserved and cannot be used with viewModels"),he.isComputedProp(ge,be)){var ve=he._getAdministration(ge,be).derivation;me.localComputedValues.set(be,he.computed(ve.bind(me)))}var xe=Object.getOwnPropertyDescriptor(ge,be),we=xe?{enumerable:xe.enumerable}:{};Object.defineProperty(me,be,__assign(__assign({},we),{configurable:!0,get:function(){return he.isComputedProp(ge,be)?me.localComputedValues.get(be).get():me.isPropertyDirty(be)?me.localValues.get(be):me.model[be]},set:he.action((function(he){he!==me.model[be]?me.localValues.set(be,he):me.localValues.delete(be)}))}))}}))}Object.defineProperty(ViewModel.prototype,"isDirty",{get:function(){return this.localValues.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(ViewModel.prototype,"changedValues",{get:function(){return this.localValues.toJS()},enumerable:!1,configurable:!0}),ViewModel.prototype.submit=function(){var ge=this;he.keys(this.localValues).forEach((function(me){var be=ge.localValues.get(me),ve=ge.model[me];he.isObservableArray(ve)?ve.replace(be):he.isObservableMap(ve)?(ve.clear(),ve.merge(be)):he.isComputed(be)||(ge.model[me]=be)})),this.localValues.clear()},ViewModel.prototype.reset=function(){this.localValues.clear()},ViewModel.prototype.resetProperty=function(he){this.localValues.delete(he)},__decorate$1([he.computed],ViewModel.prototype,"isDirty",null),__decorate$1([he.computed],ViewModel.prototype,"changedValues",null),__decorate$1([he.action.bound],ViewModel.prototype,"submit",null),__decorate$1([he.action.bound],ViewModel.prototype,"reset",null),__decorate$1([he.action.bound],ViewModel.prototype,"resetProperty",null)}();var xe,we=(xe=function(he,ge){return xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(he,ge){he.__proto__=ge}||function(he,ge){for(var me in ge)ge.hasOwnProperty(me)&&(he[me]=ge[me])},xe(he,ge)},function(he,ge){function __(){this.constructor=he}xe(he,ge),he.prototype=null===ge?Object.create(ge):(__.prototype=ge.prototype,new __)});!function(ge){function ObservableGroupMap(me,be,ve){var _e=void 0===ve?{}:ve,xe=_e.name,we=void 0===xe?"ogm"+(1e3*Math.random()|0):xe,Me=_e.keyToName,Se=void 0===Me?function(he){return""+he}:Me,De=ge.call(this)||this;De._keyToName=Se,De._groupBy=be,De._ogmInfoKey=Symbol("ogmInfo"+we),De._base=me;for(var ze=0;ze<me.length;ze++)De._addItem(me[ze]);return De._disposeBaseObserver=he.observe(De._base,(function(ge){if("splice"===ge.type)he.transaction((function(){for(var he=0,me=ge.removed;he<me.length;he++){var be=me[he];De._removeItem(be)}for(var ve=0,_e=ge.added;ve<_e.length;ve++){var xe=_e[ve];De._addItem(xe)}}));else{if("update"!==ge.type)throw new Error("illegal state");he.transaction((function(){De._removeItem(ge.oldValue),De._addItem(ge.newValue)}))}})),De}we(ObservableGroupMap,ge),ObservableGroupMap.prototype.clear=function(){throw new Error("not supported")},ObservableGroupMap.prototype.delete=function(he){throw new Error("not supported")},ObservableGroupMap.prototype.set=function(he,ge){throw new Error("not supported")},ObservableGroupMap.prototype.dispose=function(){this._disposeBaseObserver();for(var he=0;he<this._base.length;he++){var ge=this._base[he];ge[this._ogmInfoKey].reaction(),delete ge[this._ogmInfoKey]}},ObservableGroupMap.prototype._getGroupArr=function(me){var be=ge.prototype.get.call(this,me);return void 0===be&&(be=he.observable([],{name:"GroupArray["+this._keyToName(me)+"]",deep:!1}),ge.prototype.set.call(this,me,be)),be},ObservableGroupMap.prototype._removeFromGroupArr=function(he,me){var be=ge.prototype.get.call(this,he);1===be.length?ge.prototype.delete.call(this,he):(me===be.length-1||(be[me]=be[be.length-1],be[me][this._ogmInfoKey].groupArrIndex=me),be.length--)},ObservableGroupMap.prototype._addItem=function(ge){var me=this,be=this._groupBy(ge),ve=this._getGroupArr(be),_e={groupByValue:be,groupArrIndex:ve.length,reaction:he.reaction((function(){return me._groupBy(ge)}),(function(he,be){var ve=ge[me._ogmInfoKey];me._removeFromGroupArr(ve.groupByValue,ve.groupArrIndex);var _e=me._getGroupArr(he),xe=_e.length;_e.push(ge),ve.groupByValue=he,ve.groupArrIndex=xe}))};Object.defineProperty(ge,this._ogmInfoKey,{configurable:!0,enumerable:!1,value:_e}),ve.push(ge)},ObservableGroupMap.prototype._removeItem=function(he){var ge=he[this._ogmInfoKey];this._removeFromGroupArr(ge.groupByValue,ge.groupArrIndex),ge.reaction(),delete he[this._ogmInfoKey]}}(he.ObservableMap),Promise.resolve(),"undefined"!=typeof queueMicrotask||"undefined"!=typeof process&&process.nextTick;const Me={ascending:1,decending:-1};function order$1(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0==ge.length)return he;const me=Array.from(he.values()),be=function normalizeOrder(he){return"string"==typeof he?[{concept:he,direction:Me.ascending}]:he.map((he=>{if("string"==typeof he)return{concept:he,direction:Me.ascending};{const ge=Object.keys(he)[0];return{concept:ge,direction:Array.isArray(he[ge])?he[ge]:"asc"==he[ge]?Me.ascending:Me.decending}}}))}(ge),ve=be.length;return me.sort(((he,ge)=>{for(var me=0;me<ve;me++){const{concept:ve,direction:_e}=be[me];if(Array.isArray(_e))return _e.indexOf(he[ve])-_e.indexOf(ge[ve]);if(he[ve]<ge[ve])return-1*_e;if(he[ve]>ge[ve])return _e}return 0})),me.key=he.key,ze(me)}function getIter(he){return"values"in he&&"function"==typeof he.values?he.values():he}function isDataFrame(he){return!("DataFrame"!=(null==he?void 0:he.type)&&"Group"!=(null==he?void 0:he.type))}function isGroupedDataFrame(he){return!(!("descendantKeys"in he)||!Array.isArray(he.descendantKeys))}function arrayEquals$1(he,ge){const me=function intersect$1(he,ge){return he.filter((he=>ge.includes(he)))}(he,ge);return me.length==he.length&&me.length==ge.length}function normalizeKey(he){return he.slice(0).sort()}const createKeyStr=he=>normalizeKey(he).map(esc).join(Se),Se="Â¬",De=new Map;function esc(he){return he instanceof Date?function dateToCachedString(he){let ge=he.getTime();return De.has(ge)||De.set(ge,he.toISOString()),De.get(ge)}(he):he}const createKeyFn=he=>{const ge=(he=normalizeKey(he)).length;return me=>{const be=[];for(let ve=0;ve<ge;ve++)be[ve]=esc(me[he[ve]]);return be.join(Se)}};function pick(he,ge){const me={};for(const be of ge)be in he&&(me[be]=he[be]);return me}function unique$2(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];const be=new Set(ge.flat());return Array.from(be)}function fullJoin(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:normalizeParam(he[0]).dataFrame.key;const me=normalizeParams(he),be=me.reduce(_fullJoin,ze([],ge)),ve=unique$2(me.map((he=>Object.values(he.projection))).flat(2));for(const he of be.values())for(const ge of ve)ge in he||(he[ge]=void 0);return be}function _fullJoin(he,ge){const me=he.key,be=ge.dataFrame.key,ve=ge.projection;if(me.every((he=>ge.dataFrame.fields.includes(he)))||console.warn("Right dataFrame does not contain all join fields.",{left:he,rightCfg:ge}),arrayEquals$1(me,be))for(let me of ge.dataFrame.keys()){const be=ge.dataFrame.getByStr(me),_e=getOrCreateRow(he,be,me);for(let he in ve)for(let ge of ve[he])_e[ge]=be[he]}else{const be=createKeyFn(me);for(let me of ge.dataFrame.keys()){const _e=ge.dataFrame.getByStr(me),xe=getOrCreateRow(he,_e,be(_e));for(let he in ve)for(let ge of ve[he])xe[ge]=_e[he]}}return he}function normalizeParams(he){return he.map(normalizeParam).reduce(((he,ge)=>{const me=he.find((he=>he.dataFrame===ge.dataFrame));return me?function mergeProjections(he,ge){for(const[me,be]of Object.entries(ge.projection))me in he.projection?he.projection[me].push(...be):he.projection[me]=be}(me,ge):he.push(ge),he}),[])}function normalizeParam(he){return isDataFrame(he)&&(he={dataFrame:he}),"projection"in he||(he.projection=relativeComplement(he.dataFrame.key,he.dataFrame.fields)),Array.isArray(he.projection)?(he.projection=he.projection.reduce(((he,ge)=>(he[ge]=[ge],he)),{}),he):he}function getOrCreateRow(he,ge,me){let be;return be=he.getByStr(me),void 0===be&&(be=function createObj(he,ge,me){const be={[Symbol.for("key")]:me};return he.forEach((he=>be[he]=ge[he])),be}(he.key,ge,me),he.set(be,me)),be}function MapStorage(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.key||[];const me=function createEmptyMap(){const he=new Map;let ge=[];const me=he.has.bind(he),be=he.get.bind(he),ve=he.set.bind(he);return Object.defineProperty(he,"fields",{get:function(){var ge,me;return unique$2(he.key,null!==(ge=Object.keys(null!==(me=he.values().next().value)&&void 0!==me?me:{}))&&void 0!==ge?ge:[])}}),he.setKey=me=>{ge=normalizeKey(me),he.incrementIndex=0===he.key.length,he.keyFn=he.incrementIndex?()=>he.size:createKeyFn(he.key),he.updateIndexes()},Object.defineProperty(he,"key",{set:he.setKey,get:()=>ge}),he.has=ge=>he.incrementIndex||"string"==typeof ge?me(ge):me(he.keyFn(ge)),he.get=ge=>(ge=he.incrementIndex||"string"==typeof ge?ge:he.keyFn(ge),be(ge)),he.set=(ge,me)=>{(void 0===me||he.incrementIndex)&&(me=he.keyFn(ge),ge[Symbol.for("key")]=me),ve(me,ge)},he.setByStr=ve,he.hasByStr=me,he.getByStr=be,he.hasByObjOrStr=(he,ge)=>me(ge),he.getByObjOrStr=(he,ge)=>be(ge),he.batchSet=ge=>function batchSet(he,ge){const me=getIter(ge);if(he.incrementIndex)for(let ge of me)he.set(ge);else{let be;const ve=[],_e=Array.isArray(ge.key)&&arrayEquals$1(he.key,ge.key)?he=>he[Symbol.for("key")]:ge=>ge[Symbol.for("key")]=he.keyFn(ge);for(let ge of me)be=_e(ge),he.hasByStr(be)&&ve.push({keyStr:be,orig:he.getByStr(be),new:ge}),he.setByStr(be,ge);ve.length>0&&console.warn("Found duplicates for given key when constructing dataframe.",{key:he.key,duplicates:ve})}}(he,ge),he.rows=he.values,he.updateIndexes=()=>function updateIndexes(he){for(let[ge,me]of he)he.delete(ge),he.set(me)}(he),he.setKey(ge),he}();return me.key=ge,me.batchSet(he),me}function cloneRow(he){return function joinRows(){return Object.assign(...arguments)}({},he)}const project=(he,ge)=>fullJoin([{dataFrame:he,projection:ge}]);function extent(he,ge,me,be){return isGroupedDataFrame(he)?function extentGroups(he,ge,me,be){return[...getIter(he)].map((he=>extent(he,ge,me,be))).reduce(combineResults)}(...arguments):function extentIterable(he,ge,me,be){let ve;if(he=getIter(he),me){be=be?Array.from(be):be;let _e=Array.isArray(me)?createKeyFn(me):void 0,xe={};for(ve of he){const he=_e(ve);be&&!be.includes(he)||(xe[he]||(xe[he]=[]),xe[he]=minmax(ve[ge],xe[he]))}return xe}{let me=[];for(ve of he)me=minmax(ve[ge],me);return me}}(...arguments)}function combineResults(he,ge){if(Array.isArray(he))return[Math.min(he[0],ge[0]),Math.max(he[1],ge[1])];for(let me in ge)he[me]=me in he?combineResults(he[me],ge[me]):ge[me];return he}function extentOfGroupKeyPerMarker(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.key[0],be=arguments.length>3&&void 0!==arguments[3]?arguments[3]:he.descendantKeys[0];if(!isGroupedDataFrame(he))throw"iterable is not a grouped dataframe";const ve=he.descendantKeys;if(!arrayEquals$1(he.key,[me]))throw"grouping is not by given concept";if(1!=ve.length)throw"grouping is more than 1 level deep";if(!arrayEquals$1(ve[0],be))throw"grouping members keys is not same as `groupBy`";if(!function isIterable$1(he){return Symbol.iterator in he}(ge))throw"groupSubset iterable not given.";const _e={};for(let be of ge){let ge,ve,xe;for(xe of he.values())if(xe.hasByStr(be))void 0===ge&&(ge=xe),ve=xe;else if(ge)break;_e[be]=[ge,ve].map((he=>null==he?void 0:he.getByStr(be)[me]))}return _e}function minmax(he,ge){let[me,be]=ge;return null!=he&&(void 0===me?he>=he&&(me=be=he):(me>he&&(me=he),be<he&&(be=he))),[me,be]}function getFrames(he,ge,me,be){const ve=[];for(let _e=ge;_e<me;_e++)ve.push(he.get(be[_e]));return ve}function doExtrapolate(he,ge,me,be){const ve=ge[Symbol.for("key")];for(const _e of he){const he=be(_e,ve,ge);he[me]=ge[me],he[Symbol.for("extrapolated")][me]=ge}}function interpolateField(he,ge,me){const be={start:void 0,rows:[]};for(let ve of he.values())evaluateGap(ve,ge,be,me)}function evaluateGap(he,ge,me,be){const{rows:ve,start:_e}=me;null==he[ge]?void 0!==_e&&ve.push(he):(ve.length>0&&(interpolateGap(ve,_e,he,ge,be),ve.length=0),me.start=he)}function interpolateGap(he,me,be,ve){const _e=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:ge.interpolate)(me[ve],be[ve]),xe=1/(he.length+1);let we=0;for(let ge of he)we+=xe,ge[ve]=_e(we),Symbol.for("interpolated")in ge||(ge[Symbol.for("interpolated")]={}),ge[Symbol.for("interpolated")]={[ve]:[me,be]}}function reindexGroup(he,ge){const me=DataFrameGroup([],he.key,he.descendantKeys);for(let be of ge){const ge={[me.key[0]]:be},ve=me.keyFn(ge);if(he.has(ve)){let be=he.get(ve);me.set(ge,be)}else me.createMember(ge)}return me}function getDataFrameMultiGroup(he,ge){if("DataFrame"==he.type)return[he];let me;return me=ge?function pickMultiGroup(he,ge){let me=[{}];for(const be of ge)be in he&&(me=[].concat(he[be]).flatMap((he=>me.map((ge=>Object.assign({},ge,{[be]:he}))))));return me}(ge,he.key).map((ge=>{const me=he.keyFn(ge);return he.has(me)?he.get(me):he.createMember(ge)})):[he.values().next().value],me.flatMap((he=>getDataFrameMultiGroup(he,ge)))}function DataFrameGroup(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Array.isArray(me)||(me=[[me]]),Array.isArray(me[0])||(me=[me]),Array.isArray(ge)||(ge=[ge]),0===me.length&&he.key&&(me=[he.key]),createGroup(ge,me).batchSetRow(he)}function createGroup(he,ge){const me=new Map,be=new WeakMap,ve=me.set.bind(me);return me.type="Group",me.key=he,me.keyObject=he=>be.get(he),me.keyFn=createKeyFn(he),me.descendantKeys=ge,me.each=he=>function each(he,ge){for(let[me,be]of he)ge(be,me,he);return he}(me,he),me.map=he=>function map(he,ge){let me=DataFrameGroup([],he.key,he.descendantKeys);for(let[be,ve]of he){const _e=he.keyObject(ve);me.set(_e,ge(ve,be,he))}return me}(me,he),me.interpolate=mapCall(me,"interpolate"),me.filter=mapCall(me,"filter"),me.filterNullish=mapCall(me,"filterNullish"),me.order=mapCall(me,"order"),me.reindex=mapCall(me,"reindex"),me.interpolate=mapCall(me,"interpolate"),me.extrapolate=mapCall(me,"extrapolate"),me.reindexGroup=he=>reindexGroup(me,he),me.reindexToKeyDomain=he=>function reindexGroupToKeyDomain(he,ge){if(he.size>1){const me=he.keyExtent();he=reindexGroup(he,inclusiveRange(me[0],me[1],ge))}return he}(me,he),me.interpolateOverMembers=he=>function interpolateGroup(he){let{fields:ge=he.fields,frameField:me="",frameCopyFields:be=[],interpolators:ve={},ammendNewRow:_e=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const xe=relativeComplement(ge,he.values().next().value.fields).filter((he=>!be.includes(he)));xe.push(Symbol.for("key"));const we=[...he.keys()],Me=we.length;for(const Se of ge){const ge=new Map;for(let De=0;De<Me;De++){const Me=he.get(we[De]);for(const ze of Me.keys()){const Oe=Me.getByStr(ze);if(null!=Oe[Se]){const Me=ge.get(ze);if(void 0!==Me&&De-Me>1){const ge=[];for(let ve=Me+1;ve<De;ve++){const Me=he.get(we[ve]);let Se=Me.get(ze);if(void 0===Se){Se=Object.assign(pickGetters(Oe,xe),he.keyObject(Me));for(let he of be)Se[he]=Se[me];_e(Se),Se[Symbol.for("interpolated")]={},Me.setByStr(ze,Se)}else Symbol.for("interpolated")in Se||(Se=assign({},Se),Se[Symbol.for("interpolated")]={},Me.setByStr(ze,Se));ge.push(Se)}interpolateGap(ge,he.get(we[Me]).get(ze),he.get(we[De]).get(ze),Se,ve[Se])}ge.set(ze,De)}}}}return he}(me,he),me.extrapolateOverMembers=he=>function extrapolateGroup(he,ge){const{fields:me=he.fields,sizeLimit:be,indexLimit:ve,ammendNewRow:_e=(he=>he)}=ge,xe=[...he.keys()],[we,Me]=null!=ve?ve:[0,xe.length-1],Se=relativeComplement(me,he.values().next().value.fields);Se.push(Symbol.for("key"));const De=he.copy();function copyOrCreate(he,ge,me){let be=he.getByStr(ge);return void 0!==be?Symbol.for("extrapolated")in be||(be=assign({},be),be[Symbol.for("extrapolated")]={},he.setByStr(ge,be)):(be=Object.assign(pickGetters(me,Se),De.keyObject(he)),_e(be),be[Symbol.for("extrapolated")]={},he.setByStr(ge,be)),be}for(const he of me){const ge=new Map;for(let me=we;me<Me+1;me++){const ve=xe[me],_e=De.get(ve);for(const ve of _e.keys()){const Me=_e.getByStr(ve);if(null!=Me[he]){if(!ge.has(ve)&&me>0){const ge=Math.max(we,me-be);doExtrapolate(getFrames(De,ge,me,xe),Me,he,copyOrCreate)}ge.set(ve,me)}}}for(const me of ge.keys()){const ve=ge.get(me);if(ve===Me)continue;const _e=De.get(xe[ve]),we=Math.min(Me+1,ve+1),Se=Math.min(Me+1,we+be);doExtrapolate(getFrames(De,we,Se,xe),_e.getByStr(me),he,copyOrCreate)}}return De}(me,he),me.copy=()=>me.map((he=>he.copy())),me.flatten=he=>flatten(me,he),me.extent=(he,ge,be)=>extent(me,he,ge,be),me.keyExtent=()=>function extentOfGroupKey(he){if(he.key.length>1)throw"Can't get group key extent if key size is > 1";let ge=he.key[0],me=[];return he.each((be=>{const ve=he.keyObject(be);me=minmax(ve[ge],me)})),me}(me),me.keyExtentIndices=he=>function extentIndicesOfGroupKey(he,ge){let{filter:me=(()=>!0)}=ge;if(he.key.length>1)throw"Can't get group key extent if key size is > 1";let be,ve,_e,xe,we=he.key[0],Me=0;return he.each((ge=>{if(me(ge)){const me=he.keyObject(ge)[we];null!=me&&(void 0===_e?me>=me&&(_e=xe=me,be=ve=Me):(_e>me&&(_e=me,be=Me),xe<me&&(xe=me,ve=Me)))}Me++})),[be,ve]}(me,he),me.extentOfGroupKeyPerMarker=he=>extentOfGroupKeyPerMarker(me,he),me.groupBy=he=>{for(let[ge,be]of me){const ge=me.keyObject(be),ve=be.groupBy(he);"DataFrame"===be.type&&me.set(ge,ve)}return me.descendantKeys.push(he),me},me.createMember=he=>function createMember(he,ge){const me=1===he.descendantKeys.length?ze([],he.descendantKeys[0]):DataFrameGroup([],he.descendantKeys[0],he.descendantKeys.slice(1));return he.set(ge,me),me}(me,he),me.toJSON=()=>mapToObject(me),me.rows=function*(){let he,ge;for(he of me.values())for(ge of he.rows())yield ge},me.filterGroups=function(he){let ge=arguments.length>1&&void 0!==arguments[1]&&arguments[1],be=ge?me:DataFrameGroup([],me.key,me.descendantKeys);for(let[ve,_e]of me){const xe=me.keyObject(_e),we=_e.filterGroups(he,ge),Me=he(we,ve);!ge&&Me&&be.set(xe,we),ge&&!Me&&be.delete(ve)}return be},me.set=(he,ge)=>{be.set(ge,he);const _e=me.keyFn(he);return ve(_e,ge)},me.setRow=(he,ge)=>getDataFrame(me,he).set(he,ge),me.batchSetRow=he=>{var ge;const be=me.descendantKeys;if((null===(ge=he.key)||void 0===ge?void 0:ge.length)>0&&arrayEquals$1(he.key,be[be.length-1]))for(let ge of he.values())getDataFrame(me,ge).setByStr(ge[Symbol.for("key")],ge);else for(let ge of he.values())getDataFrame(me,ge).set(ge);return me},me}function mapCall(he,ge){return function(){let me=DataFrameGroup([],he.key,he.descendantKeys);for(let[be,ve]of he){const be=he.keyObject(ve);me.set(be,ve[ge](...arguments))}return me}}function getDataFrame(he,ge){if("DataFrame"==he.type)return he;let me;if(ge){const be=pick(ge,he.key),ve=he.keyFn(be);me=he.has(ve)?he.get(ve):he.createMember(be)}else me=he.values().next().value;return getDataFrame(me,ge)}function flatten(he,ge){for(let me of he.values())"Group"==me.type?ge=flatten(me,ge):ge?ge.batchSet(me):ge=ze(me,me.key);return ge}function groupByWithMultiGroupMembership(he,ge){return function DataFrameMultiGroup(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Array.isArray(me)||(me=[[me]]),Array.isArray(me[0])||(me=[me]),Array.isArray(ge)||(ge=[ge]),0===me.length&&he.key&&(me=[he.key]);const be=createGroup(ge,me);return be.setRow=(he,ge)=>getDataFrameMultiGroup(be,he).map((me=>me.set(he,ge))),be.batchSetRow=he=>{var ge;const me=be.descendantKeys;if((null===(ge=he.key)||void 0===ge?void 0:ge.length)>0&&arrayEquals$1(he.key,me[me.length-1]))for(let ge of he.values())getDataFrameMultiGroup(be,ge).forEach((he=>he.setByStr(ge[Symbol.for("key")],ge)));else for(let ge of he.values())getDataFrameMultiGroup(be,ge).forEach((he=>he.set(ge)));return be},be.batchSetRow(he)}(he,ge,arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.key)}function unique$1(he,ge){he=getIter(he);const me=new Set;for(let be of he)me.add(be[ge]);return[...me]}const copy=he=>ze(he);function defaultInterpolator(he,me){return null!=he&&!isNaN(he)||"number"!=typeof me?ge.interpolate(he,me):()=>{}}const fromArray=function(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return constructDataFrame(MapStorage(he,arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.key||[]))},ze=fromArray;function constructDataFrame(he){const ge=Object.assign(he,{order:he=>order$1(ge,he),leftJoin:he=>function leftJoin(he,ge){const me=he.dataFrame,be=me.key;(ge=normalizeParams(ge)).forEach((he=>{he.sameKey=arrayEquals$1(he.dataFrame.key,be)}));const ve=ze([],be);for(let he of me.keys()){const be=me.getByStr(he),_e=cloneRow(be);for(let me of ge){const ge=me.sameKey?me.dataFrame.getByStr(he):me.dataFrame.get(be);for(let he in me.projection)for(let be of me.projection[he])_e[be]=ge[he]}ve.set(_e,he)}return ve}({dataFrame:ge},he),fullJoin:(he,me)=>fullJoin([ge,...he],me),copyColumn:(he,me)=>function copyColumn(he,ge,me){for(let be of he.values())be[me]=be[ge];return he}(ge,he,me),filter:he=>filter$1(ge,he),filterNullish:he=>function filterNullish(he,ge){let me=ge.every(isString)?function simpleNullishCheck(he){const ge=he.length;return me=>{for(let be=0;be<ge;be++)if(null==me[he[be]])return!1;return!0}}(ge):function nullishFilterSpec(he){return{$nor:makeSpec(he)};function makeSpec(he){return he.map((he=>"string"==typeof he?{$or:[{[he]:{$eq:null}},{[he]:{$eq:void 0}}]}:Object.fromEntries(Object.entries(he).map((he=>{let[ge,me]=he;return[ge,makeSpec(me)]})))))}}(ge);return filter$1(he,me)}(ge,he),project:he=>project(ge,he),addColumn:(he,me)=>function addColumn(he,ge,me){if("function"==typeof me)for(let be of he.values())be[ge]=me(be);else for(let be of he.values())be[ge]=me;return he}(ge,he,me),groupBy:(he,me)=>function groupBy(he,ge){return DataFrameGroup(he,ge,arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.key)}(ge,he,me),groupByWithMultiGroupMembership:(he,me)=>groupByWithMultiGroupMembership(ge,he,me),interpolate:()=>function interpolate(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.fields,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(let be of ge)interpolateField(he,be,me[be]);return he}(ge),interpolateTowards:(he,me,be,ve)=>function interpolateBetween(he,ge,me){let be=arguments.length>3&&void 0!==arguments[3]?arguments[3]:he.fields,ve=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const _e=ze([],he.key);let xe,we;for(const Me of he.keys()){const Se=he.getByStr(Me);if(we=ge.getByStr(Me),we){if(we!==Se){xe=Object.assign({},Se);for(let he of be)xe[he]=(ve[he]||defaultInterpolator)(Se[he],we[he])(me)}else xe=Se;_e.set(xe,xe[Symbol.for("key")])}}return _e}(ge,he,me,be,ve),reindex:he=>function reindex(he,ge){const me=function createEmptyRow(he){const ge={};for(let me of he)ge[me]=null;return ge}(he.fields),be=ze([],he.key),ve=he.key[0];for(let _e of ge){const ge={[ve]:_e},xe=he.keyFn(ge),we=he.hasByStr(xe)?he.getByStr(xe):Object.assign({},me,ge);be.setByStr(xe,we)}return be}(ge,he),fillNull:he=>function fillNull(he,ge){let me,be;if(function isNonNullObject$1(he){return!!he&&"object"==typeof he}(ge))for(me in ge){const ve=ge[me];if("function"==typeof ve)for(be of he.values())null===be[me]&&(be[me]=ve(be));else for(be of he.values())null===be[me]&&(be[me]=ve)}else for(be of he.values())for(me in be)null===be[me]&&(be[me]=ge);return he}(ge,he),copy:()=>copy(ge),differentiate:he=>function differentiate(he){let ge,me=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";for(let be of he.values()){const he=ge?be[me]-ge:0;ge=be[me],be[me]=he}return he}(ge,he),extent:(he,me,be)=>extent(ge,he,me,be),unique:he=>unique$1(ge,he),type:"DataFrame",toJSON:()=>[...ge.values()]},{filterGroups:function(he){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?ge:ge.copy()},setRow:(he,me)=>ge.set(he,me)});return ge}function filter$1(he,ge){if(!function validFilterArg(he){return he&&("function"==typeof he||Object.keys(he).length>0)}(ge))return he;const me="function"==typeof ge?ge:createFilterFn(ge),be=ze([],he.key);for(let ge of he.keys()){const ve=he.getByStr(ge);me(ve)&&be.set(ve,ge)}return be}function createFilterFn(){let he="return ";return he+=createFilterFnString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),he+=";",new Function("row",he)}function createFilterFnString(he){he=function normalizeFilter(he){return he=function implicitAnd(he){const ge=Object.keys(he);return ge.length>1?{$and:ge.map((ge=>({[ge]:he[ge]})))}:he}(he=deepclone(he)),he=function implicitEq(he){const ge=Object.keys(he)[0];return ge.startsWith("$")||"object"==typeof he[ge]||(he[ge]={$eq:he[ge]}),he}(he),he}(he);let ge=Object.keys(he)[0];if(ge.startsWith("$"))return Oe[ge](he[ge]);{const me=Object.keys(he[ge])[0];return Ce[me](ge,JSON.stringify(he[ge][me]))}}ze.fromLookups=(he,ge)=>constructDataFrame(function LookupStorage(he,ge){const me={};return me.key=ge=normalizeKey(ge),me.fields=new Set([...ge,...he.keys()]),me.data=he,me.has=he=>!0,me.get=me=>{const be={};return he.forEach(((he,ve)=>{const _e={};ge.forEach((ge=>{var be;he.has(ge)?_e[ge]=null!==(be=he.get(ge).get(me[ge]))&&void 0!==be?be:me[ge]:_e[ge]=me[ge]})),be[ve]=_e})),be},me.hasByObjOrStr=(he,ge)=>me.has(he),me.getByObjOrStr=(he,ge)=>me.get(he),me.set=(he,ge)=>{console.warn("Invalid operation. Generated dataframe does not support .set().")},me.values=()=>{console.warn("Generated dataframe .values() not implemented yet")},me.delete=()=>{console.warn("Invalid operation. Generated dataframe does not support .delete()")},me[Symbol.iterator]=function*generate(){console.warn("Invalid operation. Generated dataframe iterator not yet implemented.")},me}(he,ge)),ze.fromArray=fromArray;const Oe={$not:he=>"!".concat(createFilterFnString(he)),$and:he=>"(".concat(he.map(createFilterFnString).join(" && "),")"),$or:he=>"(".concat(he.map(createFilterFnString).join(" || "),")"),$nor:he=>"!(".concat(he.map(createFilterFnString).join(" || "),")")},Ce={$eq:(he,ge)=>'row["'.concat(he,'"] == ').concat(ge),$ne:(he,ge)=>'row["'.concat(he,'"] != ').concat(ge),$gt:(he,ge)=>'row["'.concat(he,'"] > ').concat(ge),$gte:(he,ge)=>'row["'.concat(he,'"] >= ').concat(ge),$lt:(he,ge)=>'row["'.concat(he,'"] < ').concat(ge),$lte:(he,ge)=>'row["'.concat(he,'"] <= ').concat(ge),$in:(he,ge)=>"".concat(ge,'.includes(row["').concat(he,'"])'),$nin:(he,ge)=>"!".concat(ge,'.includes(row["').concat(he,'"])')},isNumeric=he=>!isNaN(he)&&isFinite(he);function isString(he){return"string"==typeof he||he instanceof String}function isModel(he){return isNonNullObject(he)&&"config"in he}function mode(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((he,ge)=>(he.c[ge]=he.c[ge]?he.c[ge]+1:1,he.max=he.max?he.max<he.c[ge]?ge:he.max:ge,he)),{c:{}}).max}function intersect(he,ge){return he.filter((he=>ge.includes(he)))}function subsets(he){return he.reduce(((he,ge)=>[...he.map((he=>[...he,ge])),...he]),[[]])}function relativeComplement(he,ge){if(he.has){const me=[];for(let be of ge)he.has(be)||me.push(be);return me}return ge.filter((ge=>!he.includes(ge)))}function concatUnique(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return Array.from(new Set(ge.flat()))}function arrayEquals(he,ge){const me=intersect(he,ge);return me.length==he.length&&me.length==ge.length}function assign(he){for(var ge=arguments.length,me=new Array(ge>1?ge-1:0),be=1;be<ge;be++)me[be-1]=arguments[be];return me.forEach((ge=>{Object.defineProperties(he,Object.getOwnPropertyDescriptors(ge))})),he}function composeObj(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return assign({},...ge)}function ucFirst(he){return he.charAt(0).toUpperCase()+he.slice(1)}function moveProperty(he,ge,me,be){Object.defineProperty(me,be,Object.getOwnPropertyDescriptor(he,ge))}function renameProperty(he,ge,me){moveProperty(he,ge,he,me)}function combineStates(he){return he.some((he=>"rejected"===he))?"rejected":he.every((he=>"fulfilled"===he))?"fulfilled":"pending"}function combineStatesSequential(he){if(!he.every((he=>"function"==typeof he)))throw new Error("Every state given to combineStatesSequential should be wrapped in a getter function.");for(let ge of he){if(ge=ge(),"pending"==ge)return"pending";if("rejected"==ge)return"rejected"}return"fulfilled"}function isMergeableObject(ge){return isNonNullObject(ge)&&!function isSpecial(ge){var me=Object.prototype.toString.call(ge);return"[object RegExp]"===me||"[object Date]"===me||he.isObservableArray(ge)||function isReactElement(he){return he.$$typeof===ke}(ge)}(ge)}function isNonNullObject(he){return!!he&&"object"==typeof he}var ke="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(he,ge){return!1!==ge.clone&&ge.isMergeableObject(he)?deepmerge(function emptyTarget(he){return Array.isArray(he)?[]:{}}(he),he,ge):"[object Date]"==Object.prototype.toString.call(he)?new Date(he.getTime()):he}const overwriteMerge=(he,ge,me)=>ge;function deepmerge(he,ge,me){(me=me||{}).arrayMerge=me.arrayMerge||overwriteMerge,me.isMergeableObject=me.isMergeableObject||isMergeableObject;var be=Array.isArray(ge);return be===Array.isArray(he)?be?me.arrayMerge(he,ge,me):function mergeObject(he,ge,me){var be={};return me.isMergeableObject(he)&&Object.keys(he).forEach((function(ge){be[ge]=cloneUnlessOtherwiseSpecified(he[ge],me)})),Object.keys(ge).forEach((function(ve){me.isMergeableObject(ge[ve])&&he[ve]?be[ve]=deepmerge(he[ve],ge[ve],me):be[ve]=cloneUnlessOtherwiseSpecified(ge[ve],me)})),be}(he,ge,me):cloneUnlessOtherwiseSpecified(ge,me)}function deepclone(he){return deepmerge({},he)}function createModel(ge,me,be,ve){let _e=ve?"-"+ve:null!=be&&be.name?"-"+be.name:"",xe=he.observable(ge.nonObservable(me,be,ve),ge.decorate,{name:(ge.name||me.modelType||"base")+_e});return xe.onCreate&&xe.onCreate(),xe}function defaultDecorator(he){let{base:ge,renameProperties:me={},defaultConfig:be={},functions:ve={}}=he;Array.isArray(ve)&&(ve=assign({},...ve));const newType=function(he,ge,me){return createModel(newType,he,ge,me)};return newType.nonObservable=function(he,_e,xe){Te(he,be),delete ve.config,ge||(ge=(he,ge)=>({config:he,parent:ge}));const we=ge.nonObservable(he,_e,xe);for(const he in me)renameProperty(we,he,me[he]);return assign(we,ve)},newType.decorate=ge.decorate,newType}deepmerge.all=function deepmergeAll(he,ge){if(!Array.isArray(he))throw new Error("first argument should be an array");return he.reduce((function(he,me){return deepmerge(he,me,ge)}),{})};const Te=he.action("applyDefaults",(function applyDefaults(he,ge){return Object.keys(ge).forEach((me=>{he.hasOwnProperty(me)?isMergeableObject(ge[me])&&isMergeableObject(he[me])&&applyDefaults(he[me],ge[me]):isMergeableObject(ge[me])?he[me]=deepclone(ge[me]):he[me]=ge[me]})),he}));function equals(he,ge){return he instanceof Date&&ge instanceof Date?he.getTime()===ge.getTime():he===ge}function clamp(he,ge,me){return Array.isArray(ge)&&([ge,me]=ge),he>me?me:he<ge?ge:he}function configValue(he,me){return he instanceof Date?null!=me&&me.format?ge.utcFormat(me.format)(he):formatDate(he):""+he}function range(he,ge,me){return interval(me).range(he,ge)}const Le=["year","month","day","week","quarter"];function interval(he){switch(he){case"year":return ge.utcYear;case"day":return ge.utcDay;case"month":return ge.utcMonth;case"week":return ge.utcMonday;case"quarter":return ge.utcMonth.every(3);default:return{offset:(he,ge)=>isNumeric(he)&&isNumeric(ge)?he+ge:console.error("Can't offset using non-numeric values",{n:he,d:ge}),range:ge.range,floor:Math.floor,ceil:Math.ceil,round:Math.round}}}function inclusiveRange(he,ge,me){return he&&ge?range(he,ge,me).concat(ge):[]}const Ae=[ge.utcParse("%Y"),ge.utcParse("%Y-%m"),ge.utcParse("%Y-%m-%d"),ge.utcParse("%Yw%V"),ge.utcParse("%Yq%q"),ge.utcParse("%Y-%m-%dT%HZ"),ge.utcParse("%Y-%m-%dT%H:%MZ"),ge.utcParse("%Y-%m-%dT%H:%M:%SZ"),ge.utcParse("%Y-%m-%dT%H:%M:%S.%LZ")];function parseConfigValue(he,me){if(!isString(he))return he;const{concept_type:be}=me;return"time"===be?function tryParse(he,ge){for(let me=0;me<ge.length;me++){let be=ge[me](he);if(be)return be}return console.warn("Could not parse time string "+he),null}(he,me.format?[ge.utcParse(me.format),...Ae]:Ae):"measure"===be?+he:""+he}function formatDate(he){var ge=he.getUTCMonth(),me=he.getUTCDate(),be=he.getUTCHours(),ve=he.getUTCMinutes(),_e=he.getUTCSeconds(),xe=he.getUTCMilliseconds();return isNaN(he)?"Invalid Date":xe?formatFullDate(he)+"T"+pad(be,2)+":"+pad(ve,2)+":"+pad(_e,2)+"."+pad(xe,3)+"Z":_e?formatFullDate(he)+"T"+pad(be,2)+":"+pad(ve,2)+":"+pad(_e,2)+"Z":ve||be?formatFullDate(he)+"T"+pad(be,2)+":"+pad(ve,2)+"Z":1!==me?formatFullDate(he):ge?formatYear(he.getUTCFullYear())+"-"+pad(he.getUTCMonth()+1,2):formatYear(he.getUTCFullYear())}function formatFullDate(he){return formatYear(he.getUTCFullYear())+"-"+pad(he.getUTCMonth()+1,2)+"-"+pad(he.getUTCDate(),2)}function formatYear(he){return he<0?"-"+pad(-he,6):he>9999?"+"+pad(he,6):pad(he,4)}function pad(he,ge){var me=he+"",be=me.length;return be<ge?new Array(ge-be+1).join(0)+me:me}const Ee=setTimeout,sleep=he=>new Promise((ge=>setTimeout(ge,he)));function compose2(he,ge){return function(){return he(ge(...arguments))}}function stableStringifyObject(he){return JSON.stringify(canonicalObject(he))}function canonicalObject(he){return isNonNullObject(he)?Object.keys(he).sort().map((ge=>({[ge]:canonicalObject(he[ge])}))):he}const sortDateSafe=(he,ge)=>he>ge?1:he<ge?-1:0;function filterObject(he,ge){let me,be={};for(me in he)he.hasOwnProperty(me)&&ge(he[me],me)&&(be[me]=he[me]);return be}function createConceptFilterFn(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 0==Object.keys(he)?()=>!0:createFilterFn(he)}function createSpaceFilterFn(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ge=arguments.length>1?arguments[1]:void 0;if(0==Object.keys(he))return()=>!0;const me=createFilterFn(he),be=ge.source;return function filter(he){return he.map((he=>"object"!=typeof he?be.getConcept(he):he)).every(me)}}function pickGetters(he,ge){const me={};for(const be of ge)be in he&&Object.defineProperty(me,be,Object.getOwnPropertyDescriptor(he,be));return me}function getConceptsCatalog(he,ge,me){const be=[],ve={},_e=ge.source;for(const xe of he){const he=_e.getConcept(xe);if(ve[xe]={concept:he},_e.isEntityConcept(xe)){const he=_e.availability.data.map((he=>he.value)).filter((he=>he.includes("is--")||"un_state"==he)),we=ge.createQuery({space:[xe],concept:["name","rank",...he],locale:ge.locale,filter:null,source:_e});if(be.push(_e.query(we).then((he=>{ve[xe].entities=he.forQueryKey()}))),me&&me>0){const he=getConceptsCatalog(_e.availability.keyValueLookup.get(xe).keys(),ge,me-1);be.push(he.then((he=>{ve[xe].properties=he})))}}}return Promise.all(be).then((()=>ve))}function removeOnce(he,ge){let me=he.indexOf(ge);return me>-1&&he.splice(me,1),he}function stepBeforeInterpolator(he,ge){if("object"==typeof he){const me=JSON.stringify(he),be=JSON.stringify(ge);return he=>JSON.parse(he<1?me:be)}return me=>me<1?he:ge}var je=Object.freeze({__proto__:null,isNumeric:isNumeric,isString:isString,isEntityConcept:function isEntityConcept(he){return["entity_set","entity_domain"].includes(he.concept_type)},isModel:isModel,isDataSource:function isDataSource(he){return isModel(he)&&"dataSource"==he.type},isDataConfig:function isDataConfig(he){return isModel(he)&&"dataConfig"==he.type},isFilter:function isFilter(he){return isModel(he)&&"filter"==he.type},mapToObj:function mapToObj(he){const ge={};return he.forEach(((he,me)=>{ge[me]=he})),ge},mode:mode,intersect:intersect,isProperSubset:function isProperSubset(he,ge){const me=intersect(he,ge);return me.length==he.length&&me.length!=ge.length},subsets:subsets,relativeComplement:relativeComplement,concatUnique:concatUnique,arrayEquals:arrayEquals,assign:assign,composeObj:composeObj,ucFirst:ucFirst,getBoundGetter:function getBoundGetter(he,ge){return Object.getOwnPropertyDescriptor(he,ge).get.bind(he)},moveProperty:moveProperty,renameProperty:renameProperty,fromPromiseAll:function fromPromiseAll(he){const ge=Array.isArray(he)?he:Object.values(he);return ge.every((he=>"fulfilled"==he.state))?fromPromise.resolve(he):ge.some((he=>"rejected"==he.state))?fromPromise.reject(he):fromPromise(((he,ge)=>{}))},combineStates:combineStates,combineStatesSequential:combineStatesSequential,isMergeableObject:isMergeableObject,isNonNullObject:isNonNullObject,deepmerge:deepmerge,deepclone:deepclone,createModel:createModel,defaultDecorator:defaultDecorator,applyDefaults:Te,equals:equals,clamp:clamp,configValue:configValue,range:range,POSSIBLE_INTERVALS:Le,interval:interval,inclusiveRange:inclusiveRange,parseConfigValue:parseConfigValue,autoFormat:function autoFormat(he){return he instanceof Date?formatDate(he):""+he},defer:Ee,sleep:sleep,compose:function compose(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return ge.reduce(compose2)},pipe:function pipe(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return ge.reduceRight(compose2)},stableStringifyObject:stableStringifyObject,sortDateSafe:sortDateSafe,getOrCreate:function getOrCreate(he,ge,me){let be;return he.has(ge)?be=he.get(ge):(be=me(),he.set(ge,be)),be},filterObject:filterObject,createConceptFilterFn:createConceptFilterFn,createSpaceFilterFn:createSpaceFilterFn,pickGetters:pickGetters,getConceptsCatalog:getConceptsCatalog,removeOnce:removeOnce,lazyAsync:function lazyAsync(ge,me,be){let ve;const _e=he.onBecomeObserved(me,be,(()=>{ve=he.autorun(ge)})),xe=he.onBecomeUnobserved(me,be,(()=>{ve()}));return()=>{var he;_e(),xe(),null===(he=ve)||void 0===he||he()}},isIterable:function isIterable(he){return null!=he&&"function"==typeof he[Symbol.iterator]},stepBeforeInterpolator:stepBeforeInterpolator});const defaultType=ge=>he.observable({config:ge});defaultType.nonObservable=he=>({config:he});const createStore=function(){let ge=arguments.length>0&&void 0!==arguments[0]?arguments[0]:defaultType,me=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return he.observable({modelTypes:{baseType:ge,...me},models:{},addType:function(he,ge){this.modelTypes[he]&&console.warn("Adding model type "+he+" failed. Type already exists",this),this.modelTypes[he]=ge},create:he.action("create",(function(he,ge,me){const be=(this.modelTypes[he.modelType]||this.modelTypes.baseType)(...arguments);return me&&this.set(me,be),be})),createMany:he.action("createMany",(function(he){const ge={};for(let me in he)ge[me]=this.create(he[me],null,me);return ge})),has:function(he){return he in this.models},get(he,ge,me){return isString(he)?this.models[he]:isModel(he)?he:this.create(he,ge,me)},getAll:function(){return Object.values(this.models)},set:he.action("set",(function(he,ge){return this.models[he]=ge})),dispose:he.action("dispose",(function(he){this.models[he].dispose(),delete this.models[he]})),disposeAll:he.action("disposeAll",(function(){for(let he in this.models)this.models[he].dispose();for(let he in this.models)delete this.models[he]}))},{models:he.observable.shallow})},Re={applyConfig:he.action("applyConfig",(function(he){return this.config=deepmerge(this.config,he),this}))};function inlineReader(he){let ge,me;return he=Promise.resolve(he).then((he=>{var ge;return he.keyConcepts=null!==(ge=he.keyConcepts)&&void 0!==ge?ge:[],he})),{async read(be){ge||(ge=he.then(parseValues));let ve=await ge;return function isConceptQuery(he){return"from"in he&&"concepts"==he.from}(be)&&(me||(me=await ge.then(getConcepts).then((he=>ze(he,["concept"])))),ve=await me),function isSchemaQuery(he){return"from"in he&&he.from.endsWith(".schema")}(be)&&(ve=ze(function getSchema(he,ge){if("datapoints.schema"==ge)return relativeComplement(he.key,[...he.fields]).map((ge=>({key:[...he.key],value:ge})));if("concepts.schema"==ge)return[{key:["concept"],value:"concept_type"}];if("entities.schema"==ge){const ge=getConceptTypes(he),me=he.key.filter((he=>"time"!==ge.get(he))).map((he=>({key:[he],value:he})));return he.fields.includes("name")&&me.push({key:[he.key[0]],value:"name"}),me}console.warn("Invalid schema query `from` clause: ",ge)}(ve,be.from),["key","value"])),function applyQuery(he,ge){const{select:me,from:be,where:ve,order_by:_e,join:xe}=ge,{key:we,value:Me}=me,Se=[...we,...Me];if("join"in ge){console.warn('Inline reader does not handle joins as it has only one table. Sections of "where" statement that refer to joins will be ignored.',{query:ge});for(let he in ve)Object.keys(xe).includes(ve[he])&&delete ve[he]}relativeComplement([...he.fields],Se).length>0&&console.error("Concepts found in query.select which are not in data",{query:ge,dataFields:he.fields});let De=he.filter(ve).project(Se).order(_e);return arrayEquals(De.key,me.key)||(De=ze(De,me.key)),De}(ve,be)},getAsset(he){console.warn("Inline reader does not support assets",{assetId:he})},async getDefaultEncoding(){const{keyConcepts:me}=await he,be=await ge,ve={};return be.fields.forEach((he=>{ve[he]={concept:he,space:me}})),ve}}}function parseValues(he){let{values:me,dtypes:be,keyConcepts:ve}=he;return ze(function makeParser(he){const me=function parserFromDtypes(he){if("auto"==he)return ge.autoType;const me={};let be;for(be in he){const ve=he[be];let _e;ve in Fe&&(_e=Fe[ve]),isNonNullObject(ve)&&"timeFormat"in ve&&(_e=ge.utcParse(ve.timeFormat)),_e||(console.warn("Unknown data type given, fall back to identity parser.",ve),_e=he=>he),me[be]=_e}return he=>{let ge,be;for(be in he)(ge=me[be])&&(he[be]=ge(he[be]))}}(he);return function parseTable(he){let ge;for(ge of he)me(ge);return he}}(be)(me),ve)}function getConcepts(he){const ge=getConceptTypes(he);return[...he.fields].map((he=>({concept:he,concept_type:ge.get(he)})))}const Fe={string:he=>he,number:he=>+he,boolean:he=>"1"==he||"true"==he.toLowerCase(),auto:function autoParse(he){var ge;return(he=he.trim())?"true"===he?he=!0:"false"===he?he=!1:"NaN"===he?he=NaN:isNaN(ge=+he)?/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/.test(he)&&(he=new Date(he)):he=ge:he=null,he},time:he=>4==(""+he).length?Fe.year(he):7==he.length&&"-"==he[4]?Fe.month(he):10==he.length?Fe.day(he):"w"==he[4].toLowerCase()?Fe.week(he):"q"==he[4].toLowerCase()?Fe.quarter(he):void 0,year:ge.utcParse("%Y"),month:ge.utcParse("%Y-%m"),day:ge.utcParse("%Y-%m-%d"),week:ge.utcParse("%Yw%V"),quarter:ge.utcParse("%Yq%q")};function getConceptTypes(he){const ge=new Map,[me]=he.values();for(let be in me)ge.set(be,getConceptType(me[be],be,he.key));for(let[me,be]of ge){const ve=validateConceptType(he,me,be);ve?"null"===be&&ge.set(me,ve!==be?ve:void 0):(console.warn("Field "+me+" is not consistently typed "+be),ge.set(me,"mixed"))}return ge}function validateConceptType(he,ge,me){let be;for(let ve of he.values())if(be=getConceptType(ve[ge],ge,he.key),me!==be)if("null"===me)me=be;else if("null"!==be)return!1;return me}function getConceptType(he,ge,me){if(null===he)return"null";if(isDate(he))return"time";if(me.includes(ge))return"entity_domain";const be=typeof he;return"string"==be?"string":"boolean"==be?"boolean":"number"==be||isNumber(he)?"measure":void console.warn("Couldn't decide type of value",{value:he,field:ge,datakey:me})}const isDate=he=>he instanceof Date,isNumber=he=>!!he&&"object"==typeof he&&"[object Number]"===Object.prototype.toString.call(he);function guessDelimiter(he,ge){const me=function _getRows(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const me=/([^\r\n]+)/g,be=[];let ve,_e=0;do{ve=me.exec(he),ve&&ve.length>1&&(++_e,be.push(ve[1]))}while(ve&&_e!==ge);return be}(he.replace(/"[^\r]*?"/g,""),2);if(2!==me.length)return{error:ge.NOT_ENOUGH_ROWS_IN_FILE};const[be,ve]=me,_e=_countCharsInLine(be,","),xe=_countCharsInLine(be,";"),we=_countCharsInLine(ve,","),Me=_countCharsInLine(ve,";");return _checkDelimiters(_e,we,xe,Me)?",":_checkDelimiters(xe,Me,_e,we)?";":{error:ge.UNDEFINED_DELIMITER}}function _checkDelimiters(he,ge,me,be){return he===ge&&he>1&&(me!==be||!me&&!be||he>me&&ge>be)}function _countCharsInLine(he,ge){const me=new RegExp(ge,"g"),be=he.match(me);return be?be.length:0}const Ie="indicator",Pe=["time","year","month","day","week","quarter"],Ne=["name","title"],Be="https://docs.google.com/spreadsheets/",qe={WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders",DIFFERENT_SEPARATORS:"reader/error/differentSeparators",FILE_NOT_FOUND:"reader/error/fileNotFoundOrPermissionsOrEmpty",REPEATED_KEYS:"reader/error/repeatedKeys"};function csvReader(he,me){let{path:be="data.csv",sheet:ve="",externalTextReader:_e,externalJsonReader:xe,hasNameColumn:we=!1,isTimeInColumns:Me=!1,assetsPath:Se="",delimiter:De="",keyConcepts:ze,nameColumnIndex:Oe,dtypes:Ce}=he,ke={};const Te=be+ve;return be=function _googleSpreadsheetURLAdaptor(he,ge){if(!he.includes(Be)||he.includes("tqx=out:csv")||he.includes("/pub?"))return he;{const me=he.split(Be)[1].split("/"),be=me[me.indexOf("d")+1];return Be+"d/"+be+"/gviz/tq?tqx=out:csv"+(ge?"&sheet="+encodeURI(ge.toLowerCase()):"")}}(be,ve),Object.assign(inlineReader(getValues().then((he=>{let{values:ge,dtypes:me,keyConcepts:be}=he;return{values:ge,keyConcepts:be,dtypes:me}}))),{getDatasetInfo:function getDatasetInfo(){return{name:ve?(me?me+": ":"")+ve:be.split("/").pop()}},getAsset:function getAsset(he){const me=Se+he;return(xe||ge.json)(me).catch((he=>{throw he.name=qe.FILE_NOT_FOUND,he.message="No permissions, missing or empty file: ".concat(me),he.endpoint=me,he}))},getValues:getValues});function getValues(){return ke[Te]?ke[Te]:ke[Te]=function loadFile(){return(_e||ge.text)(be).catch((he=>{throw he.name=qe.FILE_NOT_FOUND,he.message="No permissions, missing or empty file: ".concat(be),he.endpoint=be,he}))}().then(guessDelim).then(parseTextToTable).then(removeEmptyRows).then(transformNameColumn).then(transformTimeInColumns).then(returnValuesDtypesAndKeyConcepts)}function guessDelim(he){if(De||(De=guessDelimiter(he,qe)),De.error)throw makeError(De.error);return he}function parseTextToTable(he){const me=ge.dsvFormat(De).parse(he,(he=>Object.values(he).every((he=>!he))?null:he)),be=me.columns.filter((he=>""!==he));return{rows:me,columns:be}}function removeEmptyRows(he){let{rows:ge,columns:me}=he;return ge=ge.filter((he=>!Object.values(he).every((he=>!he||"\n"===he)))),{rows:ge,columns:me}}function transformNameColumn(he){var ge;let{rows:me,columns:be}=he;if(Oe=null!==(ge=Oe)&&void 0!==ge?ge:Ne.map((he=>be.indexOf(he))).find((he=>he>-1)),we&&null!=Oe){const he=be.splice(Oe,1),ge=guessKeyConcepts(be,ze).length;be=be.slice(0,ge).concat(he).concat(be.slice(ge))}return{rows:me,columns:be}}function transformTimeInColumns(he){let{rows:ge,columns:me}=he;if(Me)try{return function timeInColumns(he,ge,me){let{columns:be,rows:ve,hasNameColumn:_e,timeKey:xe="time",keySize:we=1}=he,Me=null;_e&&(Me=be.splice(we+1,1)[0]||"name");const Se=me&&me[xe]&&!!me[xe](be[we]);Se&&console.warn("Indicator column is missed.");const De=Se?Ie:be[we],ze=be.slice(0,we).concat(xe).concat(Me||[]).concat(Se?ucFirst(Ie):ve.reduce(((he,ge)=>{const me=ge[De];return!he.includes(me)&&me&&he.push(me),he}),[])),Oe=ze.slice(we+1+(Me?1:0)),[Ce]=ze;return{columns:ze,rows:ve.reduce(((he,me)=>{const be=me[Ce],ve=he.filter((he=>he[Ce]===be));if(ve.length){if(null!==ve[0][me[De]])throw{name:ge.REPEATED_KEYS,message:"indicator: ".concat(me[De],", key: ").concat(me[Ce])};ve.forEach((he=>{he[me[De]]=me[he[xe]]}))}else Object.keys(me).forEach((ge=>{if(![Ce,De,Me].includes(ge)){const be={[Ce]:me[Ce],[xe]:ge},ve=Me?{[Me]:me[Me]}:{},_e=Oe.reduce(((he,be)=>(he[be]=Se||me[De]===be?me[ge]:null,he)),{});he.push(Object.assign(be,ve,_e))}}));return he}),[])}}({rows:ge,columns:me},qe)}catch(he){throw makeError(he)}return{rows:ge,columns:me}}function returnValuesDtypesAndKeyConcepts(he){let{rows:me,columns:be}=he;const ve=function autotype(he){return he.map((he=>ge.autoType(he)))}(me);return{values:ve,keyConcepts:guessKeyConcepts(be,ze),columns:be,dtypes:be.reduce(((he,ge)=>{const me=ge.toLowerCase();return!Pe.includes(me)||ve[0][ge]instanceof Date||(he[ge]=me),he}),{})}}function guessKeyConcepts(he,ge){if(ge)return ge;const me=he.findIndex((he=>Pe.includes(he.toLowerCase())));return he.slice(0,me+1)}function makeError(he){return delete ke[Te],he}}function makeCache(){const he=new Map,makeKey=function(he){return stableStringifyObject(he)},set=function(ge,me){ge.select.value.length>1&&splitQuery(ge).map((he=>set(he,me)));const be=makeKey(ge);return he.set(be,me)},splitQuery=function(he){return he.select.value.map((ge=>{const me=deepclone(he);return me.select.value=[ge],me}))};return{has:function(ge){return he.has(makeKey(ge))},get:function(ge){return he.get(makeKey(ge))},set:set}}const Ue={path:null,sheet:null,keyConcepts:null,values:null,transforms:[]};function dataSource(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(dataSource,...ge)}dataSource.nonObservable=function(ge,me,be){Te(ge,Ue);const ve={get path(){return this.config.path},get sheet(){return this.config.sheet},get keyConcepts(){return this.config.keyConcepts},get locale(){if(this.config.locale)return"string"==typeof this.config.locale?this.config.locale:this.config.locale.id},get dtypes(){return this.config.dtypes},get reader(){return this.values?inlineReader({values:this.values,keyConcepts:this.keyConcepts,dtypes:this.dtypes}):this.path?csvReader(this.config,this.id):void console.warn("No inline values or csv path found. Please set `values` or `path` property on dataSource.",this)},get values(){return he.toJS(this.config.values)},get defaultEncodingPromise(){return"getDefaultEncoding"in this.reader?fromPromise(this.reader.getDefaultEncoding()):fromPromise.resolve({})},get defaultEncoding(){const he={};return this.defaultEncodingPromise.case({fulfilled:he=>(Object.values(he).forEach((he=>he.source=this)),he),pending:()=>(console.warn("Requesting default encoding before loaded. Will return empty. Recommended to await promise."),he),error:ge=>(console.warn("Requesting default encoding when loading errored. Will return empty. Recommended to catch exception."),he)})},buildAvailability(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const ge=new Map,me=new Map,be=new Map,ve=[],getFromMap=(he,ge,me)=>(he.has(ge)||he.set(ge,me()),he.get(ge)),newSet=()=>new Set,newMap=()=>new Map;return he.forEach((he=>{he=he.forQueryKey().values();for(let _e of he){let he;_e.key=Array.isArray(_e.key)?_e.key:JSON.parse(_e.key).sort(),he=createKeyStr(_e.key),ve.push(_e),me.set(he,_e.key),getFromMap(ge,he,newMap).set(_e.value,_e),getFromMap(be,_e.value,newSet).add(_e.key)}})),{valueLookup:be,keyValueLookup:ge,keyLookup:me,data:ve}},get availabilityPromise(){return this.fetchAvailability()},fetchAvailability(){return fromPromise(Promise.all(["concepts","entities","datapoints"].map((he=>this.query({select:{key:["key","value"],value:[]},from:he+".schema"})))).then(this.buildAvailability))},get availabilityState(){if("rejected"==this.availabilityPromise.state)throw this.availabilityPromise.value;return this.availabilityPromise.state},get availability(){let he=this.buildAvailability();return this.availabilityPromise.case({fulfilled:he=>he,pending:()=>(console.warn("Requesting availability before availability loaded. Will return empty. Recommended to await promise."),he),rejected:ge=>(console.warn("Requesting availability when loading errored. Will return empty. Recommended to catch exception."),he)})},get conceptsPromise(){return this.fetchConcepts()},fetchConcepts(){const he=this.locale;return fromPromise(this.availabilityPromise.then((ge=>{const me=createKeyStr(["concept"]),be={select:{key:["concept"],value:[...ge.keyValueLookup.get(me).keys()]},from:"concepts"};return he&&(be.language=he),this.query(be)})))},get conceptsState(){if("rejected"==this.conceptsPromise.state)throw this.conceptsPromise.value;return this.conceptsPromise.state},get concepts(){const he=new Map;return this.conceptsPromise.case({fulfilled:he=>he.forQueryKey(),pending:()=>(console.warn("Requesting concepts before loaded. Will return empty. Recommended to await promise."),he),rejected:ge=>(console.warn("Requesting concepts when loading errored. Will return empty. Recommended to catch exception."),he)})},get state(){return combineStates([this.availabilityState,this.conceptsState])},getConcept(he){return"concept_type"==he||0===he.indexOf("is--")||"concept"===he?{concept:he,name:he}:(this.concepts.size&&!this.concepts.has({concept:he})&&console.warn("Could not find concept "+he+" in data source ",this),this.concepts.get({concept:he})||{})},isEntityConcept(he){return["entity_set","entity_domain"].includes(this.getConcept(he).concept_type)},isTimeConcept(he){return"time"===this.getConcept(he).concept_type},normalizeResponse(he,ge){const me={};function forKey(ge){var be;const ve=createKeyStr(ge);return null!==(be=me[ve])&&void 0!==be?be:me[ve]=ze(he,ge)}return isDataFrame(he)?me[createKeyStr(he.key)]=he:1==he.length&&0==Object.keys(he[0]).length&&he.pop(),{raw:isDataFrame(he)?[...he.values()]:he,forKey:forKey,forQueryKey:function forQueryKey(){return forKey(ge.select.key)}}},query(he){return he=function dotToJoin(he){const ge=he.where&&Object.keys(he.where);if(!ge||0==ge.length)return he;const me=he.where,be=deepmerge({},he);return ge.forEach((he=>{const ge=he.split(".");if(ge.length>1){const[ve,_e]=ge,xe=me[he],we="$"+ve;be.join||(be.join={}),be.join[we]?be.join[we].where[_e]=xe:(be.join[we]={key:ve,where:{[_e]:xe}},be.where[ve]&&(be.join[we].where[ve]=be.where[ve]),be.where[ve]=we),delete be.where[he]}})),be}(he),he=function addExplicitAnd(he){const ge=he.where&&Object.keys(he.where);if(!ge||ge.length<2)return he;const me=deepmerge({},he);return me.where={$and:[]},ge.forEach((ge=>{me.where.$and.push({[ge]:he.where[ge]})})),me}(he),this.combineAndSendQueries(he)},cache:makeCache(),queue:new Map,combineAndSendQueries(he){if(this.cache.has(he))return this.cache.get(he);const ge=this.calcCombineId(he);if(this.queue.has(ge)){const{baseQuery:me,promise:be}=this.queue.get(ge);return me.select.value=concatUnique(me.select.value,he.select.value),this.cache.set(me,be),be}{const me=deepclone(he),be=fromPromise(this.sendDelayedQuery(me));return this.queue.set(ge,{baseQuery:me,promise:be}),this.cache.set(me,be),be}},async sendDelayedQuery(he){const ge=this.reader;await sleep();const me=this.calcCombineId(he);this.queue.delete(me);const be=await ge.read(he);return this.normalizeResponse(be,he)},_getDrillupCatalog(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.concepts;const ge=[],me={},be="drill_up";for(const ve of this.availability.keyLookup.values())if(1==ve.length&&this.isEntityConcept(ve[0])){const _e=ve[0],xe=he.get(_e);if(xe[be]){const he=xe.domain||_e;me[he]||(me[he]={});const ve=JSON.parse(xe[be]),we={select:{key:[_e],value:[...ve]},from:"entities",locale:this.locale};ge.push(this.query(we).then((ge=>{me[he][_e]=[];const xe=ge.forQueryKey();me[he][_e].push([Symbol.for(be),xe]),ve.forEach((ge=>{me[he][_e].push(...xe.groupByWithMultiGroupMembership(ge).filterGroups(((he,ge)=>""!==ge),!0).entries())})),me[he][_e]=new Map(me[he][_e])})))}}return fromPromise(Promise.all(ge).then((()=>me)))},enableDrillup:!1,get drillupCatalog(){return this.enableDrillup?this._getDrillupCatalog():fromPromise.resolve({})},drilldown(he){this.enableDrillup=!0;const ge=Array.isArray(he.entity)?he.entity:[he.entity],me=this.concepts.get(he.dim),be=me.domain?me.domain:he.dim;return this.drillupCatalog.then((he=>{const me={};for(const ve in he[be]){const _e=[];ge.forEach((ge=>{he[be][ve].has(ge)?_e.push(...[...he[be][ve].get(ge).values()].map((he=>he[ve]))):he[be][ve].get(Symbol.for("drill_up")).has(ge)&&_e.push(ge)})),_e.length&&(me[ve]=[...new Set(_e)].sort())}return Object.keys(me).length?me:null}))},drillup(he){this.enableDrillup=!0;const ge=this.concepts.get(he.dim),me=ge.domain?ge.domain:he.dim,be={};return this.drillupCatalog.then((ge=>{for(const ve in ge[me]){const _e=Object.assign({},ge[me][ve].get(Symbol.for("drill_up")).get(he.entity)||{});delete _e[ve],delete _e[Symbol.for("key")],Object.assign(be,_e)}return be}))},calcCombineId(he){const ge=deepclone(he);return delete ge.select.value,stableStringifyObject(ge)},disposers:[],onCreate(){this.disposers.push(he.reaction((()=>"fulfilled"==this.state?this.drillupCatalog:{}),(()=>{})))},dispose(){let he;for(;he=this.disposers.pop();)he()}};return assign({},ve,Re,{config:ge,id:be,type:"dataSource"})},dataSource.decorate={config:he.observable.shallow,queue:he.observable.ref,cache:he.observable.ref};const He=createStore(dataSource);function resolveRef(ge){let me=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ln;if(!isReference(ge))return{state:"fulfilled",value:ge};let be=isString(ge.ref)?{path:ge.ref}:ge.ref;be.path||console.warn("Invalid reference, expected string reference in ref or ref.path",ge);const ve=function resolveTreeRef(he,ge){const me=he.split(".");let be,ve=ge;for(let ge=0;ge<me.length;ge++){var _e,xe,we;let Me=me[ge];if(be=ve,ve=null!==(_e=null===(xe=(we=be).get)||void 0===xe?void 0:xe.call(we,Me))&&void 0!==_e?_e:be[Me],void 0===ve)return console.warn("Couldn't resolve reference "+he),null}return{get state(){var he,ge;return null!==(he=null!==(ge=ve.state)&&void 0!==ge?ge:be.state)&&void 0!==he?he:"fulfilled"},value:ve}}(be.path,me);return ve.value=function transformModel(ge,me){var be,ve,_e,xe,we;switch(me){case"entityConcept":return he.observable({get space(){return ge.data.isConstant?[]:[ge.data.concept]},get filter(){return{dimensions:{[ge.data.concept]:{[ge.data.concept]:{$in:ge.scale.domain}}}}},get source(){return ge.data.source},get locale(){return ge.data.locale}});case"entityConceptSkipFilter":return he.observable({get space(){return ge.data.isConstant?[]:[ge.data.concept]},get source(){return ge.data.source},get locale(){return ge.data.locale}});case"orderDirection":const me=ge.parent.space[0];return he.observable((null===(be=ge.config.dimensions)||void 0===be||null===(ve=be[me])||void 0===ve||null===(_e=ve.$or)||void 0===_e||null===(xe=_e[0])||void 0===xe||null===(we=xe[me])||void 0===we?void 0:we.$in)||[]);default:return ge}}(ve.value,be.transform),ve}function isReference(he){return isNonNullObject(he)&&void 0!==he.ref}He.createAndAddType=function(he,ge){this.addType(he,defaultDecorator({base:dataSource,functions:{get reader(){const he=Object.assign({},ge);return he.init(this.config||{}),he}}}))};const Ve={},Ye={addSolveMethod:addSolveMethod,configSolution:function configSolution(he){return he.marker?he.hasEncodingMarker?he.marker.data.configSolution?he.marker.data.configSolution.encodings[he.parent.name]:{concept:void 0,space:void 0}:function markerSolution(he){const ge=he.config;return he.parent.encoding||console.warn("Can't get marker solution for a non-marker dataconfig."),needsSpaceAutoCfg(he)?he.source?autoConfigSpace(he,void 0,(ge=>findMarkerConfigForSpace(he,ge))):void console.warn("Can't autoconfigure marker space without a source defined."):findMarkerConfigForSpace(he,ge.space)}(he):encodingSolution(he)},markerSolvingState:function markerSolvingState(he){const ge=[he.data];for(const me of Object.values(he.encoding))ge.push(me.data);return combineStates(ge.flatMap(dataConfigSolvingState))},dataConfigSolvingState:dataConfigSolvingState};function addSolveMethod(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.name;Ve[ge]=he}function autoConfigSpace(he){var ge,me,be;let ve=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_e=arguments.length>2?arguments[2]:void 0;const{markerSpaceCfg:xe}=ve;let we;he.hasEncodingMarker&&xe?(we=subsets(xe).filter((ge=>he.source.availability.keyLookup.has(createKeyStr(ge)))),we=sortSpacesByPreference(we),we.unshift(xe)):(we=Array.from(he.source.availability.keyLookup.values()),we=sortSpacesByPreference(we));const Me=createSpaceFilterFn((null===(ge=he.config.space)||void 0===ge?void 0:ge.filter)||(null===(me=he.defaults.space)||void 0===me?void 0:me.filter),he),Se=(null===(be=he.allow.space)||void 0===be?void 0:be.filter)||(()=>!0);for(let he of we){let ge;if(!he.includes("concept")&&Me(he)&&Se(he)&&(ge=_e(he)))return ge}return console.warn("Could not autoconfig to a space which also satisfies further results for "+he.parent.id+".",{dataConfig:he,spaceCfg:he.config.space||he.defaults.space,availableSpaces:we,getFurtherResult:_e}),{concept:void 0,space:void 0}}function sortSpacesByPreference(he){return he.sort(((he,ge)=>he.length>1&&ge.length>1?he.length-ge.length:ge.length-he.length))}function findMarkerConfigForSpace(he,ge){let me={},be=new Set,ve=new Map;return function sortedEncodingEntries(he){return[...Object.entries(he)].sort(((he,ge)=>he[0].localeCompare(ge[0])))}(he.parent.encoding).every((he=>{let[_e,xe]=he,we=ve.has(xe.data)?ve.get(xe.data):encodingSolution(xe.data,ge,[...be]);return!!we&&(ve.set(xe.data,we),me[_e]=we,be.add(we.concept),!0)}))?{encodings:me,space:ge}:void 0}function encodingSolution(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return he.isConstant?{concept:void 0,space:void 0}:needsSpaceAutoCfg(he)?autoConfigSpace(he,{usedConcepts:me,markerSpaceCfg:ge},(be=>findConceptForSpace(he,{usedConcepts:me,markerSpaceCfg:ge},be))):needsConceptAutoCfg(he)?findConceptForSpace(he,{usedConcepts:me}):{space:"space"in he.config?he.config.space:he.defaults.space,concept:"concept"in he.config?he.config.concept:he.defaults.concept}}function findConceptForSpace(he,ge,me){let be,{usedConcepts:ve=[]}=ge;const _e=he.config.concept||he.defaults.concept;return me=me||he.config.space||he.defaults.space,needsConceptAutoCfg(he)?be=(Ve[_e.solveMethod]||defaultConceptSolver)(me,he,ve):(isReference(_e)||he.isConceptAvailableInSpace(me,_e))&&(be=_e),!!be&&{concept:be,space:me}}function defaultConceptSolver(he,ge,me){var be;const ve=ge.source,_e=ve.availability,xe=ge.config.concept||ge.defaults.concept,we=xe.filter?createFilterFn(xe.filter):()=>!0,Me=_e.keyValueLookup.get(createKeyStr(he));if(!Me)return;const Se=[...Me.keys()].filter((he=>"is--"!==he.substr(0,4))).map(ve.getConcept.bind(ve)).filter(we);return null===(be=(Ve[xe.selectMethod]||selectUnusedConcept)({concepts:Se,dataConfig:ge,usedConcepts:me,space:he}))||void 0===be?void 0:be.concept}function selectUnusedConcept(he){let{concepts:ge,usedConcepts:me}=he;return ge.find((he=>!me.includes(he.concept)))||ge[0]}function needsSpaceAutoCfg(he){const ge=he.config,me=he.defaults,be="space"in ge&&!ge.space,ve=!ge.space&&needsSolving(me.space);return!he.isConstant&&!be&&(needsSolving(ge.space)||ve)}function needsConceptAutoCfg(he){const ge=he.config,me=he.defaults,be=!he.marker,ve="concept"in ge&&!ge.concept,_e=he.hasEncodingMarker,xe=!("concept"in ge)&&needsSolving(me.concept);return!he.isConstant&&!isReference(he.config.concept)&&!ve&&(needsSolving(ge.concept)||(_e||be)&&xe)}function needsSolving(he){return isNonNullObject(he)&&!Array.isArray(he)}function dataConfigSolvingState(he){return function needsAutoConfig(he){return needsSpaceAutoCfg(he)||needsConceptAutoCfg(he)}(he)?[he.source.conceptsState]:[]}function filter(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(filter,...ge)}function cleanEmptyObjectsAndArrays(he){function notEmpty(he){return he instanceof Date||!(null==he||"object"==typeof he&&0===Object.keys(he).length||Array.isArray(he)&&0===he.length)}if(Array.isArray(he))he=he.map((he=>cleanEmptyObjectsAndArrays(he))).filter(notEmpty);else if("object"==typeof he)for(const ge in he)he[ge]=cleanEmptyObjectsAndArrays(he[ge]),notEmpty(he[ge])||delete he[ge];return he}addSolveMethod(defaultConceptSolver),addSolveMethod((function mostCommonDimensionProperty(he,ge){const me=ge.source,be=me.availability.keyValueLookup,ve=he.filter((he=>me.isEntityConcept(he))),_e=ge.config.concept||ge.defaults.concept,xe=_e.allowedProperties,we=[];for(let he of ve){let ge;const me=be.get(createKeyStr([he]));ge=me&&xe?xe.filter((he=>me.has(he))):me?me.keys():1===ve.length?[he]:[null],we.push(...ge)}return mode(we)})),addSolveMethod(selectUnusedConcept),filter.nonObservable=function(ge,me,be){return"markers"in ge||(ge.markers=[]),"dimensions"in ge||(ge.dimensions={}),{id:be,config:ge,parent:me,type:"filter",get markers(){const ge=resolveRef(this.config.markers).value||{},me=he.isObservableArray(ge)?ge.map((he=>[he,!0])):Object.entries(ge);return new Map(me)},get dimensions(){return he.toJS(this.config.dimensions)||{}},has(he){return this.markers.has(this.getKey(he))},any(){return 0!==this.markers.size},getPayload(he){return this.markers.get(this.getKey(he))},set:he.action("setFilter",(function(he,ge){if(Array.isArray(he)){for(const ge of he)this.set(ge);return}const me=this.getKey(he);this.config.markers,ge?(Array.isArray(this.config.markers)&&(this.config.markers=Object.fromEntries(this.config.markers.map((he=>[he,!0])))),this.config.markers[me]=configValue(ge)):Array.isArray(this.config.markers)?this.config.markers.includes(me)||this.config.markers.push(me):Object.keys(this.config.markers).length>0?this.config.markers[me]=!0:this.config.markers=[me]})),delete:he.action("deleteFilter",(function(he){this.deleteFromMarkers(he),this.deleteFromDimensionsAllINstatements(he)})),clear:he.action("clearFilter",(function(){this.config.markers=[]})),toggle:he.action("toggleFilter",(function(he){return this.has(he)?this.delete(he):this.set(he)})),deleteFromMarkers:he.action("deleteInMarkers",(function(he){if(Array.isArray(he)){for(const ge of he)this.deleteFromMarkers(ge);return}const ge=this.config.markers,me=this.getKey(he);return Array.isArray(ge)?removeOnce(ge,me):delete ge[me],!this.markers.has(me)})),addUsingLimitedStructure:he.action("addUsingLimitedStructure",(function(he){let{key:ge,dim:me,prop:be}=he;if(Array.isArray(ge))for(const he of ge)this.addUsingLimitedStructure({key:he,dim:me,prop:be});else this.isAlreadyRemovedUsingLimitedStructure({key:ge,dim:me,prop:be})?this.eraseItemFromClause(ge,[me,be,"$nin"]):this.writeItemToClause(ge,[me,"$or",be,"$in"])})),deleteUsingLimitedStructure:he.action("eraseItemFromClause",(function(he){let{key:ge,dim:me,prop:be}=he;if(Array.isArray(ge))for(const he of ge)this.deleteUsingLimitedStructure({key:he,dim:me,prop:be});else this.isAlreadyAddedUsingLimitedStructure({key:ge,dim:me,prop:be})?this.eraseItemFromClause(ge,[me,"$or",be,"$in"]):this.writeItemToClause(ge,[me,be,"$nin"])})),isAlreadyAddedUsingLimitedStructure:function(he){var ge,me,be,ve,_e,xe;let{key:we,dim:Me,prop:Se}=he;return null===(ge=this.config.dimensions)||void 0===ge||null===(me=ge[Me])||void 0===me||null===(be=me.$or)||void 0===be||null===(ve=be.find((he=>he[Se])))||void 0===ve||null===(_e=ve[Se])||void 0===_e||null===(xe=_e.$in)||void 0===xe?void 0:xe.includes(we)},isAlreadyRemovedUsingLimitedStructure:function(he){var ge,me,be,ve;let{key:_e,dim:xe,prop:we}=he;return null===(ge=this.config.dimensions)||void 0===ge||null===(me=ge[xe])||void 0===me||null===(be=me[we])||void 0===be||null===(ve=be.$nin)||void 0===ve?void 0:ve.includes(_e)},writeItemToClause:function(he,ge){const me=this.config.dimensions,be=this.getKey(he);let ve=!1;function findAndAddInArray(he,ge){-1!=he.indexOf(ge)||ve||(he.push(ge),ve=!0)}ge?findAndAddInArray(ge.reduce(((he,ge)=>{if(Array.isArray(he)&&!isNumeric(ge)){const me=he.find((he=>he[ge]));return me?me[ge]:(he.push({[ge]:{}}),he.at(-1)[ge])}return null==he[ge]&&(he[ge]=["$in","$or","$and","$nin"].includes(ge)?[]:{}),he[ge]}),me),be):function findAndAddInObject(he,ge,me){if("$in"===me)findAndAddInArray(he,ge);else if(Array.isArray(he))he.forEach((he=>findAndAddInObject(he,ge)));else if("object"==typeof he)for(const me in he)findAndAddInObject(he[me],ge,me)}(me,be)},eraseItemFromClause:function(he,ge){const me=this.config.dimensions,be=this.getKey(he);function findAndRemoveInArray(he,ge){const me=he.indexOf(ge);-1!==me&&he.splice(me,1)}ge?findAndRemoveInArray(ge.reduce(((he,ge)=>{if(Array.isArray(he)&&!isNumeric(ge)){const me=he.find((he=>he[ge]));return me?me[ge]:{}}return null==he[ge]&&(he[ge]=["$in","$or","$and","$nin"].includes(ge)?[]:{}),he[ge]}),me),be):function findAndRemoveInObject(he,ge,me){if("$in"===me)findAndRemoveInArray(he,ge);else if(Array.isArray(he))he.forEach((he=>findAndRemoveInObject(he,ge)));else if("object"==typeof he)for(const me in he)findAndRemoveInObject(he[me],ge,me)}(me,be),cleanEmptyObjectsAndArrays(me)},deleteFromDimensionsAllINstatements:he.action("deleteAllInDimensions",(function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$in";if(Array.isArray(he)){for(const ge of he)this.deleteFromDimensionsAllINstatements(ge);return}const me=this.config.dimensions;!function findAndRemoveInObject(he,me,be){if(be===ge)!function findAndRemoveInArray(he,ge){const me=he.indexOf(ge);-1!==me&&he.splice(me,1)}(he,me);else if(Array.isArray(he))he.forEach((he=>findAndRemoveInObject(he,me)));else if("object"==typeof he)for(const ge in he)findAndRemoveInObject(he[ge],me,ge)}(me,this.getKey(he)),cleanEmptyObjectsAndArrays(me)})),getKey:he=>isString(he)?he:he[Symbol.for("key")],whereClause(he){let ge={};const me=[];he.forEach((ge=>{if(this.dimensions[ge])for(let be in this.dimensions[ge])be==ge||he.length<2?(he.length>1||!this.parent.source.isEntityConcept(be))&&me.push({[be]:this.dimensions[ge][be]}):me.push({[ge+"."+be]:this.dimensions[ge][be]})}));const be=[];for(let[ge,me]of this.markers)arrayEquals(Object.keys(ge),he)&&be.push(ge);return be.length>0?(ge.$or=be,me.length>0&&ge.$or.push({$and:me})):me.length>0&&(ge=deepmerge.all(me)),ge}}};const We=defaultDecorator({base:filter,renameProperties:{set:"baseSet"},functions:{get encoding(){return this.parent.parent},set:he.action("setTrailFilter",(function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he[this.encoding.groupDim]||this.encoding.frameEncoding.value,me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.encoding.limits[this.getKey(he)];if(Array.isArray(he)){for(let ge of he)this.set(ge);return}const be=this.getKey(he);this.has(be)||me||(this.baseSet(be,ge),me=this.encoding.limits[be]);const ve=clamp(ge,me[0],me[1]);this.baseSet(be,ve)}))}}),Ge=createStore(filter,{trailFilter:We});function dataConfig(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(dataConfig,...ge)}function entityPropertyDataConfig(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(entityPropertyDataConfig,...ge)}function entityMembershipDataConfig(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(entityMembershipDataConfig,...ge)}dataConfig.nonObservable=function(ge,me,be){return"filter"in ge||(ge.filter={}),"allow"in ge||(ge.allow={}),{defaults:{filter:null,constant:null,concept:{filter:{concept_type:"measure"}},space:{},value:null,locale:null,source:null,domainDataSource:"auto"},config:ge,parent:me,id:be,type:"dataConfig",isFullEntitySet(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.spaceCatalog.then((me=>{if(!me[he])return!1;const be=[...new Set(ge)],ve=[],_e=me[he].properties;let xe;for(const he in _e)if("entity_set"==_e[he].concept.concept_type){xe=0;for(const ge of _e[he].entities.keys())be.includes(ge)&&xe++;xe==_e[he].entities.size&&ve.push(he)}return!!ve.length&&ve.sort()}))},get allow(){return he.observable({config:this.config.allow,parent:this,get space(){var he;return{filter:createSpaceFilterFn(null===(he=this.config.space)||void 0===he?void 0:he.filter,this.parent)}},get concept(){var he;return{filter:createConceptFilterFn(null===(he=this.config.concept)||void 0===he?void 0:he.filter)}},get source(){return this.config.source}})},get hasEncodingMarker(){return this.parent&&this.parent.marker},get marker(){if(this.hasEncodingMarker)return this.parent.marker;if(this.parent){if(this.parent.marker)return this.parent.marker;if(this.parent.encoding)return this.parent}},get source(){const he=resolveRef(this.config.source).value;return he?He.get(he,this):this.hasEncodingMarker?this.parent.marker.data.source:null},get configSolution(){return Ye.configSolution(this)},get space(){return this.configSolution.space},get spaceCatalog(){return getConceptsCatalog(this.space,this,1)},get commonSpace(){return this.hasEncodingMarker?intersect(this.space,this.parent.marker.data.space):this.marker?void console.warn("Cannot get data.commonSpace of Marker.data. Only meaningful on Encoding.data."):this.space},get concept(){return resolveRef(this.configSolution.concept).value},get conceptProps(){return this.concept&&this.source.getConcept(this.concept)},get constant(){var he;return null!==(he=resolveRef(this.config.constant).value)&&void 0!==he?he:this.defaults.constant},get isConstant(){return null!=this.constant},get hasOwnData(){return!(!this.source||!this.concept||this.conceptInSpace)},get conceptInSpace(){return this.concept&&this.space&&this.space.includes(this.concept)},isConceptAvailableInSpace(he,ge){var me;const be=this.source.availability;return he.includes(ge)||(null===(me=be.keyValueLookup.get(createKeyStr(he)))||void 0===me?void 0:me.has(ge))},get filter(){const he=resolveRef(this.config.filter).value;return Ge.get(he,this)},get locale(){var he,ge;return this.config.locale?"string"==typeof this.config.locale?this.config.locale:this.config.locale.id:this.hasEncodingMarker?this.parent.marker.data.locale||(null===(he=this.source)||void 0===he?void 0:he.locale):null===(ge=this.source)||void 0===ge?void 0:ge.locale},get availability(){return this.source.availability.data.map((he=>this.source.getConcept(he.value)))},get domainDataSource(){let he=this.config.domainDataSource||this.defaults.domainDataSource;return"auto"===he&&(he=this.hasOwnData?"self":this.conceptInSpace?"filterRequired":void 0),he},get domainData(){const he=this.domainDataSource;return"self"===he?this.response:this.hasEncodingMarker&&this.parent.marker.transformedDataMaps.has(he)?this.parent.marker.transformedDataMaps.get(he).get():"markers"===he?this.parent.marker.dataMap:this.response},get domain(){return this.isConstant?isNumeric(this.constant)?[this.constant,this.constant]:[this.constant]:this.calcDomain(this.domainData,this.conceptProps)},calcDomain(he){let{concept:ge,concept_type:me}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.conceptProps;if(he)return["measure","time"].includes(me)?extent(he.rows(),ge):unique$1(he.rows(),ge)},get configState(){var he,ge;return null!==(he=null===(ge=this.marker)||void 0===ge?void 0:ge.configState)&&void 0!==he?he:combineStates(Ye.dataConfigSolvingState(this))},get state(){const he=[()=>this.configState];this.source&&he.push((()=>this.source.conceptsState)),he.push((()=>this.responseState));const ge=combineStatesSequential(he);return"fulfilled"==ge&&"self"==this.domainDataSource&&this.domain,ge},createQuery(){let{space:he=this.space,concept:ge=this.concept,filter:me=this.filter,locale:be=this.locale,source:ve=this.source}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const _e={},xe=createKeyStr(he);return ge===this.concept&&this.conceptIsEntitySetAndItsDomainIsInSpace&&(ge=[ge,"is--"+ge]),ge=Array.isArray(ge)?ge:[ge],ge=ge.filter((he=>{var ge;return null===(ge=ve.availability.keyValueLookup.get(xe))||void 0===ge?void 0:ge.has(he)})),_e.select={key:he.slice(),value:ge},_e.from=1===he.length?"entities":"datapoints",me&&(Array.isArray(me)?_e.where=Object.assign(...me.map((he=>he.whereClause(_e.select.key)))):_e.where=me.whereClause(_e.select.key)),be&&(_e.language=be),_e},get ddfQuery(){var he,ge;return this.createQuery({filter:[null===(he=this.marker)||void 0===he||null===(ge=he.data)||void 0===ge?void 0:ge.filter,this.filter].filter((he=>null!=he))})},get response(){return this.responsePromise.value},get responsePromise(){return this.hasOwnData?this.fetchResponse():fromPromise(Promise.resolve())},get responseState(){if(this.hasOwnData){if("rejected"==this.responsePromise.state)throw this.responsePromise.value;return this.responsePromise.state}return"fulfilled"},get conceptIsEntitySetAndItsDomainIsInSpace(){return this.concept&&this.space&&"entity_set"===this.conceptProps.concept_type&&this.space.includes(this.conceptProps.domain)},responseAdaptorHack_MoveItToDSource(he){return this.conceptIsEntitySetAndItsDomainIsInSpace&&he.raw.forEach((he=>{null==he[this.concept]&&he["is--"+this.concept]&&(he[this.concept]=he[this.conceptProps.domain])})),he},fetchResponse(){return fromPromise(this.source.query(this.ddfQuery).then(this.responseAdaptorHack_MoveItToDSource.bind(this)).then((he=>he.forKey(this.commonSpace))))},createKeyFn(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.space;return createKeyFn(he)},disposers:[],onCreate(){var ge;this.disposers.push(he.reaction((()=>"fulfilled"==this.state?this.configSolution:{}),(he=>{let{space:ge,concept:me}=he;ge&&ge!=this.config.space&&!arrayEquals(ge,this.marker.data.space)&&(this.config.space=ge),me&&me!=this.config.concept&&(this.config.concept=me)}),{name:"loopback data-config-solver "+(null===(ge=this.parent)||void 0===ge?void 0:ge.id),onError:he=>this.internalErrors.push(he)}))},internalErrors:[],dispose(){for(const he of this.disposers)he()}}},dataConfig.decorate={space:he.computed.struct,commonSpace:he.computed.struct},entityPropertyDataConfig.nonObservable=function(he,ge){"concept"in he||(he.concept={solveMethod:"mostCommonDimensionProperty",allowedProperties:["name","title"]});const me=dataConfig.nonObservable(he,ge);return composeObj(me,{iterableResponse:!1,get space(){var he;return null===(he=me.space)||void 0===he?void 0:he.filter((he=>!this.source.isTimeConcept(he)))},get queries(){const he=this.source.availability.keyValueLookup;return this.space.filter((ge=>{var me;return null===(me=he.get(ge))||void 0===me?void 0:me.has(this.concept)})).map((he=>this.createQuery({space:[he]})))},isConceptAvailableInSpace:(he,ge)=>!0,lookups(he,ge){const me=new Map;return he.forEach((he=>{const{dim:be,data:ve}=he,_e=new Map;me.set(be,_e);for(const he of ve.raw)_e.set(he[be],he[ge])})),new Map([[ge,me]])},get domain(){},fetchResponse(){const he=this.queries.map((he=>this.source.query(he).then((ge=>({dim:he.select.key[0],data:ge})))));return fromPromise(Promise.all(he).then((he=>{const ge=this.lookups(he,this.concept);return ze.fromLookups(ge,this.commonSpace)})))}})},entityPropertyDataConfig.decorate=dataConfig.decorate;const $e={exceptions:{}};entityMembershipDataConfig.nonObservable=function(he,ge){return composeObj(dataConfig.nonObservable(he,ge),{get exceptions(){return new Map(Object.entries(this.config.exceptions||$e.exceptions))},fetchResponse(){let he;return he="is--"===this.concept?this.spaceCatalog.then((he=>{const ge=this.space[0];this.space.length>1&&console.warn("DataConfig model of type entityMembershipDataConfig only supports one dimension,\n                      but got configured to a multidimensional space:",this.space.slice());const me=[];for(const[be,ve]of he[ge].entities.entries()){let he=Object.entries(ve).filter((he=>{let[ge,me]=he;return ge.includes("is--")&&me})).map((he=>{let[ge,me]=he;return this.exceptions.has(ge)?ve[this.exceptions.get(ge)]:ge}));0===he.length&&(he=["is--"+ge]),me.push({[ge]:ve[ge],"is--":he})}return ze(me,[ge])})):this.source.query(this.ddfQuery).then((he=>he.forKey(this.commonSpace))),fromPromise(he)}})},entityMembershipDataConfig.decorate=dataConfig.decorate;const Xe=createStore(dataConfig,{entityPropertyDataConfig:entityPropertyDataConfig,entityMembershipDataConfig:entityMembershipDataConfig}),Ke={linear:ge.scaleLinear,log:ge.scaleLog,genericLog:ge.scaleSymlog,sqrt:ge.scaleSqrt,ordinal:ge.scaleOrdinal,point:ge.scalePoint,band:ge.scaleBand,time:ge.scaleUtc,rank:ge.scaleLinear,svg:ge.scaleIdentity},Ze=["ordinal","band","point","rank","svg"],Je=["linear","log","genericLog","sqrt","time"];function scale(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(scale,...ge)}scale.nonObservable=function(he,me){function isArrayOneSided(he){return!!he&&(he.length<2||!(ge.min(he)<=0&&ge.max(he)>=0))}return{config:he,parent:me,name:"scale",defaults:{allowedTypes:null,clamp:!1,clampDomainToData:!1,orderDomain:!0,domain:[0,1],range:[0,1],numericType:"linear",categoricalType:"point",zeroBaseline:!1},get zeroBaseline(){var he;return(null!==(he=this.config.zeroBaseline)&&void 0!==he?he:this.defaults.zeroBaseline)&&!this.isDiscrete()&&isArrayOneSided(this.data.domain)},get clamp(){var he;return null!==(he=this.config.clamp)&&void 0!==he?he:this.defaults.clamp},get data(){return this.parent.data},get orderDomain(){var he;return null!==(he=this.config.orderDomain)&&void 0!==he?he:this.defaults.orderDomain},getScaleTypeWithoutLookingAtDomain(){const he=this.data.conceptProps;let me,be=null;return be=Ke[this.config.type]?this.config.type:null!=he&&he.scales&&(me=JSON.parse(he.scales).filter((he=>!this.allowedTypes||this.allowedTypes.includes(he)))[0])&&Ke[me]?me:"time"===(null==he?void 0:he.concept_type)?"time":this.data.constant||he&&["entity_domain","entity_set","string","boolean"].includes(he.concept_type)?[...ge.intersection(this.allowedTypes,Ze)][0]||this.defaults.categoricalType:[...ge.intersection(this.allowedTypes,Je)][0]||this.defaults.numericType,be},get allowedTypes(){var he;return null!==(he=this.config.allowedTypes)&&void 0!==he?he:Object.keys(Ke).filter((he=>"rank"!==he||"lane"===this.parent.config.modelType))},get type(){let he=this.getScaleTypeWithoutLookingAtDomain(),ge=this.allowedTypes;return"log"!=he||isArrayOneSided(this.domain)||(he="genericLog"),ge&&!ge.includes(he)&&console.warn("Scale type not in allowedTypes, please change scale type.",{scaleType:he,allowedTypes:ge}),he},get d3Type(){return Ke[this.type]},calcRange(){return arguments.length>0&&void 0!==arguments[0]||this.domain,null!=this.config.range?this.config.range:this.defaults.range},get range(){return this.calcRange()},get clampDomainToData(){var he;return null!==(he=this.config.clampDomainToData)&&void 0!==he?he:this.defaults.clampDomainToData},get isSameAsFrameEncScale(){var he;const ge=this.parent,me=this.parent.marker,be=null==me||null===(he=me.encoding)||void 0===he?void 0:he.frame;return"frame"!==ge.config.modelType&&be&&ge.data.concept===be.data.concept},get domain(){let he;if(this.config.domain)he=this.config.domain.map((he=>parseConfigValue(he,this.data.conceptProps))).map((he=>this.clampDomainToData?this.clampToDomain(he,this.data.domain):he));else if(this.data.isConstant)he=[this.data.constant];else if(this.isSameAsFrameEncScale)he=this.parent.marker.encoding.frame.scale.domain;else if("rank"===this.getScaleTypeWithoutLookingAtDomain())he=[0,this.parent.totalTrackNumber];else if(this.data.domain){if(he=this.data.domain,this.zeroBaseline){he=[...he];const me=ge.leastIndex(he.map(Math.abs));he[me]=0}}else he=this.defaults.domain;return this.isDiscrete()&&this.orderDomain?[...he].sort(sortDateSafe):he},set domain(he){this.config.domain=he},clampToDomain(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.domain;return this.isDiscrete()?ge.includes(he)?he:void 0:he<ge[0]?ge[0]:he>ge[1]?ge[1]:he},d3ScaleCreate(){const he=Ke[this.type]();return this.type,he.clamp&&he.clamp(this.clamp),he.domain(this.domain).range(this.range)},get d3Scale(){return this.d3ScaleCreate()},get zoomed(){return this.config.zoomed?this.config.zoomed.map((he=>parseConfigValue(he,this.data.conceptProps))):this.domain},set zoomed(he){this.config.zoomed=he},isDiscrete(){const he=this.getScaleTypeWithoutLookingAtDomain();return Ze.includes(he)},domainIncludes(he){let me=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.domain;if([ge.scaleLinear,ge.scaleLog,ge.scaleSymlog,ge.scaleSqrt,ge.scaleUtc].includes(this.d3Type)){const[ge,be]=me;return ge<=he&&he<=be}return me.includes(he)},disposers:[],onCreate(){},dispose(){for(let he of this.disposers)he()}}},scale.decorate={range:he.computed.struct,domain:he.computed.struct,zoomed:he.computed.struct,allowedTypes:he.computed.struct};const Qe={palette:{}},tn={defaultPalettes:{_continuous:{_default:"#789e9e",0:"#8c30e8",25:"#30a3e8",50:"#30e85e",75:"#e2c75a",100:"#e83030"},_ordinal:{_default:"#aaa",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_constant:{_default:"#789e9e"}}};function palette(){let me=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},be=arguments.length>1?arguments[1]:void 0;return Te(me,Qe),{config:me,parent:be,get encoding(){return this.parent.parent},get colorConceptProp(){return this.encoding.data.conceptProps?JSON.parse(this.encoding.data.conceptProps.color||"{}"):{}},get defaultPalettes(){return this.config.defaultPalettes||tn.defaultPalettes},get defaultPalette(){let he;return he=this.encoding.data.isConstant?/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.encoding.data.constant)?{_default:this.encoding.data.constant}:deepclone(this.defaultPalettes._constant):this.colorConceptProp.palette?deepclone(this.colorConceptProp.palette):deepclone(this.defaultPalettes[this.paletteType]),he},get paletteType(){return this.encoding.data.isConstant?"_constant":["time","measure"].includes(this.encoding.data.conceptProps.concept_type)?"_continuous":"_ordinal"},get paletteLabels(){return this.colorConceptProp.paletteLabels},get palette(){const he=Object.assign({},this.defaultPalette,this.config.palette);return Object.keys(he).forEach((ge=>{he[ge]||delete he[ge]})),he},get defaultColor(){return this.getColor("_default")||this.defaultPalettes[this.paletteType]._default},get paletteDomain(){return Object.keys(this.palette).filter((he=>"_default"!==he)).sort(((he,ge)=>he-ge))},get isUserSelectable(){return!this.colorConceptProp.hasOwnProperty("selectable")||this.colorConceptProp.selectable},get shades(){return this.colorConceptProp.shades},getColorShade(he){let{colorID:me,shadeID:be="shade"}=he;if(!me)return!1;const ve=this.palette[me];return Array.isArray(ve)?ve[this.shades[be]]:"shade"===be?ge.rgb(palette[me]||this.parent.d3Scale(me)).darker(.5).toString():ve},getColor(he){const ge=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.palette)[he];return Array.isArray(ge)?ge[0]:ge},getColorByIndex(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.palette;const me=ge[he%Object.keys(ge).filter((he=>"_default"!==he)).length];return Array.isArray(me)?me[0]:me},setColor:he.action("setColor",(function(he,me){this.parent.config.palette||(this.parent.config.palette={palette:{}}),this.parent.config.palette.palette[""+me]=he?ge.color(he).hex():he})),removeColor:he.action("removeColor",(function(he){this.config.palette.hasOwnProperty(""+he)&&delete this.config.palette[""+he]}))}}const en={categoricalType:"ordinal"},nn={schemeCategory10:ge.schemeCategory10};function color(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(color,...ge)}color.nonObservable=function(me,be){const ve=scale.nonObservable(me,be);return ve.defaults=deepmerge(ve.defaults,en),assign(ve,{calcRange(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.domain;const ge=this.config.range;if(Array.isArray(ge))return ge;if(isString(ge)&&nn[ge])return nn[ge];const me=this.palette;if("_continuous"==me.paletteType){const ge=he,be=ge[1]-ge[0]==0;return me.paletteDomain.map((he=>me.getColor(be?me.palette[me.paletteDomain[0]]:he)))}return he.map(((he,ge)=>me.getColor(he)||me.getColorByIndex(ge)||me.defaultColor))},get isPattern(){return!!(this.domain&&this.domain.length&&this.domain.some((he=>he&&he.length&&"<"==he[0])))},get palette(){const ge=resolveRef(this.config.palette).value||en.palette;return he.observable(palette(ge,this))},get d3Scale(){const he=this.d3ScaleCreate();let me=he.domain();if("_continuous"==this.palette.paletteType&&(me=this.palette.paletteDomain.map((he=>+me[0]+he/100*(me[1]-me[0])))),this.isDiscrete())he.unknown(this.palette.defaultColor);else{if("log"===this.type||"genericLog"===this.type){const ge=[me[0],me[me.length-1]],be=he.copy().domain(ge).range(ge);me=me.map((he=>be.invert(he)))}he.interpolate(ge.interpolateRgb.gamma(2.2))}return he.domain(me),he}})};const sn={clamp:!0,extent:[0,1],range:[0,20],zeroBaseline:!0,categoricalType:"point"};function size(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(size,...ge)}size.nonObservable=function(he,ge){const me=scale.nonObservable(he,ge);return me.defaults=deepmerge(me.defaults,sn),assign(me,{get extent(){return this.config.extent||this.defaults.extent},set extent(he){this.config.extent=he}})};const on=createStore(scale,{color:color,size:size}),rn={scale:{},data:{}};function encoding(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(encoding,...ge)}encoding.nonObservable=function(ge,me,be){let ve;Te(ge,rn);const _e={id:be,get marker(){return this.parent},get name(){return this.marker?this.marker.getEncodingName(this):"Unnamed"},get data(){const he=resolveRef(this.config.data).value,ge=Xe.get(he,this);return ve&&ge!=ve&&ve.dispose(),ve=ge},get transformFields(){return[]},get scale(){const he=resolveRef(this.config.scale).value;return on.get(he,this)},get references(){return Object.fromEntries(Object.entries(this.config).filter((he=>isReference(he[1]))).map((he=>{let[ge,me]=he;return[ge,resolveRef(me)]})))},get referenceState(){return combineStates(Object.values(this.references).map((he=>he.state)))},get state(){return combineStates([this.data.state,this.referenceState])},dataMapBeforeTransform(he){const ge=this.marker.transformations,me=this.name+"."+he,be=ge.findIndex((he=>he.name==me));return this.marker.getTransformedDataMap(ge[be-1].name)},setWhich:he.action("setWhich",(function(he){const ge=isNonNullObject(he.value)?he.value.concept:he.value;he.key?(isNonNullObject(he.value)&&(this.marker&&he.value.dataSource==this.marker.config.data.source?delete this.config.data.source:this.config.data.source=he.value.dataSource),this.config.data.concept=ge,this.config.data.space=he.key,delete this.config.data.constant):(this.config.data.constant=he.value.concept,delete this.config.data.concept),this.config.scale.domain=null,this.config.scale.type=null,this.config.scale.zoomed=null,this.config.scale.palette={}})),internalErrors:[],dispose(){for(const he of this.destructers)he();this.data.dispose(),this.scale.dispose()},destructers:[]};return assign({},_e,Re,{config:ge,parent:me})};const an={modelType:"frame",value:null,loop:!1,data:{concept:{selectMethod:"selectFrameConcept"}},scale:{clampDomainToData:!0}},ln=!0,cn=!1,un=!1,dn=!1,hn=1,pn=100,fn="year",gn=!1;function frame(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(frame,...ge)}frame.nonObservable=function(me,ve,_e){Te(me,an);const xe={get value(){let he;return null!=this.config.value?(he=this.parseValue(this.config.value),he=this.scale.clampToDomain(he)):he=this.scale.domain.at(-1),he},parseValue(he){return"number"==typeof he&&(he=""+he),parseConfigValue(he,this.data.conceptProps)},formatValue(he){return configValue(he,this.data.conceptProps)},get step(){return this.stepScale(this.value)},get stepScale(){const he=ge.range(0,this.stepCount),me=this.scale.d3Type(this.domainValues,he);return me.invert||(me.invert=he=>this.domainValues[he]),me},get playEmptyFrames(){var he;return null!==(he=this.config.playEmptyFrames)&&void 0!==he?he:un},get domainValues(){const he=this.marker.getTransformedDataMap("filterRequired");if(this.playEmptyFrames){const ge=he.keyExtent();return inclusiveRange(ge[0],ge[1],this.interval)}{let ge=[];for(let me of he.values()){const he=me.values().next().value[this.name];this.scale.domainIncludes(he)&&ge.push(he)}return ge}},get stepCount(){return this.domainValues.length},get speed(){return this.immediate?0:this.config.speed||pn},get loop(){return this.config.loop||dn},get playbackSteps(){return this.config.playbackSteps||hn},immediate:!1,playing:!1,togglePlaying(){this.playing?this.stopPlaying():this.startPlaying()},startPlaying:he.action("startPlaying",(function startPlaying(){this.setPlaying(!0)})),stopPlaying:he.action("stopPlaying",(function stopPlaying(){this.setPlaying(!1)})),jumpToFirstFrame:he.action("jumpToFirstFrame",(function jumpToFirstFrame(){this.setStep(0),this.immediate=this.playing})),setPlaying:he.action("setPlaying",(function setPlaying(he){this.playing=he,he&&(this.step==this.stepCount-1?this.jumpToFirstFrame():this.nextStep())})),setExtrapolate:he.action("setExtrapolate",(function setExtrapolate(he){this.config.extrapolate=he})),setSpeed:he.action("setSpeed",(function setSpeed(he){he=Math.max(0,he),this.config.speed=he})),setValue:he.action("setValue",(function setValue(he){let ge=this.data.conceptProps,me=this.parseValue(he);null!=me&&(me=this.scale.clampToDomain(me)),this.config.value=configValue(me,ge)})),setStep:he.action("setStep",(function setStep(he){this.setValue(this.stepScale.invert(he))})),setValueAndStop:he.action("setValueAndStop",(function setValueAndStop(he){this.stopPlaying(),this.setValue(he)})),setStepAndStop:he.action("setStepAndStop",(function setStepAndStop(he){this.stopPlaying(),this.setStep(he)})),snap:he.action("snap",(function snap(){this.setStep(Math.round(this.step))})),ceilKeyFrame(){return this.stepScale.invert(Math.ceil(this.step))},nextStep:he.action("update to next frame value",(function nextStep(){if(this.playing&&this.marker.state===be){this.immediate=!1;let he=this.step+this.playbackSteps;he<this.stepCount?this.setStep(he):this.step==this.stepCount-1?this.loop?this.jumpToFirstFrame():this.stopPlaying():this.setStep(this.stepCount-1)}})),markerLimits(he){return this.dataMapBeforeTransform("currentFrame").extentOfGroupKeyPerMarker(he)},get transformationFns(){return{frameMap:this.frameMap.bind(this),interpolate:this.interpolateData.bind(this),extrapolate:this.extrapolateData.bind(this),currentFrame:this.currentFrame.bind(this)}},get transformFields(){return[this.name]},frameMap(he){return he.groupBy(this.name,this.rowKeyDims).reindexToKeyDomain(this.interval)},get rowKeyDims(){return relativeComplement([this.data.concept],this.data.space)},get interpolate(){var he;return null!==(he=this.config.interpolate)&&void 0!==he?he:ln},interpolateData(he){if(0==he.size||!this.interpolate)return he;const ge=he.copy(),me=this.name;return ge.interpolateOverMembers({fields:this.changeBetweenFramesEncodings,frameField:me,frameCopyFields:this.encodingsThatCopyFrame.concat(this.data.concept),interpolators:this.fieldCustomInterpolators})},get encodingsThatCopyFrame(){const he=this.marker.encoding;return Object.keys(he).filter((ge=>he[ge]!=this&&he[ge].data.concept===this.data.concept&&he[ge].data.space.includes(this.data.concept)))},get changeBetweenFramesEncodings(){const he=this.marker.encoding,ge=Object.keys(he).filter((ge=>he[ge]!=this));return this.data.conceptInSpace?ge.filter((ge=>he[ge].data.hasOwnData&&he[ge].data.space.includes(this.data.concept))):ge},get fieldCustomInterpolators(){const he=this.marker.encoding;return this.changeBetweenFramesEncodings.reduce(((ge,me)=>{var be,ve,_e,xe,we;return["measure","time"].includes(null===(be=he[me].data)||void 0===be||null===(ve=be.conceptProps)||void 0===ve?void 0:ve.concept_type)||null!==(_e=he[me].scale)&&void 0!==_e&&_e.interpolate||null!==(xe=he[me].data)&&void 0!==xe&&null!==(we=xe.conceptProps)&&void 0!==we&&we.interpolate||(ge[me]=stepBeforeInterpolator),ge}),{})},get interval(){var he;const ge=null!==(he=this.config.interval)&&void 0!==he?he:this.data.conceptProps.concept;return Le.includes(ge)?ge:fn},get extrapolate(){var he;return null!==(he=this.config.extrapolate)&&void 0!==he?he:cn},extrapolateData(he){if(0==he.size||!this.extrapolate)return he;const ge=he.keyExtentIndices({filter:he=>{for(const ge of he.values())if(this.marker.requiredEncodings.every((he=>null!=ge[he])))return!0;return!1}}),me=this.name;return he.extrapolateOverMembers({fields:this.changeBetweenFramesEncodings,sizeLimit:this.extrapolate,indexLimit:ge,ammendNewRow:he=>{he[this.data.concept]=he[me],this.encodingsThatCopyFrame.forEach((ge=>{Object.defineProperty(he,ge,{value:he[me],enumerable:!0,configurable:!0})}))}})},currentFrame(he){return 0==he.size?ze([],he.descendantKeys[0]):he.has(this.frameKey)?he.get(this.frameKey):this.scale.domainIncludes(this.value,this.data.domain)&&this.interpolate?this.getInterpolatedFrame(he,this.step,this.stepsAround):ze([],he.descendantKeys[0])},get frameKey(){return createKeyFn([this.name])({[this.name]:this.value})},get fieldsToInterpolate(){return[this.name,this.data.concept,...this.changeBetweenFramesEncodings,...this.encodingsThatCopyFrame]},getInterpolatedFrame(he,ge,me){const be=Array.from(he.keys()),[ve,_e]=me.map((ge=>he.get(be[ge])));return ve.interpolateTowards(_e,ge%1,this.fieldsToInterpolate,this.fieldCustomInterpolators)},get stepsAround(){return[Math.floor(this.step),Math.ceil(this.step)]},get framesAround(){return this.stepsAround.map(this.stepScale.invert)},differentiate(he,ge){let me,be=DataFrameGroup([],he.key,he.descendantKeys);for(let[ve,_e]of he){const he=_e.copy();for(let[be,ve]of he){const _e=Object.assign({},ve),xe=ve[ge];void 0!==xe&&(_e[ge]=me?xe-me.getByStr(be)[ge]:0),he.set(_e,be)}me=_e,be.set(ve,he)}return be},get state(){return combineStates([this.data.state,this.data.source.conceptsPromise.state])},onCreate(){const ge=he.reaction((()=>({playing:this.playing,speed:this.speed})),(he=>{let{playing:ge,speed:me}=he;clearInterval(this.playInterval),ge&&(this.playInterval=setInterval(this.nextStep.bind(this),me))}),{name:"frame playback timer",onError:he=>this.internalErrors.push(he)});this.destructers.push(ge);const me=he.reaction((()=>{if("fulfilled"==(this.marker||this).state)return this.value}),(he=>{he&&"value"in this.config&&!equals(this.config.value,he)&&(this.config.value=configValue(he,this.data.conceptProps))}),{name:"frame config loopback",onError:he=>this.internalErrors.push(he)});this.destructers.push(me),this.destructers.push((()=>{clearInterval(this.playInterval)}))},get splash(){return this.config.splash||gn}};return assign(encoding.nonObservable(me,ve,_e),xe)},frame.splashMarker=function splashMarker(he){const ge=he.encoding.frame;if(null!=ge&&ge.splash&&null!=ge&&ge.config.value){const me=resolveRef(ge.config.data.concept).value;if("string"==typeof me){let be=Vizabi.utils.deepclone(he.config);const ve={data:{filter:{dimensions:{[me]:{[me]:ge.config.value}}}}};be=Vizabi.utils.deepmerge(be,ve);let _e=Vizabi.marker(be,he.id+"-splash"),xe=function markerWithFallback(he,ge){return new Proxy(he,{get:function(he,me,be){return ge&&"fulfilled"==he.state&&(ge.dispose(),ge=void 0),ge?ge[me]:he[me]}})}(he,_e);return{marker:xe,splashMarker:_e}}return console.warn("Frame splash does not work with autoconfig concept. Please set frame.data.concept or disable splash."),{marker:he}}return{marker:he}},frame.decorate={changeBetweenFramesEncodings:he.computed.struct,encodingsThatCopyFrame:he.computed.struct},Ye.addSolveMethod((function selectFrameConcept(he){let{concepts:ge,space:me,dataConfig:be}=he;const ve=me.map((he=>be.source.getConcept(he)));return findTimeOrMeasure(ve)||findTimeOrMeasure(ge)||ve[ve.length-1];function findTimeOrMeasure(he){return he.find((he=>"time"==he.concept_type))||he.find((he=>"measure"==he.concept_type))}}));const mn=defaultDecorator({base:encoding,defaultConfig:{modelType:"selection",data:{concept:void 0,space:void 0}}}),bn={direction:"ascending"},vn=defaultDecorator({base:encoding,functions:{get direction(){return resolveRef(this.config.direction).value||bn.direction},get transformFields(){return this.data.isConstant?[]:[this.name]},order(he){return this.data.isConstant?he:he.order([{[this.name]:this.direction}])},get transformationFns(){return{order:this.order.bind(this)}}}}),yn={data:{concept:void 0,space:void 0,filter:{modelType:"trailFilter",markers:{}}}},_n=!0,xn=!0,wn="frame";function trail(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(trail,...ge)}trail.nonObservable=function(me,be,ve){Te(me,yn);const _e=encoding.nonObservable(me,be,ve);let xe={};return assign(_e,{get show(){return"boolean"==typeof this.config.show?this.config.show:_n},get groupDim(){return this.frameEncoding.data.concept},get frameEncoding(){const he=this.config.frameEncoding||wn;return this.marker.encoding[he]},get limits(){return this.dataMapBeforeTransform("addPreviousTrailHeads").extentOfGroupKeyPerMarker(this.data.filter.markers.keys())},updateTrailStart:he.action("update trail start",(function updateTrailStart(){let he,me,be,ve=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frameEncoding.value,_e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.limits;for(he in this.starts)[me,be]=_e[he],be=ge.min([be,this.starts[he]]),this.data.filter.set(he,ve,[me,be])})),get starts(){if(!this.updateStarts)return xe;const he={};for(let[ge,me]of this.data.filter.markers){const be=this.limits[ge];if(be.some((he=>null==he)))continue;const ve=this.frameEncoding.parseValue(me);he[ge]=clamp(ve,...be)}return xe=he},get updateStarts(){return"boolean"==typeof this.config.updateStarts?this.config.updateStarts:xn},setShow:he.action((function(he){if(this.config.show=he,!0===he)for(let he of this.data.filter.markers.keys())this.data.filter.set(he)})),get transformationFns(){return{addPreviousTrailHeads:this.addPreviousTrailHeads.bind(this),addTrails:this.addTrails.bind(this)}},addPreviousTrailHeads(he){const ge=Object.keys(this.starts);if(0==ge.length||!this.show)return he;const me=DataFrameGroup([],he.key,he.descendantKeys),be=new Map;for(let[ve,_e]of he){const ve=he.keyObject(_e),xe=new Set;for(let he of ge)if(_e.hasByStr(he)){const ge=_e.getByStr(he);be.set(he,ge)}else be.has(he)&&xe.add(he);const we=_e.copy();for(let he of xe){const ge=be.get(he);we.set(ge)}me.set(ve,we)}return me},addTrails(he){const ge=he.key[0],me=Object.keys(this.starts);if(0==me.length||!this.show)return he;const be=new Map;for(let ge of me){const me=new Map;be.set(ge,me);for(let[be,ve]of he)ve.hasByStr(ge)&&me.set(be,assign({},ve.getByStr(ge)))}const ve=ge,_e=DataFrameGroup([],he.key,he.descendantKeys),xe=[...he.descendantKeys[0],ve],we=createKeyFn(xe);for(let[ge,me]of he){const ge=he.keyObject(me),xe=ze([],me.key);for(let[he,ge]of me){if(be.has(he)){const me=be.get(he),_e=this.starts[he],Me=ge[ve];for(let[ge,be]of me){const ge=be[ve];if(ge<_e)continue;if(ge>Me)break;const me=we(be),Se=Object.assign(be,{[Symbol.for("key")]:me,[Symbol.for("trailHeadKey")]:he});xe.set(Se,me)}}xe.set(ge,he)}_e.set(ge,xe)}return _e},onCreate(){const ge=he.reaction((()=>"fulfilled"==this.marker.state&&this.frameEncoding.ceilKeyFrame()),(he=>{he&&this.updateTrailStart(he)}),{name:"updateTrailStart on frame value change",onError:he=>this.internalErrors.push(he)});this.destructers.push(ge);const me=he.reaction((()=>"fulfilled"==this.marker.state?this.starts:void 0),(he=>{if(he){const ge=this.data.filter;for(let me of ge.markers.keys())me in he||ge.delete(me)}}),{name:"trail config loopback",onError:he=>this.internalErrors.push(he)});this.destructers.push(me)}})},trail.decorate={starts:he.computed.struct,limits:he.computed.struct};const Mn=1,Sn=defaultDecorator({base:encoding,defaultConfig:{data:{concept:void 0,space:void 0}},functions:{get row(){return this.config.row},get column(){return this.config.column},get allowEnc(){return this.config.allowEnc||console.warn('Repeater encoding is missine essential bit of config "allowEnc"'),this.config.allowEnc},get guessAliases(){return this.allowEnc.reduce(((he,ge)=>(this.marker.encoding[ge]||(ge=this.marker.requiredEncodings.at(-1)),he[ge]=ge,he)),{})},get useConnectedRowsAndColumns(){return!!this.config.useConnectedRowsAndColumns},get rowcolumn(){if(this.config.rowcolumn)return this.config.rowcolumn;if(this.useConnectedRowsAndColumns){const{allowEnc:he,row:ge,column:me}=this,be=[];return ge.forEach((ge=>{me.forEach((me=>{be.push({[he[0]]:ge,[he[1]]:me})}))})),be}return[this.guessAliases]},get ncolumns(){return this.config.ncolumns||this.useConnectedRowsAndColumns&&this.column.length||Mn},get nrows(){return this.rowcolumn.length/this.ncolumns},getName:function(he){const me=Object.keys(he).sort(ge.ascending).map((ge=>ge+"-"+he[ge])).join("--");return"chart-repeated--".concat(me)},getRowIndex:function(he){return Math.floor(he/this.ncolumns)},getColumnIndex:function(he){return he%this.ncolumns}}}),Dn=defaultDecorator({base:encoding,defaultConfig:{data:{concept:void 0,space:void 0}},functions:{get grouping(){var he;return null!==(he=this.config.grouping)&&void 0!==he?he:{}},get measures(){var he;return null!==(he=this.config.measures)&&void 0!==he?he:[]},aggregate(he){const ge=filterObject(this.grouping,((ge,me)=>he.key.includes(me)&&ge.grouping>1)),me=this.measures;if(0==Object.keys(ge).length)return he;let be=ze([],he.key);for(const ve of he.rows()){const _e=pick(ve,he.key);for(const he in ge){const me=ge[he].grouping;_e[he]=Math.floor(+ve[he]/me)*me}const xe=be.keyFn(_e);if(be.hasByStr(xe)){const he=be.getByStr(xe);me.forEach((ge=>he[ge]+=ve[ge]))}else{const he=assign({},ve,_e);be.setByStr(xe,he)}}return be},get transformationFns(){return{aggregate:this.aggregate.bind(this)}}}}),unique=(he,ge)=>[...new Set(he.map(ge))];let zn;const On=createStore(encoding,{frame:frame,selection:mn,order:vn,trail:trail,repeat:Sn,aggregate:Dn,lane:defaultDecorator({base:encoding,functions:{get transformFields(){return this.data.isConstant?[]:[this.name]},get firstDim(){return this.data.space[0]},lookupID(he){const ge=this.marker.encoding.frame.data.concept;return he[this.firstDim]+(this.data.space.includes(ge)?he[ge].toISOString():"")},get rollup(){const he=this.data.concept;zn=new Map;let me=0,be=0;const addTrackValue=he=>{zn.set(this.lookupID(he),he.track)};return ge.rollups(this.data.response||[],(ge=>{const be=ge.map((he=>{let[ge,me]=he;return me})),ve=!!be[0][he],_e=ve?unique(be,(he=>he[this.firstDim])):[];return me+=_e.length,{items:_e,values:be.map((he=>({track:ve?_e.indexOf(he[this.firstDim]):0,...he})))}}),(he=>{let[ge,me]=he;return me[this.data.concept]})).sort(((he,ge)=>{let[me]=he,[be]=ge;return this.comparator(me,be)})).filter((he=>{let[ge]=he;return!!ge})).map((he=>{var ge;let[ve,_e]=he;_e.values.forEach((he=>he.track+=be)),_e.values.forEach((he=>addTrackValue(he)));const xe=be,we=xe-Math.round(.1*me/2);return be+=_e.items.length+Math.round(.1*me),{id:ve,name:null===(ge=this.conceptEntities.get(ve))||void 0===ge?void 0:ge.name,min:xe,max:be,tickPosition:we}}))},get totalTrackNumber(){var he;return null===(he=this.rollup.at(-1))||void 0===he?void 0:he.max},comparator(he,me){var be,ve;return he?ge.ascending(null===(be=this.conceptEntities.get(he))||void 0===be?void 0:be.rank,null===(ve=this.conceptEntities.get(me))||void 0===ve?void 0:ve.rank):-1},get placeholderEntities(){const he=unique([...this.data.response.values()],(he=>he[this.data.concept])).filter((he=>!!he));return new Map(he.map((he=>[he,{name:he,rank:+he.replace(/\D/g,"")}])))},get conceptCatalogPromise(){return fromPromise(getConceptsCatalog([this.data.concept],this.data,1))},get conceptEntities(){const he=new Map;return this.conceptCatalogPromise.case({fulfilled:he=>he[this.data.concept].entities?new Map(he[this.data.concept].entities):this.placeholderEntities,pending:()=>he,rejected:ge=>he})},addTrack(he){if("rank"!==this.scale.type||this.data.isConstant||!this.conceptEntities.size)return he;this.rollup;const ge=DataFrameGroup([],he.key,he.descendantKeys);for(const[me,be]of he){const me=he.keyObject(be),ve=ze([],be.key);for(const[he,ge]of be){const me=assign({},ge);me[this.data.concept]=ge[this.name],me[this.name]=zn.get(this.lookupID(ge)),ve.set(me,he)}ge.set(me,ve)}return ge},get state(){return combineStates("rank"===this.scale.type?[this.data.state,this.referenceState,this.conceptCatalogPromise.state]:[this.data.state,this.referenceState])},get transformationFns(){return{addTrack:this.addTrack.bind(this)}}}})});function encodingCache(){const he={};return{cache:he,update:(ge,me)=>(function fill(ge,me){for(const be in ge)be in he||(he[be]=On.get(ge[be],me,be))}(ge,me),function purge(ge){for(const me of Object.keys(he))me in ge||(he[me].dispose(),delete he[me])}(ge),he)}}const Cn={data:{},encoding:{}},kn={requiredEncodings:[],transformations:["aggregate.aggregate","frame.frameMap","frame.interpolate","frame.extrapolate","filterRequired","trail.addPreviousTrailHeads","order.order","orderFacets.order","x.addTrack","y.addTrack","trail.addTrails","frame.currentFrame"]};function marker(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return createModel(marker,...ge)}marker.nonObservable=function(ge,me,be){let ve;Te(ge,Cn);const _e={config:ge,id:be},xe={on:function(ge,me){if(this.validProp(ge)&&"function"==typeof me){const be=he.autorun((()=>"fulfilled"==this.state&&me.call(this,this[ge])));this.getEventListenersMapFor(ge).set(me,be)}else console.warn('Invalid "on" call');return this},off:function(he,ge){var me;return null!==(me=this.eventListeners.get(he))&&void 0!==me&&me.has(ge)&&(this.getEventListenersMapFor(he).get(ge)(),this.getEventListenersMapFor(he).delete(ge)),this},validProp(he){return he in this},eventListeners:new Map,getEventListenersMapFor(he){return this.eventListeners.has(he)||this.eventListeners.set(he,new Map),this.eventListeners.get(he)},get data(){const he=resolveRef(this.config.data).value,ge=Xe.get(he,this);return ve&&ge!=ve&&ve.dispose(),ve=ge},encodingCache:encodingCache(),get encoding(){let he=[()=>this.config.encoding,()=>this.data.source.defaultEncoding].find((he=>he()&&Object.keys(he()).length>0));return he||(console.warn("No encoding found and marker data source has no default encodings"),he=()=>({})),Object.assign({},this.encodingCache.update(he(),this))},getEncodingName(he){for(let[ge,me]of Object.entries(this.encoding))if(me==he)return ge},get configState(){return Ye.markerSolvingState(this)},get references(){return Object.fromEntries(Object.entries(this.config).filter((he=>isReference(he[1]))).map((he=>{let[ge,me]=he;return[ge,resolveRef(me)]})))},get referenceState(){return combineStates(Object.values(this.references).map((he=>he.state)))},get state(){const he=combineStatesSequential([()=>this.referenceState,()=>this.configState]);var ge,me;return"fulfilled"==he&&(null!==(ge=this.encoding.frame)&&void 0!==ge&&null!==(me=ge.changeBetweenFramesEncodings)&&void 0!==me&&me.some((he=>"fulfilled"!==this.encoding[he].data.state))?this.dataMapCache:this.dataMap),combineStatesSequential([()=>he,...[...Object.values(this.encoding)].map((he=>()=>he.state))])},get availability(){const he=[];return He.getAll().forEach((ge=>{ge.availability.data.forEach((me=>{he.push({key:me.key,value:ge.getConcept(me.value),source:ge})}))})),he},get spaceAvailability(){const he=[];return He.getAll().forEach((ge=>{ge.availability.keyLookup.forEach(((ge,me)=>{he.push(ge)}))})),he},get transformFields(){return new Set(this.requiredEncodings.concat(Object.values(this.encoding).map((he=>he.transformFields)).flat()))},get encodingByType(){const he=[];let ge=[],me=[];const be=this.transformFields;for(const ve of Object.keys(this.encoding)){const _e=this.ammendFnForEncoding(ve);"defining"===_e?he.push(ve):"function"==typeof _e&&(be.has(ve)?ge.push(ve):me.push(ve))}if(he.concat(ge).every((he=>"fulfilled"==this.encoding[he].data.state))){const me=he.map((he=>this.encoding[he].data.response));ge=ge.filter((ge=>{const be=this.encoding[ge].data;return!be.hasOwnData||!me.includes(be.response)||(he.push(ge),!1)}))}return{defining:he,ammendGet:me,ammendWrite:ge}},ammendFnForEncoding(he){const ge=this.requiredEncodings,me=this.encoding[he].data,be=me.concept;return void 0!==be||me.isConstant?me.isConstant?he=>me.constant:me.conceptInSpace?he=>he[be]:me.commonSpace.length<this.data.space.length||!1===me.iterableResponse?he=>{var ge;return null===(ge=me.response.get(he))||void 0===ge?void 0:ge[be]}:ge.length>0&&!ge.includes(he)?(he,ge)=>{var ve;return null===(ve=me.response.getByStr(ge))||void 0===ve?void 0:ve[be]}:"defining":"no-op"},get encodingState(){return combineStates([...this.encodingByType.defining,...this.encodingByType.ammendWrite].map((he=>this.encoding[he].data.state)))},get dataMapCache(){if("fulfilled"!==this.encodingState)return ze([],this.data.space);const{defining:he,ammendWrite:ge,ammendGet:me}=this.encodingByType;let be=fullJoin(he.map((he=>this.joinConfig(this.encoding[he],he))),this.data.space);for(const he of me)for(const ge of be.keys()){const me=be.get(ge);let ve;Object.defineProperty(me,he,{get:()=>{var be;return null!==(be=this.ammendFnForEncoding(he)(me,ge))&&void 0!==be?be:ve},set(he){ve=he},enumerable:!0,configurable:!0})}const ve=Object.fromEntries(ge.map((he=>[he,this.ammendFnForEncoding(he)])));for(const he of be.keys()){const ge=be.get(he);for(const me in ve)ge[me]=ve[me](ge,he)}return be},joinConfig:(he,ge)=>({projection:{[he.data.concept]:[ge]},dataFrame:he.data.response}),get requiredEncodings(){return he.toJS(this.config.requiredEncodings||kn.requiredEncodings).filter((he=>this.encoding[he].data.hasOwnData))},filterRequired(he){return this.requiredEncodings,he.filterNullish(this.requiredEncodings).filterGroups((he=>he.size>0),!0)},differentiate(he,ge){const me=this.encoding.frame;return me&&this.encoding[he]?me.differentiate(ge,he):ge},get transformationFns(){const he={filterRequired:this.filterRequired.bind(this)};for(let[be,ve]of Object.entries(this.encoding)){var ge,me;if(ve.transformationFns)for(let[ge,me]of Object.entries(ve.transformationFns))he[be+"."+ge]=me;if(Array.isArray(null==ve||null===(ge=ve.config)||void 0===ge||null===(me=ge.data)||void 0===me?void 0:me.transformations))for(let ge of ve.config.data.transformations){const me=this[ge];me&&(he[be+"."+ge]=me.bind(this,be))}}return he},get transformations(){const he=this.config.transformations||kn.transformations,ge=this.transformationFns;return he.filter((he=>he in ge)).map((he=>({fn:this.transformationFns[he],name:he})))},get transformedDataMaps(){const ge=new Map;let me=he.observable.box(this.dataMapCache,{deep:!1});return this.transformations.forEach((be=>{let{name:ve,fn:_e}=be,xe=me;me=he.computed((()=>{const he=xe.get();return _e(he)}),{name:ve}),ge.set(ve,me)})),ge.set("final",me),ge},getTransformedDataMap(he){if(this.transformedDataMaps.has(he))return this.transformedDataMaps.get(he).get();console.warn("Requesting unknown transformed data name: ",he)},get dataMap(){return this.transformedDataMaps.get("final").get()},get dataArray(){var he;return null===(he=this.dataMap)||void 0===he?void 0:he.toJSON()},getDataMapByFrameValue(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"filterRequired";const me=this.encoding.frame;if(!me)return this.dataMap;const be=createKeyFn([me.name])({[me.name]:he}),ve=this.getTransformedDataMap(ge);return ve.has(be)?ve.get(be):function getInterpolatedFrame(he,ge,me){const be=he.stepScale(me),ve=[Math.floor(be),Math.ceil(be)];return he.getInterpolatedFrame(ge,be,ve)}(me,ve,he)},dispose(){this.data.dispose();for(let he of Object.values(this.encoding))he.dispose()}};return assign(_e,xe,Re)},marker.decorate={encodingCache:he.observable.ref,encodingByType:he.computed.struct,requiredEncodings:he.computed.struct};const Tn=createStore(marker),Ln={markers:Tn,dataSources:He,encodings:On},vizabi=function(ge){const me=he.observable(ge),be={};for(const he in me)he in Ln?be[he]=Ln[he].createMany(me[he]):console.warn("Vizabi() was given an unknown store name: ",he);return be.config=me,be};return vizabi.versionInfo={version:"1.33.0",build:1737499963698,package:{homepage:"http://vizabi.org",name:"@vizabi/core",description:"Vizabi core (data layer)"}},vizabi.utils=je,vizabi.stores=Ln,vizabi.dataSource=(he,ge)=>(Array.isArray(he)&&(he={values:he}),He.create(he,null,ge)),vizabi.marker=(ge,me)=>(ge=he.observable(ge),Tn.create(ge,null,me)),vizabi.encoding=(ge,me)=>(ge=he.observable(ge),On.create(ge,null,me)),vizabi.disposeAll=()=>{for(let he in Ln)Ln[he].disposeAll()},vizabi.csvReader=csvReader,vizabi.inlineReader=inlineReader,vizabi},"object"==typeof exports&&"undefined"!=typeof module?module.exports=me(require("mobx"),require("d3")):"function"==typeof define&&define.amd?define(["mobx","d3"],me):(ge="undefined"!=typeof globalThis?globalThis:ge||self).Vizabi=me(ge.mobx,ge.d3),function(he,ge){"object"==typeof exports&&"undefined"!=typeof module?ge(exports,require("d3"),require("mobx")):"function"==typeof define&&define.amd?define(["exports","d3","mobx"],ge):ge((he="undefined"!=typeof globalThis?globalThis:he||self).VizabiSharedComponents={},he.d3,he.mobx)}(window,(function(ge,me,be){const ve='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',_e='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',xe='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',we='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',Me='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',Se='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><g><path d="M1088 1248v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68zm0-512v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68zm0-512v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68z"/></g></svg>';var De=Object.freeze({__proto__:null,ICON_PAINTBRUSH:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',ICON_SEARCH:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',ICON_CIRCLE:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',ICON_EXPAND:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',ICON_ASTERISK:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',ICON_TRAILS:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',ICON_LOCK:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',ICON_UNLOCK:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',ICON_UNEXPAND:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',ICON_AXES:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',ICON_GEAR:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',ICON_STACK:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',ICON_DRAG:ve,ICON_WARN:_e,ICON_PIN:xe,ICON_QUESTION:we,ICON_CLOSE:Me,ICON_PRESENTATION:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',ICON_ABOUT:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',ICON_REPEAT:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M576 1376v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm0-384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm-512-768v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm-512-768v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm0-384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm128-320v1088q0 66-47 113t-113 47h-1344q-66 0-113-47t-47-113v-1088q0-66 47-113t113-47h1344q66 0 113 47t47 113z"/></svg>',ICON_CURSORARROW:'<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',ICON_CURSORPLUS:'<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',ICON_CURSORMINUS:'<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',ICON_HUNDREDPERCENT:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',ICON_PERCENT:'<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',ICON_SIDE:'<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>',ICON_CURSORHAND:'<svg class="vzb-icon" viewBox="0 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="scale(1,-1)" d="M880 1408q-46 0 -79 -33t-33 -79v-656h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528v-256l-154 205q-38 51 -102 51q-53 0 -90.5 -37.5t-37.5 -90.5q0 -43 26 -77l384 -512q38 -51 102 -51h688q34 0 61 22t34 56l76 405q5 32 5 59v498q0 46 -33 79t-79 33t-79 -33t-33 -79v-272h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528h-32v656q0 46 -33 79t-79 33zM880 1536q68 0 125.5 -35.5t88.5 -96.5q19 4 42 4q99 0 169.5 -70.5t70.5 -169.5v-17q105 6 180.5 -64t75.5 -175v-498q0 -40 -8 -83l-76 -404q-14 -79 -76.5 -131t-143.5 -52h-688q-60 0 -114.5 27.5t-90.5 74.5l-384 512q-51 68 -51 154q0 106 75 181t181 75q78 0 128 -34v434q0 99 70.5 169.5t169.5 70.5q23 0 42 -4q31 61 88.5 96.5t125.5 35.5z"/></svg>',ICON_ANGLEDOUBLELEFT:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"/></svg>',ICON_FORECAST:'<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><g><path d="M560.7,775.2c-8.5,8.4-17.2,17.1-26,25.8C418,917.8,327.5,1039.9,231.9,1209.3c-72.9,129.4-131,262.4-172.5,395.4l171.8,53.7c37.8-120.9,90.8-242.3,157.5-360.7c43.8-77.7,85.9-143.7,128.7-201.7c43.7-59.3,91-114.2,144.6-167.7c11.3-11.3,22.2-22.2,33-32.8L560.7,775.2z"/><path d="M973.7,461.9c-21.4,12.1-43.4,24.8-66.1,38.5c-56.1,33.7-103.4,65.5-145.8,97.2l114.5,139.2c36.3-26.8,76.5-53.6,124-82.1c23.6-14.2,46.3-27.3,68.4-39.7L973.7,461.9z"/><path d="M1448.9,252.3c-37.1,13.4-75.2,27.2-111.3,40.9c-37.6,14.2-76.7,29.6-118,47.2l71.7,165.1c36.5-15.5,72.9-29.8,110.1-44c33.7-12.8,69.4-25.8,104.4-38.4L1448.9,252.3z"/></g></svg>',ICON_ELLIPSIS_V:Se});const ze=function(){let he=0;return function(ge){return ge?ge+(he+=1):he+=1}}(),Oe=Array.isArray||(he=>"[object Array]"===Object.prototype.toString.call(he)),isObject=function(he){return"object"===typeof he&&!!he},isDate=function(he){return he instanceof Date},isString=he=>"string"==typeof he,isNaN$1=function(he){return isNumber(he)&&he!==+he},isEmpty=function(he){return 0===Object.keys(he).length&&he.constructor===Object},isNumber=function(he){return"number"==typeof he||!!he&&"object"==typeof he&&"[object Number]"===Object.prototype.toString.call(he)},isPlainObject=function(he){return null!==he&&"[object Object]"===Object.prototype.toString.call(he)},deepArrayEquals=function(he,ge){if(he===ge)return!0;if(null==he||null==ge)return!1;if(he.length!=ge.length)return!1;for(let me=0;me<he.length;++me)if(isPlainObject(he[me])&&isPlainObject(ge[me])){if(!comparePlainObjects(he[me],ge[me]))return!1}else if(he[me]!==ge[me])return!1;return!0},comparePlainObjects=function(he,ge){const whatis=function(he){if(void 0===he)return"undefined";if(null===he)return"null";let ge=typeof he;return"object"===ge&&(ge=function(he){return Object.prototype.toString.call(he).match(/^\[object\s(.*)\]$/)[1]}(he).toLowerCase()),"number"===ge?he.toString().indexOf(".")>0?"float":"integer":ge},compare=function(he,ge){if(he===ge)return!0;for(const me in he){if(!ge.hasOwnProperty(me))return!1;if(!equal(he[me],ge[me]))return!1}for(const me in ge)if(!he.hasOwnProperty(me))return!1;return!0},me={array:function(he,ge){if(he===ge)return!0;if(he.length!==ge.length)return!1;for(let me=0;me<he.length;me++)if(!equal(he[me],ge[me]))return!1;return!0}};me.object=compare,me.date=function(he,ge){return he.getTime()===ge.getTime()},me.regexp=function(he,ge){return he.toString()===ge.toString()};const equal=function(he,ge){if(he!==ge){const be=whatis(he);return be===whatis(ge)&&(me.hasOwnProperty(be)?me[be](he,ge):he==ge)}return!0};return compare(he,ge)},forEach=function(he,ge,me){if(!he)return;let be,ve;if(Oe(he))for(ve=he.length,be=0;be<ve;be+=1){if(!1===ge.apply(me,[he[be],be]))break}else{const _e=Object.keys(he);for(ve=_e.length,be=0;be<ve;be+=1){if(!1===ge.apply(me,[he[_e[be]],_e[be]]))break}}},extend=function(he){const ge=Array.prototype.slice.call(arguments,1);return forEach(ge,(ge=>{forEach(ge,((me,be)=>{ge.hasOwnProperty(be)&&(he[be]=me)}))})),he};function isSpecificValue(he){return Boolean(he instanceof Date||he instanceof RegExp)}function cloneSpecificValue(he){if(he instanceof Date)return new Date(he.getTime());if(he instanceof RegExp)return new RegExp(he);throw new Error("Unexpected situation")}function deepCloneArray(he){const ge=[];return forEach(he,((he,me)=>{"object"==typeof he&&null!==he?Oe(he)?ge[me]=deepCloneArray(he):isSpecificValue(he)?ge[me]=cloneSpecificValue(he):ge[me]=deepExtend({},he):ge[me]=he})),ge}const deepExtend=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];const he=arguments[0],ge="boolean"==typeof arguments[arguments.length-1],me=ge&&arguments[arguments.length-1],be=Array.prototype.slice.call(arguments,1,ge?-1:arguments.length);let ve,_e;return forEach(be,(ge=>{"object"!=typeof ge||Oe(ge)||forEach(Object.getOwnPropertyNames(ge),(be=>{_e=he[be],ve=ge[be],ve===he||("object"!=typeof ve||null===ve||ve._data?he[be]=ve:Oe(ve)?he[be]=deepCloneArray(ve):isSpecificValue(ve)?he[be]=cloneSpecificValue(ve):"object"!=typeof _e||null===_e||Oe(_e)?he[be]=deepExtend({},ve):me&&isEmpty(ve)?he[be]={}:he[be]=deepExtend(_e,ve,me))}))})),he},clone=function(he,ge,me){if(Oe(he))return he.slice(0);const be={};return forEach(he,((ve,_e)=>{ge&&-1===ge.indexOf(_e)||me&&-1!==me.indexOf(_e)||he.hasOwnProperty(_e)&&(be[_e]=ve)})),be},deepClone=function(he){let ge={};return Oe(he)&&(ge=[]),forEach(he,((he,me)=>{isObject(he)||Oe(he)?ge[me]=deepClone(he):ge[me]=he})),ge},unique=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he=>he;const me={};return he.filter((he=>{const be=ge(he);return!me.hasOwnProperty(be)&&(me[be]=1,!0)}))},matchAny=function(he,ge,me){Oe(he)||(he=[he]),me||(me="*");let be=!1;for(let ve=0;ve<he.length;ve++){const _e=he[ve];if(!Oe(ge)&&_e==ge){be=!0;break}if(Oe(ge)){let he=-1;for(let be=0;be<ge.length;be++){const ve=ge[be];if(!(Oe(ve)||ve!=_e&&ve!==me)){he=be;break}if(Oe(ve)){const ge=ve[0],me=ve[1]||ge;if(_e>=ge&&_e<=me){he=be;break}}}if(-1!==he){be=!0;break}}}return be},cathetus=function(he,ge){return Math.sqrt(he*he-ge*ge)},areaToRadius=function(he){return Math.sqrt(he/Math.PI)},warn=function(he){return he=Array.prototype.slice.call(arguments).map((he=>he instanceof Object?JSON.stringify(he,null,4):he)).join(" "),console&&"function"==typeof console.warn&&console.warn(he),!0},error=function(he){console&&"function"==typeof console.error&&(he.stack?console.error(he.stack):console.error(he),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},addClass=function(he,ge){he.classList?he.classList.add(ge):he.className+=" "+ge},removeClass=function(he,ge){he.classList?he.classList.remove(ge):he.className=he.className.replace(new RegExp("(^|\\b)"+ge.split(" ").join("|")+"(\\b|$)","gi")," ")},hasClass=(he,ge)=>he.classList?he.classList.contains(ge):new RegExp("(^| )"+ge+"( |$)","gi").test(he.className),throttle=function(he,ge){let me,be,ve,_e=!1;const __recallLast=function(){_e&&(_e=!1,he.apply(be,me))},wrapper=function(){if(ve>Date.now())return _e=!0,me=arguments,void(be=this);ve=Date.now()+ge,_e=!1,he.apply(this,arguments),setTimeout((()=>{__recallLast()}),ge)};return wrapper.recallLast=__recallLast,wrapper},arraySum=function(he){return he.reduce(((he,ge)=>he+ge))},diffObject=function(he,ge){const me={};return forEach(ge,((ge,be)=>{!he.hasOwnProperty(be)&&isPlainObject(ge)&&(me[be]=diffObject({},ge))})),forEach(he,((he,be)=>{if(ge.hasOwnProperty(be)){if(he!==ge[be])if(isPlainObject(he)&&isPlainObject(ge[be]))if(isEmpty(he))isEmpty(ge[be])||(me[be]={});else{const ve=diffObject(he,ge[be]);Object.keys(ve).length>0&&(me[be]=ve)}else Oe(he)&&Oe(ge[be])&&deepArrayEquals(he,ge[be])||(me[be]=he)}else me[be]=he})),me},defer=function(he){setTimeout(he,1)},nestArrayToObj=function(he){if(!he||!he.length||!he[0].key)return he;const ge={};for(let me=0;me<he.length;me++)ge[he[me].key]=nestArrayToObj(he[me].values);return ge},nestArrayToObjWithFlatKeys=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},me=arguments.length>2?arguments[2]:void 0,be=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!he||!he.length||!he[0].key)return me?(me+="]",!ge[me]&&(ge[me]={}),ge[me][be]=he):ge[be]=he,he;be&&(me=me?me+","+JSON.stringify(be):"["+JSON.stringify(be));for(let be=0;be<he.length;be++)nestArrayToObjWithFlatKeys(he[be].values||he[be].value,ge,me,he[be].key);return ge},nestArrayToValues=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(he&&he.length&&he[0].key){for(let me=0;me<he.length;me++)nestArrayToValues(he[me].values||he[me].value,ge);return ge}ge.push(...he)},ajax=function(he){const ge=new XMLHttpRequest;ge.open(he.method,he.url,!0),"POST"!==he.method||he.json?"POST"===he.method&&he.json&&ge.setRequestHeader("Content-Type","application/json; charset=UTF-8"):ge.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),ge.onload=function(){if(ge.status>=200&&ge.status<400){const me=he.json?JSON.parse(ge.responseText):ge.responseText;he.success&&he.success(me)}else he.error&&he.error()},ge.onerror=function(){he.error&&he.error()},ge.send(he.data)},debounce=function(he,ge,me){let be;return function(){const ve=this,_e=arguments,xe=me&&!be;clearTimeout(be),be=setTimeout((function(){be=null,me||he.apply(ve,_e)}),ge),xe&&he.apply(ve,_e)}},isTouchDevice=function(){return!!("ontouchstart"in document.documentElement)},pruneTree=function(he,ge){const me={};let be=[];return he.hasOwnProperty("children")&&(be=he.children.map((he=>pruneTree(he,ge))).filter((he=>0!==Object.keys(he).length))),(0!=be.length||ge(he))&&forEach(he,((he,ge)=>{me[ge]=he})),0!=be.length&&(me.children=be),me},eachTree=function(he,ge,me){he.hasOwnProperty("children")&&he.children.forEach((me=>eachTree(me,ge,he))),ge(he,me)},setIcon=function(he,ge){const me=he.node().ownerDocument.importNode((new DOMParser).parseFromString(ge,"application/xml").documentElement,!0);return me.setAttribute("width","0px"),me.setAttribute("height","0px"),he.selectAll(".svg-icon").remove(),he.node().appendChild(me),he};function firstBy(){function identity(he){return he}function ignoreCase(he){return"string"==typeof he?he.toLowerCase():he}return function tb(he,ge){const me="function"==typeof this&&this,be=function makeCompareFunction(he,ge){if(ge="number"==typeof ge?{direction:ge}:ge||{},"function"!=typeof he){const ge=he;he=function(he){return he[ge]?he[ge]:""}}if(1===he.length){const me=he,be=ge.ignoreCase?ignoreCase:identity;he=function(he,ge){return be(me(he))<be(me(ge))?-1:be(me(he))>be(me(ge))?1:0}}return-1===ge.direction?function(ge,me){return-he(ge,me)}:he}(he,ge),ve=me?function(he,ge){return me(he,ge)||be(he,ge)}:be;return ve.thenBy=tb,ve}}function transform(he){const{a:ge,b:me,c:be,d:ve,e:_e,f:xe}=he.transform.baseVal.consolidate().matrix;return function(he,ge,me,be,ve,_e){let xe=Math.sqrt(he*he+ge*ge),we=Math.sqrt(me*me+be*be),Me=he*me+ge*be;return xe&&(he/=xe,ge/=xe),Me&&(me-=he*Me,be-=ge*Me),we&&(me/=we,be/=we,Me/=we),he*be<ge*me&&(he=-he,ge=-ge,Me=-Me,xe=-xe),{translateX:ve,translateY:_e,rotate:Math.atan2(ge,he)*Math.PI/180,skewX:Math.atan(Me)*Math.PI/180,scaleX:xe,scaleY:we}}(ge,me,be,ve,_e,xe)}const capitalize=he=>he.slice(0,1).toUpperCase()+he.slice(1).toLowerCase();const getProp=(he,ge,me)=>{for(let be of Array.isArray(ge)?ge:[ge]){if(!he.hasOwnProperty(be))return me;he=he[be]}return he},replaceNumberSpacesToNonBreak=he=>he?he.replace(/\d{1,3}(?: \d{3})+(?=\W)/g,(he=>he.replace(/ /g,"Â "))):he,getSubtitle=(he,ge)=>{let me=(null!=he?he:"").replace(ge,"");","===me[0]&&(me=me.slice(1));const be=/^\((.*)\)$|.*/.exec(me.trim());return be[1]||be[0]||""},normaliseLink=he=>he?0===he.indexOf("http://")||0===he.indexOf("https://")?he:0===he.indexOf("//")?"http://"+he.slice(2):"http://"+he:he,rebind=function(he,ge){let me,be=1;const ve=arguments.length;for(;++be<ve;)he[me=arguments[be]]=d3_rebind(he,ge,ge[me]);return he};function d3_rebind(he,ge,me){return function(){const be=me.apply(ge,arguments);return be===ge?he:be}}var Ce=Object.freeze({__proto__:null,d3json:function(he,ge){me.json(he).then((he=>ge(null,he))).catch((he=>ge(he)))},d3text:function(he,ge){me.text(he).then((he=>ge(null,he))).catch((he=>ge(he)))},approxEqual:function(he,ge,me){return me=me||0,ge>0?(1-me)*ge<=he&&he<=ge*(1+me):ge<0?(1+me)*ge<=he&&he<=ge*(1-me):Math.abs(he)<=me},printAutoconfigResult:function(he){console.info("AUTOCONFIG: "+he._name+(he.isHook()?" of "+he._parent._name:"")+" choses "+(he.dim||he.which)+" from "+(he.dataSource?he.dataSource._name:"<DATA SOURCE MISSING!>")+" to be "+("entities"===he._type||"time"===he._type?"DIM":"WHICH"))},uniqueId:ze,isElement:function(he){return!(!he||1!==he.nodeType)},isArray:Oe,isObject:isObject,isDate:isDate,isString:isString,isNaN:isNaN$1,isEmpty:isEmpty,isNumber:isNumber,isPlainObject:isPlainObject,arrayEquals:function(he,ge){if(he===ge)return!0;if(null==he||null==ge)return!1;if(he.length!=ge.length)return!1;for(let me=0;me<he.length;++me)if(he[me]!==ge[me])return!1;return!0},deepArrayEquals:deepArrayEquals,comparePlainObjects:comparePlainObjects,getViewportPosition:function(he){let ge=0,me=0;for(;he;)ge+=he.offsetLeft-he.scrollLeft+he.clientLeft,me+=he.offsetTop-he.scrollTop+he.clientTop,he=he.offsetParent;return{x:ge,y:me}},strToFloat:function(he){return+he.replace(/[^\d.-]/g,"")},forEach:forEach,extend:extend,deepExtend:deepExtend,merge:function(he){const ge=Array.prototype.slice.call(arguments,1);return forEach(ge,(ge=>{forEach(ge,((me,be)=>{ge.hasOwnProperty(be)&&(he.hasOwnProperty(be)?(Oe(he[be])||(he[be]=[he[be]]),he[be].push(me)):he[be]=me)}))})),he},clone:clone,deepClone:deepClone,without:function(he,ge){const me=he.indexOf(ge);return-1!==me&&he.splice(me,1),he},unique:unique,uniqueLast:function(he,ge){const me={},be=[];ge||(ge=function(he){return he});for(let ve=0,_e=he.length;ve<_e;ve+=1){const _e=ge(he[ve]);me.hasOwnProperty(_e)&&be.splice(me[_e],1),be.push(he[ve]),me[_e]=be.length-1}return be},find:function(he,ge){let me;return forEach(he,(he=>{if(ge(he))return me=he,!1})),me},filter:function(he,ge){let me=-1;const be=he.length;let ve=-1;const _e=[],xe=Object.keys(ge),we=xe.length;let Me,Se;for(;(me+=1)<be;){const be=he[me];let De=!0;for(Me=0;Me<we;Me+=1)if(Se=xe[Me],!be.hasOwnProperty(Se)||be[Se]!==ge[Se]){De=!1;break}De&&(_e[ve+=1]=be)}return _e},filterAny:function(he,ge,me){let be=-1;const ve=he.length;let _e=-1;const xe=[],we=Object.keys(ge),Me=we.length;let Se,De;for(;(be+=1)<ve;){const ve=he[be];let ze=!0;for(Se=0;Se<Me;Se+=1)if(De=we[Se],!ve.hasOwnProperty(De)||!matchAny(ve[De],ge[De],me)){ze=!1;break}ze&&(xe[_e+=1]=ve)}return xe},matchAny:matchAny,preventAncestorScrolling:function(he){let ge=!1;he.on("mousewheel",(function(be){const ve=this.scrollTop,_e=this.scrollHeight,xe=he.node().offsetHeight,we=be.wheelDelta,Me=we>0,scrollTopTween=function(he){return function(){const ge=this,be=me.interpolateNumber(this.scrollTop,he);return function(he){ge.scrollTop=be(he)}}};if(Me?Me&&(we>ve&&ve>0?(he.transition().delay(0).duration(0).tween("scrolltween",scrollTopTween(0)),ge=!0,setTimeout((()=>{ge=!1}),2e3)):_e==xe+ve&&(ge=!1)):-we>_e-xe-ve&&_e!=xe+ve?(he.transition().delay(0).duration(0).tween("scrolltween",scrollTopTween(_e)),ge=!0,setTimeout((()=>{ge=!1}),2e3)):0==ve&&(ge=!1),ge)return be.stopPropagation(),be.preventDefault(),be.returnValue=!1,!1}))},radiusToArea:function(he){return he*he*Math.PI},hypotenuse:function(he,ge){return Math.sqrt(he*he+ge*ge)},cathetus:cathetus,areaToRadius:areaToRadius,timeStamp:function(he){console&&"function"==typeof console.timeStamp&&console.timeStamp(he)},warn:warn,groupCollapsed:function(he){he=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(he)},groupEnd:function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},error:error,countDecimals:function(he){return Math.floor(he.valueOf())===he.valueOf()?0:he.toString().split(".")[1].length||0},addClass:addClass,removeClass:removeClass,classed:function(he,ge,me){if(!0===me)addClass(he,ge);else{if(!1!==me)return hasClass(he,ge);removeClass(he,ge)}},hasClass:hasClass,throttle:throttle,keys:function(he){return Object.keys(he)},values:function(he){const ge=[],me=Object.keys(he),be=me.length;for(let ve=0;ve<be;ve+=1)ge.push(he[me[ve]]);return ge},arrayMin:function(he){return he.reduce(((he,ge)=>he<ge?he:ge))},arrayMax:function(he){return he.reduce(((he,ge)=>he>ge?he:ge))},arrayMean:function(he){return arraySum(he)/he.length},arraySum:arraySum,arrayMedian:he=>{he=he.sort(((he,ge)=>he-ge));const ge=Math.floor((he.length-1)/2);return he.length%2?he[ge]:(he[ge]+he[ge+1])/2},arrayLast:function(he){return he.length?he[he.length-1]:null},diffObject:diffObject,defer:defer,delay:function(he){return new Promise((ge=>setTimeout(ge,he)))},clearDelay:function(he){return clearTimeout(he)},hashCode:function(he){isString(he)||(he=JSON.stringify(he));let ge=0;const me=he.length;let be;if(0===me)return ge;for(let ve=0;ve<me;ve+=1)be=he.charCodeAt(ve),ge=(ge<<5)-ge+be,ge&=ge;return ge.toString()},nestArrayToObj:nestArrayToObj,nestArrayToObjWithFlatKeys:nestArrayToObjWithFlatKeys,nestArrayToValues:nestArrayToValues,interpolateVector:function(){},ajax:ajax,get:function(he,ge,me,be,ve){forEach(ge=ge||[],((he,me)=>{ge.push(me+"="+he)})),he=ge.length?he+"?"+ge.join("&"):he,ajax({method:"GET",url:he,success:me,error:be,json:ve})},post:function(he,ge,me,be,ve){ajax({method:"POST",url:he,success:me,error:be,json:ve,data:ge})},memoize:function(he){return function(){const ge=Array.prototype.slice.call(arguments);let me="",be=ge.length,ve=null;for(;be--;)ve=ge[be],me+=ve===Object(ve)?JSON.stringify(ve):ve,he.memoize||(he.memoize={});return me in he.memoize?he.memoize[me]:he.memoize[me]=he.apply(this,ge)}},debounce:debounce,isTouchDevice:isTouchDevice,pruneTree:pruneTree,eachTree:eachTree,setIcon:setIcon,makeAbsoluteContext:function makeAbsoluteContext(he,ge){return function(me,be){const ve=ge.getBoundingClientRect(),_e=he.getScreenCTM();return{x:_e.a*me+_e.c*be+_e.e-ve.left,y:_e.b*me+_e.d*be+_e.f-ve.top}}},firstBy:firstBy,transform:transform,capitalize:capitalize,isMobileOrTablet:function(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(he)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(he.substr(0,4))},getKey:function getKey(he,ge){let me=he[ge[0]];for(let be=1,ve=ge.length;be<ve;be++)me=me+","+he[ge[be]];return me},isFunction:he=>"function"==typeof he,getProp:getProp,px2num:he=>isString(he)&&he.endsWith("px")?parseFloat(he):console.warn("Strange pixels value: ".concat(he))||he,replaceNumberSpacesToNonBreak:replaceNumberSpacesToNonBreak,getSubtitle:getSubtitle,getBrowserDetails:()=>{const he=navigator.userAgent;let ge,me,be,ve=navigator.appName,_e=""+parseFloat(navigator.appVersion),xe=parseInt(navigator.appVersion,10);const we=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1;return-1!=(me=he.indexOf("Opera"))?(ve="Opera",_e=he.substring(me+6),-1!=(me=he.indexOf("Version"))&&(_e=he.substring(me+8))):-1!=(me=he.indexOf("MSIE"))?(ve="Microsoft Internet Explorer",_e=he.substring(me+5)):-1!=(me=he.indexOf("Chrome"))?(ve="Chrome",_e=he.substring(me+7)):-1!=(me=he.indexOf("Safari"))?(ve="Safari",_e=he.substring(me+7),-1!=(me=he.indexOf("Version"))&&(_e=he.substring(me+8))):-1!=(me=he.indexOf("Firefox"))?(ve="Firefox",_e=he.substring(me+8)):(ge=he.lastIndexOf(" ")+1)<(me=he.lastIndexOf("/"))&&(ve=he.substring(ge,me),_e=he.substring(me+1),ve.toLowerCase()==ve.toUpperCase()&&(ve=navigator.appName)),-1!=(be=_e.indexOf(";"))&&(_e=_e.substring(0,be)),-1!=(be=_e.indexOf(" "))&&(_e=_e.substring(0,be)),xe=parseInt(""+_e,10),isNaN$1(xe)&&(_e=""+parseFloat(navigator.appVersion),xe=parseInt(navigator.appVersion,10)),(we?"Electron ":"")+ve+" "+xe+" ("+_e+")"},normaliseLink:normaliseLink,getOSname:()=>{let he="Unknown";return-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(he="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(he="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(he="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(he="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(he="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(he="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(he="Mac/iOS"),-1!=window.navigator.userAgent.indexOf("X11")&&(he="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(he="Linux"),he},rebind:rebind});const ke={INIT:"init",PENDING:"pending",READY:"fulfilled",ERROR:"rejected"};function isEntityConcept(){return["entity_set","entity_domain"].includes((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).concept_type)}function getSpaceName(he,ge){return ge||(ge=he.data.space),Oe(ge)||(ge=[ge]),ge.map((ge=>he.data.source.getConcept(ge).name)).join(", ")}function requestEntityNames(he,ge){Oe(ge)||(ge=[ge]);const me=ge.map((ge=>he.query({select:{key:[ge],value:["name"]},from:"entities"}).then((he=>({data:he,dim:ge})))));return Promise.all(me)}function getConceptName(he,ge){const me=he.data.conceptProps;return he.data.isConstant?ge("indicator/"+he.data.constant+"/"+he.scale.modelType):me.name||me.concept||ge(he.name)}function getConceptShortName(he,ge){const me=he.data.conceptProps;return he.data.isConstant?ge("indicator/"+he.data.constant+"/"+he.scale.modelType):me.name_short||getConceptName(he,ge)}function getChildrenDefaultState(he,ge){const me=deepClone(ge);return deepExtend(me,he)}var Te=Object.freeze({__proto__:null,STATUS:ke,injectIndexes:function injectIndexes(he){return he.map(((he,ge)=>Object.assign({},he,{i:ge})))},isEntityConcept:isEntityConcept,getSpaceName:getSpaceName,getConceptNameCompliment:function getConceptNameCompliment(he){const ge=he.data.filter.dimensions;return ge||Promise.resolve(""),requestEntityNames(he.data.source,Object.keys(ge)).then((he=>he.map((he=>{let{data:me,dim:be}=he;const ve=ge[be][be];return me.raw.find((he=>he[be]==ve)).name})).join(", ")))},requestEntityNames:requestEntityNames,getConceptName:getConceptName,getConceptShortName:getConceptShortName,getConceptNameMinusShortName:function getConceptNameMinusShortName(he,ge){const me=getConceptName(he,ge),be=getConceptShortName(he,ge);if(he.data.isConstant)return me;let ve=me.replace(be,"");","===ve[0]&&(ve=ve.slice(1)),ve=ve.trim();const _e=/^\((.*)\)$|.*/.exec(ve);return _e[1]||_e[0]||""},getDefaultStateTree:function getDefaultStateTree(he,ge){const me=getChildrenDefaultState(he,ge.DEFAULT_UI);return ge.children.forEach((he=>{he.name?me[he.name]=getDefaultStateTree(me[he.name],he):deepExtend(me,getDefaultStateTree(me,he))})),me},getChildrenDefaultState:getChildrenDefaultState,clearEmpties:function clearEmpties(he){for(const ge in he)!he[ge]||"object"!=typeof he[ge]||he[ge]instanceof Date||(clearEmpties(he[ge]),0===Object.keys(he[ge]).length&&delete he[ge]);return he},mergeInTarget:function mergeInTarget(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],be=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";for(const ve in ge)"object"!=typeof ge[ve]||Array.isArray(ge[ve])||null===ge[ve]?he[ve]=ge[ve]:he[ve]&&!me.some((he=>(be+"."+ve).endsWith(he)))?mergeInTarget(he[ve],ge[ve],me,be+"."+ve):he[ve]=deepExtend({},ge[ve]);return he},replaceProps:function replaceProps(he,ge){for(const me in he)"object"!=typeof he[me]||Array.isArray(he[me])||null===he[me]?void 0!==ge[me]?he[me]=ge[me]:delete he[me]:replaceProps(he[me],ge[me]||{});return he},computeObjectsSimilarityScore:function computeObjectsSimilarityScore(he,ge){let me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";function isThereASpecialKeySubstringInBoth(he,ge,me){return me&&Object.keys(he).find((he=>he.includes(me)))&&Object.keys(ge).find((he=>he.includes(me)))}const be=function compare(he,ge){let be=0,ve=0;for(const _e in he)if("object"!=typeof he[_e]||Array.isArray(he[_e])||null==he[_e]||null==ge[_e])he[_e]==ge[_e]?be++:null!=he[_e]&&null!=ge[_e]?be+=.5:isThereASpecialKeySubstringInBoth(he,ge,me)&&(be+=.1),ve++;else{const me=compare(he[_e],ge[_e]);be+=me.score,ve+=me.total}return{score:be,total:ve}}(he,ge);return be.score/be.total}});function axisSmart$1(he){return function d3_axis_smart(ge){const be="vertical axis",ve="horizontal axis",_e="labels stack side by side",xe="labels stack top to bottom",we="optimistic approximation: labels have different lengths",Me="pessimistic approximation: all labels have the largest length";function onlyUnique(he,ge,me){return me.indexOf(he)===ge}function axis(he){const we=axis.scale().domain(),Me=axis.scale().range();if(!we.length||!Me.length||[...we,...Me].some((he=>null==he||isNaN(he))))return De=null,warn("axisSmart() skips action because of bad domain ".concat(we," or range ").concat(Me," of the attached scale"));if(null!=De)return void axis.highlightValueRun(he);const Se=he.append("g").attr("class","tick widthSampling"),ze=Se.append("text").text("0M");Le.cssMargin||(Le.cssMargin={}),Le.cssMargin.top=ze.style("margin-top"),Le.cssMargin.bottom=ze.style("margin-bottom"),Le.cssMargin.left=ze.style("margin-left"),Le.cssMargin.right=ze.style("margin-right"),Le.widthOfOneDigit=.5*ze.node().getBBox().width,Le.heightOfOneDigit=ze.node().getBBox().height,Se.remove(),axis.labelFactory(Le);let Oe=null;Le.transitionDuration>0?ge(Oe=he.transition().duration(Le.transitionDuration)):ge(he),he.attr("fill",null),he.attr("font-size",null),he.attr("font-family",null),he.attr("text-anchor",null);const Ce="top"==axis.orient()||"bottom"==axis.orient()?ve:be,Te=Ce==ve&&axis.pivot()||Ce==be&&!axis.pivot()?xe:_e;he.selectAll(".vzb-axis-value").data([null]).enter().call((he=>{he.append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text").each((function(){const he=me.select(this);he.classed("stroke",!0),he.style("paint-order").length||he.clone().classed("stroke",!1)})),he.append("g").attr("class","vzb-axis-value vzb-axis-value-shadow").style("opacity",0).append("text")}));const Ae=axis.tickPadding();if(he.selectAll("text").each((function(){if(null==axis.pivot())return;const he=me.select(this);he.attr("transform","rotate("+(axis.pivot()?-90:0)+")"),he.style("text-anchor",Le.textAnchor||(Te==_e?"middle":"end")),he.attr("x",Te==_e?Ce==be?-Ae:0:-Ae),he.attr("y",Te==_e?Ce==be?0:Ae:0),he.attr("dx",Te==_e&&Ce==be?Ae:0),he.attr("dy",Te==_e?Ce==be?-Ae:".72em":".32em")})),null!=axis.repositionLabels()){const patchLabelsPosition=()=>{he.selectAll(".tick").each((function(he){const ge=me.select(this).select("text"),be=axis.repositionLabels()[he]||{x:0,y:0};ge.attr("x",+ge.attr("x")+be.x),ge.attr("y",+ge.attr("y")+be.y)}))};Oe?Oe.on("end",(()=>patchLabelsPosition())):patchLabelsPosition()}const Ee=axis.scale();Le.viewportLength&&he.selectAll(".tick").classed("vzb-hidden",(he=>Ee(he)<0||Ee(he)>Le.viewportLength)),null==axis.tickValuesMinor()&&axis.tickValuesMinor([]);let je=he.selectAll(".tick-minor").data(ke);je.exit().remove(),je=je.enter().append("line").attr("class","tick-minor").merge(je);const Re=axis.tickSizeMinor().outbound,Fe=axis.tickSizeMinor().inbound;Le.viewportLength&&je.classed("vzb-hidden",(he=>Ee(he)<0||Ee(he)>Le.viewportLength)),je.attr("y1",Ce==ve?("top"==axis.orient()?1:-1)*Fe:Ee).attr("y2",Ce==ve?("top"==axis.orient()?-1:1)*Re:Ee).attr("x1",Ce==be?("right"==axis.orient()?-1:1)*Fe:Ee).attr("x2",Ce==be?("right"==axis.orient()?1:-1)*Re:Ee),he.selectAll("path").remove();let Ie=he.selectAll(".vzb-axis-line").data([0]);Ie.exit().remove(),Ie=Ie.enter().append("line").attr("class","vzb-axis-line").merge(Ie),Le.viewportLength?Ie.attr("x1",Ce==be?0:-1).attr("x2",Ce==be?0:Le.viewportLength).attr("y1",0).attr("y2",Ce==ve?0:Le.viewportLength):Ie.attr("x1",Ce==be?0:me.min(Ee.range())-(Le.bump||0)-1).attr("x2",Ce==be?0:me.max(Ee.range())+(Le.bump||0)).attr("y1",Ce==ve?0:me.min(Ee.range())-(Le.bump||0)).attr("y2",Ce==ve?0:me.max(Ee.range())+(Le.bump||0))}axis.highlightValueRun=function(he){Le.viewportLength&&"none"!=De&&(axis.scale()(De)>Le.viewportLength||axis.scale()(De)<0)&&(De="none");const ge="top"==axis.orient()||"bottom"==axis.orient()?ve:be,_e=ge==ve&&axis.pivot()||ge==be&&!axis.pivot()?"y":"x",xe=axis.pivot()?-1:1;let we;he.select(".vzb-axis-value").classed("vzb-hidden","none"==De),he.select(".vzb-axis-value-shadow").select("text").text("none"==De?"":Le.formatter(De));const Me={};"none"!=De&&(we=he.select(".vzb-axis-value-shadow").node().getBBox(),Me.bump=Le.bump,Me.formatter=Le.formatter,Me.viewportLength=Le.viewportLength,Me.toolMargin=Le.toolMargin,Me.cssMargin=Le.cssMargin,Me.widthOfOneDigit=we[axis.pivot()?"height":"width"]/Le.formatter(De).length,Me.heightOfOneDigit=we[axis.pivot()?"width":"height"]);const Se=("none"==De?{x:0,y:0}:repositionLabelsThatStickOut([De],Me,ge,axis.scale(),_e)[De])[_e],getTransform=function(){return"none"==De?"translate(0,0)":"translate("+(ge==ve?axis.scale()(De)+Se*xe:0)+","+(ge==be?axis.scale()(De)+Se*xe:0)+")"},getOpacity=function(he,me,be){if("none"==De)return 1;const Me=ge==ve?"width":"height",ze=((axis.repositionLabels()||{})[he]||{x:0,y:0})[_e];return axis.hlOpacityScale()(Math.abs(axis.scale()(he)+ze*xe-axis.scale()(De)-Se*xe)-be.getBBox()[Me]/2-we[Me]/2)};ze?(he.select(".vzb-axis-value").transition().duration(ze).ease(me.easeLinear).attr("transform",getTransform),he.select(".vzb-axis-value").selectAll("text").interrupt("text"+("none"==De?"on":"off")).transition("text"+("none"==De?"off":"on")).delay(ze).text("none"==De?"":Le.formatter(De)),he.selectAll(".tick:not(.vzb-hidden)").each((function(he,ge){me.select(this).select("text").transition().duration(ze).ease(me.easeLinear).style("opacity",getOpacity(he,0,this))}))):(he.select(".vzb-axis-value").interrupt().attr("transform",getTransform),he.select(".vzb-axis-value").selectAll("text").interrupt("texton").interrupt("textoff").text("none"==De?"":Le.formatter(De)),he.selectAll(".tick:not(.vzb-hidden)").each((function(he,ge){me.select(this).select("text").interrupt().style("opacity",getOpacity(he,0,this))}))),De=null};let Se=me.scaleLinear().domain([0,5]).range([0,1]).clamp(!0);axis.hlOpacityScale=function(he){return arguments.length?(Se=he,axis):Se};let De=null;axis.highlightValue=function(he){return arguments.length?(De=he,axis):De};let ze=0;axis.highlightTransDuration=function(he){return arguments.length?(ze=he,axis):ze};let Oe=null;axis.repositionLabels=function(he){return arguments.length?(Oe=he,axis):Oe};let Ce=!1;axis.pivot=function(he){return arguments.length?(Ce=!!he,axis):Ce};let ke=[];axis.tickValuesMinor=function(he){return arguments.length?(ke=he,axis):ke};let Te={outbound:0,inbound:0};axis.tickSizeMinor=function(he,ge){return arguments.length?(Te={outbound:he,inbound:ge||0},meow("setting",Te),axis):Te};let Le={};function groupByPriorities(he,ge){null==ge&&(ge=!0);const me=[],be=[];-1!=he.indexOf(0)&&(me.push([0]),be.push(he.indexOf(0)));for(let ve=he.length;ve>=1;ve=ve<4?ve-1:ve/2)me.push(he.filter(((he,me)=>!(me%Math.floor(ve)!=0||-1!=be.indexOf(me)&&ge)&&(be.push(me),!0))));return me}function repositionLabelsThatStickOut(he,ge,_e,xe,we){if(!he)return null;const Me={},Se=_e==be?{head:ge.toolMargin.top,tail:ge.toolMargin.bottom}:{head:ge.toolMargin.right,tail:ge.toolMargin.left};let De=xe.range(),ze=ge.bump;return ge.viewportLength&&(he=he.filter((he=>xe(he)>=0&&xe(he)<=ge.viewportLength)),De=[0,ge.viewportLength],ze=0),he.forEach(((Oe,Ce)=>{if(0!=Ce&&Ce!=he.length-1)return;let ke=Math.min(Se.head,.5*ge.widthOfOneDigit)+ze+(_e==ve?1:0)*me.max(De)-(_e==ve?0:1)*me.min(De)+(_e==ve?-1:1)*xe(Oe)-("x"==we)*ge.formatter(Oe).length*ge.widthOfOneDigit/2-("y"==we)*ge.heightOfOneDigit/2-("x"==we)*parseInt(ge.cssMargin.right)-("y"==we)*parseInt(ge.cssMargin.top),Te=Math.min(Se.tail,.5*ge.widthOfOneDigit)+ze+(_e==be?1:0)*me.max(De)-(_e==be?0:1)*me.min(De)+(_e==be?-1:1)*xe(Oe)-("x"==we)*ge.formatter(Oe).length*ge.widthOfOneDigit/2-("y"==we)*ge.heightOfOneDigit/2-("x"==we)*parseInt(ge.cssMargin.left)-("y"==we)*parseInt(ge.cssMargin.bottom);ke>0&&(ke=0),Te>0&&(Te=0),Me[Oe]={x:0,y:0},Me[Oe][we]=("y"==we&&_e==be?-1:1)*(ke-Te)})),he.forEach(((me,Se)=>{if(0==Se||Se==he.length-1)return;let De=Math.abs(xe(me)-xe(he[he.length-1]))-("y"==we)*(_e==ve?-1:1)*Me[he[he.length-1]][we]-("x"==we)*(_e==ve?1:-1)*Me[he[he.length-1]][we]-("x"==we)*ge.widthOfOneDigit/2*ge.formatter(me).length-("x"==we)*ge.widthOfOneDigit/2*ge.formatter(he[he.length-1]).length-("y"==we)*ge.heightOfOneDigit*.7-("x"==we)*parseInt(ge.cssMargin.left)-("y"==we)*parseInt(ge.cssMargin.bottom),ze=Math.abs(xe(me)-xe(he[0]))-("y"==we)*(_e==be?-1:1)*Me[he[0]][we]-("x"==we)*(_e==be?1:-1)*Me[he[0]][we]-("x"==we)*ge.widthOfOneDigit/2*ge.formatter(me).length-("x"==we)*ge.widthOfOneDigit/2*ge.formatter(he[0]).length-("y"==we)*ge.heightOfOneDigit*.7-("x"==we)*parseInt(ge.cssMargin.left)-("y"==we)*parseInt(ge.cssMargin.bottom);De>0&&(De=0),ze>0&&(ze=0),Me[me]={x:0,y:0},Me[me][we]=("y"==we&&_e==be?-1:1)*(De-ze)})),Me}return axis.labelerOptions=function(he){return arguments.length?(Le=he,axis):Le},axis.METHOD_REPEATING="repeating specified powers",axis.METHOD_DOUBLING="doubling the value",axis.labelFactory=function(he){if(null==he&&(he={}),he.ticks)return axis.tickValues(he.ticks).tickValuesMinor(he.ticksMinor||[]).pivot(he.pivot||!1).tickFormat(he.formatter).repositionLabels(he.repositionLabels);if("linear"!=he.scaleType&&"time"!=he.scaleType&&"genericLog"!=he.scaleType&&"log"!=he.scaleType&&"ordinal"!=he.scaleType)return axis.ticks(he.limitMaxTickNumber).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==he.scaleType)return axis;null==he.logBase&&(he.logBase=10),null==he.stops&&(he.stops=[1,2,5,3,7,4,6,8,9]),null==he.removeAllLabels&&(he.removeAllLabels=!1),null==he.formatter&&(he.formatter=axis.tickFormat()?axis.tickFormat():function(he){return he+""}),he.cssLabelMarginLimit=5,null==he.cssMargin&&(he.cssMargin={}),(null==he.cssMargin.left||parseInt(he.cssMargin.left)<he.cssLabelMarginLimit)&&(he.cssMargin.left=he.cssLabelMarginLimit+"px"),(null==he.cssMargin.right||parseInt(he.cssMargin.right)<he.cssLabelMarginLimit)&&(he.cssMargin.right=he.cssLabelMarginLimit+"px"),(null==he.cssMargin.top||parseInt(he.cssMargin.top)<he.cssLabelMarginLimit)&&(he.cssMargin.top=he.cssLabelMarginLimit+"px"),(null==he.cssMargin.bottom||parseInt(he.cssMargin.bottom)<he.cssLabelMarginLimit)&&(he.cssMargin.bottom=he.cssLabelMarginLimit+"px"),null==he.toolMargin&&(he.toolMargin={left:30,bottom:30,right:30,top:30}),null==he.bump&&(he.bump=0),null==he.viewportLength&&(he.viewportLength=0),null==he.pivotingLimit&&(he.pivotingLimit=he.toolMargin[this.orient()]),null==he.showOuter&&(he.showOuter=!1),null==he.limitMaxTickNumber&&(he.limitMaxTickNumber=0);const ge="top"==this.orient()||"bottom"==this.orient()?ve:be;null==he.isPivotAuto&&(he.isPivotAuto=ge==be),null==he.cssFontSize&&(he.cssFontSize="13px"),null==he.widthToFontsizeRatio&&(he.widthToFontsizeRatio=.75),null==he.heightToFontsizeRatio&&(he.heightToFontsizeRatio=1.2),null==he.widthOfOneDigit&&(he.widthOfOneDigit=parseInt(he.cssFontSize)*he.widthToFontsizeRatio),null==he.heightOfOneDigit&&(he.heightOfOneDigit=parseInt(he.cssFontSize)*he.heightToFontsizeRatio),null!=he.fitIntoScale&&"pessimistic"!=he.fitIntoScale||(he.fitIntoScale=Me),"optimistic"==he.fitIntoScale&&(he.fitIntoScale=we),meow("********** "+ge+" **********");const _e=axis.scale().domain(),xe=axis.scale().range(),Se=Math.abs(xe[xe.length-1]-xe[0]),De=me.min([_e[0],_e[_e.length-1]]),ze=me.max([_e[0],_e[_e.length-1]]),Oe=("linear"==he.scaleType?De<0:De<=0)&&ze>=0&&"time"!=he.scaleType;let Ce=he.showOuter?[De,ze]:[],ke=[],Te=5;function getBaseLog(ge,me){return 0==ge||0==me?0:(null==me&&(me=he.logBase),Math.log(ge)/Math.log(me))}const Le=me.max(me.range(De,ze,(ze-De)/17).concat(ze).map((ge=>he.formatter(ge).replace(".","").length)))*he.widthOfOneDigit+parseInt(he.cssMargin.left),Ae=he.isPivotAuto&&(Le>he.pivotingLimit&&ge==be||!(Le>he.pivotingLimit)&&!(ge==be)),Ee=ge==ve&&Ae||ge==be&&!Ae,je=!Ee&&he.heightOfOneDigit>he.pivotingLimit;if(he.removeAllLabels)return axis.tickValues([]);if(De==ze)return axis.tickValues([De]).ticks(1).tickFormat(he.formatter);const labelsFitIntoScale=function(ge,be,ve,_e){if(null==ge||ge.length<=1)return!0;if(null==ve&&(ve=Me),Ee)return be>ge.length*(he.heightOfOneDigit+parseInt(he.cssMargin.top)+parseInt(he.cssMargin.bottom));const xe=parseInt(he.cssMargin.left)+parseInt(he.cssMargin.right),Se=me.max(ge.map((ge=>he.formatter(ge).length)));return"log"==_e?(be=Math.abs(axis.scale()(me.max(ge))-axis.scale()(me.min(ge))))>me.sum(ge.map((ge=>(he.widthOfOneDigit*(ve==Me?Se:he.formatter(ge).length)+xe)*(1+Math.log(ge.toString().replace(/([0.])/g,"")[0])/Math.LN10)))):be>ge.length*xe+(ve==Me?he.widthOfOneDigit*ge.length*Se:0)+(ve==we?he.widthOfOneDigit*ge.map((ge=>he.formatter(ge))).join("").length:0)},collisionBetween=function(ge,me){if(null==me||0==me.length)return!1;me instanceof Array||(me=[me]);for(let be=0;be<me.length;be++)if(ge!=me[be]&&0!=ge&&Math.abs(axis.scale()(ge)-axis.scale()(me[be]))<(Ee?he.heightOfOneDigit:(he.formatter(ge).length+he.formatter(me[be]).length)*he.widthOfOneDigit/2))return!0;return!1};if("genericLog"==he.scaleType||"log"==he.scaleType){const ge=axis.scale().constant?axis.scale().constant():0,be=Oe?[0]:[],ve=ze<ge?[]:me.range(Math.floor(getBaseLog(Math.max(ge,De))),Math.ceil(getBaseLog(ze)),1).concat(Math.ceil(getBaseLog(ze))).map((ge=>Math.pow(he.logBase,ge))),_e=De>-ge?[]:me.range(Math.floor(getBaseLog(Math.max(ge,-ze))),Math.ceil(getBaseLog(-De)),1).concat(Math.ceil(getBaseLog(-De))).map((ge=>-Math.pow(he.logBase,ge)));if(null==he.method){const me=Oe?Math.max(Math.abs(ze),Math.abs(De))/ge:Math.max(Math.abs(ze),Math.abs(De))/Math.min(Math.abs(ze),Math.abs(De));he.method=10<=me&&me<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(he.method==this.METHOD_DOUBLING){let he=[];Oe&&Ce.push(0);const be=[].concat(Ce),xe=ze<ge?null:4*ve[Math.floor(ve.length/2)-1],we=De>-ge?null:4*_e[Math.floor(_e.length/2)-1];if(xe)for(let ge=xe;ge<=ze;ge*=2)he.push(ge);if(xe)for(let me=xe/2;me>=Math.max(De,ge);me/=2)he.push(me);if(we)for(let ge=we;ge>=De;ge*=2)he.push(ge);if(we)for(let me=we/2;me<=Math.min(ze,-ge);me/=2)he.push(me);he=he.sort(me.ascending).filter((he=>De<=he&&he<=ze)),ke=ke.concat(he),he=groupByPriorities(he,!1);const Te=Ce;for(let ge=0;ge<he.length;ge++){const me=Te.concat(he[ge]).filter((he=>!collisionBetween(he,be))).filter(onlyUnique);if(!labelsFitIntoScale(me,Se,Me,"none"))break;Ce=me}}if(he.method==this.METHOD_REPEATING){let ge=be.concat(ve).concat(_e).sort(me.ascending);he.stops.forEach((he=>{ke=ke.concat(ge.map((ge=>ge*he)))})),ge=groupByPriorities(ge);const xe=be.concat(Ce);let we=!1;he.stops.forEach(((me,be)=>{if(0==be){for(let he=0;he<ge.length;he++){const be=Ce.concat(ge[he].map((he=>he*me))).filter((he=>!collisionBetween(he,xe))).filter((he=>De<=he&&he<=ze)).filter(onlyUnique);if(!labelsFitIntoScale(be,Se,Me,"none"))break;Ce=be}ge=[].concat(...ge)}else{if(we)return;const be=Ce.concat(ge.map((he=>he*me))).filter((he=>De<=he&&he<=ze)).filter(onlyUnique);if(!labelsFitIntoScale(be,Se,Me,"log"))return void(we=!0);if(Ce.length>he.limitMaxTickNumber&&0!=he.limitMaxTickNumber)return void(we=!0);Ce=be}}))}}if("linear"==he.scaleType||"time"==he.scaleType){Oe&&Ce.push(0);const ge=[].concat(Ce);Te=Ee?Math.max(Math.floor(Se/(he.heightOfOneDigit+parseInt(he.cssMargin.top))),2):Math.max(Math.floor(Se/Le),2),0!=he.limitMaxTickNumber&&Te>he.limitMaxTickNumber&&(Te=he.limitMaxTickNumber);let be=axis.scale().ticks(Te).sort(me.ascending).filter((he=>De<=he&&he<=ze));ke=ke.concat(be),be=groupByPriorities(be,!1);const ve=Ce;for(let me=0;me<be.length;me++){const _e=ve.concat(be[me]).filter((he=>!collisionBetween(he,ge))).filter(onlyUnique);if(!labelsFitIntoScale(_e,Se,he.fitIntoScale,"none"))break;Ce=_e}Ce=Ce.filter((he=>!collisionBetween(he,ge))).filter(onlyUnique)}null!=Ce&&Ce.length<2&&!Oe&&(Ce=Math.abs(axis.scale()(De)-axis.scale()(ze))<(Ee?he.heightOfOneDigit:(he.formatter(De).length+he.formatter(ze).length)*he.widthOfOneDigit)?[ze]:[De,ze],1!=Ce.length||"linear"!=he.scaleType&&"time"!=he.scaleType||(ke=[])),null!=Ce&&Ce.length<=3&&Oe&&(Ce=collisionBetween(0,[De,ze])?[De,ze]:[De,0,ze]),null!=Ce&&Ce.sort(((he,me)=>(ge==ve?-1:1)*(axis.scale()(me)-axis.scale()(he)))),je&&(Ce=[]),ke=ke.filter((he=>-1==Ce.indexOf(he)&&De<=he&&he<=ze));const Re=he.viewportLength;if(Re&&Se>3*Re){const he=xe[0]>xe.at(-1),ge=Math.max(he?xe.at(-1):xe[0],-Re),me=Math.min(he?xe[0]:xe.at(-1),2*Re),be=axis.scale().invert(he?me:ge),ve=axis.scale().invert(he?ge:me),_e=[];let we=0;for(;Ce[we]<be;)we++;for(;we<Ce.length&&!(Ce[we]>ve);we++)_e.push(Ce[we]);Ce=_e,ke=ke.filter((he=>he>be&&he<ve)),Te*=Math.abs(me-ge)/Se,Te=Math.max(Te,5)}return meow("final result",Ce),axis.ticks(Te).tickFormat(he.formatter).tickValues(Ce).tickValuesMinor(ke).pivot(Ae).repositionLabels(repositionLabelsThatStickOut(Ce,he,ge,axis.scale(),Ee?"y":"x"))},axis.copy=function(){return d3_axis_smart(me["axis"+capitalize(he)]())},axis.orient=function(){return arguments.length?axis:he},rebind(axis,ge,"scale","ticks","tickArguments","tickValues","tickFormat","tickSize","tickSizeInner","tickSizeOuter","tickPadding");function meow(){axis.labelerOptions().isDevMode&&console.info(...arguments)}}(me["axis"+capitalize(he)]())}function detectTouchEvent(he,ge,be){var ve,_e,xe,we=ge?".onTap":".onLongTap";me.select(he).on("touchstart"+we,(function(he){ve=he.timeStamp,_e=he.changedTouches[0].screenX,xe=he.changedTouches[0].screenY})).on("touchend"+we,(function(he,me){return _e=Math.abs(_e-he.changedTouches[0].screenX),xe=Math.abs(xe-he.changedTouches[0].screenY),_e<5&&xe<5?he.timeStamp-ve<500?ge?ge(he,me):void 0:be?be(he,me):void 0:void 0}))}me.selection.prototype.onTap=function(he){return this.each((function(){detectTouchEvent(this,he)}))},me.selection.prototype.onLongTap=function(he){return this.each((function(){detectTouchEvent(this,null,he)}))};const Le=De,Ae=Te,Ee=Ce,je=axisSmart$1,Re=function collisionResolver$1(){return function collision_resolver(){const he=300;let ge=0;function resolver(_e){if(null==be)return void console.warn("D3 collision resolver stopped: missing a CSS slector");if(null==ve)return void console.warn("D3 collision resolver stopped: missing height of the canvas");if(null==xe)return void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' ");if(null==De)return void console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' ");if(!_e.node())return void console.warn("D3 collision resolver stopped: missing the target DOM element",_e);ge=.8*_e.node().getBBox().height;const Me=_e.filter((he=>filter(he,we))).sort(((he,ge)=>me.ascending(he.valueY,ge.valueY))).data(),Se={};for(let he=0;he<Me.length-1;he++){const me=Me[he],be=Me[he+1];if(me.shiftY||(me.shiftY=0),be.shiftY=0,be.valueY-me.valueY-me.shiftY>=ge)continue;let _e=0;me.valueY>ge&&(0==he?_e=Math.min(ge,me.valueY):me.valueY-Me[he-1].valueY+Me[he-1].shiftY>ge&&(_e=Math.min(ge,me.valueY-Me[he-1].valueY+Me[he-1].shiftY))),me.upperAvailable=_e;let xe=0;be.valueY<ve&&(he==Me.length-2?xe=Math.min(ge,ve-be.valueY):Me[he+2].valueY-be.valueY>ge&&(xe=Math.min(ge,Me[he+2].valueY-be.valueY))),be.underAvailable=xe;const we=ge-(be.valueY-me.valueY-me.shiftY);Se[me[De]]={},Se[be[De]]={},_e>=we/2&&xe>=we/2?(me.shiftY=-we/2,be.shiftY=we/2):_e>=we/2?(be.shiftY=xe,me.shiftY=-Math.min(_e,we-xe)):xe>=we/2?(me.shiftY-=_e,be.shiftY=Math.min(xe,we-_e)):(me.shiftY=-_e,be.shiftY=xe),Se[me[De]].valueY=me.valueY+me.shiftY,Se[be[De]].valueY=be.valueY+be.shiftY}_e.each((function(ge){Se[ge[De]]&&Se[ge[De]].valueY&&me.select(this).selectAll(be).transition().duration(he).attr("transform","translate(0,"+Se[ge[De]].valueY+")")}))}let be=null;resolver.selector=function(he){return arguments.length?(be=he,resolver):be};let ve=null;resolver.height=function(he){return arguments.length?(ve=he,resolver):ve};let _e=me.scaleLinear().domain([0,1]).range([0,1]);resolver.scale=function(he){return arguments.length?(_e=he,resolver):_e};let xe=null;resolver.value=function(he){return arguments.length?(xe=he,resolver):xe};let we=null;resolver.time=function(he){return arguments.length?(we=he,resolver):we};let filter=function(){return!0};resolver.filter=function(he){return arguments.length?(filter=he,resolver):filter};let Me=null;resolver.fixed=function(he){return arguments.length?(Me=he,resolver):Me};let Se=null;resolver.handleResult=function(he){return arguments.length?(Se=he,resolver):Se};let De=null;return resolver.KEY=function(he){return arguments.length?(De=he,resolver):De},resolver}()},Fe=class TextEllipsis$1{constructor(he){this.context=he,this.interact=this._createInteract()}setTooltip(he){this.tooltip=he}_createInteract(){const he=this;return{mouseOver(ge){const be=me.pointer(ge,he.context.element.node());he._setTooltip(me.select(ge.target).attr("data-text"),be[0],be[1])},mouseOut(){he._setTooltip()},tap(){}}}_setTooltip(he,ge,me){if(he){this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(he);const be=this.tooltip.select("text").node().getBBox();ge-be.width<0?ge+=be.width+5:ge-=5,me-be.height<0?me+=be.height:me-=11,this.tooltip.attr("transform","translate("+ge+","+me+")"),this.tooltip.selectAll("rect").attr("width",be.width+8).attr("height",1.2*be.height).attr("x",-be.width-4).attr("y",.85*-be.height).attr("rx",.2*be.height).attr("ry",.2*be.height)}else this.tooltip.classed("vzb-hidden",!0)}clear(he){he.attr("data-text",null)}wrap(he,ge){const be=me.select(he),ve=Math.abs;let _e=be.attr("data-text");_e||(_e=be.text(),be.attr("data-text",_e)),be.text(_e);let xe=_e,we=xe.length,Me=be.node().getComputedTextLength();for(;ge-Me<=0&&""!==xe;)xe=Me>=ge?xe.slice(0,-ve(.5*we)):_e.slice(0,ve(.5*we)),be.text(xe+"â¦"),Me=be.node().getComputedTextLength(),we=xe.length;xe!==_e?(""===xe&&be.text(_e[0]),be.on("mouseover.tooltip",this.interact.mouseOver).on("mouseout.tooltip",this.interact.mouseOut).style("pointer-events","all")):be.on("mouseover.tooltip",null).on("mouseout.tooltip",null).style("pointer-events",null)}};class BaseService{isService(){return!0}constructor(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=he,this.setup()}deconstruct(){}setup(){}}const Ie=[{id:"LARGE",min_width:900,min_height:520},{id:"MEDIUM",min_width:600,min_height:400},{id:"SMALL",min_width:1,min_height:1}],Pe="vzb-";class _LayoutService extends BaseService{setup(){this.name="layout",this.status=ke.INIT,this.width=1,this.height=1,this.size=this.getSize(),this.profile="SMALL",this.placeholder=this.config.placeholder||this.constructor.DEFAULTS.placeholder,this.hGrid=[],this.element=me.select(this.placeholder).classed("vzb-tool",!0),this._resizeHandler();const he=this._resizeHandler.bind(this);window.addEventListener("resize",he),this.removeListener=function(){window.removeEventListener("resize",he)},this.removeProjectorListener=be.autorun((()=>{this.setProjector.bind(this)()}),{name:"Layout.js: setProjector()"})}deconstruct(){this.removeProjectorListener(),this.removeListener(),super.deconstruct()}get projector(){return this.config.projector||this.constructor.DEFAULTS.projector}set projector(he){this.config.projector=he}getSize(){const{width:he,height:ge}=this;return{width:he,height:ge}}_resizeHandler(){be.action("Layout.js: _resizeHandler()",(()=>{this.width=this.element.node().clientWidth,this.height=this.element.node().clientHeight;const he=Ie.find((he=>this.width>=he.min_width&&this.height>=he.min_height));he?(this.element.classed(Pe+this.profile.toLowerCase(),!1),this.profile=he.id,this.element.classed(Pe+this.profile.toLowerCase(),!0),this.element.classed("vzb-landscape",this.width>this.height),this.element.classed("vzb-portrait",!(this.width>this.height)),this.status=ke.READY):(this.profile="SMALL",this.status=ke.ERROR,console.warn("\n          Layout service: nothing should be rendered, because\n          placeholder ".concat(this.placeholder," has display:none or is too little: ").concat(this.width," x ").concat(this.height," px\n        "))),this.size=this.getSize()}))()}getProfileConstants(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},me=arguments.length>2?arguments[2]:void 0;const be=this.projector?deepExtend({},he[this.profile]||{},ge[this.profile]||{}):deepExtend({},he[this.profile]||{});return me&&(me.row.first||(be.margin.top=.5*be.margin.betweenRow||2),me.row.last||(be.margin.bottom=.5*be.margin.betweenRow||2),me.column.first||(be.margin.left=.5*be.margin.betweenColumn||2),me.column.last||(be.margin.right=.5*be.margin.betweenColumn||2)),be}setProjector(){this.element.classed("vzb-presentation",this.projector),this.size=this.getSize()}setHGrid(he){be.action((()=>{this.hGrid=he}))()}}vendorMin._(_LayoutService,"DEFAULTS",{projector:!1,placeholder:"body"});const Ne=be.decorate(_LayoutService,{size:be.observable.ref,hGrid:be.observable,projector:be.computed,width:be.observable,height:be.observable,profile:be.observable,status:be.observable}),Be="en",qe="share",Ue="percent";class _LocaleService extends BaseService{setup(){this.status=ke.INIT,this.path=this.config.path||this.constructor.DEFAULTS.path,this.getExternalFileReader=this.config.getExternalFileReader||this.constructor.DEFAULTS.getExternalFileReader,this.resolve=this.config.resolve,this.placeholder=this.config.placeholder||this.constructor.DEFAULTS.placeholder,this.element=me.select(this.placeholder),this.content={},this.removeLoadFileAutorun=be.autorun(this._loadFile.bind(this),{name:"Locale.js: _loadFile()"}),this.removeApplyRTL=be.autorun(this._applyRTL.bind(this),{name:"Locale.js: _applyRTL()"})}get id(){return this.config.id||this.constructor.DEFAULTS.id}get shortNumberFormat(){var he;return null!==(he=this.config.shortNumberFormat)&&void 0!==he?he:this.constructor.DEFAULTS.shortNumberFormat}set id(he){be.runInAction((()=>{this.config.id=he,this.config.Vizabi.stores.dataSources.getAll().forEach((ge=>ge.config.locale=he))}))}set shortNumberFormat(he){this.config.shortNumberFormat=he}deconstruct(){this.removeLoadFileAutorun(),super.deconstruct()}_applyRTL(){this.status===ke.READY&&this.element.classed("vzb-rtl",this.isRTL())}_resolveReader(he){var ge,be,ve,_e,xe;if(null!==(ge=this.resolve)&&void 0!==ge&&ge[he]&&isObject(null===(be=this.resolve)||void 0===be?void 0:be[he]))return Promise.resolve(null===(xe=this.resolve)||void 0===xe?void 0:xe[he]);if(this.getExternalFileReader)return this.getExternalFileReader(he);const we=null!==(ve=this.resolve)&&void 0!==ve&&ve[he]?null===(_e=this.resolve)||void 0===_e?void 0:_e[he]:this.path+he+".json";return me.json(we)}_loadFile(){this.status=ke.PENDING;const he=[this._resolveReader(this.id)];this.id==Be||this.content[Be]||he.push(this._resolveReader(Be)),Promise.all(he).then((he=>{this.content[this.id]=he[0],he[1]&&(this.content[Be]=he[1]),this._initFormatters(),this.status=ke.READY})).catch((he=>{throw this.state=ke.ERROR,he}))}_initFormatters(){const he=this.getPercentSymbol();this.shortNumberF=function(ge,be){if(be===qe&&(ge*=100),Math.abs(ge)<1e-14)return"0";let ve="";switch(Math.floor(Math.log(Math.abs(ge))/Math.LN10+1e-14)){case 0:case-1:case 1:case-2:case 2:case-3:case 3:case-4:break;case 4:case 5:ge/=1e3,ve="k";break;case 6:case 7:case 8:ge/=1e6,ve="M";break;case 9:case 10:case 11:ge/=1e9,ve="B";break;case 12:case 13:case 14:ge/=1e12,ve="TR";break;case-5:case-6:case-7:ge*=1e6,ve="Âµ";break;case-10:ge*=1e9,ve="n";break;case-13:ge*=1e12,ve="p";break;default:return me.format(".3s")(ge).replace("G","B")}return me.format(".3~r")(ge)+ve+(be===Ue||be===qe?he:"")};const ge=me.formatLocale({decimal:".",thousands:"â",grouping:[3]}).format(",.3~r");this.longNumberF=function(me,be){return be===qe&&(me*=100),ge(me)+(be===Ue||be===qe?he:"")},this.dateF={year:me.utcFormat("%Y"),month:me.utcFormat("%Y-%m"),day:me.utcFormat("%Y-%m-%d"),week:me.utcFormat("%Yw%V"),quarter:me.utcFormat("%Yq%q")},this.stringF=function(he){let ge=this.content[this.id].dictionary?this.content[this.id].dictionary[he]:this.content[this.id][he];return ge||""===ge?ge:(ge=this.content[Be].dictionary?this.content[Be].dictionary[he]:this.content[Be][he],ge||""===ge?ge:he)}}getFormattedNumber(he,ge){return this.shortNumberFormat?this.shortNumberF(he,ge):this.longNumberF(he,ge)}getFormattedDate(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"year";return this.dateF[ge](he)}getUIstring(he){return this.stringF(he)}auto(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(ge){return ge||0===ge||""===ge?"number"==typeof ge?this.getFormattedNumber(ge,he.shareOrPercent):ge instanceof Date?this.getFormattedDate(ge,he.interval):"string"==typeof ge?this.getUIstring(ge):void 0:ge}.bind(this)}isRTL(){return!!this.content[this.id].rtl}getPercentSymbol(){return this.content[this.id].percentSymbol||"%"}}vendorMin._(_LocaleService,"DEFAULTS",{id:Be,path:"./assets/locale/",getExternalFileReader:null,placeholder:"body",shortNumberFormat:!0});const He=be.decorate(_LocaleService,{id:be.computed,shortNumberFormat:be.computed,status:be.observable});function ui(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},me=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const ve={},_e=Object.getOwnPropertyNames(he),xe=Object.getOwnPropertyNames(ge),we=Object.getOwnPropertyNames(me);for(let Me of new Set([..._e,...xe,...we]))if("function"!=typeof he[Me]&&(isPlainObject(ge[Me])||isPlainObject(me[Me])||isPlainObject(he[Me])))ge[Me]||be.extendObservable(ge,{[Me]:{}}),ve[Me]=ui(he[Me],ge[Me],me[Me]);else{const be={get:()=>void 0!==ge[Me]?ge[Me]:void 0!==me[Me]?me[Me]:"function"==typeof he[Me]?deepClone(he[Me]()):he[Me],set(me){void 0!==ge[Me]&&me==he[Me]?Object.getOwnPropertyDescriptor(ge,Me)&&Object.getOwnPropertyDescriptor(ge,Me).configurable&&delete ge[Me]:ge[Me]=me},enumerable:!0,configurable:!0};Object.defineProperty(ve,Me,be)}return be.observable(ve)}class _BaseComponent{constructor(he){let{placeholder:ge,model:be,services:ve,subcomponents:_e,template:xe,id:we,parent:Me,root:Se,name:De,ui:ze,default_ui:Oe={},state:Ce,options:ke}=he;this.id=we||"c0",this.template=xe||"",this.subcomponents=_e||[],this.services=ve||{},this.model=be,this.state=Ce||{},this.parent=Me||null,this.children=[],this.root=Se||this,this.name=De||"",this.options=ke||{},this.reactions=new Map;const Te=this.parent&&this.parent.element?this.parent.element:me;this.element=Te.select(ge).html(this.template),this.element.node()||console.warn("\n      Vizabi component ".concat(this.constructor.name," id: ").concat(this.id," name: ").concat(this.name," \n      can't find placeholder to render: \n      ").concat(ge," \n      Please check that placeholder exists and is correctly specified in the component initialisation.\n    "),this),this.DEFAULT_UI=deepExtend(Oe,deepExtend(deepExtend({},this.constructor.DEFAULT_UI),Oe)),this.ui=this.setupUI(this.DEFAULT_UI,ze),this.subcomponents.forEach(((he,ge)=>{if(he.type){const me=new he.type({placeholder:he.placeholder,model:he.model||this.model,services:this.services,id:this.id+"-"+ge,parent:this,root:this.root,ui:this.getUI(he,ze),default_ui:he.default_ui||this.getUI(he,Oe),state:he.state,name:he.name,template:he.template,options:he.options});this.children.push(me)}else console.error('\n          Was unable to find a subcomponent "'.concat(he.name,'"\n          while building a component tree in parent "').concat(this.name,'".\n          This can be due to a misconfiguration, error in parent "subcomponents" definitions\n          or that subcomponent in question isn\'t registered or available to code. Hard to tell...\n        '),he)})),this.setup(this.options),this.addReaction(this.draw),this.addReaction(this.loading,{ignoreStatus:!0}),this.addReaction(this.resize)}getUI(he,ge){const me=he.name;return me&&!ge[me]&&(ge[me]={}),me?ge[me]:ge}setupUI(he,ge,me){return ui(he,ge,me)}addReaction(he){let{ignoreStatus:ge=!1,throttle_ms:me=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!he)return warn("Basecomponent: addReaction() method not found",he);this.reactions.has(he)||this.reactions.set(he,be.autorun((()=>{const be=me?throttle(he.bind(this),me):he.bind(this);(ge||this.status===ke.READY)&&be()}),{name:he.name,onError:he=>{this.element.classed("vzb-loading-data",!1),this.error(he)}}))}removeReaction(he){this.reactions.has(he)&&(this.reactions.get(he)(),this.reactions.delete(he))}removeAllReactions(){this.reactions.forEach(((he,ge)=>this.removeReaction(ge)))}findChild(he){let{name:ge,id:me,type:be}=he;if(ge&&this.name===ge||me&&this.id===me||be&&this.constructor.name===be)return this;for(const he of this.children){const ve=he.findChild({name:ge,id:me,type:be});if(ve)return ve}return!1}deconstruct(){this.children.length&&this.children.forEach((he=>{he.deconstruct(),he=void 0})),this.removeAllReactions(),this.root==this&&Object.values(this.services).forEach((he=>{he.deconstruct(),he=void 0}))}get status(){const he=Object.values(this.services).map((he=>he.status)).concat(this.children.map((he=>he.status))).concat(this.model.state);return he.every((he=>he===ke.READY||null==he))?ke.READY:he.some((he=>he===ke.ERROR))?ke.ERROR:ke.PENDING}setup(){}draw(){}loading(){this.options.showLoading&&this.element.classed("vzb-loading-data",this.status==ke.PENDING)}error(he){console.warn(he)}resize(){}}_BaseComponent.DEFAULT_UI={};const Ve=be.decorate(_BaseComponent,{status:be.computed,state:be.observable});class _AddGeo extends Ve{constructor(he){he.template='\n      <div class="vzb-addgeo-button"></div>\n      </div>\n    ',he.subcomponents=[],super(he)}setup(he){const ge=this;this.DOM={button:this.element.select(".vzb-addgeo-button")},this.DOM.button.on("click",(()=>{const he=ge.root.findChild({name:"markercontrols"});he&&("LARGE"===ge.root.services.layout.profile&&!ge.root.findChild({name:"buttons"}).ui.sidebarCollapse||he.isOpen||he.parent.toggleDialogOpen("markercontrols"),he.element.select(".vzb-search").each((function(){this.value="add ",this.dispatchEvent(new Event("input"));const he=this;me.select(this).style("background","lightgreen").transition().duration(1e3).ease(me.easeCubicOut).style("background","#fff"),setTimeout((()=>{he.setSelectionRange(he.value.length,he.value.length),he.focus()}),250)})))})),this.PROFILE_CONSTANTS=he.PROFILE_CONSTANTS,this.PROFILE_CONSTANTS_FOR_PROJECTOR=he.PROFILE_CONSTANTS_FOR_PROJECTOR,this.xAlign=he.xAlign,this.yAlign=he.yAlign}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.updateSize,{throttle_ms:500}),this.addReaction(this.redraw)}redraw(){this.DOM.button.text(this.localise("buttons/addgeo"))}updateSize(){this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(this.PROFILE_CONSTANTS,this.PROFILE_CONSTANTS_FOR_PROJECTOR);const{margin:he,dy:ge,dx:me}=this.profileConstants;this.element.style("top","top"==this.yAlign?he.top+(ge||0)+"px":null),this.element.style("bottom","bottom"==this.yAlign?he.bottom+(ge||0)+"px":null),this.element.style("left","left"==this.xAlign?he.left+(me||0)+"px":null),this.element.style("right","right"==this.xAlign?he.right+(me||0)+"px":null)}}const Ye=be.decorate(_AddGeo,{}),CollectionMixin$2=he=>class extends he{static add(he,ge){CollectionMixin$2._collection[he]=ge}static get(he){return CollectionMixin$2._collection[he]}};CollectionMixin$2._collection={};class Chart extends(CollectionMixin$2(Ve)){}const CollectionMixin$1=he=>class extends he{static add(he,ge){this._collection[he]=ge}static get(he){return CollectionMixin$1._collection[he]}};CollectionMixin$1._collection={};class Button extends(CollectionMixin$1(Ve)){constructor(he){super(he);const{title:ge,icon:me,func:be,required:ve,statebind:_e,statebindfunc:xe,ignoreSize:we}=he;this.title=ge,this.icon=me,this.func=be,this.required=ve,this.statebind=_e,this.statebindfunc=xe,this.ignoreSize=we}}Button.BaseClass=Button;
/*!
   * VIZABI BUTTONLIST
   * Reusable buttonlist component
   */
const We="vzb-active",Ge="vzb-hidden",$e="vzb-active-locked",Xe="vzb-unavailable";class ButtonList extends Ve{constructor(he){super(he)}setup(){this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},markercontrols:{title:"buttons/markercontrols",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},mapcolors:{title:"buttons/mapcolors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},zoom:{title:"buttons/zoom",icon:"cursorPlus",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"MDL.trail.show",statebindfunc:this.setBubbleTrails.bind(this)},forecast:{title:"buttons/forecast",icon:"forecast",func:this.toggleTimeForecast.bind(this),required:!1,statebind:"MDL.frame.showForecast",statebindfunc:this.setTimeForecast.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"root.ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"root.ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"root.ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},sidebarcollapse:{title:"buttons/sidebar_collapse",icon:"angleDoubleLeft",func:this.toggleSidebarCollapse.bind(this),required:!0,statebind:"root.ui.buttons.sidebarCollapse",statebindfunc:this.setSidebarCollapse.bind(this),ignoreSize:!0},about:{title:"buttons/about",icon:"about",required:!1},repeat:{title:"buttons/repeat",icon:"repeat",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},sided:{title:"buttons/sided",icon:"side",func:this.toggleSided.bind(this),statebind:"root.model",statebindfunc:this.setSided.bind(this),required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.validatePopupButtons(this.root.ui.buttons.buttons,this.root.ui.dialogs.dialogs),this.element.selectAll("div").remove(),this._prev_body_overflow=document.body.style.overflow,this.root.ui.buttons.buttons.includes("sidebarcollapse")&&this.setSidebarCollapse()}draw(){this.MDL={frame:this.model.encoding.frame},this.localise=this.services.locale.auto(),this._dialogs=this.root.findChild({type:"Dialogs"}),this._dialogs||console.warn("Buttonlist was unable to find a subcomponent of type 'Dialogs' in root component. Could be that index.js of a tool is lacking a configuration.");const he=(this.root.ui.dialogs.dialogs||{}).sidebar||[],ge=[].concat(this.root.ui.buttons.buttons);this._addButtons(ge,he),this.addReaction(this._localiseButtons),this.addReaction(this._toggleButtons),this.addReaction(this._bindButtonState)}_bindButtonState(){this.root.ui.buttons.buttons.forEach((he=>{const ge=this._available_buttons[he];ge&&(ge.statebind?this.addReaction((()=>{ge.statebindfunc(he,getProp(this,ge.statebind.split(".")))})):this.addReaction((()=>{const ge=this._dialogs.findChild({name:he});if(!ge)return;this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']").classed(We,ge.getOpen())})))})),this.reactions.get(this._bindButtonState)()}proceedClick(he){const ge=this._available_buttons[he];ge&&ge.func?ge.func(he):this._dialogs.toggleDialogOpen(he)}validatePopupButtons(he,ge){const me=this,be=ge.popup,ve=he.filter((he=>me._available_buttons[he]&&!me._available_buttons[he].func));for(let he=0,ge=ve.length;he<ge;he++)if(-1==be.indexOf(ve[he]))return error('Buttonlist: bad buttons config: "'+ve[he]+'" is missing in popups list');return!1}_showAllButtons(){this.element.selectAll(".vzb-buttonlist-btn").each((function(){me.select(this).style("display","")}))}_localiseButtons(){const he=this;this.services.locale.id,this.element.selectAll("span[data-localise]").each((function(){const ge=me.select(this);ge.text(he.localise(ge.attr("data-localise")))}))}_toggleButtons(){this.services.layout.size;const he=this,ge=this.root.element,be=(this.root.ui.dialogs.dialogs||{}).sidebar||[];he._showAllButtons();const ve=this.element.selectAll(".vzb-buttonlist-btn"),_e=[],xe=[];let we=80,Me=80,Se=this.element.node().getBoundingClientRect().width,De=this.element.node().getBoundingClientRect().height,ze=0,Oe=0;ve.filter((he=>!he.ignoreSize)).each((function(ge){const ve=ge,Se=me.select(this),De=-1!==be.indexOf(ve.id),Ce=parseInt(Se.style("margin-top")),ke=parseInt(Se.style("margin-right")),Te=parseInt(Se.style("margin-left")),Le=parseInt(Se.style("margin-bottom"));we=Se.node().getBoundingClientRect().width+ke+Te,Me=Se.node().getBoundingClientRect().height+Ce+Le,Se.classed(Ge)||(!De||"LARGE"!==he.services.layout.profile||he.ui.sidebarCollapse?(ze+=we,Oe+=Me,ve.required?xe.push(Se):_e.push(Se)):Se.style("display","none"))}));const Ce=ze-Se,ke=Oe-De;let Te=1;ge.classed("vzb-large")&&ge.classed("vzb-dialog-expand-true")||ge.classed("vzb-small")&&ge.classed("vzb-portrait")?(Ce>0&&Ce<=10&&(Se+=Ce),Te=Math.floor(Se/we)-xe.length,Te<0&&(Te=0)):(ke>0&&ke<=10&&(De+=ke),Te=Math.floor(De/Me)-xe.length,Te<0&&(Te=0)),_e.reverse();const Le=[];for(let he=0,ge=_e.length-Te;he<ge;he++)_e[he].style("display","none"),Le.push(_e[he].attr("data-btn"));this.element.dispatch("custom-togglebuttons",{detail:{hiddenButtons:Le}})}_addButtons(he,ge){const be=this;this._components_config=[];const ve=[];if(!he.length)return;for(let ge=0;ge<he.length;ge++){const me=he[ge],be=this._available_buttons[me]?me:"_default",_e=clone(this._available_buttons[be]);"_default"==be&&(_e.title="buttons/"+me),_e.id=me,_e.icon=De["ICON_"+_e.icon.toUpperCase()],ve.push(_e)}this.element.selectAll("button").data(ve).enter().append("button").attr("class",(he=>{let me="vzb-buttonlist-btn";return ge.length>0&&ge.indexOf(he.id)>-1&&(me+=" vzb-dialog-side-btn"),me})).attr("data-btn",(he=>he.id)).html((he=>"\n        <span class='vzb-buttonlist-btn-icon fa'>".concat(he.icon,"</span>\n        <span class='vzb-buttonlist-btn-title'>\n          <span data-localise='").concat(he.title,"'></span>\n        </span>\n      ")));this.element.selectAll(".vzb-buttonlist-btn").on("click",(function(he){he.preventDefault(),he.stopPropagation();const ge=me.select(this).attr("data-btn");be.proceedClick(ge)}))}scrollToEnd(){let he=0;const ge=this.root.element;ge.classed("vzb-portrait")&&ge.classed("vzb-small")?(this.model.state.marker.select.length>0&&(he=this.element.node().scrollWidth),this.element.node().scrollLeft=he):(this.model.state.marker.select.length>0&&(he=this.element.node().scrollHeight),this.element.node().scrollTop=he)}resize(){if(!this.element.selectAll)return warn("buttonlist resize() aborted because element is not yet defined");"SMALL"===this.services.layout.profile&&this.services.layout.projector&&this.togglePresentationMode()}setButtonActive(he,ge){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']").classed(We,ge)}setButtonUnavailable(he,ge){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']").classed(Xe,ge)}toggleSidebarCollapse(){this.ui.sidebarCollapse=!this.ui.sidebarCollapse,this.setSidebarCollapse(),this.services.layout._resizeHandler()}setSidebarCollapse(){this.root.element.classed("vzb-dialog-expand-true",!this.ui.sidebarCollapse)}toggleBubbleTrails(){if(this.model.encoding){const he=this.model.encoding.trail;he.setShow(!he.show)}this.setBubbleTrails()}setBubbleTrails(){if(!this.model.encoding)return;const he=this.model.encoding.trail;if(!he)return;const ge="trails",me=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+ge+"']");if(!me.node())return warn("setBubbleTrails: no button '"+ge+"' found in DOM. doing nothing");me.classed($e,he.show);const be=this.model.encoding.selected.data.filter.any();me.classed(Ge,!be)}toggleTimeForecast(){this.root.ui.chart.showForecast=!this.root.ui.chart.showForecast,this.setTimeForecast()}setTimeForecast(){const he=this.root.ui.chart.showForecast;if(!he&&!1!==he)return;const ge="forecast",me=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+ge+"']");if(!me.node())return warn("setBubbleTrails: no button '"+ge+"' found in DOM. doing nothing");me.classed($e,he),me.classed(Ge,!this.root.ui.chart.endBeforeForecast)}toggleBubbleLock(){const he=(this.root.ui.chart||{}).lockActive;if(!this.model.encoding.selected.data.filter.any()&&!he)return;let ge=this.root.ui.chart.lockNonSelected;const me=this.model.encoding.frame.value;ge=ge?0:this.localise(me),this.root.ui.chart.lockNonSelected=ge,this.setBubbleLock()}setBubbleLock(){let he=(this.root.ui.chart||{}).lockNonSelected;const ge=(this.root.ui.chart||{}).lockActive,me=(this.root.ui.chart||{}).lockUnavailable||!1;if(!he&&0!==he)return;0!==he&&this.model.encoding.selected.data.filter.any()&&!ge&&(he=this.root.ui.chart.lockNonSelected=0);const be=this.element.selectAll(".vzb-buttonlist-btn[data-btn='lock']");if(!be.node())return warn("setBubbleLock: no button 'lock' found in DOM. doing nothing");be.classed(Xe,me),void 0===ge?be.classed(Ge,!this.model.encoding.selected.data.filter.any()):be.classed(Ge,!ge),be.classed($e,he),be.select(".vzb-buttonlist-btn-icon").html(De[he?"ICON_LOCK":"ICON_UNLOCK"]),be.select(".vzb-buttonlist-btn-title>span").text(he||this.localise("buttons/lock")).attr("data-vzb-translate",he?null:"buttons/lock")}toggleInpercent(){this.root.ui.chart.inpercent=!this.root.ui.chart.inpercent,this.setInpercent()}setInpercent(){if(void 0===(this.root.ui.chart||{}).inpercent)return;this.element.selectAll(".vzb-buttonlist-btn[data-btn='inpercent']").classed($e,this.root.ui.chart.inpercent)}toggleSided(){const he=this.model.encoding.side.config.defaultConcept,ge=this.model.data.space;be.runInAction((()=>{ge.includes(he)?(this.model.config.data.space=ge.toSpliced(ge.indexOf(he),1),this.model.encoding.side.config.data.constant="_default",this.model.encoding.side.config.data.concept=null):(this.model.config.data.space=[...ge,he],this.model.encoding.side.config.data.concept=he,this.model.encoding.side.config.data.constant=null)}))}setSided(){const he=this.element.selectAll(".vzb-buttonlist-btn[data-btn='sided']"),ge=this.model.encoding.side.config.defaultConcept,me=this.model.data.space;he.classed($e,me.includes(ge))}togglePresentationMode(){this.services.layout.projector=!this.services.layout.projector,this.setPresentationMode()}setPresentationMode(){this.element.selectAll(".vzb-buttonlist-btn[data-btn='presentation']").classed($e,this.services.layout.projector)}toggleFullScreen(he,ge){if(!window)return;let me=this.root.element.node();const be=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']"),ve=!this.ui.fullscreen,_e=ve?"hidden":this._prev_body_overflow;ve?(this.resizeInExitHandler=!1,function launchIntoFullscreen(he){he.requestFullscreen?he.requestFullscreen():he.msRequestFullscreen?he.msRequestFullscreen():he.mozRequestFullScreen?he.mozRequestFullScreen():he.webkitRequestFullscreen&&allowWebkitFullscreenAPI()&&he.webkitRequestFullscreen()}(me),subscribeFullscreenChangeEvent.call(this,this.toggleFullScreen.bind(this,he,!0))):(this.resizeInExitHandler=!ge,exitFullscreen.call(this)),this.ui.fullscreen=ve,be.classed($e,ve),be.select(".vzb-buttonlist-btn-icon").html(De[ve?"ICON_UNEXPAND":"ICON_EXPAND"]),be.select(".vzb-buttonlist-btn-title").text(this.localise("buttons/"+(ve?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(ve?"unexpand":"expand")),document.body.style.overflow=_e,this.resizeInExitHandler||this.services.layout._resizeHandler()}}function exitHandler(he){(function isFullscreen(){return!!window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)})()||(removeFullscreenChangeEvent.call(this),this.resizeInExitHandler?this.services.layout._resizeHandler():he())}function subscribeFullscreenChangeEvent(he){if(!window)return;const ge=window.document;this.exitFullscreenHandler=exitHandler.bind(this,he),ge.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),ge.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),ge.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),ge.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}function removeFullscreenChangeEvent(){const he=window.document;he.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),he.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),he.removeEventListener("fullscreenchange",this.exitFullscreenHandler),he.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function exitFullscreen(){document.exitFullscreen&&document.fullscreenElement?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&allowWebkitFullscreenAPI()?document.webkitExitFullscreen():(removeFullscreenChangeEvent.call(this),this.resizeInExitHandler=!1)}function allowWebkitFullscreenAPI(){return!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"))}
/*!
   * VIZABI BUBBLE SIZE slider
   * Reusable bubble size slider
   */ButtonList.DEFAULT_UI={buttons:["fullscreen"],sidebarCollapse:!1};const Ke={EXTENT_MIN:0,EXTENT_MAX:1,BAR_WIDTH:6,THUMB_HEIGHT:20,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,ROUND_DIGITS:2,value:"extent",setValueFunc:null,submodel:null,submodelFunc:null,PROFILE_CONSTANTS:{SMALL:{},MEDIUM:{},LARGE:{}},PROFILE_CONSTANTS_FOR_PROJECTOR:{SMALL:{},MEDIUM:{},LARGE:{}}};const Ze=be.decorate(class BrushSlider extends Ve{constructor(he){he.template='\n      <div class="vzb-slider-holder">\n        <svg class="vzb-slider-svg">\n          <g class="vzb-slider-wrap">\n            <g class="vzb-slider">\n            </g>\n          </g>\n        </svg>\n      </div>  \n    ',super(he),this._setModel=throttle(this._setModel,50)}setup(he){this.type=this.type||"brushslider",this.DOM={sliderSvg:this.element.select(".vzb-slider-svg"),sliderWrap:this.element.select(".vzb-slider-wrap"),slider:this.element.select(".vzb-slider")},this.DOM.slider.classed("vzb-slider-"+this.constructor.name.toLowerCase(),!0);const ge=this.options=deepExtend(deepExtend({},Ke),he||{});this.value=ge.value,this.submodel=ge.submodel,this.submodelFunc=ge.submodelFunc,this.setValueFunc=ge.setValueFunc,this.padding=this._getPadding(),this.rescaler=me.scaleLinear().domain([ge.EXTENT_MIN,ge.EXTENT_MAX]).clamp(!0),this.brushEventListeners=this._getBrushEventListeners(),this.brush=me.brushX().extent([[0,0],[0,0]]).handleSize(this._getHandleSize()).on("start",this.brushEventListeners.start).on("brush",this.brushEventListeners.brush).on("end",this.brushEventListeners.end),this.DOM.sliderThumbs=this.DOM.slider.selectAll(".handle").data([{type:"w"},{type:"e"}],(he=>he.type)).enter().append("svg").attr("class",(he=>"handle handle--"+he.type+" "+he.type)).classed("vzb-slider-thumb",!0),this._createThumbs(this.DOM.sliderThumbs.append("g").attr("class","vzb-slider-thumb-badge")),this.DOM.slider.call(this.brush);const be=ge.BAR_WIDTH;this.DOM.slider.selectAll(".selection,.overlay").attr("height",be).attr("rx",.25*be).attr("ry",.25*be).attr("transform","translate(0,"+.5*-be+")")}get MDL(){return{model:this._getModel()}}draw(){this.localise=this.services.locale.auto(),this.element.classed("vzb-hidden")||this._updateLayoutProfile()||(this.addReaction(this.updateSize,{throttle_ms:500}),this.addReaction(this._updateView))}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(this.options.PROFILE_CONSTANTS,this.options.PROFILE_CONSTANTS_FOR_PROJECTOR),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Slider _updateProfile() abort: container is too little or has display:none")}_getPadding(){const he=.5*this.options.THUMB_HEIGHT;return{top:.5*this.options.BAR_WIDTH,left:he,right:he,bottom:he+this.options.THUMB_STROKE_WIDTH}}_getHandleSize(){return this.options.THUMB_HEIGHT+2*this.options.BAR_WIDTH}_getComponentWidth(){const he=this.element.node().offsetWidth-this.padding.left-this.padding.right;return he<0?0:he}_getComponentHeight(){return this.options.BAR_WIDTH}_getBrushEventListeners(){const he=this;return{start:ge=>{!he.nonBrushChange&&ge.sourceEvent&&(this._savedSelection=ge.selection,this._setFromExtent(!1,!1,!1))},brush:he=>{!this.nonBrushChange&&he.sourceEvent&&(this._savedSelection=he.selection,this._setFromExtent(!0,!1,!1))},end:he=>{!this.nonBrushChange&&he.sourceEvent&&(null===he.selection&&this.DOM.slider.call(this.brush.move,this._savedSelection),this._setFromExtent(!0,!0),this._savedSelection=void 0)}}}_createThumbs(he){const ge=this.options.BAR_WIDTH,me=.5*this.options.THUMB_HEIGHT;he.append("path").attr("d","M"+(me+ge)+" "+(me+1.5*ge)+"l"+-me+" "+1.5*me+"h"+2*me+"Z")}_updateThumbs(){}updateSize(){this.services.layout.size;const he=this._getComponentWidth()+this.padding.left+this.padding.right;this.DOM.sliderSvg.attr("height",this._getComponentHeight()+this.padding.top+this.padding.bottom).attr("width",he),this.DOM.sliderWrap.attr("transform",this.services.locale.isRTL()?"translate("+(he-this.padding.right)+","+this.padding.top+") scale(-1,1)":"translate("+this.padding.left+","+this.padding.top+")"),this._updateRescaler()}_updateRescaler(){const he=this._getComponentWidth();this.rescaler.range([0,he])}_getModel(){if(this.submodelFunc)return this.submodelFunc.call(this.model);if(this.submodel){const he=getProp(this,this.submodel.split("."));return he||console.error("Slider inside ".concat(this.parent.name||this.parent.constructor.name," was not able to access part of model ").concat(this.submodel)),he}return this.model}_setBrushExtent(){return this.brush.extent([[0,0],[this._getComponentWidth(),this._getComponentHeight()]])}_updateView(){this.services.layout.size;const he=this.MDL.model[this.value];he||0===he||!1===he||console.error("Slider inside ".concat(this.parent.name||this.parent.constructor.name," was unable to access value ").concat(this.value," in its model")),this.DOM.slider.call(this._setBrushExtent());const ge=this._valueToExtent(he)||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(ge),this._updateThumbs(ge)}_moveBrush(he){const ge=he.map(this.rescaler);this.nonBrushChange=!0,this.DOM.slider.call(this.brush.move,[ge[0],ge[1]]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)}_valueToExtent(he){return he}_extentToValue(he){return he}_setFromExtent(he,ge,be){let ve=me.brushSelection(this.DOM.slider.node());ve&&(ve=[this.rescaler.invert(ve[0]),this.rescaler.invert(ve[1])],this._updateThumbs(ve),he&&this._setModel(ve,ge,be))}_setModel(he){const ge=this.options.ROUND_DIGITS;he=[+he[0].toFixed(ge),+he[1].toFixed(ge)],this.setValueFunc?this.MDL.model[this.setValueFunc](this._extentToValue(he)):this.MDL.model[this.value]=this._extentToValue(he)}},{MDL:be.computed});let Je=!0;class _DataWarning extends Ve{constructor(he){he.template='\n      <div class="vzb-data-warning-background"></div>\n      <div class="vzb-data-warning-box">\n        <div class="vzb-data-warning-link"></div>\n        <div class="vzb-data-warning-title"></div>\n        <div class="vzb-data-warning-body vzb-dialog-scrollable"></div>\n      </div>\n    ',super(he)}setup(){this.DOM={background:this.element.select(".vzb-data-warning-background"),container:this.element.select(".vzb-data-warning-box"),icon:this.element.select(".vzb-data-warning-link"),close:this.element.select(".vzb-data-warning-close"),title:this.element.select(".vzb-data-warning-title"),body:this.element.select(".vzb-data-warning-body"),button:this.root.element.select(this.options.button)},this.element.classed("vzb-hidden",!0),this.setupDialog(),this.setupTiggerButton(),this.setOptions()}setupDialog(){this.DOM.background.on("click",(()=>{this.toggle(!0)})),this.DOM.container.append("div").html(Me).on("click",(()=>{this.toggle()})).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close"),this.DOM.icon.html(_e).append("div")}setupTiggerButton(){if(!this.DOM.button.size())return warn("quit setupTiggerButton of DataWarning because no button provided");setIcon(this.DOM.button,_e).append("text").attr("text-anchor","end").on("click",(()=>{this.toggle()})).on("mouseover",(()=>{this.updateButtonOpacity(1)})).on("mouseout",(()=>{this.updateButtonOpacity()}))}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected}}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.updateUIstrings),this.addReaction(this.updateButtonOpacityScale),this.addReaction(this.updateButtonOpacity),this.addReaction(this.updateButtonPosition)}updateUIstrings(){this.DOM.button&&this.DOM.button.select("text").text(this.localise("hints/dataWarning")),this.DOM.icon.select("div").text(this.localise("hints/dataWarning"));const he=this.localise("datawarning/title/"+this.root.name);this.DOM.title.html(he).classed("vzb-hidden",!he||he=="datawarning/title/"+this.root.name),this.DOM.body.html(this.localise("datawarning/body/"+this.root.name))}toggle(he){null==he&&(he=!Je),Je=he,this.element.classed("vzb-hidden",Je),this.root.children.forEach((he=>{he.element.classed("vzb-blur",he!=this&&!Je)}))}updateButtonOpacityScale(){var he,ge;this.wScale=this.MDL.frame.scale.d3Scale.copy().domain(null===(he=this.ui)||void 0===he?void 0:he.doubtDomain.map((he=>this.MDL.frame.parseValue(""+he)))).range(null===(ge=this.ui)||void 0===ge?void 0:ge.doubtRange).clamp(!0)}updateButtonOpacity(he){var ge;if(!this.DOM.button.size())return warn("quit updateButtonOpacity of DataWarning because no button provided");null==he&&(he=this.wScale(this.MDL.frame.value)),this.MDL.selected.data.filter.any()&&(he=1),this.DOM.button.style("opacity",!1===(null===(ge=this.ui)||void 0===ge?void 0:ge.enable)?0:he)}updateButtonPosition(){var he;if(!this.DOM.button.size())return warn("quit updateButtonPosition of DataWarning because no button provided");if(!1===(null===(he=this.ui)||void 0===he?void 0:he.enable))return;const{vertical:ge,horizontal:me,width:be,height:ve,wLimit:_e}=this,{top:xe,bottom:we,left:Me,right:Se}=this,De=this.DOM.button.select("text").style("font-size",null);let ze=De.node().getBBox();const Oe=ze.width+3*ze.height;if(_e>0&&Oe>_e){const he=parseInt(De.style("font-size"))*_e/Oe;De.style("font-size",he+"px")}ze=De.node().getBBox(),this.DOM.button.select("svg").attr("width",.75*ze.height).attr("height",.75*ze.height).attr("x",-ze.width-1.2*ze.height).attr("y",.65*-ze.height),ze=this.DOM.button.node().getBBox(),this.DOM.button.classed("vzb-hidden",this.services.layout.projector||_e&&_e<100).attr("transform","translate(".concat("left"==me?Me+ze.width:be-Se,", ").concat("top"==ge?xe+ze.height:ve-we,")"))}setOptions(){let{width:he=0,height:ge=0,vertical:me="top",horizontal:ve="right",top:_e=0,bottom:xe=0,left:we=0,right:Me=0,wLimit:Se=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};be.runInAction((()=>{this.vertical=me,this.horizontal=ve,this.width=he,this.height=ge,this.top=_e,this.bottom=xe,this.left=we,this.right=Me,this.wLimit=Se||he}))}}_DataWarning.DEFAULT_UI={doubtDomain:[],doubtRange:[]};const Qe=be.decorate(_DataWarning,{MDL:be.computed,vertical:be.observable,horizontal:be.observable,width:be.observable,height:be.observable,top:be.observable,bottom:be.observable,left:be.observable,right:be.observable,wLimit:be.observable});const tn=be.decorate(class DateTimeBackground extends Ve{setup(he){this.DOM={svg:this.element.append("svg")},this.DOM.group=this.DOM.svg.append("g"),this.DOM.textEl=this.DOM.group.append("text").style("font-size","20px"),this.DOM.sampleTextEl=this.DOM.group.append("text").style("font-size","20px").style("opacity",0),this.element.classed("vzb-datetime-background",!0),this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",he&&this.setConditions(he)}updateLayoutProfile(){if(this.services.layout.size,this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Chart _updateProfile() abort: container is too little or has display:none")}setConditions(he){return!isNaN(parseFloat(he.rightOffset))&&isFinite(he.rightOffset)&&(this.rightOffset=he.rightOffset),!isNaN(parseFloat(he.leftOffset))&&isFinite(he.leftOffset)&&(this.leftOffset=he.leftOffset),!isNaN(parseFloat(he.topOffset))&&isFinite(he.topOffset)&&(this.topOffset=he.topOffset),!isNaN(parseFloat(he.bottomOffset))&&isFinite(he.bottomOffset)&&(this.bottomOffset=he.bottomOffset),he.xAlign&&(this.xAlign=he.xAlign),he.yAlign&&(this.yAlign=he.yAlign),!isNaN(parseFloat(he.widthRatio))&&he.widthRatio>0&&he.widthRatio<=1&&(this.widthRatio=he.widthRatio),!isNaN(parseFloat(he.heightRatio))&&he.heightRatio>0&&he.heightRatio<=1&&(this.heightRatio=he.heightRatio),this}get MDL(){return{frame:this.model.encoding.frame}}get duration(){return this.MDL.frame&&this.MDL.frame.playing?(this.frameValue_1=this.frameValue,this.frameValue=this.MDL.frame.value,this.frameValue>this.frameValue_1?this.MDL.frame.speed:0):0}draw(){this.localise=this.services.locale.auto({interval:this.MDL.frame.interval}),this.updateLayoutProfile()||(this.addReaction(this.updateText),this.addReaction(this.updateSize,{throttle_ms:50}))}updateText(){this.setText(this.MDL.frame.value,this.duration)}updateSize(){this.services.layout.size,this._resizeText()}resizeText(he,ge,me,be){this.width=parseInt(he,10)||0,this.height=parseInt(ge,10)||0,me&&(this.topOffset=me),be&&(this.leftOffset=be),this._resizeText()}setText(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{textEl:me,sampleTextEl:be}=this.DOM;he=this.localise(he);const callback=()=>{be.text(he),this._resizeText(),me.text(he)},clear=()=>{clearTimeout(this._text.timeout),delete this._text};return ge?(this._text&&(this._text.callback(),clear()),this._text={callback:callback,timeout:setTimeout((()=>{callback(),clear()}),ge)}):(this._text&&clear(),callback()),this}_resizeText(){const{textEl:he,sampleTextEl:ge}=this.DOM,me=ge.node().getBBox();if(!(me.width&&me.height&&this.width&&this.height))return this;const be=this.width*this.widthRatio/me.width,ve=this.height*this.heightRatio/me.height;switch(this.scalar=Math.min(be,ve),he.attr("transform","scale("+this.scalar+")"),this.textHeight=me.height*this.scalar,this.textWidth=me.width*this.scalar,this.yAlign){case"bottom":case"center":he.attr("dy",".325em");break;case"top":he.attr("dy","0")}return this.DOM.group.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this}_getLeftOffset(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}}_getTopOffset(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}},{MDL:be.computed,duration:be.computed}),en=6;function updateRainbowLegend(he){var ge,ve;const _e=this.DOM;_e.rainbowHolder.classed("vzb-hidden",!he);const xe=_e.rainbow.node().getBoundingClientRect().width;if(!he||!xe)return;const we=this.services.locale.auto({shareOrPercent:null===(ge=this.MDL.color.data)||void 0===ge||null===(ve=ge.conceptProps)||void 0===ve?void 0:ve.format}),Me=this.MDL.color.scale,Se=Me.palette.paletteDomain.map(parseFloat),De=Me.palette.paletteLabels,ze=Me.d3Scale.copy(),Oe=parseInt(_e.rainbow.style("left"),10)||0,Ce=parseInt(_e.rainbow.style("right"),10)||Oe;let ke,Te,Le;De?(ke=De.map((he=>parseFloat(he))),Le=me.max(ke),Te=ke.map((he=>he/Le*xe))):(ke=ze.domain(),Le=me.max(Se),Te=Se.map((he=>he/Le*xe)));const Ae=axisSmart$1("bottom"),Ee=ze.copy().interpolate(me.interpolate).range(Te),je=me.extent(ke),Re=Ee.copy().domain(je).range(je),Fe=me.scaleLinear().domain(je).range([0,100]);function getPaletteKey(he){return Math.round(+Fe(Re(he)))}function highlightValue(he){_e.labelScaleG.call(Ae.highlightValue(he))}function setColor(he,ge){Me.palette.setColor(he,ge)}function removeColor(he){Me.palette.defaultPalette[he]?Me.palette.setColor(null,he):Me.palette.removeColor(he)}!function updateLabelScale(){_e.labelScaleSVG.style("width",Oe+xe+Ce+"px"),_e.labelScaleG.attr("transform","translate("+Oe+",2)"),Ae.scale(Ee).tickSizeOuter(5).tickPadding(8).tickSizeMinor(3,-3).labelerOptions({scaleType:Me.type,toolMargin:{right:Ce,left:Oe},showOuter:!1,formatter:we,bump:Oe,cssFontSize:"8px",fitIntoScale:De?"optimistic":null}),_e.labelScaleG.call(Ae)}(),function updateRainbowCanvas(){_e.rainbow.style("top",3+en+"px"),_e.rainbowCanvas.attr("width",xe).attr("height",1).style("width",xe+"px").style("height","100%");const he=_e.rainbowCanvas.node().getContext("2d"),ge=he.createImageData(xe,1);for(let he,be=0,ve=-1;be<xe;++be)he=me.rgb(ze(Ee.invert(be))),ge.data[++ve]=he.r,ge.data[++ve]=he.g,ge.data[++ve]=he.b,ge.data[++ve]=255;he.putImageData(ge,0,0)}(),function updateSubtitle(){const he=Me.parent.data.conceptProps,ge=getSubtitle(he.name,he.name_short);_e.subtitleText.classed("vzb-hidden",""==ge).text(he.name_short?ge:""),_e.subtitleReset.text(we("buttons/reset")).classed("vzb-hidden",!Object.keys(Me.palette.config.palette).length).on("click",(()=>{be.runInAction((()=>{Object.keys(Me.palette.config.palette).forEach((he=>Me.palette.removeColor(he)))}))}))}(),"none"!==_e.rainbowLegend.style("display")&&function updateColorStops(){_e.rainbowLegend.style("width",xe+"px").style("left",Oe-en+"px").style("top","3px"),_e.labelScale.selectAll(".vzb-axis-value text").attr("dy","1.5em"),_e.rainbowLegendEventArea.style("width",xe+"px").style("top",3+en+"px").style("left",en+"px").on("mousemove",(function(he){highlightValue(Ee.invert(me.pointer(he)[0]))})).on("mouseleave",(()=>highlightValue("none"))).on("dblclick",(function(he){let ge=me.pointer(he)[0];ge=ge<=2*en?2*en:ge>=xe-2*en?xe-2*en:ge;const be=Ee.invert(ge),ve=ze(be),_e=getPaletteKey(be);Me.palette.setColor(ve,_e)})),me.extent(ke).includes(0)||_e.labelScaleG.selectAll(".tick text").filter((function(){return"0"===me.select(this).text()})).style("cursor","pointer").on("dblclick",(()=>{const he=ze(0),ge=getPaletteKey(0);Me.palette.setColor(he,ge)}));const he=me.min(ke)<0&&me.max(ke)>0?Ee(0):null,ge=ke.map(((ge,me)=>({val:ge,i:me,value0:he,isEdgePoint:0===me||me===ke.length-1,color:ze.range()[me],paletteKey:Se[me],xMin:me-1<0?1:Ee(ke[me-1])+2*en,xMax:me+1>=ke.length?xe-1:Ee(ke[me+1])-2*en})));let ve,we=!1,De=_e.rainbowLegend.selectAll(".vzb-cl-rainbow-legend-circle").data(ge,(he=>he.i));De.exit().remove(),De=De.enter().append("div").attr("class","vzb-cl-rainbow-legend-circle").style("width",2*en+"px").style("height",2*en+"px").style("border","1px solid #000").each((function(){me.select(this).append("input").attr("type","color")})).merge(De),De.style("border-radius",(he=>he.isEdgePoint?null:en+"px")).call(function dragCircles(){return me.drag().on("start",(function start(he){const ge=me.select(this);let ve=!1;function drag(he,me){if(!me.isEdgePoint&&!(he.x<0)&&!(he.x>xe)&&!(he.x<me.xMin||he.x>me.xMax)&&(ve||0===he.dx||(ve=!0),me.x=he.x,null!==me.value0&&(me.x=me.x<me.value0-3||me.x>me.value0+3?me.x:me.value0),ge.style("left",me.x+"px"),ve)){const he=Ee.invert(me.x),ge=getPaletteKey(he);highlightValue(he),me.paletteKey!==ge&&(!function replaceColor(he,ge,me){be.runInAction((()=>{removeColor(ge),setColor(he,me)}))}(me.color,me.paletteKey,ge),me.val=he,me.paletteKey=ge)}}function end(){ge.classed("dragging",!1)}ge.classed("dragging",!0),he.on("drag",drag).on("end",end)}))}()).on("mouseenter",(he=>{highlightValue(he.val)})).on("mouseleave",(()=>{highlightValue("none")})).on("click",(function(){const he=me.select(this).select("input").node();ve=setTimeout((()=>{we?(clearTimeout(ve),we=!1):he.click()}),500)})).on("dblclick",(function(he,ge){we=!0,ge.isEdgePoint||removeColor(ge.paletteKey)})).each((function(he){me.select(this).select("input").property("value",he.color).on("click",(he=>{he.stopPropagation()})).on("input",(function(){setColor(me.select(this).property("value"),he.paletteKey)})),me.select(this).style("left",(he.x=Ee(he.val))+"px")}))}()}
/*!
   * VIZABI BUBBLE COLOR LEGEND COMPONENT
   */const nn=Symbol.for("key");const sn=be.decorate(class ColorLegend extends Ve{constructor(he){he.template='\n      <div class="vzb-cl-outer">\n        <div class="vzb-cl-holder">\n          <div class="vzb-cl-minimap">\n            <svg>\n              <g></g>\n            </svg>\n          </div>\n\n          <div class="vzb-cl-colorlist vzb-hidden"></div>\n\n          <div class="vzb-cl-rainbow-holder vzb-hidden">\n            <div class="vzb-cl-rainbow">\n              <canvas></canvas>\n            </div>\n\n            <div class="vzb-cl-rainbow-legend">\n              <div class="vzb-cl-rainbow-legend-eventarea"></div>\n            </div>\n\n            <div class="vzb-cl-labelscale">\n              <svg>\n                <g></g>\n              </svg>\n            </div>\n\n            <div class="vzb-cl-subtitle">\n              <span class="vzb-cl-subtitle-text"></span>\n              <span class="vzb-cl-subtitle-reset"></span>\n            </div>\n          </div>\n          \n          <span class="vzb-cl-more-hint vzb-hidden">click for more options</span>\n\n          <div class="vzb-cl-select-dialog vzb-hidden">\n            <div class="vzb-cl-select-dialog-title"></div>\n            <div class="vzb-cl-select-dialog-close"></div>\n          </div>\n      </div>\n    ',super(he)}setup(he){this.DOM={wrapper:this.element.select(".vzb-cl-holder")},this.DOM.minimap=this.DOM.wrapper.select(".vzb-cl-minimap"),this.DOM.minimapSVG=this.DOM.minimap.select("svg"),this.DOM.minimapG=this.DOM.minimapSVG.select("g"),this.DOM.listColors=this.DOM.wrapper.select(".vzb-cl-colorlist"),this.DOM.rainbowHolder=this.DOM.wrapper.select(".vzb-cl-rainbow-holder"),this.DOM.rainbow=this.DOM.rainbowHolder.select(".vzb-cl-rainbow"),this.DOM.rainbowCanvas=this.DOM.rainbow.select("canvas"),this.DOM.rainbowLegend=this.DOM.rainbowHolder.select(".vzb-cl-rainbow-legend"),this.DOM.rainbowLegendEventArea=this.DOM.rainbowLegend.select(".vzb-cl-rainbow-legend-eventarea"),this.DOM.labelScale=this.DOM.rainbowHolder.select(".vzb-cl-labelscale"),this.DOM.labelScaleSVG=this.DOM.labelScale.select("svg"),this.DOM.labelScaleG=this.DOM.labelScaleSVG.select("g"),this.DOM.subtitleDiv=this.DOM.rainbowHolder.select(".vzb-cl-subtitle"),this.DOM.subtitleText=this.DOM.subtitleDiv.select(".vzb-cl-subtitle-text"),this.DOM.subtitleReset=this.DOM.subtitleDiv.select(".vzb-cl-subtitle-reset"),this.legendModelName=he.legendModelName,this.colorModelName=he.colorModelName,this._initSelectDialog()}get MDL(){return{color:this.model.encoding[this.colorModelName],selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted,superHighlighted:this.model.encoding.superhighlighted,legend:this.root.model.markers[this.legendModelName]}}draw(){this.localise=this.services.locale.auto(),this._legendHasOwnModel()&&!this._isLegendModelReady()||(this.KEY=Symbol.for("key"),this.canShowMap=this.MDL.legend&&this._canShowMap(),this.which=this.MDL.color.data.constant||this.MDL.color.data.concept,this.addReaction(this._updateView),this.addReaction(this.closeSelectDialogOnConceptChange))}_legendHasOwnModel(){return this.MDL.legend&&!this.MDL.color.data.isConstant&&isEntityConcept(this.MDL.color.data.conceptProps)}_isLegendModelReady(){return this.MDL.legend.state==ke.READY}_canShowMap(){if(!this._legendHasOwnModel())return!1;const he=this.MDL.legend.dataArray;return he.length>0&&he.every((he=>he.map))}_updateView(){if(this._legendHasOwnModel()&&!this._isLegendModelReady())return;this._updateListLegend(this.MDL.color.scale.isDiscrete()&&!this.canShowMap&&!this.MDL.color.scale.isPattern),this._updateMinimapLegend(this.MDL.color.scale.isDiscrete()&&this.canShowMap),updateRainbowLegend.bind(this)(!this.MDL.color.scale.isDiscrete())}_getUniqueColorValuesInAllFramesThatShouldAppearInTheChart(){const he=new Set;return this.model.getTransformedDataMap("filterRequired").each((ge=>ge.forEach((ge=>he.add(ge[this.colorModelName]))))),he}_updateListLegend(he){if(this.DOM.listColors.classed("vzb-hidden",!he),!he)return;const ge=this,be=this.MDL.color.scale.d3Scale;let ve=[];if(this._legendHasOwnModel()&&this._isLegendModelReady()&&!this.MDL.color.data.isConstant){const he=this._getUniqueColorValuesInAllFramesThatShouldAppearInTheChart();ve=this.MDL.legend.dataArray.filter((ge=>he.has(ge[this.which])))}else ve=be.domain().map((he=>{const ge={};return ge[this.which]=he,ge}));let _e=this.DOM.listColors.selectAll(".vzb-cl-option").data(unique(ve,(he=>he[this.which])),(he=>he[this.which]));_e.exit().remove(),_e=_e.enter().append("div").attr("class","vzb-cl-option").each((function(){me.select(this).append("div").attr("class","vzb-cl-color-sample"),me.select(this).append("div").attr("class","vzb-cl-color-legend")})).on("mouseover",((he,ge)=>this._interact().mouseover(ge))).on("mouseout",(()=>this._interact().mouseout())).on("click",((he,ge)=>{this._bindSelectDialogItems(ge),this.DOM.selectDialog.classed("vzb-hidden",!1)})).merge(_e),_e.each((function(he){const ve=be(he[ge.which]);me.select(this).select(".vzb-cl-color-sample").style("background-color",ve).style("border","1px solid black");let _e=he.name;_e||0===_e||(_e=he[ge.which]),ge.MDL.color.data.isConstant&&(_e=ge.localise("indicator/_default/color")),me.select(this).select(".vzb-cl-color-legend").text(_e)}))}_updateMinimapLegend(he){if(this.DOM.minimap.classed("vzb-hidden",!he),!he)return;if(!this._isLegendModelReady())return;const ge=this.MDL.color.scale.d3Scale,be=this.DOM.minimap.append("div").attr("class","vzb-temp");this.DOM.minimapSVG.attr("viewBox",null),this.DOM.minimapSVG.selectAll("g").remove(),this.DOM.minimapG=this.DOM.minimapSVG.append("g"),this.DOM.minimapG.selectAll("path").data(this.MDL.legend.dataArray,(he=>he[this.KEY])).enter().append("path").on("mouseover",((he,ge)=>this._interact().mouseover(ge))).on("mouseout",(()=>this._interact().mouseout())).on("click",((he,ge)=>{this._bindSelectDialogItems(ge),this.DOM.selectDialog.classed("vzb-hidden",!1)})).each((function(he){let ve=he.map.trim();"<svg"==ve.slice(0,4)&&(be.html(ve),ve=be.select("svg").select("path").attr("d")),me.select(this).attr("d",ve).style("fill",ge(he.color)).append("title").text(he.name),be.html("")}));const ve=this.DOM.minimapG.node().getBBox();this.DOM.minimapSVG.attr("viewBox","0 0 "+1.05*ve.width+" "+1.05*ve.height),be.remove()}_interact(){const he=this;return{mouseover(ge){var me,be,ve;if(he.DOM.moreOptionsHint.classed("vzb-hidden",!1),he._interact().disableSelectHover())return;const _e=he.MDL.color.data.concept,xe=he.MDL.color.name,we=null===(me=he.model.dataArray)||void 0===me?void 0:me.filter((he=>he[xe]==ge[_e]));we&&(null!==(be=he.root.ui)&&void 0!==be&&null!==(ve=be.chart)&&void 0!==ve&&ve.superhighlightOnMinimapHover&&he.MDL.superHighlighted?he.MDL.superHighlighted.data.filter.set(we):he.MDL.highlighted.data.filter.set(we))},mouseout(){var ge,me;he.DOM.moreOptionsHint.classed("vzb-hidden",!0),he._interact().disableSelectHover()||(null!==(ge=he.root.ui)&&void 0!==ge&&null!==(me=ge.chart)&&void 0!==me&&me.superhighlightOnMinimapHover&&he.MDL.superHighlighted?he.MDL.superHighlighted.data.filter.clear():he.MDL.highlighted.data.filter.clear())},clickToAddAllinGroup(ge){if(!isEntityConcept(he.MDL.color.data.conceptProps))return;const me=he.model.encoding.color.data.space[0],be=he.MDL.color.data.concept;he.model.data.filter.addUsingLimitedStructure({key:ge[nn],dim:me,prop:be})},clickToRemoveAllinGroup(ge){if(!isEntityConcept(he.MDL.color.data.conceptProps))return;const me=he.model.encoding.color.data.space[0],be=he.MDL.color.data.concept;he.model.data.filter.deleteUsingLimitedStructure({key:ge[nn],dim:me,prop:be})},clickToRemoveAllinOtherGroups(ge){if(!isEntityConcept(he.MDL.color.data.conceptProps))return;const me=he.MDL.legend.dataArray.map((he=>he[nn])).filter((he=>he!==ge[nn])),be=he.model.encoding.color.data.space[0],ve=he.MDL.color.data.concept;he.model.data.filter.deleteUsingLimitedStructure({key:me,dim:be,prop:ve})},disableSelectHover(){var ge,me;if(null!==(ge=he.root.ui.dialogs)&&void 0!==ge&&null!==(me=ge.markercontrols)&&void 0!==me&&me.disableFindInteractions)return!0},disableAddAll(ge){var me,be;if(!isEntityConcept(he.MDL.color.data.conceptProps))return!0;if(null!==(me=he.root.ui.dialogs)&&void 0!==me&&null!==(be=me.markercontrols)&&void 0!==be&&be.disableAddRemoveGroups)return!0;const ve=he.model.encoding.color.data.space[0],_e=he.MDL.color.data.concept;return!he.model.data.filter.isAlreadyRemovedUsingLimitedStructure({key:ge[nn],dim:ve,prop:_e})},disableRemoveAll(ge){var me,be;if(!isEntityConcept(he.MDL.color.data.conceptProps))return!0;if(null!==(me=he.root.ui.dialogs)&&void 0!==me&&null!==(be=me.markercontrols)&&void 0!==be&&be.disableAddRemoveGroups)return!0;const ve=he.model.encoding.color.data.space[0],_e=he.MDL.color.data.concept;return he.model.data.filter.isAlreadyRemovedUsingLimitedStructure({key:ge[nn],dim:ve,prop:_e})},disableRemoveAllinOtherGroups(ge){var me,be;if(!isEntityConcept(he.MDL.color.data.conceptProps))return!0;if(null!==(me=he.root.ui.dialogs)&&void 0!==me&&null!==(be=me.markercontrols)&&void 0!==be&&be.disableAddRemoveGroups)return!0;const ve=he.model.encoding.color.data.space[0],_e=he.MDL.color.data.concept,xe=he.MDL.legend.dataArray.map((he=>he[nn])).filter((he=>he!==ge[nn]));return he.model.data.filter.isAlreadyRemovedUsingLimitedStructure({key:ge[nn],dim:ve,prop:_e})||xe.every((ge=>he.model.data.filter.isAlreadyRemovedUsingLimitedStructure({key:ge,dim:ve,prop:_e})))},clickToSelect(ge){var me;const ve=he.MDL.color.data.concept,_e=he.MDL.color.name,xe=he.MDL.selected.data.filter,we=null===(me=he.model.dataArray)||void 0===me?void 0:me.filter((he=>!function isTrailBubble(he){return!!he[Symbol.for("trailHeadKey")]}(he)&&he[_e]==ge[ve]));we&&(we.every((he=>xe.has(he)))?be.runInAction((()=>xe.delete(we))):be.runInAction((()=>xe.set(we))))}}}_initSelectDialog(){this.DOM.moreOptionsHint=this.DOM.wrapper.select(".vzb-cl-more-hint"),this.DOM.selectDialog=this.DOM.wrapper.select(".vzb-cl-select-dialog"),this.DOM.selectDialogTitle=this.DOM.selectDialog.select(".vzb-cl-select-dialog-title"),this.DOM.selectDialogClose=this.DOM.selectDialog.select(".vzb-cl-select-dialog-close"),this.DOM.selectDialogClose.html(Me).on("click",(()=>this._closeSelectDialog())),this.DOM.selectAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-cl-select-dialog-item vzb-clickable"),this.DOM.addAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-cl-select-dialog-item vzb-clickable"),this.DOM.removeAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-cl-select-dialog-item vzb-clickable"),this.DOM.removeAllinOtherGroups=this.DOM.selectDialog.append("div").attr("class","vzb-cl-select-dialog-item vzb-clickable"),this.DOM.editColorButton=this.DOM.selectDialog.append("div").attr("class","vzb-cl-select-dialog-item vzb-cl-select-dialog-item-moreoptions"),this.DOM.editColorButton.append("label").attr("class","vzb-clickable").attr("for","vzb-cl-select-dialog-color-"+this.id),this.DOM.editColorButton.append("input").attr("type","color").attr("class","vzb-invisible").attr("id","vzb-cl-select-dialog-color-"+this.id),this.DOM.editColorButton.append("span").attr("class","vzb-clickable"),this.DOM.editColorButtonTooltip=this.DOM.editColorButton.append("div").attr("class","vzb-cl-select-dialog-item-tooltip")}_updateUiStrings(he){const ge=this.localise;this.DOM.selectDialogTitle.text(he),this.DOM.moreOptionsHint.text(ge("hints/color/more")),this.DOM.selectAllinGroup.text("â "+ge("dialogs/color/select-all-in-group")+" "+he),this.DOM.addAllinGroup.text("â³ï¸ "+ge("dialogs/color/add-all-in-group")+" "+he),this.DOM.removeAllinGroup.text("ðï¸ "+ge("dialogs/color/remove-all-in-group")+" "+he),this.DOM.removeAllinOtherGroups.text("ð¯ "+ge("dialogs/color/remove-else")),this.DOM.editColorButton.select("label").text("ð¨ "+ge("dialogs/color/edit-color")),this.DOM.editColorButton.select("span").text(ge("buttons/reset")),this.DOM.editColorButtonTooltip.text(ge("dialogs/color/edit-color-blocked-hint")+" "+(this.MDL.color.data.conceptProps.name||this.MDL.color.data.concept))}closeSelectDialogOnConceptChange(){this.MDL.color.data.concept,this._closeSelectDialog()}_closeSelectDialog(){this.DOM.selectDialog.classed("vzb-hidden",!0)}_bindSelectDialogItems(he){const ge=this;this._updateUiStrings(he.name),this.DOM.selectAllinGroup.classed("vzb-hidden",(()=>this._interact().disableSelectHover(he))).on("click",(()=>{this._interact().clickToSelect(he),this._closeSelectDialog()})),this.DOM.addAllinGroup.classed("vzb-hidden",(()=>this._interact().disableAddAll(he))).on("click",(()=>{this._interact().clickToAddAllinGroup(he),this._closeSelectDialog()})),this.DOM.removeAllinGroup.classed("vzb-hidden",(()=>this._interact().disableRemoveAll(he))).on("click",(()=>{this._interact().clickToRemoveAllinGroup(he),this._closeSelectDialog()})),this.DOM.removeAllinOtherGroups.classed("vzb-hidden",(()=>this._interact().disableRemoveAllinOtherGroups(he))).on("click",(()=>{this._interact().clickToRemoveAllinOtherGroups(he),this._closeSelectDialog()}));const be=this.MDL.color.scale.palette.isUserSelectable;if(this.DOM.editColorButtonTooltip.classed("vzb-hidden",be),this.DOM.editColorButton.select("span").classed("vzb-hidden",!be),this.DOM.editColorButton.classed("vzb-cl-select-dialog-item-disabled",!be),be){const be=this.MDL.color.scale,ve=this.MDL.color.data.concept,_e=this.MDL.color.data.isConstant?"_default":he[ve],xe=be.palette.getColor(_e),we=be.palette.getColor(_e,be.palette.defaultPalette);this.DOM.editColorButton.select("input").property("value",xe).on("input",(function(){const he=me.select(this).property("value");be.palette.setColor(he,_e)})).on("change",(function(){ge._closeSelectDialog()})),this.DOM.editColorButton.select("span").classed("vzb-hidden",xe==we).style("color",we).on("click",(function(){be.palette.removeColor(_e),ge._closeSelectDialog()}))}}},{MDL:be.computed}),on={SMALL:{},MEDIUM:{},LARGE:{}},rn={SMALL:{},MEDIUM:{},LARGE:{}},CollectionMixin=he=>class extends he{static add(he,ge){CollectionMixin._collection[he]=ge}static get(he){return CollectionMixin._collection[he]}};
/*!
   * VIZABI DIALOG
   * Reusable Dialog component
   */CollectionMixin._collection={};class Dialog extends(CollectionMixin(Ve)){constructor(he){super(he)}setup(){this.DOM={dialog:this.element.select(".vzb-dialog-modal"),title:this.element.select(".vzb-dialog-modal>.vzb-dialog-title"),buttons:me.select(this.element.selectAll(".vzb-dialog-modal>.vzb-dialog-buttons").nodes().pop()),content:this.element.select(".vzb-dialog-modal > .vzb-dialog-content"),dragHandler:this.element.select("[data-click='dragDialog']"),pinIcon:this.element.select("[data-click='pinDialog']")},this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"],this.state.opened=!1;const he=this;this.DOM.dragHandler.html(ve),this.DOM.pinIcon.html(xe),this.DOM.pinIcon.on("click",(()=>{this.setPin(!this.getPin())}));const ge=function dialogDrag(he,ge,be){let ve,_e,xe,we,Me,Se,De,ze,Oe,Ce,ke,Te,Le,Ae;return{move(ge,me){he.style("right",ge+"px"),he.style("top",me+"px")},dragStart(Ee){if(isTouchDevice()){const he=me.pointer(Ee,ge.node());ve=he[0][0],_e=he[0][1]}else ve=Ee.sourceEvent.clientX,_e=Ee.sourceEvent.clientY;xe=parseInt(he.style("top"))||0,we=parseInt(he.style("right"))||0,Se=parseInt(he.style("margin-left"))||0,Me=parseInt(he.style("margin-right"))||0,ze=Math.min(be,Se),De=Math.min(be,Me),Oe=parseInt(he.style("width"),10)+Se-ze||0,Ce=parseInt(he.style("height"),10)||0,ke=ge.node().offsetWidth-Me||0,Te=ge.node().offsetHeight||0,Le=ve+we,Ae=_e-xe},drag(he){if(isTouchDevice()){const be=me.pointer(he,ge.node());ve=be[0][0],_e=be[0][1]}else ve=he.sourceEvent.clientX,_e=he.sourceEvent.clientY;let be=-ve+Le,xe=_e-Ae;be<-De&&(be=-De),xe<0&&(xe=0),be+Oe>ke&&(be=ke-Oe),xe+Ce>Te&&(xe=Te-Ce),this.move(be,xe)}}}
/*!
   * VIZABI DIALOGS
   * Reusable dialogs component
   */(this.element,this.root.element,10),be=me.drag().on("start",(me=>{const be=he.element.node().offsetTop;he.element.style("top",be+"px"),he.element.style("bottom","auto"),he.element.dispatch("custom-dragstart"),ge.dragStart(me)})).on("drag",(me=>{he.element.dispatch("custom-drag"),ge.drag(me)})).on("end",(()=>{he.rightPos=he.element.style("right"),he.topPos=he.element.style("top"),he.element.dispatch("custom-dragend")}));this.DOM.dragHandler.call(be)}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted}}draw(){this.localise=this.services.locale.auto(),this._localiseDialogTexts(),this._updateLayoutProfile()||(this.addReaction(this._pinButtonUpdate),this.addReaction(this.updateSize,{throttle_ms:500}))}resize(){}_localiseDialogTexts(){const he=this;this.element.selectAll("span[data-localise]").each((function(){const ge=me.select(this);ge.text(he.localise(ge.attr("data-localise")))}))}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(on,rn),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Dialog _updateProfile() abort: container is too little or has display:none")}updateSize(){if(this.services.layout.size,this.element.classed("vzb-top-dialog")){this.element.classed("notransition",!0);const he=this.services.layout.profile;if("SMALL"!==he){const ge=this.root.element.node().offsetWidth||0,me=this.root.element.node().offsetHeight||0,be=parseInt(this.element.style("width"),10)||0,ve=parseInt(this.element.style("height"),10)||0,_e=parseInt(this.rightPos,10),xe=parseInt(this.topPos,10),we=parseInt(this.element.style("margin-right"),10)||0;isNumber(_e)&&_e>ge-be-we&&this.rightPos&&(this.rightPos=ge-be-we+"px",this.isOpen&&this.element.style("right",this.rightPos)),isNumber(xe)&&isNumber(ve)&&xe>=0&&xe>me-ve&&this.topPos&&(this.topPos=(me-ve>0?me-ve:0)+"px",this.isOpen&&this.element.style("top",this.topPos)),this.topPos&&"LARGE"===he&&this.root.element.classed("vzb-dialog-expand-true")&&this.element.style("bottom","auto"),this.root.element.classed("vzb-landscape"),this.DOM.dialog.style("max-height","")}else this.rightPos="",this.topPos="",this.element.attr("style","");this.DOM.dragHandler.classed("vzb-hidden","SMALL"===he),this.DOM.pinIcon.classed("vzb-hidden","SMALL"===he),this._setMaxHeight()}}_setMaxHeight(){let he=this.root.element.node().offsetHeight;const ge=this.services.layout.profile;if("SMALL"!==ge)if(!this.topPos&&"LARGE"===ge&&this.root.element.classed("vzb-dialog-expand-true")){he-=parseInt(this.element.style("bottom"),10)}else{he-=this.topPos?parseInt(this.topPos,10):this.element.node().offsetTop}else he=this.root.element.classed("vzb-portrait")?he-50:he-10;this.DOM.dialog.style("max-height",he+"px");const me=he-this.DOM.title.node().offsetHeight-((this.DOM.buttons.node()||{}).offsetHeight||0);this.DOM.content.style("max-height",me+"px")}beforeOpen(){const he=this;if(this.transitionEvents.forEach((ge=>{he.element.on(ge,he._transitionEnd.bind(he,ge))})),this.element.classed("notransition",!0),this.element.style("top",""),this.element.style("bottom",""),this.topPos&&"LARGE"===this.services.layout.profile&&this.root.element.classed("vzb-dialog-expand-true")){const he=this.element.node().offsetTop;this.element.style("top",he+"px"),this.element.style("bottom","auto")}else this.services.layout.profile;this.element.node().offsetTop,this.element.classed("notransition",!1),"SMALL"===this.services.layout.profile?this.element.style("top",""):this.root.element.classed("vzb-landscape")}open(){this.isOpen=!0,"SMALL"!==this.services.layout.profile&&this.topPos&&(this.element.style("top",this.topPos),this.element.style("right",this.rightPos))}beforeClose(){this.root.element.classed("vzb-portrait")&&"SMALL"===this.services.layout.profile&&this.element.style("top","auto"),"LARGE"===this.services.layout.profile&&this.root.element.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.element.node().parentNode.offsetHeight-this.element.node().offsetHeight+"px":""),this.element.classed("notransition",!1),this.element.node().offsetHeight}close(){this.root.element.classed("vzb-portrait")&&"SMALL"===this.services.layout.profile||(this.element.style("top",""),this.element.style("right","")),"LARGE"===this.services.layout.profile&&this.root.element.classed("vzb-dialog-expand-true")&&(this.element.style("top",this.topPos0),this.element.style("right","")),this.isOpen=!1}_transitionEnd(){const he=this;this.transitionEvents.forEach((ge=>{he.element.on(ge,null)})),this.isOpen&&this.element.classed("notransition",!0)}setOpen(he){this.ui.opened=he}getOpen(){return this.ui.opened}setPin(he){this.ui.pinned=he}getPin(){return this.ui.pinned}_pinButtonUpdate(){this.element.classed("pinned",this.getPin())}}Dialog.DEFAULT_UI={opened:!1,pinned:!1};const an=be.decorate(Dialog,{MDL:be.computed});const ln="vzb-active";let cn=!0;class _ErrorMessage extends Ve{constructor(he){he.template='\n      <div class="vzb-errormessage-background"></div>\n      <div class="vzb-errormessage-box">\n        <div class="vzb-errormessage-hero">ð</div>\n        <div class="vzb-errormessage-title"></div>\n        <div class="vzb-errormessage-body vzb-dialog-scrollable">\n          <div class="vzb-errormessage-message"></div>\n          <div class="vzb-errormessage-expand"></div>\n          <pre class="vzb-errormessage-details vzb-hidden"></pre>\n        </div>\n      </div>\n    ',super(he)}setup(){this.DOM={background:this.element.select(".vzb-errormessage-background"),container:this.element.select(".vzb-errormessage-box"),close:this.element.select(".vzb-errormessage-close"),hero:this.element.select(".vzb-errormessage-hero"),title:this.element.select(".vzb-errormessage-title"),message:this.element.select(".vzb-errormessage-message"),expand:this.element.select(".vzb-errormessage-expand"),details:this.element.select(".vzb-errormessage-details")},this.element.classed("vzb-hidden",!0),this.DOM.background.on("click",(()=>{this.toggle(!0)})),this.DOM.expand.on("click",(()=>{this.DOM.details.classed("vzb-hidden",!this.DOM.details.classed("vzb-hidden"))}))}get MDL(){return{frame:this.model.encoding.frame}}rethrow(he){setTimeout((function(){throw he}),1),setTimeout((function(){throw"ERROR REACHED USER"}),1)}toggle(he){null==he&&(he=!cn),cn=he,this.element.classed("vzb-hidden",cn),this.root.children.forEach((he=>{he.element.classed("vzb-blur",he!=this&&!cn)}))}error(he){if(!cn)return console.warn("errorMessage: skipping action because already in error");const ge="fulfilled"==this.services.locale.status?this.services.locale.auto():he=>he;this.DOM.title.text(ge(he.name)),this.DOM.message.text(ge(he.message)),this.DOM.expand.style("display",he.details?"block":"none").html(ge("crash/expand")),this.DOM.details.style("display",he.details?"block":"none").text(JSON.stringify(he.details,null,2)),this.toggle(!1),this.rethrow(he)}}_ErrorMessage.DEFAULT_UI={};const un=be.decorate(_ErrorMessage,{MDL:be.computed});function getFacetId(he){return he}function firstLastOrMiddle$1(he,ge){return{first:0===he,last:he+1===ge}}class _Facet extends Ve{setup(he){this.direction=this.options.direction||"row",super.setup(he)}get MDL(){return this.model}loading(){}draw(){this.updateLayoutProfile()||(this.addReaction(this.addRemoveSubcomponents),this.addReaction(this.updatePositionInRepeat),this.addReaction(this.updateSize,{throttle_ms:50}))}updatePositionInRepeat(){this.children.forEach((he=>he.state.positionInRepeat=this.state.positionInRepeat))}getDataForSubcomponent(he){return[...this.data.get(he).values()]}sortFacets(he){return new Map([...he].sort(((he,ge)=>he[0].includes("is--")?-1:ge[0].includes("is--")?1:void 0)))}get data(){const he="facet_"+this.direction;return this.sortFacets(this.model.dataMap.groupByWithMultiGroupMembership(he))}howManyFacets(){return this.data.size}isRowDirection(){return"row"==this.direction}get maxValues(){let he;return be.runInAction((()=>{he=[...this.data.keys()].map((he=>[he,null]))})),be.observable.map(he)}getScaleDomainForSubcomponent(he){return he?this.maxValues.get(he)||0:me.sum(this.maxValues.values())}updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(this.options.facetedComponent.PROFILE_CONSTANTS,this.options.facetedComponent.PROFILE_CONSTANTS_FOR_PROJECTOR),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Chart _updateProfile() abort: container is too little or has display:none")}propagateInteractivity(he){this.children.forEach((ge=>he(ge)))}get largetstFacetId(){if(this.ui.inpercent)return[...this.maxValues.keys()].at(-1);{const he={k:null,v:0};return[...this.maxValues.entries()].forEach((ge=>{let[me,be]=ge;be>he.v&&(he.v=be,he.k=me)})),he.k}}updateSize(){this.services.layout.size,this.services.layout.projector,this.ui.inpercent;const he=this.isRowDirection(),ge=[...this.maxValues.keys()],be=[...this.maxValues.values()],{margin:ve,minHeight:_e=1,minWidth:xe=1}=this.profileConstants,we=he?_e:xe,Me=(he?ve.betweenRow:ve.betweenColumn)||0,Se=(he?this.height-ve.top-ve.bottom:this.width-ve.left-ve.right)-Me*(ge.length-1),getUpdateStr=()=>JSON.stringify(ge)+JSON.stringify(be)+we+Se+this.ui.inpercent;if(getUpdateStr()===this.resizeUpdateString)return;this.resizeUpdateString=getUpdateStr();let De=be.map((()=>null));if(this.ui.inpercent){const he=me.sum(be);this.scaleRange=Se/be.length<we?we:Se/be.length,De=be.map((ge=>Math.round(Se*ge/he)))}else{let he,ge,ve=5,_e=Se,xe=!1;const proportion=me=>ge*be[me]/he;for(let Me=0;Me<ve&&_e>1&&!xe;Me++)ge=Se-me.sum(De.filter((he=>he==we))),he=me.sum(be.filter(((he,ge)=>De[ge]!=we))),De=De.map(((he,ge)=>he==we||proportion(ge)<we?we:Math.floor(proportion(ge)))),xe=De.every((he=>he==we)),_e=me.sum(De)-Se;const Me=me.scaleLinear().domain([0,me.max(be)]).range([0,me.max(De)]),ze=me.sum(De.map(((he,ge)=>he-Me(be[ge]))));this.scaleRange=Se-ze}const ze=this.howManyFacets()-1,Oe={first:he?ve.top:ve.left,last:he?ve.bottom:ve.right},Ce={first:he?ve.left:ve.top,last:he?ve.right:ve.bottom},ke={dominant:De.map(((he,ge)=>""+"[start_".concat(ge,"]")+" ".concat(0==ge?Oe.first:.5*Me,"px ")+" ".concat(he||1,"px ")+" ".concat(ge==ze?Oe.last:.5*Me,"px ")+"[end_".concat(ge,"]"))).join(" 0px "),non_dominant:"[start_0]"+" ".concat(Ce.first,"px ")+" 1fr "+" ".concat(Ce.last,"px ")+"[end_0]"};this.element.style("grid-template-columns",ke[he?"non_dominant":"dominant"]).style("grid-template-rows",ke[he?"dominant":"non_dominant"]),this.rangePartsHash=De.join(",")}addRemoveSubcomponents(){const{facetedComponentCssClass:he}=this.options,ge=[...this.data.keys()];if(JSON.stringify(ge)===this.facetKeysString)return;this.facetKeysString=JSON.stringify(ge);const ve=this.isRowDirection();be.runInAction((()=>{let be=this.element.selectAll(".vzb-facet-inner").data(ge,getFacetId);be.exit().each((he=>this.removeSubcomponent(he))).remove(),be.enter().append("div").attr("class","vzb-facet-inner").each((function(ge){me.select(this).append("div").datum(null).attr("class",(()=>"".concat(he," vzb-").concat(ge)))})).each(((he,ge)=>this.addSubcomponent(he,ge))).merge(be).style("grid-row-start",((he,ge)=>"start_"+(ve?ge:0))).style("grid-row-end",((he,ge)=>"end_"+(ve?ge:0))).style("grid-column-start",((he,ge)=>"start_"+(ve?0:ge))).style("grid-column-end",((he,ge)=>"end_"+(ve?0:ge))).classed("vzb-facet-row-first",(he=>this.getPosition(ge.indexOf(he)).row.first)).classed("vzb-facet-row-last",(he=>this.getPosition(ge.indexOf(he)).row.last)).classed("vzb-facet-column-first",(he=>this.getPosition(ge.indexOf(he)).column.first)).classed("vzb-facet-column-last",(he=>this.getPosition(ge.indexOf(he)).column.last)).each((he=>{this.findChild({name:he}).state.positionInFacet=this.getPosition(ge.indexOf(he))})),this.services.layout._resizeHandler()}))}getPosition(he){const ge=this.isRowDirection(),me=ge?1:[...this.data.keys()].length,be=ge?[...this.data.keys()].length:1,ve={row:firstLastOrMiddle$1(ge?he:0,be),column:firstLastOrMiddle$1(ge?0:he,me)};return ve.row.start=(ve.row.first?0:he+1)+1,ve.row.end=(ve.row.last?be+2:he+2)+1,ve.column.start=(ve.column.first?0:he+1)+1,ve.column.end=(ve.column.last?me+2:he+2)+1,ve}addSubcomponent(he,ge){const{facetedComponent:me}=this.options,be=he,ve=new me({id:this.id+"-"+ge,placeholder:".vzb-"+be,model:this.model,name:be,parent:this,root:this.root,state:{alias:this.state.alias,positionInRepeat:this.state.positionInRepeat},services:this.services,ui:this.ui,default_ui:this.DEFAULT_UI});this.children.push(ve)}removeSubcomponent(he){const ge=this.findChild({name:he});if(ge){ge.deconstruct();const he=this.children.indexOf(ge);he>=0&&this.children.splice(he,1)}}}_Facet.DEFAULT_UI={};const dn=be.decorate(_Facet,{MDL:be.computed,data:be.computed,scaleRange:be.observable,maxValues:be.computed,largetstFacetId:be.computed,rangePartsHash:be.observable});
/*!
   * VIZABI INDICATOR PICKER
   * Reusable indicator picker component
   */class IndicatorPicker extends Ve{constructor(he){he.template='\n      <span class="vzb-ip-holder">\n        <span class="vzb-ip-select"></span>\n        <span class="vzb-ip-info"></span>\n      </span>\n    ',super(he)}setup(he){this.targetProp=he.targetProp,this.submodel=he.submodel,this.submodelFunc=he.submodelFunc,this.showHoverValues=he.showHoverValues||!1,this.DOM={select:this.element.select(".vzb-ip-select"),info:this.element.select(".vzb-ip-info")},this.DOM.select.on("click",(()=>{const he=this.DOM.select.node().getBoundingClientRect(),ge=this.root.element.node().getBoundingClientRect(),me=this.root.findChild({type:"TreeMenu"}),be=me.profileConstants.col_width,ve=me.element.select(".vzb-treemenu-wrap"),_e=parseInt(ve.style("padding-left"),10)||0,xe=parseInt(ve.style("padding-right"),10)||0,we=he.bottom-ge.top,Me=he.left-ge.left-.5*(_e+xe+be-he.width);this._isEncoding()&&me.alignX("left").alignY("top").top(we).left(Me).encoding(this.targetProp).toggle()}))}draw(){this.MDL={model:this._getModel()},this.showHoverValues&&(this.MDL.highlighted=this.model.encoding.highlighted),this.localise=this.services.locale.auto(),this.addReaction(this._updateView)}_getModel(){return"encoding"===this.submodel?this.model.encoding[this.targetProp]:this.submodel||this.submodelFunc?this.submodelFunc?this.submodelFunc():getProp(this,this.submodel.split(".")):this.model}_updateView(){let he;if(this._isEncoding())if(this.MDL.model.data.isConstant){const ge=this.MDL.model.data.constant,me=this.MDL.model.scale.config.modelType;he=this.localise("indicator/"+ge+(me?"/"+me:""))}else if(this.showHoverValues&&1===this.MDL.highlighted.data.filter.markers.size&&!this.MDL.model.scale.isPattern){const be=this.MDL.highlighted.data.filter.markers,[ve,_e]=be.entries().next().value,xe=(this.model.dataMap.getByStr(ve)||!0!==_e&&JSON.parse(_e)||{})[this.targetProp];if(["entity_domain","entity_set","string"].includes(this.MDL.model.data.conceptProps.concept_type))he=this.state.hoverKeyLabels&&null!=this.state.hoverKeyLabels[xe]?this.state.hoverKeyLabels[xe]:this.localise(xe);else{var ge,me;he=this.services.locale.auto({shareOrPercent:null===(ge=this.MDL.model.data)||void 0===ge||null===(me=ge.conceptProps)||void 0===me?void 0:me.format})(xe)}}else he=getConceptShortName(this.MDL.model,this.localise);this.treemenu=this.root.findChild({type:"TreeMenu"}),this.DOM.select.classed("vzb-disabled",this.treemenu.state.ownReadiness!==ke.READY).text(he)}_isEncoding(){return!!this.MDL.model.marker}_setModel(he){this.MDL.model[this.checkbox]=he}}function key(he){return he[Symbol.for("key")]}const hn={SMALL:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,closeCrossSize:19.2,labelLeashCoeff:.4},MEDIUM:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,closeCrossSize:24,labelLeashCoeff:.3},LARGE:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,closeCrossSize:26.4,labelLeashCoeff:.2}},pn={MEDIUM:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,closeCrossSize:31.2,labelLeashCoeff:.3},LARGE:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,closeCrossSize:38.4,labelLeashCoeff:.2}},fn={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0};class Labels extends Ve{setup(he){this.context=this.parent,this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null,this.cached={},this.label=this.LABEL(this),this.options=extend({},fn),he&&this.setOptions(he),this.label.setCssPrefix(this.options.CSS_PREFIX),this.labelsContainer=this.context.element.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.context.element.select("."+this.options.LINES_CONTAINER_CLASS),this.tooltipEl=this.labelsContainer.append("g").attr("class",this.options.CSS_PREFIX+"-tooltip")}setOptions(he){extend(this.options,he)}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected.data.filter,highlighted:this.model.encoding.highlighted.data.filter,size:this.model.encoding.size,size_label:this.model.encoding.size_label,color:this.model.encoding.color,label:this.model.encoding.label}}draw(){this.addReaction(this._updateLayoutProfile),this.addReaction(this.selectDataPoints),this.addReaction(this.updateSizeTextScale),this.addReaction(this.updateLabelSizeLimits),this.addReaction(this.updateLabelsOnlyTextSize),this.addReaction(this.updateCloseCrossHeight),this.addReaction(this.updateTooltipFontSize)}updateLabelSizeLimits(){if(!this.MDL.size_label)return;this.services.layout.size;const he=this.MDL.size_label.scale.extent||[0,1],ge=this.profileConstants.minLabelTextSize,me=this.profileConstants.maxLabelTextSize-ge;this.minLabelTextSize=Math.max(ge+me*he[0],ge),this.maxLabelTextSize=Math.max(ge+me*he[1],ge),this.MDL.size_label.data.isConstant&&(null===he[1]?this.minLabelTextSize=this.maxLabelTextSize=this.profileConstants.defaultLabelTextSize:this.minLabelTextSize=this.maxLabelTextSize),this.labelSizeTextScale.range([this.minLabelTextSize,this.maxLabelTextSize])}updateSizeTextScale(){this.MDL.size_label&&(this.labelSizeTextScale=this.MDL.size_label.scale.d3Scale)}setScales(he,ge){this._xScale=he,this._yScale=ge}updateCloseCrossHeight(){this.services.layout.size;const he=this.profileConstants.closeCrossSize;this._closeCrossHeight!=he&&(this._closeCrossHeight=he,this.entityLabels&&this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))}xScale(he){return this._xScale?this._xScale(he):he*this.context.width}yScale(he){return this._yScale?this._yScale(he):he*this.context.height}selectDataPoints(){const he=this,ge=this.options.CSS_PREFIX,be=[...this.MDL.selected.markers.keys()].filter((ge=>he.model.dataMap.hasByStr(ge))).map((he=>({[Symbol.for("key")]:he})));this.entityLabels=this.labelsContainer.selectAll("."+ge+"-entity").data(be,key),this.entityLines=this.linesContainer.selectAll("g.entity-line."+ge+"-entity").data(be,key),this.entityLabels.exit().each((ge=>{null!=he.cached[key(ge)]&&(he.cached[key(ge)]=void 0)})).remove(),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().insert("g",(function(ge){return this.querySelector("."+he.options.LINES_CONTAINER_SELECTOR_PREFIX+CSS.escape(key(ge)))})).attr("class",(he=>ge+"-entity entity-line line-"+key(he))).each((function(){he.label.line(me.select(this))})).merge(this.entityLines).classed("vzb-hidden",!this.ui.enabled),this.entityLabels=this.entityLabels.enter().append("g").attr("class",(he=>ge+"-entity label-"+key(he))).each((function(ge){he.cached[key(ge)]={_new:!0},he.label(me.select(this))})).merge(this.entityLabels).classed("vzb-hidden",!this.ui.enabled),Object.keys(this.ui.offset).forEach((he=>{this.MDL.selected.has(he)||delete this.ui.offset[he]}))}showCloseCross(he,ge){this.entityLabels.filter((ge=>!he||key(ge)==key(he))).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!ge||isTouchDevice())}highlight(he,ge){let me=this.entityLabels;me&&(he&&(me=me.filter((ge=>!he||key(ge)==key(he)))),me.classed("vzb-highlighted",ge))}updateLabel(he,ge,be,ve,_e,xe,we,Me,Se,De){const ze=this;if(key(he)==this.dragging)return;const Oe=this.options.CSS_PREFIX;if(this.MDL.selected.has(he)&&null!=this.entityLabels){null==this.cached[key(he)]&&this.selectDataPoints();const Ce=this.cached[key(he)];if(ge&&extend(Ce,ge),null!=Ce.scaledS0&&null!=Ce.labelX0&&null!=Ce.labelY0||this._initNewCache(Ce,be,ve,_e,xe,we,Me),null==Ce.labelX_||null==Ce.labelY_){const ge=this.ui.offset[key(he)];Ce.labelOffset=ge&&ge.slice(0)||[0,0]}const ke=!Ce.labelX0&&0!==Ce.labelX0||!Ce.labelY0&&0!==Ce.labelY0||!Ce.scaledS0&&0!==Ce.scaledS0,Te=this.entityLines.filter((ge=>key(ge)==key(he)));this.entityLabels.filter((ge=>key(ge)==key(he))).each((function(){const ge=me.select(this);if(ke)return ge.classed("vzb-invisible",ke),void Te.classed("vzb-invisible",ke);const be=ge.selectAll("."+Oe+"-label-content").text(we||Ce.labelText);ze._updateLabelSize(he,null,ge,Me,be),ze.positionLabel(he,null,this,Se,De,Te)}))}}_initNewCache(he,ge,me,be,ve,_e,xe){(be||0===be)&&(he.scaledS0=areaToRadius(this.context.sScale(be))),he.valueS0=be,he.labelX0=ge,he.labelY0=me,he.labelText=_e,he.valueLST=xe,he.scaledC0=null!=ve?this.context.cScale(ve):this.context.COLOR_WHITEISH}setTooltip(he,ge,me,be){if(ge){let ve=0;const _e=this.options.CSS_PREFIX;if(this.tooltipEl.raise().text(null).classed("vzb-invisible",!1),this.label(this.tooltipEl,!0),he){const ge={};this._initNewCache(ge,be.valueX,be.valueY,be.valueS,be.valueC,"",be.valueLST),this.tooltipEl.classed(this.options.CSS_PREFIX+"-tooltip",!1).classed(this.options.CSS_PREFIX+"-entity",!0).selectAll("."+_e+"-label-content").text(be.labelText),this._updateLabelSize(he,ge,this.tooltipEl,be.valueLST),ve=this.positionLabel(he,ge,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"))}this.tooltipEl.classed(this.options.CSS_PREFIX+"-entity",!1).classed(this.options.CSS_PREFIX+"-tooltip",!0).selectAll("."+_e+"-label-content").text(ge),this._updateLabelSize(he,me,this.tooltipEl,null),this.positionLabel(he,me,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"),ve)}else this.tooltipEl.text(null)}updateTooltipFontSize(){this.services.layout.size,this.tooltipEl.style("font-size",this.profileConstants.defaultLabelTextSize)}_updateLabelSize(he,ge,me,be,ve){const _e=this,xe=ge||_e.cached[key(he)],we=this.options.CSS_PREFIX,Me=this.root.ui.chart.labels;me.classed("vzb-label-boxremoved",Me.removeLabelBox);const Se=ve||me.selectAll("."+we+"-label-content");if(_e.labelSizeTextScale)if(null!=be){const he=_e.labelSizeTextScale.range(),ge=he[0]+Math.sqrt((_e.labelSizeTextScale(be)-he[0])*(he[1]-he[0]));Se.attr("font-size",ge+"px"),xe.fontSize=ge,xe.initFontSize||(xe.initFontSize=ge)}else Se.attr("font-size",null),xe.fontSize=parseFloat(Se.style("font-size")),xe.initFontSize||(xe.initFontSize=xe.fontSize);else xe.fontSize=parseFloat(Se.style("font-size")),xe.initFontSize||(xe.initFontSize=xe.fontSize);let De;Se.style("stroke","none"),xe.initTextBBox=Se.node().getBBox(),Se.style("stroke",null),De=xe.textBBox={width:xe.initTextBBox.width,height:xe.initTextBBox.height};xe.textBBox.width=1*xe.initTextBBox.width,xe.textBBox.height=1*xe.initTextBBox.height,De=xe.textBBox;const ze=me.selectAll("rect");if(!xe.textWidth||xe.textWidth!=De.width){xe.textWidth=De.width;const he=_e._closeCrossHeight||De.height,ge=_e.services.locale.isRTL(),be=me.select("."+we+"-label-x").attr("transform","translate("+(ge?-De.width-4:4)+","+.85*-De.height+")");this.updateLabelCloseGroupSize(be,he);const ve=xe.rectBBox={x:-De.width-4,y:.85*-De.height,width:De.width+8,height:1.2*De.height};xe.rectOffsetX=ve.width+ve.x,xe.rectOffsetY=ve.height+ve.y,ze.attr("width",ve.width).attr("height",ve.height).attr("x",ve.x).attr("y",ve.y).attr("rx",.2*De.height).attr("ry",.2*De.height)}const Oe=me.select(".vzb-label-glow");Oe.attr("stroke")!==xe.scaledC0&&Oe.attr("stroke",xe.scaledC0)}updateLabelCloseGroupSize(he,ge){he.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*ge),he.select("svg").attr("x",.5*-ge).attr("y",-.5*ge).attr("width",ge).attr("height",ge)}updateLabelsOnlyTextSize(){const he=this;this.MDL.size_label.scale.extent,this.services.layout.size,be.runInAction((()=>{this.entityLabels.each((function(ge){if(he._updateLabelSize(ge,null,me.select(this),he.model.dataMap.getByStr(ge[Symbol.for("key")]).size_label),he.cached[key(ge)]._new)return;const be=he.entityLines.filter((he=>key(he)==key(ge)));he.positionLabel(ge,null,this,0,null,be)}))}))}updateLabelOnlyPosition(he,ge,me){const be=this,ve=this.cached[key(he)];me&&extend(ve,me);const _e=be.entityLines.filter((ge=>key(ge)==key(he)));this.entityLabels.filter((ge=>key(ge)==key(he))).each((function(){be.positionLabel(he,null,this,0,null,_e)}))}updateLabelOnlyColor(he,ge,me){const be=this.cached[key(he)];me&&extend(be,me);const ve=this.entityLabels.filter((ge=>key(ge)==key(he)));this._updateLabelSize(he,null,ve,null)}positionLabel(he,ge,me,be,ve,_e,xe){if(key(he)==this.dragging)return;const we=ge||this.cached[key(he)],Me=xe||0===xe,Se=1&(xe||0),De=(2&(xe||0))>>1;let ze=0,Oe=0;const Ce=this.context.width,ke=this.context.height,Te=this.xScale(we.labelX0),Le=this.yScale(we.labelY0),Ae=we.rectOffsetX,Ee=we.rectOffsetY;we.labelOffset||(we.labelOffset=[0,0]),we.labelX_=we.labelOffset[0]||(.75*-we.scaledS0-Ae)/Ce,we.labelY_=we.labelOffset[1]||(.75*-we.scaledS0-Ee)/ke;let je=Te+we.labelX_*Ce,Re=Le+we.labelY_*ke;if(we.labelOffset[0]+we.labelOffset[1]==0&&((!Me&&Re-we.rectBBox.height+Ee<=0||De)&&(Oe=1,we.labelY_=(.75*we.scaledS0+we.rectBBox.height-Ee)/ke,Re=Le+we.labelY_*ke),(!Me&&je-we.rectBBox.width+Ae<=0||Se)&&(ze=1,we.labelX_=(.75*we.scaledS0+we.rectBBox.width-Ae)/Ce,je=Te+we.labelX_*Ce,je>Ce&&(ze=0,Oe=0==Oe&&Le-.5*Ee-we.scaledS0<we.rectBBox.height?1:Oe,we.labelY_=Oe?.5*-Ee+we.rectBBox.height+we.scaledS0:1.5*-Ee-we.scaledS0,we.labelY_/=ke,Re=Le+we.labelY_*ke,we.labelX_=(we.rectBBox.width-Ae-Te)/Ce,je=Te+we.labelX_*Ce))),Me){let he=!1;if(je-we.rectBBox.width+Ae<=0){const ge=Te-we.rectBBox.width,me=ge>0?cathetus(we.scaledS0,ge):we.scaledS0;Re=Oe?Le+we.rectBBox.height-.5*Ee+me:Le-1.5*Ee-me,Re-we.rectBBox.height<0&&(he=!0)}if(Re-we.rectBBox.height+Ee<=0){const ge=Le-we.rectBBox.height,me=ge>0?cathetus(we.scaledS0,ge):we.scaledS0;je=ze?Te+we.rectBBox.width+me:Te-2*Ae-me,(je-we.rectBBox.width<0||je>Ce)&&(he=!0)}if(he){Oe++;const he=Te-we.rectBBox.width;Re=Le+we.rectBBox.height-.5*Ee+(he>0&&we.scaledS0>he?cathetus(we.scaledS0,he):we.scaledS0)}}return this.label._repositionLabels(he,ge,me,je,Re,Te,Le,be,ve,_e),2*Oe+ze}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(hn,pn),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Chart _updateProfile() abort: container is too little or has display:none")}LABEL(he){return function d3_label(){const ge=he;let be;label.setCssPrefix=function(he){return be=he,label};const ve=me.drag().on("start",(he=>{he.sourceEvent.stopPropagation()})).on("drag",(function(he,me){if(!ge.ui.dragging)return;ge.dragging||(ge.dragging=key(me));const be=ge.cached[key(me)];be.labelFixed=!0;const ve=ge.context.width,_e=ge.context.height;be.labelX_+=he.dx/ve,be.labelY_+=he.dy/_e;const xe=ge.xScale(be.labelX0)+be.labelX_*ve,we=ge.yScale(be.labelY0)+be.labelY_*_e,Me=ge.xScale(be.labelX0),Se=ge.yScale(be.labelY0),De=ge.entityLines.filter((he=>key(he)==key(me)));label._repositionLabels(me,null,this,xe,we,Me,Se,0,null,De)})).on("end",((he,me)=>{if(ge.dragging){const he=ge.cached[key(me)];ge.dragging=null,he.labelOffset[0]=he.labelX_,he.labelOffset[1]=he.labelY_,ge.ui.offset=Object.assign(ge.ui.offset,{[key(me)]:[he.labelX_,he.labelY_]})}}));function label(he,_e){return he.each((function(he){const ve=me.select(this);ve.append("rect").attr("class","vzb-label-glow").attr("filter","url(#vzb-glow-filter-".concat(ge.parent.id,")")),ve.append("rect").attr("class","vzb-label-fill vzb-tooltip-border");const xe=ve.append("text").attr("class",be+"-label-content stroke");if(ve.style("paint-order").length||(ve.insert("text",".".concat(be,"-label-content")).attr("class",be+"-label-content "+be+"-label-shadow vzb-noexport"),xe.classed("stroke",!1)),!_e){const me=ve.append("g").attr("class",be+"-label-x vzb-transparent");setIcon(me,Me),me.insert("circle","svg"),me.select("svg").attr("class",be+"-label-x-icon").attr("width","0px").attr("height","0px"),me.on("click",(me=>{me.defaultPrevented||(me.stopPropagation(),ge.MDL.highlighted.delete(he),ge.MDL.selected.delete(he))}))}})),_e||he.call(ve).on("mouseenter",(function(he,ve){isTouchDevice()||ge.dragging||(ge.MDL.highlighted.set(ve),ge.entityLabels.sort((he=>key(he)!=key(ve)?-1:1)),me.select(this).selectAll("."+be+"-label-x").classed("vzb-transparent",!1))})).on("mouseleave",(function(he,ve){isTouchDevice()||ge.dragging||(ge.MDL.highlighted.delete(ve),me.select(this).selectAll("."+be+"-label-x").classed("vzb-transparent",!0))})).on("click",(function(he,ve){if(!isTouchDevice())return;const _e=me.select(this).selectAll("."+be+"-label-x"),xe=_e.classed("vzb-transparent");xe&&(ge.entityLabels.sort((he=>key(he)!=key(ve)?-1:1)),ge.showCloseCross(null,!1)),_e.classed("vzb-transparent",!xe),ge.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&ge.MDL.frame.playing||(xe?ge.MDL.highlighted.set(ve):ge.MDL.highlighted.delete(ve))})),label}return label.line=function(he){he.append("line").attr("class",be+"-label-line")},label._repositionLabels=function _repositionLabels(he,be,ve,_e,xe,we,Me,Se,De,ze){const Oe=be||ge.cached[key(he)],Ce=me.select(ve),ke=!_e&&0!==_e||!xe&&0!==xe||!we&&0!==we||!Me&&0!==Me;if(Oe.brokenInputs||ke)return Oe.brokenInputs=ke,Ce.classed("vzb-invisible",ke),void ze.classed("vzb-invisible",ke);const Te=ge.context.width,Le=ge.context.height,Ae=Oe.rectBBox,Ee=Ae.height,je=Oe.rectOffsetX,Re=Oe.rectOffsetY;_e+Ae.x<=0?(_e=-Ae.x,Oe.labelX_=(_e-ge.xScale(Oe.labelX0))/Te):_e+je>Te&&(_e=Te-je,Oe.labelX_=(_e-ge.xScale(Oe.labelX0))/Te);xe+Ae.y<=0?(xe=-Ae.y,Oe.labelY_=(xe-ge.yScale(Oe.labelY0))/Le):xe+Re>Le&&(xe=Le-Re,Oe.labelY_=(xe-ge.yScale(Oe.labelY0))/Le);null==Se&&(Se=ge.context.duration);Oe._new&&(Se=0,delete Oe._new);Se?De&&!he.hidden?(Ce.classed("vzb-invisible",he.hidden),Ce.attr("transform","translate("+_e+","+xe+")").style("opacity",0).transition().duration(Se).ease(me.easeExp).style("opacity",1).on("interrupt",(()=>{Ce.style("opacity",1)})),ze.classed("vzb-invisible",he.hidden),ze.attr("transform","translate("+_e+","+xe+")").style("opacity",0).transition().duration(Se).ease(me.easeExp).style("opacity",1).on("interrupt",(()=>{ze.style("opacity",1)}))):De&&he.hidden?(Ce.style("opacity",1).transition().duration(Se).ease(me.easeExp).style("opacity",0).on("end",(()=>{Ce.style("opacity",1).classed("vzb-invisible",he.hidden)})),ze.style("opacity",1).transition().duration(Se).ease(me.easeExp).style("opacity",0).on("end",(()=>{ze.style("opacity",1).classed("vzb-invisible",he.hidden)}))):(Ce.transition().duration(Se).ease(me.easeLinear).attr("transform","translate("+_e+","+xe+")"),ze.transition().duration(Se).ease(me.easeLinear).attr("transform","translate("+_e+","+xe+")")):(Ce.interrupt().attr("transform","translate("+_e+","+xe+")").transition(),ze.interrupt().attr("transform","translate("+_e+","+xe+")").transition(),De&&Ce.classed("vzb-invisible",he.hidden),De&&ze.classed("vzb-invisible",he.hidden));const Fe=we-_e,Ie=Me-xe,Pe=Oe.textBBox;let Ne=.5*-Pe.width,Be=.2*-Ee;const qe=ge.root.ui.chart.labels,Ue=qe.removeLabelBox?Pe:Ae,He=ge.profileConstants.labelLeashCoeff||0,Ve=function circleRectIntersects(he,ge){const me=Math.abs(he.x-ge.x),be=Math.abs(he.y-ge.y),ve=.5*ge.width,_e=.5*ge.height;if(me>ve+he.r)return!1;if(be>_e+he.r)return!1;if(me<=ve)return!0;if(be<=_e)return!0;return Math.pow(me-ve,2)+Math.pow(be-_e,2)<=Math.pow(he.r,2)}({x:Fe,y:Ie,r:Oe.scaledS0},{x:Ne,y:Be,width:2*Ue.height*He+Ue.width,height:Ue.height*(2*He+1)});if(ze.select("line").classed("vzb-invisible",Ve),Ve)return;if(qe.removeLabelBox){const he=180*Math.atan2(Fe-Ne,Ie-Be)/Math.PI,ge=he>=0&&he<=180?.5*Ue.width:.5*-Ue.width,me=Math.abs(he)<=90?.55*Ue.height:.45*-Ue.height;Ne+=Math.abs(Fe-Ne)>.5*Pe.width?ge:0,Be+=Math.abs(Ie-Be)>.5*Pe.height?me:.05*Pe.height}const Ye=Math.abs(Fe)>Math.abs(Ie)?Math.abs(Fe):Math.abs(Ie);ze.select("line").style("stroke-dasharray","0 "+Oe.scaledS0+" "+2*~~Ye),Se?ze.selectAll("line").transition().duration(Se).ease(me.easeLinear).attr("x1",Fe).attr("y1",Ie).attr("x2",Ne).attr("y2",Be):ze.selectAll("line").interrupt().attr("x1",Fe).attr("y1",Ie).attr("x2",Ne).attr("y2",Be).transition()},label}()}}Labels.DEFAULT_UI={offset:()=>({}),enabled:!0,dragging:!0,removeLabelBox:!1};const gn=be.decorate(Labels,{MDL:be.computed});function firstLastOrMiddle(he,ge){return{first:0===he,last:he+1===ge}}class _Repeater extends Ve{get MDL(){return{repeat:this.model.encoding.repeat}}loading(){this.addReaction(this.addRemoveSubcomponents,{ignoreStatus:!0})}addRemoveSubcomponents(){const{repeatedComponentCssClass:he}=this.options,{rowcolumn:ge,ncolumns:be,nrows:ve}=this.MDL.repeat,_e=this.MDL.repeat;this.element.style("grid-template-rows","1fr ".repeat(ve)).style("grid-template-columns","1fr ".repeat(be));let xe=this.element.selectAll(".vzb-repeat-inner").data(ge,(he=>_e.getName(he)));xe.exit().each((he=>this.removeSubcomponent(he))).remove(),xe.enter().append("div").attr("class","vzb-repeat-inner").each((function(ge){me.select(this).append("div").datum(null).attr("class",(()=>"".concat(he," vzb-").concat(_e.getName(ge))))})).each(((he,ge)=>this.addSubcomponent(he,ge))).merge(xe).style("grid-row-start",((he,ge)=>_e.getRowIndex(ge)+1)).style("grid-column-start",((he,ge)=>_e.getColumnIndex(ge)+1)).each(((he,ge)=>{this.findChild({name:_e.getName(he)}).state.positionInRepeat=this.getPosition(ge)})),this.services.layout._resizeHandler()}getPosition(he){const ge=this.MDL.repeat,{ncolumns:me,nrows:be}=ge;return{row:firstLastOrMiddle(ge.getRowIndex(he),be),column:firstLastOrMiddle(ge.getColumnIndex(he),me)}}addSubcomponent(he,ge){const{repeatedComponent:me}=this.options,be=this.MDL.repeat.getName(he),ve=new me({id:this.id+"-"+ge,placeholder:".vzb-"+be,model:this.model,name:be,parent:this,root:this.root,state:{alias:he},services:this.services,options:this.options.repeatedComponentOptions,ui:this.ui,default_ui:this.DEFAULT_UI});this.children.push(ve)}removeSubcomponent(he){const ge=this.findChild({name:this.MDL.repeat.getName(he)});ge&&ge.deconstruct()}}_Repeater.DEFAULT_UI={};const mn=be.decorate(_Repeater,{MDL:be.computed}),bn={checkbox:null,setCheckboxFunc:null,submodel:null,submodelFunc:null,prefix:""};class SimpleCheckbox extends Ve{constructor(he){he.template='\n      <span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>    \n    ',super(he)}setup(he){this.DOM={check:this.element.select("input"),label:this.element.select("label")},this.options=deepExtend(deepExtend({},bn),he||{});const ge=this,be="-check-"+this.id;this.DOM.label.attr("for",be),this.DOM.check.attr("id",be).on("change",(function(){ge._setModel(me.select(this).property("checked"))}))}draw(){this.MDL={model:this._getModel()},this.localise=this.services.locale.auto(),this.addReaction(this._updateView)}_getModel(){const{submodel:he,submodelFunc:ge}=this.options;return he||ge?ge?ge():getProp(this,he.split(".")):this.model}_updateView(){const he=this.MDL.model,{checkbox:ge,prefix:me,labelText:be}=this.options,ve=he&&(he[ge]||!1===he[ge]);this.DOM.label.classed("vzb-hidden",!ve),ve&&(this.DOM.label.html(this.localise(be||"check/"+(me?me+"/":"")+ge)),this.DOM.check.property("checked",!!he[ge]))}_setModel(he){this.options.setCheckboxFunc?this.options.setCheckboxFunc(he):this.MDL.model[this.options.checkbox]=he}}
/*!
   * VIZABI MIN MAX INPUT FIELDS
   */class MinMaxInputs extends Ve{constructor(he){he.template='\n      <div class="vzb-mmi-holder">\n\n        <span class="vzb-mmi-zoomedmin-label"></span>\n        <input type="text" class="vzb-mmi-zoomedmin" name="min">\n        <span class="vzb-mmi-zoomedmax-label"></span>\n        <input type="text" class="vzb-mmi-zoomedmax" name="max">\n\n      </div>\n    ',super(he)}setup(){this.DOM={zoomed_labelMin:this.element.select(".vzb-mmi-zoomedmin-label"),zoomed_labelMax:this.element.select(".vzb-mmi-zoomedmax-label"),zoomed_fieldMin:this.element.select(".vzb-mmi-zoomedmin"),zoomed_fieldMax:this.element.select(".vzb-mmi-zoomedmax")},this.DOM.zoomed_fieldMin.on("change",this._setModel.bind(this)),this.DOM.zoomed_fieldMax.on("change",this._setModel.bind(this)),this.element.selectAll("input").on("keypress",(he=>{13==he.which&&document.activeElement.blur()}))}get MDL(){return{model:this._getModel()}}draw(){this.localise=this.services.locale.auto();const he=this;this.formatter=function(ge){return ge||0===ge?isDate(ge)?he.localise(ge):"time"===this.MDL.model.type?ge:me.format(".2r")(ge):ge},this.addReaction(this._updateView)}_updateView(){this.DOM.zoomed_labelMin.text(this.localise("hints/min")+":"),this.DOM.zoomed_labelMax.text(this.localise("hints/max")+":"),this.DOM.zoomed_fieldMin.property("value",this.formatter(this.MDL.model.zoomed[0])),this.DOM.zoomed_fieldMax.property("value",this.formatter(this.MDL.model.zoomed[1]))}_getModel(){if(this.state.submodel){const he=this.state.submodel.split(".");if("encoding"===he[0])return getProp(this.model.encoding[he[1]],he.slice(2))}return this.state.submodel||this.state.submodelFunc?this.state.submodelFunc?this.state.submodelFunc():getProp(this,this.state.submodel.split(".")):this.model}_setModel(){let he=[this.DOM.zoomed_fieldMin.property("value"),this.DOM.zoomed_fieldMax.property("value")].map((he=>he.replace("â","-")));"time"===!this.MDL.model.type&&(he=he.map((he=>parseFloat(he)))),he.some((he=>!he&&0!==he))?this._updateView():this.MDL.model.config.zoomed=he}}MinMaxInputs.DEFAULT_UI={};const vn=be.decorate(MinMaxInputs,{MDL:be.computed});function spacesAreEqual$3(he,ge){return he.concat().sort().join()===ge.concat().sort().join()}let yn=!0;class _SpaceConfig extends Ve{constructor(he){he.template='\n      <div class="vzb-spaceconfig-background"></div>\n      <div class="vzb-spaceconfig-box">\n        <div class="vzb-spaceconfig-title"></div>\n        <div class="vzb-spaceconfig-body vzb-dialog-scrollable">\n          <div class="vzb-spaceconfig-marker">\n            <label for="vzb-spaceconfig-select"></label>\n            <select id="vzb-spaceconfig-select"></select>\n          </div>\n          <div class="vzb-spaceconfig-encodings"></div>\n        </div>\n        <div class="vzb-spaceconfig-buttons">\n        <div class="vzb-spaceconfig-button-apply"></div>\n        <div class="vzb-spaceconfig-button-cancel"></div>\n        </div>\n      </div>\n    ',super(he)}setup(){this.DOM={background:this.element.select(".vzb-spaceconfig-background"),container:this.element.select(".vzb-spaceconfig-box"),close:this.element.select(".vzb-spaceconfig-close"),title:this.element.select(".vzb-spaceconfig-title"),body:this.element.select(".vzb-spaceconfig-body"),marker:this.element.select(".vzb-spaceconfig-marker"),encodings:this.element.select(".vzb-spaceconfig-encodings"),buttoncancel:this.element.select(".vzb-spaceconfig-button-cancel"),buttonapply:this.element.select(".vzb-spaceconfig-button-apply"),button:me.select(this.options.button)},this.element.classed("vzb-hidden",!0),this.setupDialog(),this.setupTiggerButton()}setupDialog(){this.DOM.background.on("click",(()=>{this.toggle(!0)})),this.DOM.container.append("div").html(Me).on("click",(()=>{this.toggle()})).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-spaceconfig-close")}setupTiggerButton(){if(!this.DOM.button.size())return warn("quit setupTiggerButton of SpaceConfig because no button provided");setIcon(this.DOM.button,Se).attr("title","Configure marker space").on("click",(()=>{this.toggle()}))}get MDL(){return{frame:this.model.encoding.frame}}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.updateUIstrings),this.addReaction(this.drawContent)}drawContent(){this.element.classed("vzb-hidden")||(this.addReaction(this.updateMarker),this.addReaction(this.updateEncodigns),this.addReaction(this.updateApplyCancelButtons))}updateUIstrings(){this.DOM.title.html(this.localise("Space config")),this.DOM.marker.select("label").text(this.localise("Marker space")),this.DOM.buttoncancel.text("Cancel"),this.DOM.buttonapply.text("Apply")}toggle(he){null==he&&(he=!yn),yn=he,this.element.classed("vzb-hidden",yn),this.root.children.forEach((he=>{he.element.classed("vzb-blur",he!=this&&!yn)})),this.drawContent()}_getDataModels(he){return Object.keys(he).map((he=>this.services.Vizabi.Vizabi.stores.dataSources.get(he)))}_getAvailability(){const he=[];return this._getDataModels(this.root.model.config.dataSources).forEach((ge=>{ge.availability.data.forEach((me=>{he.push({key:me.key,value:ge.getConcept(me.value),source:ge})}))})),he}_getSpaceAvailability(){const he=[];return this._getDataModels(this.root.model.config.dataSources).forEach((ge=>{ge.availability.keyLookup.forEach((ge=>{he.push(ge)}))})),he}_nestAvailabilityByConcepts(he){return he.reduce(((he,ge)=>{const me=ge.value,be=ge.key;return he.has(me)||he.set(me,{source:ge.source,spaces:new Set}),he.get(me).spaces.add(be),he}),new Map)}_conceptsCompatibleWithMarkerSpace(he,ge){const me=new Map,be=new Set(ge);for(const[ge,{source:ve,spaces:_e}]of he){const he=[..._e].filter((he=>{const ge=(me=be,he.filter((he=>me.has(he))));var me;return ge.length==be.size||ge.length==he.length}));he.length&&me.set(ge,{source:ve,spaces:he})}return me}_convertConceptMapToArray(he){return[...he].map((he=>{let[ge,{source:me,spaces:be}]=he;return{concept:ge,source:me,spaces:[...be]}}))}updateMarker(){const he=this,ge=this.MDL.frame.data.concept,be=function removeDulicates$1(he){const ge=[];return he.forEach((he=>{ge.some((ge=>spacesAreEqual$3(ge,he)))||ge.push(he)})),ge}(this._getSpaceAvailability().filter((he=>he.includes(ge)))),ve=this.DOM.marker.select("select"),_e=ve.selectAll("option").data(be,(he=>he.sort().join()));_e.exit().remove(),_e.enter().append("option").text((he=>he.join())).merge(_e).property("selected",(he=>spacesAreEqual$3(he,this.model.data.space))),ve.on("change",(function(){const ge=me.select(this.options[this.selectedIndex]).datum();he.proposedSpace=ge,he.updateEncodigns(),he.updateApplyCancelButtons()}))}getEncodings(){const he=this.model.encoding;return Object.keys(he).filter((he=>!(this.model.requiredEncodings&&!this.model.requiredEncodings.includes(he))||("color"==he||("label"==he||void 0))))}updateEncodigns(){const he=this,ge=this.model.encoding,be=this._nestAvailabilityByConcepts(this._getAvailability());this.concepts=this._convertConceptMapToArray(be),this.encNewConfig={},this.DOM.encodings.html("").selectAll("div").data(this.getEncodings(),(he=>he)).enter().append("div").each((function(ve){const _e=me.select(this),xe=ge[ve],we=he.getSpaceCompatibilityStatus(xe),Me=he.concepts.find((he=>he.concept.concept==xe.data.concept)),Se=xe.data.config.space,De=he.encNewConfig[ve]={};if(_e.append("div").attr("class","vzb-spaceconfig-enc-status").attr("title",we.status).text(he.statusIcons(we)),_e.append("div").attr("class","vzb-spaceconfig-enc-name").text(ve),"constant"==we.status)_e.append("div").attr("class","vzb-spaceconfig-enc-concept").text("constant: "+xe.data.constant);else if(_e.append("div").attr("class","vzb-spaceconfig-enc-concept").text(Me.concept.name),_e.append("div").attr("for","vzb-spaceconfig-enc-space-current").text("current space: "+xe.data.space.join()+(Se?" (set)":" (inherited)")),"alreadyInSpace"!=we.status&&"entityPropertyDataConfig"!=we.status||(_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("new space: will reset to marker space if set"),Se&&(De.space=null),xe.data.config.filter&&(De.filter={})),"matchingSpaceAvailable"==we.status&&(_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("new space: "+we.spaces[0].join()+(Se?" (set)":" (inherited)")),Se&&(De.space=null),xe.data.config.filter&&(De.filter={})),"subspaceAvailable"==we.status&&(_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("new space: "+we.spaces[0].join()+" (set)"),De.space=we.spaces[0],xe.data.config.filter&&(De.filter={})),"superspaceAvailable"==we.status&&(_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("new space: "+we.spaces[0].join()+" (set)"),_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("suggest constants for compliment dimensions!"),De.space=we.spaces[0],xe.data.config.filter&&(De.filter={})),"patialOverlap"==we.status||"noOverlap"==we.status){_e.append("div").attr("for","vzb-spaceconfig-enc-space-new").text("new space: not avaiable"),_e.append("label").attr("for","vzb-spaceconfig-enc-space-select").text("select concept:");const ge=he._conceptsCompatibleWithMarkerSpace(be,he.proposedSpace),ve=he._convertConceptMapToArray(ge);_e.append("select").attr("class","vzb-spaceconfig-enc-concept-new").attr("id","vzb-spaceconfig-enc-space-select").on("change",(function(){De.concept=me.select(this).property("value"),De.space=null,De.filter={}})).selectAll("option").data(ve).enter().append("option").attr("value",(he=>he.concept.concept)).text((he=>he.concept.name)).property("selectedIndex",-1)}}))}statusIcons(he){return{true:"â«",constant:"â³ï¸",alreadyInSpace:"â»ï¸",entityPropertyDataConfig:"ð·",matchingSpaceAvailable:"â¡ï¸",subspaceAvailable:"âï¸",superspaceAvailable:"âï¸",patialOverlap:"ð§",noOverlap:"ð§",false:"â"}[""+he.status]}getSpaceCompatibilityStatus(he){var ge;const me=null===(ge=this.concepts.find((ge=>ge.concept.concept==he.data.concept)))||void 0===ge?void 0:ge.spaces,be=this.proposedSpace;if(!be)return{status:!0,spaces:[]};if(he.data.isConstant)return{status:"constant"};if("entityPropertyDataConfig"==he.data.config.modelType)return{status:"entityPropertyDataConfig",spaces:[be]};if(spacesAreEqual$3(he.data.space,be))return{status:"alreadyInSpace",spaces:[be]};if(function getMatchingSpace$1(he,ge){return he.find((he=>spacesAreEqual$3(he,ge)))}(me,be))return{status:"matchingSpaceAvailable",spaces:[be]};const ve=function getSubspaces$1(he,ge){return he.filter((he=>he.every((he=>ge.includes(he))))).sort(((he,ge)=>ge.length-he.length))}(me,be);if(ve.length>0)return{status:"subspaceAvailable",spaces:ve};const _e=function getSuperspaces$1(he,ge){return he.filter((he=>ge.every((ge=>he.includes(ge))))).sort(((he,ge)=>he.length-ge.length))}(me,be);if(_e.length>0)return{status:"superspaceAvailable",spaces:_e};const xe=function getPartiallyOverlappingSpaces$1(he,ge){return he.filter((he=>ge.some((ge=>he.includes(ge))))).sort(((he,ge)=>he.length-ge.length))}(me,be);return xe.length>0?{status:"patialOverlap",spaces:[]}:0==xe.length?{status:"noOverlap",spaces:[]}:{status:!1,spaces:[]}}updateApplyCancelButtons(){const he=!this.proposedSpace||spacesAreEqual$3(this.proposedSpace,this.model.data.space);this.DOM.buttoncancel.classed("vzb-hidden",he).on("click",(()=>{this.cancelChanges()})),this.DOM.buttonapply.classed("vzb-hidden",he).on("click",(()=>{this.applyChanges()}))}cancelChanges(){this.proposedSpace=null,this.toggle()}applyChanges(){this.proposedSpace&&(be.runInAction((()=>{this.model.config.data.space=this.proposedSpace,Object.keys(this.encNewConfig).forEach((he=>{const ge=this.encNewConfig[he];ge.concept&&(this.model.encoding[he].config.data.concept=ge.concept),ge.space?this.model.encoding[he].config.data.space=ge.space:ge.hasOwnProperty("space")&&delete this.model.encoding[he].config.data.space,ge.filter?this.model.encoding[he].config.data.filter=ge.filter:ge.hasOwnProperty("filter")&&delete this.model.encoding[he].config.data.filter}))})),this.toggle())}}_SpaceConfig.DEFAULT_UI={};const _n=be.decorate(_SpaceConfig,{MDL:be.computed});class PlayButton extends Ve{constructor(he){he.template="<button class=\"vzb-ts-btn\">\n        <div class='vzb-loader'></div>\n      </button>",super(he)}setup(){this.buttonEl=this.element.select(".vzb-ts-btn").on("click",(()=>{this.model.encoding.frame.togglePlaying()}))}draw(){this.buttonEl.html(this.model.encoding.frame.playing?'<svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n  xmlns="http://www.w3.org/2000/svg">\n  <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n  </svg>':'<svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n  xmlns="http://www.w3.org/2000/svg">\n  <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n  </svg>')}loading(){this.buttonEl.html("<div class='vzb-loader'></div>")}}const xn={SMALL:{margin:{top:7,right:25,bottom:10,left:60},radius:8,label_spacing:5},MEDIUM:{margin:{top:0,right:25,bottom:10,left:55},radius:9,label_spacing:5},LARGE:{margin:{top:-5,right:25,bottom:10,left:80},radius:11,label_spacing:8}},wn={MEDIUM:{margin:{top:9,right:25,bottom:10,left:55}},LARGE:{margin:{top:-5,right:25,bottom:10,left:80}}},Mn="vzb-ts-dragging";class TimeSlider extends Ve{constructor(he){he.subcomponents=[{type:PlayButton,placeholder:".vzb-ts-btns"}],he.template='\n      <div class="vzb-ts-slider">\n        <svg class="vzb-ts-slider-svg">\n          <g>\n            <g class="vzb-ts-slider-axis"></g>\n            <g class="vzb-ts-slider-progress"></g>\n            <g class="vzb-ts-slider-select"></g>\n            <line class="vzb-ts-slider-forecastboundary"></line>\n            <circle class="vzb-ts-slider-handle"></circle>\n            <text class="vzb-ts-slider-value"></text>\n            <line class="vzb-ts-slider-slide"></line>\n          </g>\n        </svg>      \n      </div>\n      <div class="vzb-ts-btns"></div>\n    ',super(he)}setup(){this.DOM={slider_outer:this.element.select(".vzb-ts-slider-svg"),axis:this.element.select(".vzb-ts-slider-axis"),select:this.element.select(".vzb-ts-slider-select"),progressBar:this.element.select(".vzb-ts-slider-progress"),slide:this.element.select(".vzb-ts-slider-slide"),forecastBoundary:this.element.select(".vzb-ts-slider-forecastboundary"),handle:this.element.select(".vzb-ts-slider-handle"),valueText:this.element.select(".vzb-ts-slider-value")},this.DOM.slider=this.DOM.slider_outer.select("g"),this.xAxis=axisSmart$1("bottom"),this.sliderWidth=0,this.sliderHeight=0;const{valueText:he,slider:ge,slide:be,slider_outer:ve}=this.DOM;he.classed("stroke",!0),ge.style("paint-order").length||(ge.insert("text",".vzb-ts-slider-value").attr("class","vzb-ts-slider-value stroke"),he.classed("stroke",!1)),this.DOM.valueText=this.element.selectAll(".vzb-ts-slider-value").attr("text-anchor","middle").attr("dy","-0.7em"),be.call(me.drag().on("start drag",(he=>this._brushed(he))).on("end",(he=>this._brushedEnd(he)))),ve.on("mousewheel",(he=>{if(this.ui.dragging)return he.stopPropagation(),he.preventDefault(),he.returnValue=!1,!1})),this.DOM.forecastBoundary.on("click",(()=>{this.MDL.frame.setValueAndStop(this.root.ui.chart.endBeforeForecast)}))}get MDL(){return{frame:this.model.encoding.frame}}draw(){this.localise=this.services.locale.auto({interval:this.MDL.frame.interval}),this.element.classed("vzb-ts-loading",!1),this._updateLayoutProfile()||(this.addReaction(this._configEndBeforeForecast),this.addReaction(this._adjustFrameScaleDomainConfig),this.addReaction(this.updateSize,{throttle_ms:100}),this.addReaction(this._redrawForecast),this.addReaction(this._optionClasses),this.addReaction(this._processForecast),this.addReaction(this._setHandle))}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(xn,wn),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return warn("Timeslider _updateProfile() abort: container is too little or has display:none")}get xScale(){return this.MDL.frame.scale.d3Scale}_configEndBeforeForecast(){const he=this.MDL.frame,{offset:ge,floor:me}=this.services.Vizabi.Vizabi.utils.interval(he.interval);if(!this.root.ui.chart.endBeforeForecast){const be=me(ge(new Date,-1));this.root.ui.chart.endBeforeForecast=he.formatValue(be)}this.firstForecastFrame=ge(he.parseValue(this.root.ui.chart.endBeforeForecast),1)}_adjustFrameScaleDomainConfig(){const he=this.MDL.frame;if(this.root.ui.chart.showForecast)delete he.scale.config.domain;else{const ge=he.parseValue(this.root.ui.chart.endBeforeForecast);ge&&he.data.domain[1]>ge?he.scale.config.domain=[he.data.domain[0],ge].map((ge=>he.formatValue(ge))):delete he.scale.config.domain}}_processForecast(){const he=this.MDL.frame,ge=he.parseValue(this.root.ui.chart.endBeforeForecast),me=this.root.ui.chart.pauseBeforeForecast,be=this.services.Vizabi.Vizabi.utils.equals;he.playing&&me&&be(he.value,this.firstForecastFrame)&&this.allowForecastPause&&he.setValueAndStop(ge),this.allowForecastPause=he.playing&&be(he.value,ge)}_redrawForecast(){this.services.layout.size;const he=this.MDL.frame.parseValue(this.root.ui.chart.endBeforeForecast),ge=this.root.ui.chart.showForecast&&this.MDL.frame.scale.domain[1]>he;if(this.DOM.forecastBoundary.classed("vzb-hidden",!ge),ge){const ge=this.profileConstants.radius;this.DOM.forecastBoundary.attr("transform","translate(0,"+this.height/2+")").attr("x1",this.xScale(he)-ge/2).attr("x2",this.xScale(he)+ge/2).attr("y1",ge).attr("y2",ge)}}updateSize(){this.services.layout.size;const{margin:he,radius:ge,label_spacing:me}=this.profileConstants,{slider:be,slide:ve,axis:_e,handle:xe,select:we,progressBar:Me}=this.DOM,Se=this.services.layout.hGrid.length?this.width-this.services.layout.hGrid[0]:he.right;this.sliderWidth=this.width-he.left-Se,this.sliderHeight=this.height-he.bottom-he.top,be.attr("transform","translate("+he.left+","+he.top+")"),this.MDL.frame.scale.config.range=[0,this.sliderWidth],ve.attr("transform","translate(0,"+this.sliderHeight/2+")").attr("x1",this.xScale.range()[0]).attr("x2",this.xScale.range()[1]).style("stroke-width",2*ge+"px"),this.xAxis.scale(this.xScale).tickSizeInner(0).tickSizeOuter(0).tickPadding(me).tickSizeMinor(0,0),_e.attr("transform","translate(0,"+this.sliderHeight/2+")").call(this.xAxis),we.attr("transform","translate(0,"+this.sliderHeight/2+")"),Me.attr("transform","translate(0,"+this.sliderHeight/2+")"),xe.attr("transform","translate(0,"+this.sliderHeight/2+")").attr("r",ge)}_getValueWidth(){return this.valueText.node().getBoundingClientRect().width}_brushed(he){const{frame:ge}=this.MDL,{handle:me,valueText:be}=this.DOM;let ve;if(ge.playing&&ge.stopPlaying(),this.ui.dragging=!0,this.element.classed(Mn,this.ui.dragging),he.sourceEvent){he.sourceEvent.preventDefault();let _e=he.x;const xe=this.sliderWidth,we=ge.parseValue(this.root.ui.chart.endBeforeForecast),Me=this.root.ui.chart.showForecast&&ge.data.domain.at(-1)>we,Se=this.xScale(we),De=.5*me.attr("r");_e>xe?_e=xe:_e<0?_e=0:Math.abs(_e-Se)<De&&he.sourceEvent.shiftKey&&Me&&(_e=Se),ve=this.xScale.invert(_e),me.attr("cx",_e),be.attr("transform","translate("+_e+","+this.sliderHeight/2+")"),be.text(this.localise(ve))}ve-this.MDL.frame.value!=0&&this._setTime(ve)}_brushedEnd(){this.MDL.frame.snap(),this.ui.dragging=!1,this.element.classed(Mn,this.ui.dragging)}_setHandle(){this.services.layout.size,this.services.layout.hGrid;const{value:he,speed:ge,playing:be}=this.MDL.frame;if(this.ui.dragging||this._isDomainNotVeryGood())return;const{handle:ve,valueText:_e}=this.DOM,xe=this.xScale(he),we=ge;be?(ve.transition().duration(we).ease(me.easeLinear).attr("cx",xe),_e.transition("text").delay(we).text(this.localise(he)),_e.transition().duration(we).ease(me.easeLinear).attr("transform","translate("+xe+","+this.sliderHeight/2+")")):(ve.interrupt().attr("cx",xe),_e.interrupt().interrupt("text").transition("text"),_e.attr("transform","translate("+xe+","+this.sliderHeight/2+")").text(this.localise(he)))}_setTime(he){var ge=new Date;null!=this._updTime&&ge-this._updTime<50||(this._updTime=ge,this.MDL.frame.setValue(he))}_optionClasses(){const{frame:he}=this.MDL,ge=this.ui.show_ticks,me=this.ui.show_value,be=this.ui.show_value_when_drag_play,ve=this.ui.axis_aligned,_e=this.ui.show_button&&he.playable;this.xAxis.labelerOptions({scaleType:"time",removeAllLabels:!ge,limitMaxTickNumber:3,showOuter:!1,toolMargin:{left:10,right:10,top:0,bottom:30},fitIntoScale:"optimistic"}),this.DOM.axis.call(this.xAxis),this.element.classed("vzb-ts-disabled",this._isDomainNotVeryGood()),this.element.classed("vzb-ts-hide-play-button",!_e),this.element.classed("vzb-playing",he.playing),this.element.classed("vzb-ts-show-value",me),this.element.classed("vzb-ts-show-value-when-drag-play",be),this.element.classed("vzb-ts-axis-aligned",ve)}_isDomainNotVeryGood(){const he=this.xScale.domain();return!he||2!==he.length||(he[1]-he[0]<=0||!!he.some((he=>null==he||isNaN(he))))}}TimeSlider.DEFAULT_UI={show_ticks:!1,show_value:!1,show_value_when_drag_play:!0,axis_aligned:!1,show_button:!0,dragging:!1};const Sn=be.decorate(TimeSlider,{xScale:be.computed,MDL:be.computed}),Dn="vzb-treemenu-wrap",zn="vzb-treemenu-wrap-header",On="vzb-treemenu-wrap-outer",Cn="vzb-treemenu-background",kn="vzb-treemenu-close",Tn="vzb-treemenu-search",Ln="vzb-treemenu-list",An="vzb-treemenu-list-outer",En="vzb-treemenu-list-item",jn="vzb-treemenu-list-item-leaf",Rn="vzb-treemenu-leaf",Fn="vzb-treemenu-leaf-content",In="vzb-treemenu-leaf-content-item",Pn="vzb-treemenu-leaf-content-item-title",Nn="vzb-treemenu-leaf-content-item-datasources",Bn="vzb-treemenu-leaf-content-item-space",qn="vzb-treemenu-leaf-content-item-descr",Un="vzb-treemenu-leaf-content-item-helptranslate",Hn="vzb-treemenu-list-item-children",Vn="vzb-treemenu-list-item-label",Yn="vzb-treemenu-list-top",Wn="vzb-treemenu-search-wrap",Gn="vzb-treemenu-list-item-special",$n="vzb-hidden",Xn="vzb-treemenu-title",Kn="vzb-treemenu-scaletypes",Zn="vzb-treemenu-scaletypes-disabled",Jn="vzb-treemenu-scaletypes-active",Qn="vzb-align-y-top",ti="vzb-align-y-bottom",ei="vzb-align-x-left",ni="vzb-align-x-right",ii="vzb-align-x-center",si="vzb-treemenu-horizontal",oi="vzb-treemenu-vertical",ri="vzb-treemenu-abs-pos-vert",ai="vzb-treemenu-abs-pos-horiz",li="vzb-treemenu-open-left-side",ci="notransition",di={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:1,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1};function spacesAreEqual$2(he,ge){return he.concat().sort().join()===ge.concat().sort().join()}class DeepLeaf{constructor(he,ge){this.context=he,this.view=ge,this.spaceChanged=!1,this.encoding=this.context._targetModel,this.datum=ge.datum(),this.buildLeaf()}_getDatumForDS(){return this.datum.byDataSources.find((he=>he.dataSource==this.encoding.data.source))||this.datum.byDataSources[0]}_isSelectedConcept(){return this.datum.id==this.encoding.data.concept}buildLeaf(){this.view.selectAll("div").remove();const he=this.view.append("div").attr("class","".concat(Rn," ").concat(Fn," vzb-dialog-scrollable")).style("width",this.width+"px");this.DOM={title:he.append("div").attr("class","".concat(In," ").concat(Pn)),datasourceContainer:he.append("div").attr("class","".concat(In," ").concat(Nn)).on("click",(he=>he.stopPropagation())),spaceContainer:he.append("div").classed(In+" "+Bn,!0).on("click",(he=>he.stopPropagation())),descr:he.append("div").attr("class","".concat(In," ").concat(qn)),helptranslate:he.append("div").attr("class","".concat(In," ").concat(Un))},this.updateNameSection(),this.updateDatasoutceSection(),this.updateSpaceSection(),this.updateDescrSection()}updateNameSection(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();this.DOM.title.text(replaceNumberSpacesToNonBreak(he.name)||"")}updateDescrSection(){var he,ge;let me=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();this.DOM.descr.text(replaceNumberSpacesToNonBreak(me.description||this.context.localise("hints/nodescr"))),this.DOM.helptranslate.classed("vzb-invisible",!(null!==(he=me.dataSource)&&void 0!==he&&he.translateContributionLink)).html('<a href="'.concat(null===(ge=me.dataSource)||void 0===ge?void 0:ge.translateContributionLink,'" target="_blank">').concat(this.context.localise("dialogs/helptranslate"),"</a>"))}updateDatasoutceSection(){const he=this;if("_default"==this.datum.id)return;const getDSColorLight=he=>this.context.dsColorScaleLight(he.dataSource.id),getDSColorDark=he=>this.context.dsColorScaleDark(he.dataSource.id),paintBackground=he=>he.dataSource==this.encoding.data.source&&this._isSelectedConcept()&&multipleDataSourcesAvailable,multipleDataSourcesAvailable=()=>this.datum.byDataSources>1;this.context.ui.showDataSources&&(this.DOM.datasourceContainer.selectAll("span").data(this.datum.byDataSources,(he=>he)).enter().append("span").text((he=>he.dataSource.id)).on("mouseenter",(function(ge,be){me.select(this).style("background-color",getDSColorLight(be)),he.updateNameSection(be),he.updateDescrSection(be)})).on("mouseout",(function(ge,be){me.select(this).style("background-color",paintBackground(be)?getDSColorLight(be):null),he.updateNameSection(),he.updateDescrSection()})).on("click",(function(ge,me){he.DOM.spaceContainer.select("select").node()&&he.resetPickers(),he.setDatasource(me)})),this.DOM.datasourceContainer.selectAll("span").style("pointer-events",this._isSelectedConcept()?null:"none").style("border-color",getDSColorDark).style("background-color",(he=>paintBackground(he)?getDSColorLight(he):null)))}updateSpaceSection(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();const ge=this;if("_default"==this.datum.id)return;const me=this.encoding.data.space,be=this.encoding.marker.data.space;if(this._isSelectedConcept()&&(he.spaces.length>1||!spacesAreEqual$2(he.spaces[0],be)&&!(he.spaces[0].length<be.length))){const be=this.DOM.spaceContainer.append("select").attr("name","vzb-select-treemenu-leaf-space").attr("id","vzb-select-treemenu-leaf-space").on("change",(function(){ge.spaceChanged=!0,ge.updateComplimentSetters()}));be.selectAll("option").data(he.spaces).enter().append("option").attr("value",(he=>he.join())).text((he=>"by "+getSpaceName(this.encoding,he))),be.property("value",me.join()),this.DOM.spaceContainer.append("div").attr("class","vzb-treemenu-leaf-space-compliment"),this.DOM.spaceContainer.append("div").attr("class","vzb-hidden vzb-treemenu-leaf-space-reset").text("Reset").on("click",(()=>{this.resetPickers(),this.setModel()})),this.DOM.spaceContainer.append("div").attr("class","vzb-hidden vzb-treemenu-leaf-space-apply").text("Apply").on("click",(()=>{this.setModel()})),this.updateComplimentSetters()}}updateComplimentSetters(){const he=this,ge=this.context._targetModel,be=this.context.services.Vizabi.Vizabi.utils.relativeComplement(ge.marker.data.space,this._getSelectedSpace());requestEntityNames(ge.data.source,be).then((be=>{let ve=this.DOM.spaceContainer.select("div.vzb-treemenu-leaf-space-compliment").selectAll("div.vzb-treemenu-leaf-space-compliment-setter").data(be,(he=>he.dim));ve.exit().remove(),ve=ve.enter().append("div").attr("class","vzb-treemenu-leaf-space-compliment-setter").each((function(be){const ve=me.select(this);ve.append("label").attr("for",be.dim+"_extraDim").text(getSpaceName(ge,be.dim)+":");const _e=ve.append("select").attr("id",be.dim+"_extraDim").on("change",(()=>{he.spaceChanged=!0,he.updateResetApplyButtons()}));_e.selectAll("option").data(be.data.raw).enter().append("option").attr("value",(he=>he[be.dim])).text((he=>he.name)),_e.property("selectedIndex",-1)})).merge(ve),ve.each((function(he){var be,ve;const _e=me.select(this).select("select"),xe=null===(be=ge.data.filter)||void 0===be||null===(ve=be.dimensions[he.dim])||void 0===ve?void 0:ve[he.dim];xe?_e.property("value",xe):_e.property("selectedIndex",-1)})),this.updateResetApplyButtons()}))}_getSelectedSpace(){const he=this.view.select("div."+Bn).select("select").node();return me.select(he.options[he.selectedIndex]).datum()}_getSelectedFilter(){const he={};let ge=!1;return this.view.select("div."+Bn).select("div.vzb-treemenu-leaf-space-compliment").selectAll("select").each((function(me){he[me.dim]={},he[me.dim][me.dim]=this.value,-1==this.selectedIndex&&(ge=!0)})),ge?null:he}updateResetApplyButtons(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();const ge=this.context.targetModel().data.space,me=this.context.getNearestSpaceToMarkerSpace(he.spaces),be=this._getSelectedSpace(),ve=this._getSelectedFilter(),_e=this.view.select("div."+Bn);_e.select(".vzb-treemenu-leaf-space-reset").classed("vzb-hidden",spacesAreEqual$2(ge,me)),_e.select(".vzb-treemenu-leaf-space-apply").classed("vzb-hidden",!this.spaceChanged).classed("vzb-disabled",!ve&&!spacesAreEqual$2(ge,be))}resetPickers(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();const ge=this.context.getNearestSpaceToMarkerSpace(he.spaces);this.view.select("div."+Bn).select("select").property("value",ge.join()),this.updateComplimentSetters()}setDatasource(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getDatumForDS();const ge=this.context._targetModel;be.runInAction((()=>{ge.data.config.source=he.dataSource.id}))}setModel(){const he=this.context._targetModel,ge=this._getSelectedSpace(),me=this._getSelectedFilter()||{};be.runInAction((()=>{he.data.config.space=ge,he.data.filter.config.dimensions=me}))}}class Menu{constructor(he,ge,be,ve){const _e=this;let xe;return this.context=he,this.parent=ge,this.OPTIONS=ve,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this.OPTIONS.createSubmenu(be,be.datum(),null===ge),this.entity=null===ge?be.selectAll("."+Yn):be.select("."+An),this._setDirectionClass(),this.menuItems=[],this.entity.empty()||(this.entity.each((function(){xe=me.selectAll(this.childNodes).filter((function(){return me.select(this).classed(Ln)}))})),xe.empty()&&(xe=this.entity),this.entity.selectAll("."+En).filter((function(){return this.parentNode==xe.node()})).each((function(){_e.addSubmenu(me.select(this))})),!this.menuItems.length&&this.isActive()&&(this.deepleaf=new DeepLeaf(this.context,this.entity)),this.setWidth(this.OPTIONS.COL_WIDTH,!1,!0)),this}setWidth(he,ge,me){if(this.width!=he&&this.entity.node()){if(this.width=he,(this.entity.classed(Yn)||this.entity.classed("active"))&&1==this.direction&&(me?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(Yn)&&this.entity.selectAll("."+Rn).style("width",this.width-1+"px"),ge)for(let he=0;he<this.menuItems.length;he++)this.menuItems[he].setWidth(this.width,ge,me);return this}}setDirection(he,ge){if(this.direction=he,this.entity.style("width","").style("height",""),ge)for(let he=0;he<this.menuItems.length;he++)this.menuItems[he].setDirection(this.direction,ge);return this._setDirectionClass(),this}_setDirectionClass(){1==this.direction?(this.entity.classed(oi,!1),this.entity.classed(si,!0)):(this.entity.classed(si,!1),this.entity.classed(oi,!0))}addSubmenu(he){this.menuItems.push(new MenuItem(this.context,this,he,this.OPTIONS))}open(){const he=this;return this.isActive()||(he.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors((()=>{1==he.direction?(this.menuItems.length||(he.deepleaf=new DeepLeaf(he.context,this.entity)),he._openHorizontal(),he.calculateMissingWidth(0)):he._openVertical()})),he.parent.parentMenu.openSubmenuNow=!1),this}calculateMissingWidth(he,ge){const me=this;this.entity.classed(Yn)?he>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof ge&&ge(he-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(he+this.width,(he=>{he>0?me.reduceWidth(he,(he=>{"function"==typeof ge&&ge(he)})):"function"==typeof ge&&ge(he)}))}restoreWidth(he,ge,me){const be=this;if(ge)this.parent.parentMenu.restoreWidth(he,!1,me);else if(he<=0)"function"==typeof me&&me();else if(this.entity.classed(Yn))"function"==typeof me&&me();else{const ge=this.entity.node().offsetWidth,ve=Math.min(he,be.width);if(ge<ve){const _e=ge/ve*250;this.entity.transition().delay(0).duration(_e).style("width",ve+"px").on("end",(()=>{})),be.parent.parentMenu.restoreWidth(he-ve,!1,me)}else this.parent.parentMenu.restoreWidth(he,!1,me)}}reduceWidth(he,ge){const me=this,be=this.entity.node().offsetWidth;if(be<=this.OPTIONS.MIN_COL_WIDTH)ge(he-me.width+be);else{const be=Math.max(this.OPTIONS.MIN_COL_WIDTH,me.width-he),ve=250/(me.width/be);this.entity.transition().delay(0).duration(ve).style("width",be+"px").on("end",(()=>{ge(he-me.width+be)}))}}_openHorizontal(){const he=this;he.entity.classed("active",!0).transition().delay(0).duration(250).style("width",he.width+"px").on("end",(()=>{he.marqueeToggle(!0)}))}_openVertical(){const he=this;he.entity.style("height","0px"),he.entity.transition().delay(0).duration(250).style("height",36*he.menuItems.length+"px").on("end",(()=>{he.entity.style("height","auto"),he.marqueeToggle(!0),he.scrollToFitView()})),he.entity.classed("active",!0)}closeAllChildren(he){let ge=0;for(let me=0;me<this.menuItems.length;me++)this.menuItems[me].isActive()&&(++ge,this.menuItems[me].submenu.close((()=>{0==--ge&&"function"==typeof he&&he()})));0==ge&&"function"==typeof he&&he()}closeNeighbors(he){this.parent?this.parent.closeNeighbors(he):he()}close(he){const ge=this;this.closeAllChildren((()=>{1==ge.direction?(ge.deepleaf=null,ge._closeHorizontal(he)):ge._closeVertical(he)}))}_closeHorizontal(he){const ge=this,me=ge.parent.parentMenu.openSubmenuNow;ge.entity.transition().delay(0).duration(20).style("width","0px").on("end",(()=>{ge.marqueeToggle(!1),ge.entity.classed("active",!1),me?"function"==typeof he&&he():ge.restoreWidth(ge.OPTIONS.MAX_MENU_WIDTH,!0,(()=>{"function"==typeof he&&he()}))}))}_closeVertical(he){const ge=this;ge.entity.transition().delay(0).duration(100).style("height","0px").on("end",(()=>{ge.marqueeToggle(!1),ge.entity.classed("active",!1),"function"==typeof he&&he()}))}isActive(){return this.entity.classed("active")}hasActiveParentNeighbour(){return this.menuItems.filter((he=>he.isActive())).some((he=>!!me.select(he.entity).node().classed(Hn)))}marqueeToggle(he){for(let ge=0;ge<this.menuItems.length;ge++)this.menuItems[ge].marqueeToggle(he)}marqueeToggleAll(he){for(let ge=0;ge<this.menuItems.length;ge++)this.menuItems[ge].marqueeToggleAll(he)}findItemById(he){for(let ge=0;ge<this.menuItems.length;ge++){if(this.menuItems[ge].entity.datum().id==he)return this.menuItems[ge];if(this.menuItems[ge].submenu){const me=this.menuItems[ge].submenu.findItemById(he);if(me)return me}}return null}getTopMenu(){return this.parent?this.parent.parentMenu.getTopMenu():this}scrollToFitView(){const he=this.getTopMenu().entity.node().parentNode,ge=this.entity.node().parentNode,be=he.getBoundingClientRect(),ve=ge.getBoundingClientRect(),_e=ve.top-be.top;if(_e+ve.height>be.height){const ge=ve.height>be.height?be.height-10:ve.height+10,xe=he.scrollTop+ge-be.height+_e,scrollTopTween=function(ge){return function(){const be=me.interpolateNumber(this.scrollTop,ge);return function(ge){he.scrollTop=be(ge)}}};me.select(he).transition().duration(100).tween("scrolltoptween",scrollTopTween(xe))}}}class MenuItem{constructor(he,ge,be,ve){const _e=this;return this.context=he,this.parentMenu=ge,this.entity=be,this.entity.select("."+Vn).call((he=>{isTouchDevice()?he.onTap((he=>{if(he.stopPropagation(),2==_e.parentMenu.direction){if(!_e.entity.select("."+Vn).attr("children"))return}_e.submenu||(_e.submenu=new Menu(_e.context,_e,_e.entity,ve)),_e.toggleSubmenu()})):he.on("mouseenter",(function(){1!=_e.parentMenu.direction||me.select(this).attr("children")?_e.parentMenu.hasActiveParentNeighbour()||_e.closeNeighbors():(_e.submenu||(_e.submenu=new Menu(_e.context,_e,_e.entity,ve)),_e.openSubmenu()),_e.marqueeToggle(!0)})).on("click.item",(function(he){if(he.stopPropagation(),_e.submenu||(_e.submenu=new Menu(_e.context,_e,_e.entity,ve)),1==_e.parentMenu.direction)_e.openSubmenu();else{if(!me.select(this).attr("children"))return;_e.toggleSubmenu()}})),ve.selectedPath[0]===he.datum().id&&(ve.selectedPath.shift(),_e.submenu=new Menu(_e.context,_e,_e.entity,ve))})),this}setWidth(he,ge,me){return this.submenu&&ge&&this.submenu.setWidth(he,ge,me),this}setDirection(he,ge){return this.submenu&&ge&&this.submenu.setDirection(he,ge),this}toggleSubmenu(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())}openSubmenu(){this.submenu?this.submenu.open():this.closeNeighbors()}closeNeighbors(he){this.parentMenu.closeAllChildren(he)}isActive(){return this.submenu&&this.submenu.isActive()}marqueeToggleAll(he){this.entity.selectAll("."+Vn).each((function(){const ge=me.select(this).select("span"),be=me.select(this.parentNode);if(be.classed("marquee",!1),ge.style("width",""),he&&ge.node().scrollWidth>ge.node().offsetWidth){ge.attr("data-content",ge.text());const he=30+ge.node().scrollWidth;ge.style("width",he+"px"),be.classed("marquee",!0)}}))}marqueeToggle(he){const ge=this.entity.select("."+Vn).select("span");if(this.entity.classed("marquee",!1),ge.style("width",""),he&&ge.node().scrollWidth>ge.node().offsetWidth){ge.attr("data-content",ge.text());const he=30+ge.node().scrollWidth;ge.style("width",he+"px"),this.entity.classed("marquee",!0)}}}const hi={SMALL:{col_width:200},MEDIUM:{col_width:200},LARGE:{col_width:200}},pi={MEDIUM:{col_width:200},LARGE:{col_width:200}};function getTagNameForDs(he){return"dataset "+he.id}function getItemName(he){return"indicator"==he.type?he.byDataSources.map((he=>he.name_catalog)).concat(he.byDataSources.map((he=>he.name))).concat(he.id).filter((he=>he))[0]:he.name_catalog||he.name||he.id}function spacesAreEqual$1(he,ge){return he.concat().sort().join()===ge.concat().sort().join()}
/*!
   * VIZABI TREEMENU
   * Treemenu component
   */const fi={triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]};const gi=be.decorate(class SteppedSlider extends Ve{constructor(he){he.template='\n      <div class="vzb-stepped-slider">\n        <svg>\n          <g class="vzb-stepped-slider-triangle"></g>\n          <g class="vzb-stepped-slider-axis"></g>\n        </svg>\n      </div>',super(he)}setup(){this.config=deepExtend(deepExtend({},fi),this.config),this.config.height-=this.config.triangleHeight/2;const{domain:he,range:ge,height:be}=this.config;this.DOM={svg:this.element.select("svg"),slide:this.element.select(".vzb-stepped-slider-triangle")},this.axisScale=me.scaleLog().domain(me.extent(he)).range([be,0]),this.delayScale=me.scaleLinear().domain(he).range(ge),this.initTriangle(),this.initAxis()}draw(){this.addReaction(this.redraw)}get MDL(){return{frame:this.model.encoding.frame}}initAxis(){const{lineWidth:he,triangleWidth:ge,triangleHeight:be,height:ve}=this.config,_e=me.axisLeft().scale(this.axisScale).tickFormat((()=>"")).tickSizeInner(he).tickSizeOuter(0),xe=ge+he/2,we=be/2;this.DOM.svg.on("mousedown",(he=>{const ge=Math.max(0,Math.min(he.offsetY-we,ve));this.setDelay(Math.round(this.delayScale(this.axisScale.invert(ge))),!0,!0)})).select(".vzb-stepped-slider-axis").attr("transform","translate(".concat(xe,", ").concat(we,")")).call(_e),this.drag=me.drag().on("drag",(he=>{const{translateY:ge}=transform(this.DOM.slide.node()),me=Math.max(0,Math.min(he.dy+ge,ve));this.setDelay(Math.round(this.delayScale(this.axisScale.invert(me))),!0)})).on("end",(()=>{this.setDelay(this.MDL.frame.speed)})),this.DOM.svg.call(this.drag)}initTriangle(){this.DOM.slide.append("g").append("path").attr("d",this.getTrianglePath())}getTrianglePath(){const{triangleHeight:he,triangleWidth:ge}=this.config;return"M ".concat(ge,",").concat(he/2," 0,").concat(he," 0,0 z")}redraw(){const he=this.axisScale(this.delayScale.invert(this.MDL.frame.speed));this.DOM.slide.attr("transform","translate(0, ".concat(he,")"))}setDelay(he){this.MDL.frame.setSpeed(he)}},{MDL:be.computed}),mi={SMALL:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,closeCrossSize:19.2,labelLeashCoeff:.4},MEDIUM:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,closeCrossSize:24,labelLeashCoeff:.3},LARGE:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,closeCrossSize:26.4,labelLeashCoeff:.2}},bi={MEDIUM:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,closeCrossSize:31.2,labelLeashCoeff:.3},LARGE:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,closeCrossSize:38.4,labelLeashCoeff:.2}},vi={SUPPRESS_HIGHLIGHT_DURING_PLAY:!0};class LabelSizeHelper extends Ve{setup(he){this.context=this.parent,this.labelSizeTextScale=null,this.options=extend({},vi),he&&this.setOptions(he)}setOptions(he){extend(this.options,he)}get MDL(){return{size_label:this.model.encoding.size_label}}draw(){this.addReaction(this._updateLayoutProfile),this.addReaction(this.updateSizeTextScale),this.addReaction(this.updateLabelSizeLimits)}updateLabelSizeLimits(){if(!this.MDL.size_label)return;this.services.layout.size;const he=this.MDL.size_label.scale.extent||[0,1],ge=this.profileConstants.minLabelTextSize,me=this.profileConstants.maxLabelTextSize-ge;this.minLabelTextSize=Math.max(ge+me*he[0],ge),this.maxLabelTextSize=Math.max(ge+me*he[1],ge),this.MDL.size_label.data.isConstant&&(null===he[1]?this.minLabelTextSize=this.maxLabelTextSize=this.profileConstants.defaultLabelTextSize:this.minLabelTextSize=this.maxLabelTextSize),this.labelSizeTextScale.range([this.minLabelTextSize,this.maxLabelTextSize])}updateSizeTextScale(){this.MDL.size_label&&(this.labelSizeTextScale=this.MDL.size_label.scale.d3Scale)}_updateLayoutProfile(){this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(mi,bi)}get closeCrossHeight(){return this.services.layout.size,this.profileConstants.closeCrossSize}get defaultFontSize(){return this.services.layout.size,this.profileConstants.defaultLabelTextSize}getFontSize(he){if(this.labelSizeTextScale&&(he||0==he)){const ge=this.labelSizeTextScale.range();return ge[0]+Math.sqrt((this.labelSizeTextScale(he)-ge[0])*(ge[1]-ge[0]))}return this.defaultFontSize}}LabelSizeHelper.DEFAULT_UI={offset:()=>({}),enabled:!0,dragging:!0,removeLabelBox:!1};const yi=be.decorate(LabelSizeHelper,{MDL:be.computed,defaultFontSize:be.computed,closeCrossHeight:be.computed}),_i="vzb-active";
/*!
   * VIZABI ZOOMBUTTONLIST
   * Reusable zoombuttonlist component
   */class ZoomButtonList extends Ve{constructor(he){super(he)}setup(){this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"root.ui.chart.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"root.ui.chart.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"root.ui.chart.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hand:{title:"buttons/cursorhand",icon:"cursorHand",func:this.toggleCursorMode.bind(this),required:!0,hide:"root.ui.chart.panWithArrow",statebind:"root.ui.chart.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}}}draw(){this.localise=this.services.locale.auto(),Object.keys(this._available_buttons).forEach((he=>{const ge=this._available_buttons[he];ge&&ge.statebind&&this.addReaction((()=>{ge.statebindfunc(he,getProp(this,ge.statebind.split(".")))}))})),this._addButtons(Object.keys(this._available_buttons),[]),this.addReaction(this.updateHiding)}updateHiding(){this.element.selectAll("button").classed("vzb-hidden",(he=>he.hide&&getProp(this,he.hide.split("."))))}_addButtons(he,ge){const me=this;this._components_config=[];const be=[];if(!he.length)return;for(let ge=0;ge<he.length;ge++){const me=he[ge],ve=this._available_buttons[me]?me:"_default",_e=clone(this._available_buttons[ve]);"_default"==ve&&(_e.title="buttons/"+me),_e.id=me,_e.icon=De["ICON_"+_e.icon.toUpperCase()],be.push(_e)}const ve=this.localise;this.element.selectAll("button").data(be).enter().append("button").attr("class",(he=>{let me="vzb-buttonlist-btn";return ge.length>0&&ge.indexOf(he.id)>-1&&(me+=" vzb-dialog-side-btn"),me})).attr("data-btn",(he=>he.id)).html((he=>"<span class='vzb-buttonlist-btn-icon fa'>"+he.icon+"</span><span class='vzb-buttonlist-btn-title'>"+ve(he.title)+"</span>"));this.element.selectAll(".vzb-buttonlist-btn").on("click",(function(he,ge){he.preventDefault(),he.stopPropagation(),me.proceedClick(ge.id)}))}proceedClick(he){const ge=this,me=ge.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']"),be=me.attr("class"),ve=ge._available_buttons[he];if(ve&&ve.func)ve.func(he);else{const ve=-1===be.indexOf(_i);me.classed(_i,ve);const _e={};_e.id=he,_e.active=ve,ge.trigger("click",_e)}}setButtonActive(he,ge){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+he+"']").classed(_i,ge)}toggleCursorMode(he){const ge=he;this.root.ui.chart.cursorMode=ge}setCursorMode(he,ge){this.element.selectAll(".vzb-buttonlist-btn").classed(_i,(he=>he.id==ge))}toggleHundredPercent(){this.root.element.dispatch("custom-resetZoom")}}
/*!
   * VIZABI OPTIONSBUTTONLIST
   * Reusable optionsbuttonlist component
   */class OptionsButtonList extends ButtonList{setup(){super.setup(),Object.keys(this._available_buttons).forEach((he=>{const ge=this._available_buttons[he];ge.required=!ge.required}))}draw(){super.draw();this.root.findChild({name:"buttons"}).element.on("custom-togglebuttons",(he=>{const{hiddenButtons:ge}=he.detail;this.element.selectAll(".vzb-buttonlist-btn").style("display",(he=>-1==ge.indexOf(he.id)?"none":""))}))}_toggleButtons(){}}
/*!
   * VIZABI BUBBLE SIZE slider
   * Reusable bubble size slider
   */const xi={PADDING:{TOP:132,BOTTOM:50,LEFT:20,RIGHT:20},BAR_WIDTH:3,TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},THUMB_STROKE_WIDTH:2,THUMB_HEIGHT:15,labelsValue:"domain",PROFILE_CONSTANTS:{SMALL:{},MEDIUM:{},LARGE:{}}};class BubbleSize extends Ze{setup(he){const ge=deepExtend(deepExtend({},xi),he||{});super.setup(ge),this.rescaler.clamp(!1),this.showArcs=this.options.showArcs,this.showArcs&&(this.DOM.sliderArcs=this.DOM.slider.selectAll(".vzb-bs-slider-thumb-arc").data([0,0]).enter().append("path").attr("class",((he,ge)=>"vzb-bs-slider-thumb-arc vzb-bs-slider-thumb-arc-".concat(ge?"max":"min"))).lower()),this.DOM.sliderLabelsWrapper=this.DOM.slider.append("g"),this.DOM.sliderLabels=this.DOM.sliderLabelsWrapper.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("dy",((he,ge)=>ge?"-0.5em":"1.9em"))}_updateView(){super._updateView(),this._setLabelsText()}_getPadding(){const he=super._getPadding();return he.top=this.options.PADDING.TOP,he.left=this.options.PADDING.LEFT,he.right=this.options.PADDING.RIGHT,he.bottom=this.options.PADDING.BOTTOM,he}_updateThumbs(he){this._updateArcs(he),this._updateLabels(he)}_updateArcs(he){if(!this.showArcs)return;const ge=this,be=me.arc().outerRadius((he=>ge.rescaler(he))).innerRadius(0).startAngle(-.5*Math.PI).endAngle(1.5*Math.PI);this.DOM.sliderArcs.data(he).attr("d",be).attr("transform","translate(0,0)")}_updateLabels(he){he&&this.DOM.sliderLabels.data(he);const ge=this.services.locale.isRTL();this.DOM.sliderLabels.attr("transform",(he=>{const me=this.rescaler(he);return"translate("+(ge?-1:1)*me+",0)"})).attr("text-anchor",(he=>!ge&&he<this.__labelSideSwitchEdge||ge&&he>=this.__labelSideSwitchEdge?"start":"end")).attr("dx",((he,me)=>(ge?-1:1)*(he<this.__labelSideSwitchEdge?me?.3:.1:me?-.3:-.4)+"em"))}_setLabelsText(){let he=[];he=this.MDL.model.data.isConstant?["",""]:this.MDL.model[this.options.labelsValue].map(this.localise),this.DOM.sliderLabels.text(((ge,me)=>he[me]))}_getMinMaxBubbleRadius(){if(this.root.ui.minMaxRadius)return this.root.ui.minMaxRadius;const he=this.model.encoding.size.scale.range;return{min:areaToRadius(me.min(he)),max:areaToRadius(me.max(he))}}updateSize(){super.updateSize(),this.__labelSideSwitchEdge=.75*this.rescaler.invert(this._getComponentWidth()),this.DOM.sliderLabelsWrapper.attr("transform",this.services.locale.isRTL()?"scale(-1,1)":null)}_setBrushExtent(){return this.brush.extent([[this.rescaler.range()[0],0],[this._getComponentWidth(),this._getComponentHeight()]])}_updateRescaler(){const he=this._getMinMaxBubbleRadius();this.rescaler.range([he.min,he.max])}}
/*!
   * VIZABI BUBBLE SIZE slider
   * Reusable bubble size slider
   */const wi={THUMB_HEIGHT:17,THUMB_STROKE_WIDTH:3,domain:null,suppressInput:null,snapValue:null};class SingleHandleSlider extends Ze{setup(he){this.type=this.type||"singlehandleslider";const ge=extend(extend({},wi),he||{});super.setup(ge),this.options.domain&&this._setDomain(this.options.domain),this.DOM.slider.selectAll(".w").classed("vzb-hidden",!0),this.DOM.slider.select(".selection").classed("vzb-hidden",!0),this.DOM.slider.select(".overlay").lower().style("stroke-opacity","0").style("stroke-width",.5*this.options.THUMB_HEIGHT+"px").attr("rx",.5*this.options.BAR_WIDTH).attr("ry",.5*this.options.BAR_WIDTH),this.DOM.slider.selectAll(".vzb-slider-thumb-badge").style("stroke-width",this.options.THUMB_STROKE_WIDTH+"px")}_setDomain(he){this.options.EXTENT_MIN=this.options.domain[0],this.options.EXTENT_MAX=this.options.domain[this.options.domain.length-1],this.rescaler.domain(he)}_createThumbs(he){const ge=.5*this.options.THUMB_HEIGHT,be=me.arc().outerRadius(ge).startAngle(0).endAngle(2*Math.PI);he.attr("transform","translate("+(ge+.5*this.options.THUMB_STROKE_WIDTH)+","+(ge+.5*this.options.THUMB_STROKE_WIDTH)+")").append("path").attr("d",be)}_getBrushEventListeners(){const he=super._getBrushEventListeners();return{start:he.start,brush:(ge,me)=>{!this.nonBrushChange&&ge.sourceEvent&&(this.options.suppressInput?(this._savedSelection=ge.selection,this._snap(ge.selection)):he.brush.call(this,ge,me))},end:he=>{!this.nonBrushChange&&he.sourceEvent&&(this.options.snapValue?this._snap(he.selection||this._savedSelection):this.DOM.slider.call(this.brush.move,[this.rescaler.range()[0],this._savedSelection[1]]),this._setFromExtent(!0,!0),this._savedSelection=void 0)}}}_snap(he){let ge=this.rescaler.invert(this._extentToValue(he));const be=this.rescaler.domain(),ve=be[be.length-1]>be[0],_e=me.bisector(me[ve?"ascending":"descending"]).left(be,ge)||1;ge=(ve?1:-1)*(ge-be[_e-1]-(be[_e]-ge))>0?be[_e]:be[_e-1],this._moveBrush(this._valueToExtent(ge))}_getHandleSize(){return this.options.THUMB_HEIGHT+this.options.THUMB_STROKE_WIDTH}_getPadding(){const he=this.options.BAR_WIDTH,ge=this.options.THUMB_HEIGHT,me=super._getPadding();return me.top=.5*(ge+this.options.THUMB_STROKE_WIDTH),me.bottom=.5*(ge+this.options.THUMB_STROKE_WIDTH)-he,me}updateSize(){super.updateSize();const he=this._getComponentWidth();this.rescaler.range(me.range(0,he||1,he/(this.rescaler.domain().length-1)||1).concat([he]))}_valueToExtent(he){return[this.rescaler.domain()[0],he]}_extentToValue(he){return he[1]}_setModel(he,ge,me){if(this.options.suppressInput){if(this._extentToValue(he).toFixed(this.options.ROUND_DIGITS)==this.MDL.model[this.value])return}super._setModel(he,ge,me)}}
/*!
   * VIZABI BUBBLE SIZE slider
   * Reusable bubble size slider
   */const Mi={propertyName:"LabelTextSize",PROFILE_CONSTANTS:{SMALL:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},MEDIUM:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},LARGE:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}}};class SizeSlider extends Ze{setup(he){const ge=deepExtend(deepExtend({},Mi),he||{});super.setup(ge);const be=this.options.BAR_WIDTH;this.DOM.sliderLabelsWrapper=this.DOM.slider.append("g"),this.DOM.sliderLabelsWrapper.selectAll("text").data([0,0]).enter().append("text").attr("class",((he,ge)=>"vzb-szs-slider-thumb-label "+(ge?"e":"w"))).attr("dy",1.25*-be+"px"),this.DOM.sliderLabels=this.DOM.slider.selectAll("text.vzb-szs-slider-thumb-label"),this.propertyScale=me.scaleLinear().domain([this.options.EXTENT_MIN,this.options.EXTENT_MAX]).clamp(!0)}_updateView(){super._updateView(),this.MDL.model.data.isConstant?(this.DOM.slider.selectAll(".w").classed("vzb-hidden",!0),this.DOM.slider.select(".selection").classed("vzb-hidden",!0),this.DOM.slider.select(".overlay").classed("vzb-pointerevents-none",!0)):(this.DOM.slider.selectAll(".w").classed("vzb-hidden",!1),this.DOM.slider.select(".selection").classed("vzb-hidden",!1),this.DOM.slider.select(".overlay").classed("vzb-pointerevents-none",!1)),this._setLabelsText()}_updateThumbs(he){this._updateLabels(he)}_updateLabels(he){he&&this.DOM.sliderLabels.data(he),this.DOM.sliderLabels.attr("transform",((he,ge)=>{const me=this.rescaler(ge);return"translate("+(this.services.locale.isRTL()?-1:1)*me+",0)"})).attr("font-size",(he=>this.propertyScale(he))),this.MDL.model.data.isConstant&&this.DOM.sliderLabels.text((he=>~~this.propertyScale(he)+(this.localise(this.options.constantUnit)||"")))}_setLabelsText(){const he=this.MDL.model.domain,ge=[he[0],he[he.length-1]].map(this.localise);this.MDL.model.data.isConstant||this.DOM.sliderLabels.text(((he,me)=>ge[me]))}_getMinMaxDefaultPropertyValues(){const he=this.options.propertyName;return{min:this.profileConstants["min"+he],max:this.profileConstants["max"+he],default:this.profileConstants["default"+he]}}updateSize(){const he=this._getMinMaxDefaultPropertyValues();this.padding.top=he.max+1.25*this.options.BAR_WIDTH,this.propertyScale.range([he.min,he.max]),super.updateSize();const ge=this.services.locale.isRTL();this.DOM.sliderLabelsWrapper.attr("transform",ge?"scale(-1,1)":null),this.DOM.sliderLabels.attr("text-anchor",((he,me)=>(ge?me:!me)?"start":"end"))}_valueToExtent(he){return this.MDL.model.data.isConstant&&null===he[1]?super._valueToExtent([he[0],this.propertyScale.invert(this._getMinMaxDefaultPropertyValues().default)]):super._valueToExtent(he)}}function url(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return ge?"<a class='vzb-underline' href='".concat(ge,"' target='_blank'>â§ ").concat(he,"</a>"):he}class About extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <div class="vzb-dialog-title"> \n          <span data-localise="buttons/about"></span>\n        </div>\n\n        <div class="vzb-dialog-content">\n          <div class="vzb-about-header"></div>\n          <div class="vzb-about-body"></div>\n          <div class="vzb-about-footer"></div>\n        </div>\n    \n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n      </div>\n    ',super(he)}setup(){this.DOM={header:this.element.select(".vzb-about-header"),body:this.element.select(".vzb-about-body"),footer:this.element.select(".vzb-about-footer")}}draw(){this.addReaction(this.drawHeader),this.addReaction(this.drawBody),this.addReaction(this.drawFooter)}drawHeader(){var he,ge,me;const be=(null===(he=this.root.constructor.versionInfo)||void 0===he||null===(ge=he.sharedComponents)||void 0===ge||null===(me=ge.package)||void 0===me?void 0:me.author)||{};this.DOM.header.html(""),this.DOM.header.append("p").html("Next level data graphics"),this.DOM.header.append("p").html("This chart is made with Vizabi, <br/> an open-source project originally <br/> built at "+url(be.name,be.url)+"<br/> Currently maintained and extended by <br/> Angie and team at "+url("Visual Encodings AB","https://visual-encodings.com")),this.DOM.header.append("p").html("If you would like to use these graphs, we <br/> can help you set them up and customise <br/>"+function mailto(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"ð <a class='vzb-underline' href='mailto:".concat(he,"' target='_blank'>").concat(he,"</a>")}("info@visual-encodings.com"))}drawBody(){var he;const ge=[this.root.constructor.versionInfo||{},(null===(he=this.root.constructor.versionInfo)||void 0===he?void 0:he.sharedComponents)||{},this.services.Vizabi.Vizabi.versionInfo||{}],be=this.services.Vizabi.Vizabi.stores.dataSources.getAll().map((he=>{const ge=he.reader.getDatasetInfo?he.reader.getDatasetInfo():{};return{name:he.config.name||ge.name,url:he.config.path,type:he.config.modelType}}));this.DOM.body.html(""),this.DOM.body.append("div").append("p").append("h1").html("Components:"),this.DOM.body.append("div").selectAll("p").data(ge).enter().append("p").html((he=>{var ge,be,ve;return url((null===(ge=he.package)||void 0===ge?void 0:ge.description)||(null===(be=he.package)||void 0===be?void 0:be.name),null===(ve=he.package)||void 0===ve?void 0:ve.homepage)+"<br/> - Version: ".concat(function formatVersion(he){return he||"N/A"}(he.version)," <br/> - Build ").concat(function formatBuild(he){return he?me.utcFormat("%Y-%m-%d at %H:%M")(new Date(parseInt(he))):"N/A"}(he.build))})),this.DOM.body.append("div").append("p").append("h1").html("Data sources:"),this.DOM.body.append("div").selectAll("p").data(be).enter().append("p").html((he=>url(he.type+" "+he.name,he.url)))}drawFooter(){var he,ge,me;const be=(null===(he=this.root.constructor.versionInfo)||void 0===he||null===(ge=he.sharedComponents)||void 0===ge||null===(me=ge.package)||void 0===me?void 0:me.contributors)||[];this.DOM.footer.html(""),this.DOM.footer.append("p").append("h1").html("Contributors:"),this.DOM.footer.append("p").selectAll("span").data(be).enter().append("span").html((he=>url(he.name,he.url)))}}an.add("about",About);class Axes extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n        <div class="vzb-dialog-title">\n          <span data-localise="buttons/axes"></span>\n        </div>\n        <div class="vzb-dialog-content">\n          <p class="vzb-dialog-sublabel">\n            <span data-localise="buttons/x"></span>\n            <span class="vzb-xaxis-selector"></span>\n          </p>\n          <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n          <p class="vzb-dialog-sublabel">\n            <span data-localise="buttons/y"></span>\n            <span class="vzb-yaxis-selector"></span>\n          </p>\n          <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n        </div>\n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n      </div>    \n    ',he.subcomponents=[{type:IndicatorPicker,placeholder:".vzb-xaxis-selector",options:{submodel:"encoding",targetProp:"x"}},{type:vn,placeholder:".vzb-xaxis-minmax",state:{submodel:"encoding.x.scale"}},{type:IndicatorPicker,placeholder:".vzb-yaxis-selector",options:{submodel:"encoding",targetProp:"y"}},{type:vn,placeholder:".vzb-yaxis-minmax",state:{submodel:"encoding.y.scale"}}],super(he)}}an.add("axes",Axes);
/*!
   * VIZABI COLOR DIALOG
   */
class Colors extends an{constructor(he){var ge,me;he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n        \n        <div class="vzb-dialog-title">\n          <span data-localise="buttons/colors"></span>\n          <span class="vzb-caxis-selector"></span>\n        </div>\n      \n        <div class="vzb-dialog-content vzb-dialog-scrollable">\n          <div class="vzb-clegend-container">\n            <svg>\n              <g class="vzb-timedisplay"></g>\n            </svg>\n          </div>\n        </div>\n\n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n\n      </div>\n    ',he.subcomponents=[{type:IndicatorPicker,placeholder:".vzb-caxis-selector",options:{submodel:"encoding",targetProp:"color",showHoverValues:!0},state:{get hoverKeyLabels(){var ge,me,be;const ve=null===(ge=he.root.model.markers)||void 0===ge?void 0:ge[(null===(me=he.root.options)||void 0===me||null===(be=me.markerNames)||void 0===be?void 0:be.legend)||"legend"];if(!ve)return null;if(ve.state===ke.READY){const he=ve.data.space[0];return ve.dataArray.reduce(((ge,me)=>(ge[me[he]]=me.name,ge)),{})}return null}}},{type:sn,placeholder:".vzb-clegend-container",options:{colorModelName:"color",legendModelName:(null===(ge=he.root.options)||void 0===ge||null===(me=ge.markerNames)||void 0===me?void 0:me.legend)||"legend"}}],super(he)}}an.add("colors",Colors);class Label extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n        <div class="vzb-dialog-title"> \n          <span data-localise="buttons/label"></span>\n        </div>\n\n        <div class="vzb-dialog-content">\n          <div class="vzb-enablelabelbox-switch"></div>\n          <span class="vzb-saxis-selector"></span>\n          <div class="vzb-dialog-sizeslider"></div>\n          <div class="vzb-removelabelbox-switch"></div>\n        </div>\n\n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n\n      </div>\n    ',he.subcomponents=[{type:SizeSlider,placeholder:".vzb-dialog-sizeslider",options:{constantUnit:"unit/pixels",submodelFunc:()=>this.model.encoding.size_label.scale}},{type:IndicatorPicker,placeholder:".vzb-saxis-selector",options:{submodel:"encoding",targetProp:"size_label"}},{type:SimpleCheckbox,placeholder:".vzb-removelabelbox-switch",options:{checkbox:"removeLabelBox",submodel:"root.ui.chart.labels"}},{type:SimpleCheckbox,placeholder:".vzb-enablelabelbox-switch",options:{checkbox:"enabled",submodel:"root.ui.chart.labels"}}],super(he)}}an.add("label",Label);
/*!
   * VIZABI SHOW PANEL CONTROL
   * Reusable show panel dialog
   */
class Show extends Ve{constructor(he){he.template='\n      <div class="vzb-show-list vzb-accordion">\n        \x3c!-- list will be placed here --\x3e\n      </div>\n    ',super(he)}setup(){this.DOM={},this.DOM.list=this.element.select(".vzb-show-list"),this.DOM.input_search=this.parent.element.select(".vzb-find-search"),this.DOM.deselect_all=this.parent.element.select(".vzb-show-deselect"),this.DOM.apply=this.parent.element.select(".vzb-show-apply"),this.DOM.deselect_all.on("click",(()=>{this._resetShow()})),this.DOM.apply.on("click",(()=>{this._applyShowChanges()})),this.tabsConfig=this.ui.showTabs||{}}draw(){this.MDL={selected:this.model.encoding.selected,frame:this.model.encoding.frame},this.localise=this.services.locale.auto(),this.previewShow={};const he=this.model.data.filter.dimensions;this.resetFilter||(this.resetFilter=deepClone(he)),forEach(this.model.data.space,(ge=>{he[ge]&&(this.previewShow[ge]=deepExtend({},he[ge]),forEach(he[ge].$and||[he[ge]],(he=>{forEach(he,((he,me)=>{this.previewShow[ge][me]=(he.$in||[]).slice(0)}))})))})),this.checkedDifference={},this.addReaction(this._updateView)}_updateView(){const he=this;if("show"!==this.parent._getPanelMode())return;function addCategory(me,be){if(me.entities){var ve;const _e=null===(ve=he.model.encoding.show)||void 0===ve?void 0:ve.data.filter.dimensions[be];ge.push({dim:be,key:me.concept.concept,entities:me.entities.filter(_e),name:me.concept.name})}me.properties&&Object.keys(me.properties).forEach((he=>{addCategory(me.properties[he],be)}))}const ge=[];this.model.data.spaceCatalog.then((he=>{Object.keys(he).forEach((ge=>{addCategory(he[ge],ge)})),this.buildList(ge)}))}buildList(he){const ge=this;this.DOM.list.html(""),forEach(he,(he=>{let{dim:be,key:ve,name:_e,entities:xe}=he;const we=be!==ve;xe=[...xe.values()].map((he=>Object.assign(he,{isShown:this._isMarkerInDimFilter(he,be,ve)}))).sort(((he,ge)=>he.name<ge.name?-1:1));const Me=this.DOM.list.append("div").attr("class","vzb-accordion-section").classed("vzb-accordion-active","open"===this.tabsConfig[ve]).datum({key:ve,isSet:we});Me.append("div").attr("class","vzb-accordion-section-title").on("click",(function(){const he=me.select(this.parentNode);he.classed("vzb-fullexpand",!1).classed("vzb-accordion-active",!he.classed("vzb-accordion-active"))})).call((he=>he.append("span").attr("class","vzb-show-category").classed("vzb-show-category-set",(he=>he.isSet)).text(_e).attr("title",(function(){return this.offsetWidth<this.scrollWidth?_e:null})))).call((he=>he.append("span").attr("class","vzb-show-clear-cross").text("â").on("click",(he=>{he.stopPropagation(),Me.selectAll(".vzb-checked input").property("checked",!1).dispatch("change")})))).call((he=>he.append("span").attr("class","vzb-show-more vzb-dialog-button").text(ge.localise("buttons/moreellipsis")).on("click",(he=>{he.stopPropagation(),Me.classed("vzb-fullexpand",!0)}))));const Se=Me.append("div").attr("class","vzb-show-category-list"),De=Se.selectAll(".vzb-show-item").data(xe).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox").classed("vzb-checked",(he=>he.isShown));De.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",(he=>"-show-"+ve+"-"+he[ve]+"-"+ge.id)).property("checked",(he=>he.isShown)).on("change",((he,ge)=>{ge.isShown!==he.currentTarget.checked?this.checkedDifference[ve+ge[ve]]=!0:delete this.checkedDifference[ve+ge[ve]],this.DOM.apply.classed("vzb-disabled",!Object.keys(this.checkedDifference).length),this.previewShow[be]||(this.previewShow[be]={}),this.previewShow[be][ve]||(this.previewShow[be][ve]=[]);const me=this.previewShow[be][ve].indexOf(ge[ve]);-1===me?this.previewShow[be][ve].push(ge[ve]):this.previewShow[be][ve].splice(me,1)})),De.append("label").attr("for",(he=>"-show-"+ve+"-"+he[ve]+"-"+ge.id)).text((he=>he.name)).attr("title",(function(he){return this.offsetWidth<this.scrollWidth?he.name:null}));const ze=Se.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];if(ze&&ze.nextSibling){const he=ze.parentNode.offsetTop+ze.offsetTop;me.select(ze.parentNode.parentNode).style("max-height",he+ze.offsetHeight+25+"px").select(".vzb-show-more").style("transform","translate(0, ".concat(he,"px)"))}else Me.select(".vzb-show-more").classed("vzb-hidden",!0);Me.classed("vzb-filtered",!!ze),Me.classed("vzb-fullexpand",!!ze&&"open fully"===this.tabsConfig[ve])}))}_showHideSearch(){if("show"!==this.parent._getPanelMode())return;let he=this.DOM.input_search.node().value||"";he=he.toLowerCase(),this.DOM.list.selectAll(".vzb-show-item").classed("vzb-hidden",(ge=>-1===(ge.name||"").toString().toLowerCase().indexOf(he))),""!==he&&this.DOM.list.selectAll(".vzb-accordion-section").classed("vzb-accordion-active",!0)}_showHideButtons(){"show"===this.parent._getPanelMode()&&(this.DOM.deselect_all.classed("vzb-hidden",this._hideResetButton()),this.DOM.apply.classed("vzb-hidden",!1).classed("vzb-disabled",!0))}_hideResetButton(){let he=!0;const ge=this.model.data.space;return forEach(ge,(ge=>(he=comparePlainObjects(this.resetFilter[ge]||{},this.model.data.filter.dimensions[ge]||{}),he))),he}_applyShowChanges(){be.runInAction((()=>{this.MDL.selected.data.filter.delete([...this.MDL.selected.data.filter.markers]);const he={};forEach(this.previewShow,((ge,me)=>{const be={},ve=[];forEach(ge,((he,ge)=>{ve.push(ge),he.length&&(be[ge]={$in:he.slice(0)})})),forEach(this.model.data.filter.dimensions[me],((he,ge)=>{ve.includes(ge)||(be[ge]=deepClone(he))})),he[me]=be})),this.model.data.filter.config.dimensions=he}))}_resetShow(){be.runInAction((()=>{this.model.data.filter.config.dimensions=this.resetFilter}))}_closeClick(){this._applyShowChanges()}_isMarkerInDimFilter(he,ge,me){const be=this.model.data.filter.dimensions[ge]||{};return getProp(be,[me,"$in"],[]).includes(he[me])}}
/*!
   * VIZABI FIND CONTROL
   * Reusable find dialog
   */class Find extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n        <div class="vzb-dialog-title">\n          <label class="vzb-dialog-title-switch">\n            <input type="checkbox">\n            <span class="vzb-switch-slider round"></span>\n            <span class="vzb-switch-off">\n              <span data-localise="dialogs/find"></span>\n            </span>\n            <span class="vzb-switch-on">\n              <span data-localise="buttons/show"></span>\n            </span>\n          </label>\n\n          <span class="vzb-dialog-content vzb-find-filter">\n            <form novalidate>\n              <input class="vzb-find-search" type="search" required/>\n              <button class="vzb-cancel-button" type="reset"></button>\n            </form>\n          </span>\n\n          <span class="vzb-spaceconfig-button"></span>\n        </div>\n\n        <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n          <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-find vzb-active">\n            <div class="vzb-find-list">\n              \x3c!-- list will be placed here --\x3e\n            </div>\n          </div>\n\n          <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-show">\n          </div>\n        </div>\n\n        <div class="vzb-dialog-buttons">\n          <div class="vzb-dialog-bubbleopacity vzb-dialog-control" data-panel="find"></div>\n          <div class="vzb-dialog-button vzb-find-deselect" data-panel="find">\n            <span data-localise="buttons/deselect"></span>\n          </div>\n          <div class="vzb-dialog-button vzb-show-deselect" data-panel="show">\n            <span data-localise="buttons/reset"></span>\n          </div>\n          <div class="vzb-dialog-button vzb-show-apply" data-panel="show">\n            <span data-localise="buttons/apply"></span>\n          </div>\n\n          <div data-dialogtype="find" data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>  \n\n      </div>      \n    ',he.subcomponents=[{type:Show,placeholder:".vzb-dialog-panel-show"},{type:SingleHandleSlider,placeholder:".vzb-dialog-bubbleopacity",options:{value:"opacitySelectDim",submodel:"root.ui.chart"}}],super(he)}setup(he){super.setup(he),this.DOM.findList=this.element.select(".vzb-find-list"),this.DOM.titleSwitch=this.element.select(".vzb-dialog-title-switch"),this.DOM.titleSwitchSlider=this.DOM.titleSwitch.select(".vzb-switch-slider"),this.DOM.titleSwitchInput=this.DOM.titleSwitch.select("input"),this.DOM.panels=this.DOM.content.selectAll(".vzb-dialog-content"),this.DOM.panelFind=this.DOM.content.select(".vzb-dialog-panel-find"),this.DOM.input_search=this.element.select(".vzb-find-search"),this.DOM.deselect_all=this.element.select(".vzb-find-deselect"),this.DOM.markerSpaceButton=this.element.select(".vzb-spaceconfig-button"),this.DOM.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.DOM.titleSwitchInput.on("change",(()=>{this.ui.panelMode=this.DOM.titleSwitchInput.property("checked")?"show":"find"})).property("checked","find"!==this._getPanelMode()),this.DOM.input_search.on("keyup",(he=>{13==he.keyCode&&"select all"==this.DOM.input_search.node().value&&(this.DOM.input_search.node().value="")})),this.DOM.input_search.on("input",(()=>{this.panelComps[this._getPanelMode()]._showHideSearch()})),me.select(this.DOM.input_search.node().parentNode).on("reset",(()=>{defer((()=>this.panelComps[this._getPanelMode()]._showHideSearch()))})).on("submit",(he=>(he.preventDefault(),!1))),this.DOM.deselect_all.on("click",(()=>{this.MDL.selected.data.filter.clear()}));this.DOM.buttons.select(".vzb-dialog-button[data-click='closeDialog']").on("click.panel",(()=>this.panelComps[this._getPanelMode()]._closeClick())),this.panelComps={find:this,show:this.findChild({type:"Show"})}}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted}}draw(){super.draw(),this.TIMEDIM=this.MDL.frame.data.concept,this.KEY=Symbol.for("key"),this.KEYS=this.model.data.space.filter((he=>he!==this.TIMEDIM)),this.DOM.input_search.attr("placeholder",this.localise("placeholder/search")+"..."),this.addReaction(this._enablePanelModeSwitch),this.addReaction(this._enableMarkerSpaceOptions),this.addReaction(this._changePanelMode),this.addReaction(this._createFindList),this.addReaction(this._updateBrokenData),this.addReaction(this._selectDataPoints)}_changePanelMode(){const he=this._getPanelMode();this.DOM.panels.classed("vzb-active",!1),this.DOM.content.select(".vzb-dialog-panel-"+he).classed("vzb-active",!0),this.panelComps[he]._showHideSearch(),this._buttonAdjust(),this.panelComps[he]._showHideButtons()}_getPanelMode(){return this.ui.panelMode}_enablePanelModeSwitch(){this.DOM.titleSwitchSlider.classed("vzb-hidden",!this.ui.enableSelectShowSwitch),this.DOM.titleSwitch.style("pointer-events",this.ui.enableSelectShowSwitch?"auto":"none")}_enableMarkerSpaceOptions(){this.DOM.markerSpaceButton.classed("vzb-hidden",!this.ui.enableMarkerSpaceOptions)}_buttonAdjust(){this.DOM.buttons.selectAll(".vzb-dialog-buttons > :not([data-dialogtype])").classed("vzb-hidden",!0),this.DOM.buttons.selectAll("[data-panel=".concat(this._getPanelMode(),"]")).classed("vzb-hidden",!1)}_processFramesData(){const he=this.KEY,ge=new Map;return this.model.getTransformedDataMap("filterRequired").each((me=>me.forEach(((me,be)=>{ge.has(be)||ge.set(be,{[he]:be,name:this._getCompoundLabelText(me)})})))),ge}_createFindList(){const he=this.DOM.findList,ge=this.KEY,me=[...this._processFramesData().values()];me.sort(((he,ge)=>he.name<ge.name?-1:1)),this.DOM.findListItems=he.text("").selectAll("div").data(me,(function(he){return he[ge]})).join("div").attr("class","vzb-find-item vzb-dialog-checkbox").call(this._createListItem.bind(this))}_createListItem(he){he.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",((he,ge)=>"-find-"+ge+"-"+this.id)).on("change",((he,ge)=>{isTouchDevice()||this.MDL.highlighted.data.filter.delete(ge),this.MDL.selected.data.filter.toggle(ge),this.DOM.panelFind.node().scrollTop=0,isTouchDevice()||ge.brokenData||this.MDL.highlighted.data.filter.set(ge)})),he.append("label").attr("for",((he,ge)=>"-find-"+ge+"-"+this.id)).text((he=>he.name)).on("mouseover",((he,ge)=>{isTouchDevice()||ge.brokenData||this.MDL.highlighted.data.filter.set(ge)})).on("mouseout",((he,ge)=>{isTouchDevice()||this.MDL.highlighted.data.filter.delete(ge)}))}_getCompoundLabelText(he){return"object"==typeof he.label?Object.entries(he.label).filter((he=>he[0]!=this.MDL.frame.data.concept)).map((he=>isNumber(he[1])?he[0]+": "+he[1]:he[1])).join(", "):null!=he.label?""+he.label:he[Symbol.for("key")]}_updateBrokenData(){const he=this.model.dataMap,ge=this.DOM.findListItems,me=this.KEY;ge.data().forEach((ge=>{ge.brokenData=!he.hasByStr(ge[me])})),this._updateLabelTitle()}_updateLabelTitle(){const he=this.localise(this.MDL.frame.value)+": "+this.localise("hints/nodata");this.DOM.findListItems.select("label").classed("vzb-find-item-brokendata",(he=>he.brokenData)).attr("title",(ge=>ge.nameIfEllipsis+(ge.brokenData?(ge.nameIfEllipsis?" | ":"")+he:"")))}_updateView(){}_selectDataPoints(){const he=this.MDL.selected.data.filter;this.DOM.findListItems.order().select("input").property("checked",(function(ge){const be=he.has(ge);return me.select(this.parentNode).classed("vzb-checked",be),be}));this.DOM.findList.selectAll(".vzb-checked").lower().classed("vzb-separator",((he,ge)=>!ge))}_showHideSearch(){if("find"!==this._getPanelMode())return;let he=this.DOM.input_search.node().value||"";he=he.toLowerCase(),this.DOM.findList.selectAll(".vzb-find-item").classed("vzb-hidden",(ge=>-1===(ge.name||"").toString().toLowerCase().indexOf(he)))}_showHideButtons(){if("find"!==this._getPanelMode())return;const he=this.MDL.selected.data.filter.any();this.DOM.deselect_all.classed("vzb-hidden",!he),this.DOM.opacity_nonselected.classed("vzb-hidden",!he),he&&be.runInAction((()=>{const he=this.findChild({type:"SingleHandleSlider"});he.updateSize(),he._updateView()}))}_closeClick(){}}Find.DEFAULT_UI={enableSelectShowSwitch:!1,enableMarkerSpaceOptions:!1,panelMode:"find",enablePicker:!1};const Si=be.decorate(Find,{MDL:be.computed});an.add("find",Si);class ShortcutForSwitch extends Ve{constructor(he){super(he)}setup(he){super.setup(he),this.DOM={container:this.element}}draw(){this.addReaction(this.updateList)}updateList(){var he,ge;if(!(null===(he=this.parent.ui)||void 0===he?void 0:he.shortcutForSwitch))return this.DOM.container.style("display","none");const me=null===(ge=this.parent.ui)||void 0===ge?void 0:ge.shortcutForSwitch_allow,be=this.parent.children.find((he=>"SectionSwitch"===he.constructor.name)),ve=be.items.filter((he=>!me||me.includes(he.concept))).toSorted(((he,ge)=>he.name<ge.name?-1:1)),_e=be.isCurrentSetting.bind(be),xe=be.setFilter.bind(be);this.DOM.container.style("display",ve.length?"block":"none").selectAll("span").data(ve).join("span").classed("vzb-active",(he=>_e(he))).text((he=>he.name)).on("click",((he,ge)=>xe(ge)))}}class MarkerControlsSection extends Ve{constructor(he){he.template='\n      <div class = "vzb-header">\n        <span class = "vzb-back">â¬</span>\n        <span class = "vzb-title"></span>\n        <span class = "vzb-threedots"></span>\n        <span class = "vzb-enterhint"></span>\n      </div>\n      <div class = "vzb-content"></div>\n\n    ',super(he),this.magicCommand=this.constructor.name.replace("_","").replace("Section","").toLowerCase()}setup(){this.DOM={header:this.element.select(".vzb-header"),back:this.element.select(".vzb-back"),title:this.element.select(".vzb-title"),threedots:this.element.select(".vzb-threedots"),enterhint:this.element.select(".vzb-enterhint"),content:this.element.select(".vzb-content")},this.DOM.back.on("click",(()=>this.cancelChanges()))}example(){return""}cancelChanges(){this.parent.toggleFullscreenish()}showHideHeader(he){this.DOM.header.classed("vzb-hidden",!he)}showHideSection(he){this.element.classed("vzb-hidden",!he)}updateSearch(){console.warn("updateSearch(text) function is not implemented in "+this.constructor.name),this.showHideHeader()}concludeSearch(){console.warn("concludeSearch(text) function is not implemented in "+this.constructor.name)}}const Di=Symbol.for("key");function _getLeafChildren(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return he.folder?he.children.forEach((he=>_getLeafChildren(he,ge))):ge.push(...he.children),ge}function _getLeafChildrenCount(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];return he.folder?he.children.forEach((he=>_getLeafChildrenCount(he,ge))):ge[0]+=he.children.length,ge[0]}function nameLocaleCompare(he,ge){return he.name.localeCompare(ge.name)}function folderAndNameLocaleCompare(he,ge){return(he.folder||0)-(ge.folder||0)||he.name.localeCompare(ge.name)}function sortItems(he){const ge=he.selectChildren(".vzb-item:not(.vzb-item-folder)");ge.filter(":not(.vzb-checked)").sort(nameLocaleCompare).classed("vzb-separator",!1),ge.filter(".vzb-checked").lower().sort(nameLocaleCompare).classed("vzb-separator",((he,ge,me)=>ge==me.length-1))}const zi=be.decorate(class SectionFind extends MarkerControlsSection{constructor(ge){super(ge),vendorMin._(this,"setModel",{select:he=>{he.missingData||be.runInAction((()=>_getLeafChildren(he).forEach((he=>this.MDL.selected.data.filter.toggle(he)))))},deselect:he=>{be.runInAction((()=>_getLeafChildren(he).forEach((he=>this.MDL.selected.data.filter.delete(he)))))},highlight:he=>{he.missingDataForFrame||he.missingData||be.runInAction((()=>_getLeafChildren(he).forEach((he=>this.MDL.highlighted.data.filter.set(he)))))},unhighlight:he=>{be.runInAction((()=>_getLeafChildren(he).forEach((he=>this.MDL.highlighted.data.filter.delete(he)))))}})}setup(he){super.setup(he),this.DOM.selectDialog=this.DOM.content.append("div").attr("class","vzb-find-select-dialog vzb-hidden"),this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-title"),this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-close"),this.DOM.list=this.DOM.content.append("div").attr("class","vzb-list"),this.listReady=!1,this.entitiesWithMissingDataInAllFrames=[],this.drilldownValues=new Map,this.listData=[],this.listScrollTransitionFlag=!1,this._initSelectDialog()}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.createList),this.addReaction(this.updatemissingDataForCurrentFrame),this.addReaction(this.updateSelection),this.addReaction(this.getEntitiesExplicitlyAddedInFilterButMissingDataInAllFrames),this.addReaction(this.getDrilldownValues),this.addReaction(this.getListData)}get MDL(){return{color:this.model.encoding.color,frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted}}getDrilldownValues(){if(!this.isFindInFolderView())return;const he=this._getPrimaryDim(),ge=this._getDrilldownProps(),me=ge.map((he=>"is--"+he)),be={select:{key:[he],value:[...ge,...me,"name"]},from:"entities",locale:this.model.data.source.locale};this.model.data.source.query(be).then((he=>{this.drilldownValues=he.forQueryKey()}))}getListData(){const he=this._foldEntityListToPrimaryDimension(this.parent.marksFromAllFrames.concat(this.entitiesWithMissingDataInAllFrames).toSorted(((he,ge)=>he.name<ge.name?-1:1)));if(!this.isFindInFolderView())return void(this.listData=he);if(!this.drilldownValues.size)return;const ge=this._getPrimaryDim(),be=this._getDrilldownProps();he.forEach((he=>{be.forEach((me=>{var be;he[me]=null===(be=this.drilldownValues.get(he.children[0][ge]))||void 0===be?void 0:be[me]}))}));const mapChildren=he=>{const ge=he.findIndex((he=>!he[0]));return-1!==ge?he.slice(0,ge).concat(he.slice(ge+1)).map(mapGroupData).concat(mapGroupData(he[ge])):he.map(mapGroupData)},mapGroupData=(he,ge)=>{var me,ve,_e,xe;let[we,Me]=he;if(!we)return null!==(me=Me[0])&&void 0!==me&&me.children?null!==(ve=Me[0])&&void 0!==ve&&ve[1]?mapGroupData(Me[0],ge):void 0===ge?Me:Me[0]:mapChildren(Me);const Se=this.drilldownValues.get(we);return{[Di]:we,children:null!==(_e=Me[0])&&void 0!==_e&&_e.children?null!==(xe=Me[0])&&void 0!==xe&&xe[1]?mapGroupData(Me[0]):Me:mapChildren(Me),name:Se.name,prop:be.find((he=>Se["is--"+he])),folder:!0}},ve=mapGroupData([null,me.groups.apply(null,[he,...be.map((he=>ge=>ge[he]))])]);this.listData=ve.sort(folderAndNameLocaleCompare)}getEntitiesExplicitlyAddedInFilterButMissingDataInAllFrames(){const he=[];this.model.data.spaceCatalog.then((ge=>{var me,be,ve,_e,xe;const we=this._getPrimaryDim(),Me=(null===(me=this.model.encoding)||void 0===me||null===(be=me.show)||void 0===be||null===(ve=be.data)||void 0===ve||null===(_e=ve.filter)||void 0===_e||null===(xe=_e.dimensions)||void 0===xe?void 0:xe[we])||{};if(ge[we].entities){var Se,De,ze,Oe,Ce;const me=(null===(Se=this.model.data.filter.dimensions)||void 0===Se||null===(De=Se[we])||void 0===De||null===(ze=De.$or)||void 0===ze||null===(Oe=ze.find((he=>he[we])))||void 0===Oe||null===(Ce=Oe[we])||void 0===Ce?void 0:Ce.$in)||[];[...ge[we].entities.filter(Me).values()].forEach((ge=>{if(me.includes(ge[Di])&&!this.parent.marksFromAllFrames.some((he=>he[we]===ge[we]))){const me={[Di]:ge[Di],[we]:ge[we],name:ge.name,missingData:!0};he.push(me)}}))}this.entitiesWithMissingDataInAllFrames=he}))}createList(){this.DOM.title.text(this.localise("markercontrols/section/find")),this.listReady=!1;const he=this.isFindInFolderView(),ge=this.DOM.list.text("");this.DOM.listItems=ge.selectAll("div").data(this.listData,(he=>he[Di])).join("div").attr("class",(he=>"vzb-item vzb-item-toplevel vzb-dialog-checkbox ".concat(he.folder?"vzb-item-folder":""))).call(this._createListItem.bind(this,he?me.sum(this.listData.map((he=>_getLeafChildrenCount(he)))):this.listData.length)),he&&(this.DOM.listItems=this.DOM.list.selectAll(".vzb-item")),this.listReady=!0}isFindInFolderView(){return 0!=this._getDrilldownProps().length}_getPrimaryDim(){return this.parent.ui.primaryDim||this.model.data.space[0]}_getDrilldownProps(){var he,ge;return(null===(he=this.parent.ui.drilldown)||void 0===he||null===(ge=he.split)||void 0===ge?void 0:ge.call(he,"."))||[]}_foldEntityListToPrimaryDimension(he){const ge=this._getPrimaryDim();return me.groups(he,(he=>he[ge])).map((he=>{var me;let[be,ve]=he;return{[Di]:be,children:ve,name:(null===(me=ve[0].label)||void 0===me?void 0:me[ge])||ve[0].name,missingData:ve.every((he=>he.missingData))}}))}_createListItem(he,ge){if(ge.empty())return;const be=this;ge.append("input").attr("type","checkbox").attr("id",((he,ge)=>he[Di]+"-find-"+ge+"-"+this.id)).on("change",((he,ge)=>{if(this.parent.ui.disableFindInteractions)return;const be=he.target.parentNode,ve=me.select(be.parentNode).selectChildren(".vzb-separator").node(),_e=this.parent.DOM.content.node(),xe=be.offsetTop-((null==ve?void 0:ve.offsetTop)||0),we=_e.scrollTop-xe+(xe>0?2*be.clientHeight:-be.clientHeight);if(he.target.checked&&ge.folder||this.setModel.unhighlight(ge),he.target.checked)if(ge.folder){he.target.checked=!1,this._bindSelectDialogItems(ge),this.DOM.selectDialog.classed("vzb-hidden",!1);const me=be.getBoundingClientRect(),ve=_e.getBoundingClientRect(),xe=me.top-ve.top+_e.scrollTop+.6*me.height;this.DOM.selectDialog.style("top",xe+"px")}else this.setModel.select(ge);else this.setModel.deselect(ge);this.listScrollTransitionFlag=!0,defer((()=>{ge.folder?(this.parent.DOM.content.interrupt(),this.listScrollTransitionFlag=!1):xe<=0?(this.parent.DOM.content.interrupt(),_e.scrollTop=we,this.listScrollTransitionFlag=!1):this.parent.DOM.content.transition().duration(300).tween("scrollTopTween",function scrollTopTween(he){return function(){var ge=me.interpolateNumber(this.scrollTop,he);return function(he){this.scrollTop=ge(he)}}}(we)).on("end",(()=>{this.listScrollTransitionFlag=!1}))})),this.parent._clearSearch(),this.parent.updateSearch()})),ge.append("label").classed("vzb-disabled",this.parent.ui.disableFindInteractions).attr("for",((he,ge)=>he[Di]+"-find-"+ge+"-"+this.id)).on("mouseover",((he,ge)=>{isTouchDevice()||this.listScrollTransitionFlag||this.parent.ui.disableFindInteractions||this.setModel.highlight(ge)})).on("mouseout",((he,ge)=>{isTouchDevice()||this.listScrollTransitionFlag||this.parent.ui.disableFindInteractions||this.setModel.unhighlight(ge)})).each((function(){const he=me.select(this);he.append("span").attr("class","vzb-label").text((he=>he.name)).on("click",(function(he,ge){if(!ge.folder)return;he.stopPropagation(),he.preventDefault();const be=me.select(this.parentNode.parentNode);be.classed("vzb-item-opened")?(be.classed("vzb-item-opened",!1),be.selectAll(".vzb-item.vzb-item-folder").classed("vzb-item-opened",!1)):be.classed("vzb-item-opened",!0)})),he.append("span").attr("class","vzb-frame")})),ge.filter((he=>he.folder)).append("span").attr("class","vzb-folder-mark").on("click",(function(){const he=me.select(this.parentNode);he.classed("vzb-item-opened")?(he.classed("vzb-item-opened",!1),he.selectAll(".vzb-item.vzb-item-folder").classed("vzb-item-opened",!1)):he.classed("vzb-item-opened",!0)})),ge.append("span").attr("class","vzb-closecross").text("âï¸").classed("vzb-hidden",1===he).on("click",((he,ge)=>{this.setModel.unhighlight(ge),this.setModel.deselect(ge);const me=this._getPrimaryDim();this.model.data.filter.deleteUsingLimitedStructure({key:ge[Di],dim:me,prop:me}),this.parent._clearSearch(),this.parent.updateSearch()})),ge.each((function(ge){if(ge.folder){ge.children.sort(folderAndNameLocaleCompare);me.select(this).append("div").attr("class","vzb-item-children").selectAll("div").data(ge.children,(he=>he[Di])).join("div").attr("class",(he=>"vzb-item vzb-dialog-checkbox ".concat(he.folder?"vzb-item-folder":""))).call(be._createListItem.bind(be,he))}}))}updatemissingDataForCurrentFrame(){if(!this.listReady)return;this.entitiesWithMissingDataInAllFrames;const he=this.model.dataMap,ge=this.DOM.listItems;if(ge.data().length>1e3&&(this.MDL.frame.playing||(()=>this.root.findChild({type:"TimeSlider"}))().ui.dragging))return;ge.data().forEach((ge=>{ge.missingDataForFrame=!ge.missingData&&_getLeafChildren(ge).every((ge=>!he.hasByStr(ge[Di])))}));const be=this.localise(this.MDL.frame.value),ve=be+": "+this.localise("hints/nodata");ge.select("label").classed("vzb-find-item-missingDataForFrame",(he=>he.missingDataForFrame)).classed("vzb-find-item-missingData",(he=>he.missingData)).attr("title",(he=>"key: "+he[Di]+(he.missingDataForFrame?", "+ve:""))).each((function(he){me.select(this).select(".vzb-frame").text(he.missingDataForFrame?be:"")}))}example(){const he=this.parent.marksFromAllFrames;return he[Math.floor(Math.random()*he.length)].name}updateSelection(){if(!this.listReady)return;const he=this.MDL.selected.data.filter;this.DOM.listItems.select("input").property("checked",(function(ge){const be=he.has(ge);return me.select(this.parentNode).classed("vzb-checked",be),be})),this.DOM.listItems.filter(".vzb-item-folder").each((function(he){const ge=me.select(this),be=ge.selectAll(".vzb-checked").size(),ve=_getLeafChildrenCount(he);ge.select("input").property("checked",be).property("indeterminate",be&&be!=ve)})),sortItems(this.DOM.listItems.select(".vzb-item-children")),sortItems(this.DOM.list)}updateSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.listReady)return;let ge=0;const be=this.DOM.list.selectAll(".vzb-item:not(.vzb-item-folder)").each((function(be){const ve=me.select(this),_e=!(be.name||"").toString().toLowerCase().includes(he);ge+=+(he&&_e),ve.classed("vzb-hidden",he&&_e),ve.classed("vzb-item-insearch",he&&!_e)}));this.DOM.list.selectAll(".vzb-item-folder").classed("vzb-item-insearch",he),this.showHideHeader(be.size()-ge)}getListItemCount(){return this.DOM.list.selectAll(".vzb-item:not(.vzb-hidden)").size()}concludeSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";be.runInAction((()=>{const ge=this.parent.marksFromAllFrames.filter((ge=>(ge.name||"").toString().toLowerCase().includes(he)));1===ge.length&&(this.MDL.selected.data.filter.toggle(ge[0]),this.updateSearch())}))}_interact(){const he=this;return{clickToAddAllinGroup(ge){const me=he._getPrimaryDim(),be=ge.prop;he.model.data.filter.addUsingLimitedStructure({key:ge[Di],dim:me,prop:be})},clickToRemoveAllinGroup(ge){const me=he._getPrimaryDim(),be=ge.prop;he.model.data.filter.deleteUsingLimitedStructure({key:ge[Di],dim:me,prop:be})},clickToRemoveAllinOtherGroups(ge){const me=he._getPrimaryDim(),be=ge.prop,ve=[...he.drilldownValues.values()].filter((he=>he["is--"+ge.prop]&&he[Di]!==ge[Di]));he.model.data.filter.deleteUsingLimitedStructure({key:ve,dim:me,prop:be}),he.parent.DOM.content.node().scrollTop=0},disableSelectHover(){var ge,me;if(null!==(ge=he.root.ui.dialogs)&&void 0!==ge&&null!==(me=ge.markercontrols)&&void 0!==me&&me.disableFindInteractions)return!0},disableAddAll(){var ge,me;return null!==(ge=he.root.ui.dialogs)&&void 0!==ge&&null!==(me=ge.markercontrols)&&void 0!==me&&me.disableFindAddRemoveGroups,!0},disableRemoveAll(ge){var me,be;if(null!==(me=he.root.ui.dialogs)&&void 0!==me&&null!==(be=me.markercontrols)&&void 0!==be&&be.disableFindAddRemoveGroups)return!0;const ve=he.model.data.space[0],_e=ve;return he.model.data.filter.isAlreadyRemovedUsingLimitedStructure({key:_getLeafChildren(ge).map((he=>he[Di])),dim:ve,prop:_e})},disableRemoveAllinOtherGroups(){var ge,me;return!(null===(ge=he.root.ui.dialogs)||void 0===ge||null===(me=ge.markercontrols)||void 0===me||!me.disableFindAddRemoveGroups)},clickToSelect(ge){he.setModel.select(ge)}}}_initSelectDialog(){this.DOM.selectDialog.on("mouseleave",(()=>{this._closeSelectDialog()})),this.DOM.selectDialogTitle=this.DOM.selectDialog.select(".vzb-find-select-dialog-title"),this.DOM.selectDialogClose=this.DOM.selectDialog.select(".vzb-find-select-dialog-close"),this.DOM.selectDialogClose.html(Me).on("click",(()=>this._closeSelectDialog())),this.DOM.selectAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-item vzb-clickable"),this.DOM.addAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-item vzb-clickable"),this.DOM.removeAllinGroup=this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-item vzb-clickable"),this.DOM.removeAllinOtherGroups=this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-item vzb-clickable"),this.DOM.editColorButton=this.DOM.selectDialog.append("div").attr("class","vzb-find-select-dialog-item vzb-find-select-dialog-item-moreoptions"),this.DOM.editColorButton.append("label").attr("class","vzb-clickable").attr("for","vzb-find-select-dialog-color-"+this.id),this.DOM.editColorButton.append("input").attr("type","color").attr("class","vzb-invisible").attr("id","vzb-find-select-dialog-color-"+this.id),this.DOM.editColorButton.append("span").attr("class","vzb-clickable"),this.DOM.editColorButtonTooltip=this.DOM.editColorButton.append("div").attr("class","vzb-find-select-dialog-item-tooltip")}_updateUiStrings(he){const ge=this.localise;this.DOM.selectDialogTitle.text(he),this.DOM.selectAllinGroup.text("â "+ge("dialogs/color/select-all-in-group")+" "+he),this.DOM.addAllinGroup.text("â³ï¸ "+ge("dialogs/color/add-all-in-group")+" "+he),this.DOM.removeAllinGroup.text("ðï¸ "+ge("dialogs/color/remove-all-in-group")+" "+he),this.DOM.removeAllinOtherGroups.text("ð¯ "+ge("dialogs/color/remove-else")+" "+he),this.DOM.editColorButton.select("label").text("ð¨ "+ge("dialogs/color/edit-color")),this.DOM.editColorButton.select("span").text(ge("buttons/reset")),this.DOM.editColorButtonTooltip.text(ge("dialogs/color/edit-color-blocked-hint")+" "+(this.MDL.color.data.conceptProps.name||this.MDL.color.data.concept))}_closeSelectDialog(){this._selectDialogDatum&&this.setModel.unhighlight(this._selectDialogDatum),this._selectDialogDatum=null,this.DOM.selectDialog.classed("vzb-hidden",!0)}_bindSelectDialogItems(he){this._selectDialogDatum=he,this._updateUiStrings(he.name),this.DOM.selectAllinGroup.classed("vzb-hidden",(()=>this._interact().disableSelectHover(he))).on("click",(()=>{this._interact().clickToSelect(he),this._closeSelectDialog()})),this.DOM.addAllinGroup.classed("vzb-hidden",(()=>this._interact().disableAddAll(he))).on("click",(()=>{this._interact().clickToAddAllinGroup(he),this._closeSelectDialog()})),this.DOM.removeAllinGroup.classed("vzb-hidden",(()=>this._interact().disableRemoveAll(he))).on("click",(()=>{this._interact().clickToRemoveAllinGroup(he),this._closeSelectDialog()})),this.DOM.removeAllinOtherGroups.classed("vzb-hidden",(()=>this._interact().disableRemoveAllinOtherGroups(he))).on("click",(()=>{this._interact().clickToRemoveAllinOtherGroups(he),this._closeSelectDialog()})),this.DOM.editColorButtonTooltip.classed("vzb-hidden",!0),this.DOM.editColorButton.classed("vzb-hidden",!0)}},{MDL:be.computed,entitiesWithMissingDataInAllFrames:be.observable,listReady:be.observable,drilldownValues:be.observable.struct,listData:be.observable.struct}),Oi=Symbol.for("key");const Ci=be.decorate(class SectionAdd extends MarkerControlsSection{constructor(he){super(he)}setup(he){super.setup(he),this.DOM.matches=this.DOM.content.append("ul").attr("class","vzb-addgeo-matches"),this.catalog=[],this.allCatalog=[],this.entitySetsColorScale=me.scaleOrdinal(me.schemePastel2)}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.buildList)}updateSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.search(he)}concludeSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.search(he)}_getKey(he,ge,me){return me+"Â¬"+ge+"Â¬"+he}buildList(){this.DOM.title.text(this.localise("markercontrols/section/add")),this.model.encoding.label.data.spaceCatalog.then((he=>{const ge=[],me=[];for(const Le in he){var be,ve,_e,xe,we,Me,Se,De;if(this.parent.ui.primaryDim&&Le!==this.parent.ui.primaryDim)continue;const Ae=(null===(be=this.model.encoding)||void 0===be||null===(ve=be.show)||void 0===ve||null===(_e=ve.data)||void 0===_e||null===(xe=_e.filter)||void 0===xe||null===(we=xe.dimensions)||void 0===we?void 0:we[Le])||{},Ee=null===(Me=this.model.data.filter.dimensions)||void 0===Me||null===(Se=Me[Le])||void 0===Se||null===(De=Se.$or)||void 0===De?void 0:De[0],je=[];for(const he in Ee)he!=Le&&Ee[he].$in&&Ee[he].$in.forEach((ge=>{je.push(this._getKey(ge,he,Le))}));if(he[Le].entities){var ze,Oe,Ce,ke,Te;const be=(null===(ze=this.model.data.filter.dimensions)||void 0===ze||null===(Oe=ze[Le])||void 0===Oe||null===(Ce=Oe.$or)||void 0===Ce||null===(ke=Ce.find((he=>he[Le])))||void 0===ke||null===(Te=ke[Le])||void 0===Te?void 0:Te.$in)||[],ve=[...he[Le].entities.filter(Ae).values()].map((ge=>{const me=deepClone(ge);return me.isness=Object.keys(me).filter((he=>he.includes("is--")&&me[he])).map((ge=>{var me;const be=ge.replace("is--","");return{id:ge,name:null===(me=this.model.data.source.getConcept(be))||void 0===me?void 0:me.name,concept:be,isProp:he[Le].properties.hasOwnProperty(be)}})),me[Oi]=ge[Oi],me.dim=Le,me.prop=Le,me}));ge.push(...ve.filter((he=>!this.parent.dimMarkersData.has(he[Symbol.for("key")])&&!be.includes(he[Symbol.for("key")])))),this.parent.ui.disableAddRemoveGroups||me.push(...ve.reduce(((he,ge)=>{const me=ge.isness.filter((he=>he.isProp));return me.length&&me.forEach((me=>{je.includes(this._getKey(ge[Oi],me.concept,Le))||he.push({__allElements:!0,[Oi]:ge[Oi],name:ge.name,prop:me.concept,propName:me.name,dim:Le})})),he}),[]))}}this.catalog=ge,this.allCatalog=me,this.search()}))}example(){const he=this.catalog;return he[Math.floor(Math.random()*he.length)].name}search(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(he&&he.length<2)return this.DOM.matches.selectAll("li").remove(),this.DOM.matches.classed("vzb-hidden",!0),void this.showHideHeader();const ge=this.catalog.filter((ge=>ge.name.toLowerCase().trim().includes(he.toLowerCase().trim())||ge[Symbol.for("key")].includes(he.toLowerCase().trim()))).sort(((he,ge)=>me.ascending(he.isness.map((he=>he.id)).join(),ge.isness.map((he=>he.id)).join()))).concat(this.allCatalog.filter((ge=>ge.name.toLowerCase().trim().includes(he.toLowerCase().trim())||ge[Symbol.for("key")].includes(he.toLowerCase().trim()))).sort(((he,ge)=>me.ascending(he.propName,ge.propName))));this.DOM.matches.classed("vzb-hidden",!ge.length),this.DOM.matches.selectAll("li").remove(),this.DOM.matches.selectAll("li").data(ge).enter().append("li").html((he=>he.__allElements?"ALL "+this.localise("marker-plural/"+this.model.id.replace("-splash",""))+" where</br>"+he.propName+" = "+he.name:he.name+he.isness.map((he=>'<span class="vzb-dialog-isness" style="background-color:'.concat(this.entitySetsColorScale(he.id),'">').concat(he.name,"</span>"))).join(""))).on("click",((he,ge)=>{this.model.data.filter.addUsingLimitedStructure({key:ge[Oi],dim:ge.dim,prop:ge.prop}),this.concludeSearch()})).classed("vzb-dialog-all-entites",(he=>he.__allElements)),this.showHideHeader(ge.length)}},{}),ki=Symbol.for("key");const Ti=be.decorate(class SectionRemove extends MarkerControlsSection{constructor(he){super(he)}setup(he){super.setup(he),this.DOM.matches=this.DOM.content.append("ul").attr("class","vzb-remove-matches"),this.catalog=[],this.allCatalog=[]}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.createList)}updateSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.search(he)}concludeSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.search(he)}_getKey(he,ge,me){return me+"Â¬"+ge+"Â¬"+he}createList(){this.DOM.title.text(this.localise("markercontrols/section/remove")),this.model.encoding.label.data.spaceCatalog.then((he=>{const ge=[...this.parent.dimMarkersData.keys()],me=[];for(const Me in he){var be,ve,_e,xe,we;const Se=(null===(be=this.model.data.filter.dimensions)||void 0===be||null===(ve=be[Me])||void 0===ve||null===(_e=ve.$or)||void 0===_e||null===(xe=_e.find((he=>he[Me])))||void 0===xe||null===(we=xe[Me])||void 0===we?void 0:we.$in)||[];me.push(...Se.filter((he=>!ge.includes(he))).map((ge=>{if(he[Me].entities&&he[Me].entities.has(ge)){const me=he[Me].entities.get(ge);return{[ki]:me[ki],[Me]:me[Me],name:me.name,prop:Me,dim:Me}}return{[ki]:ge,[Me]:Me,name:ge,prop:Me,dim:Me}})))}this.catalog=[...this.parent.dimMarkersData.values(),...me];const Me=[];for(const ge in he){var Se;const me=(null===(Se=this.model.data.filter.dimensions)||void 0===Se?void 0:Se[ge])||{},be=[];for(const he in me)he!=ge&&me[he].$nin&&me[he].$nin.forEach((me=>{be.push(this._getKey(me,he,ge))}));const ve=he[ge].properties;if(ve)for(const he in ve){var De,ze;"entity_set"==(null===(De=ve[he])||void 0===De||null===(ze=De.concept)||void 0===ze?void 0:ze.concept_type)&&ve[he].entities.forEach(((me,_e)=>{be.includes(this._getKey(_e,he,ge))||Me.push({__allElements:!0,[ki]:_e,[ge]:he,name:me.name,prop:he,propName:ve[he].concept.name,dim:ge})}))}}this.parent.ui.disableAddRemoveGroups||(this.allCatalog=Me),this.search()}))}search(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(he&&he.length<2)return this.DOM.matches.selectAll("li").remove(),this.DOM.matches.classed("vzb-hidden",!0),void this.showHideHeader();const ge=this.catalog.filter((ge=>ge.name.toLowerCase().trim().includes(he.toLowerCase().trim())||ge[Symbol.for("key")].includes(he.toLowerCase().trim()))).sort(((he,ge)=>me.ascending(he.name,ge.name))).concat(this.allCatalog.filter((ge=>ge.name.toLowerCase().trim().includes(he.toLowerCase().trim())||ge[Symbol.for("key")].includes(he.toLowerCase().trim()))).sort(((he,ge)=>me.ascending(he.propName,ge.propName))));this.DOM.matches.classed("vzb-hidden",!ge.length),this.DOM.matches.selectAll("li").remove(),this.DOM.matches.selectAll("li").data(ge).enter().append("li").html((he=>he.__allElements?"ALL "+this.localise("marker-plural/"+this.model.id.replace("-splash",""))+" where</br>"+he.propName+" = "+he.name:he.name)).on("click",((he,ge)=>{this.model.data.filter.deleteUsingLimitedStructure({key:ge[ki],dim:ge.dim,prop:ge.prop}),this.concludeSearch()})).classed("vzb-dialog-all-entites",(he=>he.__allElements)),this.showHideHeader(ge.length)}},{});const Li=be.decorate(class SectionSwitch extends MarkerControlsSection{constructor(he){super(he)}setup(he){super.setup(he),this.DOM.list=this.DOM.content.append("div").attr("class","vzb-list"),this.DOM.hint=this.DOM.content.append("div").attr("class","vzb-hint"),this.items=[]}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.getListData),this.addReaction(this.createList)}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted}}getListData(){const getAvailabilitySize=(he,ge,me)=>{var be;const ve=this.MDL.frame.data.concept,_e="boolean"===me?[ge,ve]:[he,ve];return null===(be=this.model.data.source.availability.keyValueLookup.get((he=>he.toSorted().join("Â¬"))(_e)))||void 0===be?void 0:be.size},he=[];this.model.data.spaceCatalog.then((ge=>{for(const me in ge)if(ge[me].entities&&ge[me].properties){const be=ge[me].properties,ve=Object.keys(be).filter((he=>he.includes("is--")||"boolean"===be[he].concept.concept_type)).map((he=>he.replace("is--",""))).map((he=>({dim:me,concept:he,concept_type:this.model.data.source.getConcept(he).concept_type,name:this.model.data.source.getConcept(he).name||he,availabilitySize:getAvailabilitySize(he,me,this.model.data.source.getConcept(he).concept_type)}))).concat({dim:me,concept:me,concept_type:"entity_domain",name:this.model.data.source.getConcept(me).name,availabilitySize:getAvailabilitySize(me)}).filter((he=>he.availabilitySize)).toSorted(((he,ge)=>ge.availabilitySize-he.availabilitySize));he.push(ve)}this.items=he.flat()}))}isCurrentSetting(he){let{dim:ge,concept:me}=he;const be=this.model.data.filter.dimensions[ge];return!be&&ge===me||(be&&(be[me]||be["is--"+me]||be.$or&&be.$or.some((he=>he[me]||he["is--"+me])))||!1)}createList(){this.DOM.title.text(this.localise("markercontrols/section/switch"));const he=this.DOM.list;this.model.data.filter,this.DOM.listItems=he.selectAll("div").data(this.items,(he=>he.concept)).join((he=>he.append("div").attr("class","vzb-item").call((he=>{he.append("input").attr("type","radio").attr("id",(he=>this.id+"--"+he.concept)).attr("name",this.id+"--radiogroup").on("change",((he,ge)=>this.setFilter(ge))),he.append("label").attr("for",(he=>this.id+"--"+he.concept)).html((he=>{return"<span>".concat((ge=he.name,me=20,ge.length>me?ge.substr(0,me)+"â¦":ge),'</span> <span class="vzb-hint">').concat(he.availabilitySize?"("+he.availabilitySize+")":"","</span>");var ge,me}))}))),(he=>he.selectAll("input").property("checked",(he=>this.isCurrentSetting(he))))),this.DOM.hint.text(this.localise("markercontrols/section/switchNumberHint").replace("{{dataset}}",this.model.data.source.id))}example(){const he=this.items;return he[Math.floor(Math.random()*he.length)].name}setFilter(he){let{dim:ge,concept:me,concept_type:be}=he;const ve=this.model.data.filter.config.dimensions;if(!ve)return!1;ve[ge]=ge===me?null:{$or:[{["boolean"===be?me:"is--"+me]:!0}]}}updateSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",ge=0;const me=this.DOM.list.selectAll(".vzb-item").classed("vzb-hidden",(me=>{const be=he&&!me.name.toString().toLowerCase().includes(he);return ge+=+be,be})).classed("vzb-current-choice",(he=>this.isCurrentSetting(he)&&!this.parent.isFullscreenish()));this.showHideHeader(me.size()-ge),this.DOM.hint.classed("vzb-hidden",!(me.size()-ge))}concludeSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const ge=this.items.find((ge=>he&&ge.name.toString().toLowerCase().includes(he)&&!this.isCurrentSetting(ge)));ge&&this.setFilter(ge)}},{items:be.observable});function spacesAreEqual(he,ge){return he.toSorted().join()===ge.toSorted().join()}const longestFirst=(he,ge)=>ge.length-he.length,shortestFirst=(he,ge)=>he.length-ge.length;function removeDulicates(he){const ge=[];return he.forEach((he=>{ge.some((ge=>spacesAreEqual(ge.space,he.space)))||ge.push(he)})),ge}const Ai=be.decorate(class SectionSlice extends MarkerControlsSection{constructor(he){super(he),this.showAllEncs=!1,this.proposedSpace=null,this.goodToGo=!1}setup(he){super.setup(he),this.DOM.title.text("Slice by"),this.DOM.list=this.DOM.content.append("div").attr("class","vzb-list"),this.DOM.actionSummary=this.DOM.content.append("div").attr("class","vzb-spaceconfig-actionsummary"),this.DOM.encodings=this.DOM.content.append("div").attr("class","vzb-spaceconfig-encodings"),this.DOM.buttonShowAllEncs=this.DOM.content.append("div").attr("class","vzb-spaceconfig-showallencs").text("â¢â¢â¢").on("click",(()=>{this.showAllEncs=!this.showAllEncs})),this.DOM.buttons=this.DOM.content.append("div").attr("class","vzb-spaceconfig-buttons"),this.DOM.buttonapply=this.DOM.buttons.append("div").attr("class","vzb-spaceconfig-button-apply"),this.DOM.buttoncancel=this.DOM.buttons.append("div").attr("class","vzb-spaceconfig-button-cancel")}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.createList),this.addReaction(this.updateEncodigns),this.addReaction(this.updateUIstrings),this.addReaction(this.updateApplyCancelButtons)}get MDL(){return{frame:this.model.encoding.frame}}updateUIstrings(){this.DOM.buttoncancel.text("Cancel"),this.DOM.buttonapply.text("Apply")}_getMarkerSpaceAvailability(){const he=[],ge=["entity_domain","time"];this._getAllDataSources().forEach((me=>{me.availability.keyLookup.forEach((be=>{be.every((he=>ge.includes(me.getConcept(he).concept_type)))&&he.push({space:be,dsId:me.id})}))}));const me=this.model.data.space,be=this.MDL.frame.data.concept;return he.map((he=>({dsId:he.dsId,space:he.space.toSorted((he=>0===me.indexOf(he)?-1:-1===me.indexOf(he)?0:he===be?1:void 0))})))}createList(){this.proposedSpace;const he=this.MDL.frame.data.concept,ge=removeDulicates(this._getMarkerSpaceAvailability().filter((ge=>ge.space.includes(he))));this.DOM.list.selectAll("div").data(ge,this._getItemId).join((he=>he.append("div").attr("class","vzb-item").call((he=>{he.append("input").attr("type","radio").attr("id",this._getItemId).attr("name",this.id+"--radiogroup").on("change",((he,ge)=>{this._proposeSpace(ge)})),he.append("label").attr("for",this._getItemId).text(this._getText.bind(this))}))),(he=>he.select("input").property("checked",(he=>{var ge;return spacesAreEqual(he.space,(null===(ge=this.proposedSpace)||void 0===ge?void 0:ge.space)||this.model.data.space)}))))}_proposeSpace(he){this.parent.isFullscreenish()||this.parent.toggleFullscreenish(this),this.proposedSpace=he}getEncodings(){const he=this.model.encoding;return Object.keys(he).filter((he=>!(this.model.requiredEncodings&&!this.model.requiredEncodings.includes(he))||("color"==he||("label"==he||void 0))))}_getDataModels(he){return Object.keys(he).map((he=>this.services.Vizabi.Vizabi.stores.dataSources.get(he)))}_getAvailability(){const he=[];return this._getDataModels(this.root.model.config.dataSources).forEach((ge=>{ge.availability.data.forEach((me=>{he.push({key:me.key,value:ge.getConcept(me.value),source:ge})}))})),he}_conceptsCompatibleWithMarkerSpace(he,ge,me){const be=new Map,ve=new Set(ge);for(const[ge,{source:_e,spaces:xe}]of he){const he=[...xe].filter((he=>{const ge=(be=ve,he.filter((he=>be.has(he))));var be;const _e=he.length==ve.size,xe=ge.length==ve.size||ge.length==he.length;return me&&_e||!me&&xe}));he.length&&be.set(ge,{source:_e,spaces:he})}return be}_convertConceptMapToArray(he){return[...he].map((he=>{let[ge,{source:me,spaces:be}]=he;return{concept:ge,source:me,spaces:[...be]}}))}_nestAvailabilityByConcepts(he){return he.reduce(((he,ge)=>{const me=ge.value,be=ge.key;return he.has(me)||he.set(me,{source:ge.source,spaces:new Set}),he.get(me).spaces.add(be),he}),new Map)}updateEncodigns(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.proposedSpace;const ge=this,be=this.model.encoding,ve=this._nestAvailabilityByConcepts(this._getAvailability());this.concepts=this._convertConceptMapToArray(ve),this.encNewConfig={};const _e=this.getEncodings().map((me=>({enc:me,status:ge.getSpaceCompatibilityStatus(be[me],null==he?void 0:he.space)}))),isRequired=he=>!this.model.requiredEncodings||this.model.requiredEncodings.includes(he),xe=this.model.requiredEncodings&&this.model.requiredEncodings.length>0&&_e.every((he=>{let{enc:ge,status:me}=he;return"subspaceAvailable"===me.status||!isRequired(ge)})),we=_e.some((he=>{let{status:ge}=he;return ge.actionReqired})),Me=(null==he?void 0:he.space)&&spacesAreEqual(he.space,this.model.data.space);this.DOM.actionSummary.classed("vzb-hidden",!he).text(we?"Pls review the following:":xe?"Options below have no data for the chosen slicing. To proceed, switch at least one of them to a different variable, that has data "+ge._getText(he)+":":Me?"This is the current configuration":"Good to go!"),this.goodToGo=!we&&!xe&&!Me,this.DOM.encodings.html("").selectAll("div").data(_e,(he=>he.enc)).enter().append("div").attr("class","vzb-spaceconfig-enc").each((function(_e){let{enc:we,status:Me}=_e;const Se=me.select(this),De=be[we],ze=ge.concepts.find((he=>he.concept.concept==De.data.concept)),Oe=De.data.config.space,Ce=ge.encNewConfig[we]={},ke={status:Se.append("div").attr("class","vzb-spaceconfig-enc-status").attr("title",Me.status).classed("vzb-hidden",!ge.showAllEncs).text(ge.statusIcons(Me)),name:Se.append("div").attr("class","vzb-spaceconfig-enc-name").text(we),concept:Se.append("div").attr("class","vzb-spaceconfig-enc-concept"),spaceCurrent:Se.append("div").attr("for","vzb-spaceconfig-enc-space-current").classed("vzb-hidden",!ge.showAllEncs),spaceNew:Se.append("div").attr("for","vzb-spaceconfig-enc-space-new").classed("vzb-hidden",!ge.showAllEncs)};var Te,Le;De.data.isConstant?(ke.concept.text("constant: "+De.data.constant),ke.spaceCurrent.text("current space: none (constant value)")):(ke.concept.text((null==ze||null===(Te=ze.concept)||void 0===Te?void 0:Te.name)||De.data.concept),ke.spaceCurrent.text("current space: "+(null===(Le=De.data.space)||void 0===Le?void 0:Le.join())+(Oe?" (set)":" (inherited)")));if((!0!==Me.status||!1!==Me.status)&&("alreadyInSpace"!=Me.status&&"entityPropertyDataConfig"!=Me.status||(ke.spaceNew.text("new space: "+(Oe?" will reset to marker space":"no change")),Oe&&(Ce.space=null),De.data.config.filter&&(Ce.filter={})),"matchingSpaceAvailable"==Me.status&&(ke.spaceNew.text("new space: "+Me.spaces[0].join()+(Oe?" (set)":" (inherited)")),Oe&&(Ce.space=null),De.data.config.filter&&(Ce.filter={})),"subspaceAvailable"==Me.status&&(ke.spaceNew.text("new space: "+Me.spaces[0].join()+" (set)"),Ce.space=Me.spaces[0],De.data.config.filter&&(Ce.filter={})),"superspaceAvailable"==Me.status&&(ke.spaceNew.text("new space: "+Me.spaces[0].join()+" (set)"),Ce.space=Me.spaces[0],De.data.config.filter&&(Ce.filter={})),"patialOverlap"==Me.status||"noOverlap"==Me.status||xe&&isRequired(we))){ke.concept.classed("vzb-hidden",!0),ke.spaceNew.text("new space: not avaiable");const be=ge._conceptsCompatibleWithMarkerSpace(ve,he.space,xe&&isRequired(we)),_e=[ze].concat(ge._convertConceptMapToArray(be));Se.append("select").attr("class","vzb-spaceconfig-enc-concept-new").attr("id","vzb-spaceconfig-enc-space-select").on("change",(function(){ge.goodToGo=!0,Ce.concept=me.select(this).property("value"),Ce.space=null,Ce.filter={}})).selectAll("option").data(_e).enter().append("option").property("selected",(he=>he.concept.concept===ze.concept.concept)).property("disabled",(he=>he.concept.concept===ze.concept.concept)).attr("value",(he=>he.concept.concept)).text((he=>he.concept.name))}Se.classed("vzb-hidden",!(Me.actionReqired||ge.showAllEncs||xe&&isRequired(we)))}))}getSpaceCompatibilityStatus(he,ge){var me;const be=(null===(me=this.concepts.find((ge=>ge.concept.concept==he.data.concept)))||void 0===me?void 0:me.spaces)||[];if(!ge)return{status:!0,spaces:[]};if(he.data.isConstant)return{status:"constant"};if("entityPropertyDataConfig"==he.data.config.modelType)return{status:"entityPropertyDataConfig",spaces:[ge]};if(spacesAreEqual(he.data.space,ge))return{status:"alreadyInSpace",spaces:[ge]};if(function getMatchingSpace(he,ge){return he.find((he=>spacesAreEqual(he,ge)))}(be,ge))return{status:"matchingSpaceAvailable",spaces:[ge]};const ve=function getSubspaces(he,ge){return he.filter((he=>he.every((he=>ge.includes(he))))).toSorted(longestFirst)}(be,ge);if(ve.length>0)return{status:"subspaceAvailable",spaces:ve};const _e=function getSuperspaces(he,ge){return he.filter((he=>ge.every((ge=>he.includes(ge))))).toSorted(shortestFirst)}(be,ge);if(_e.length>0)return{status:"superspaceAvailable",spaces:_e};const xe=function getPartiallyOverlappingSpaces(he,ge){return he.filter((he=>ge.some((ge=>he.includes(ge))))).toSorted(shortestFirst)}(be,ge);return xe.length>0?{status:"patialOverlap",actionReqired:!0,spaces:[]}:0==xe.length?{status:"noOverlap",actionReqired:!0,spaces:[]}:{status:!1,spaces:[]}}statusIcons(he){return{true:"â«",constant:"â³ï¸",alreadyInSpace:"â",entityPropertyDataConfig:"ð·",matchingSpaceAvailable:"â©",subspaceAvailable:"ð½",superspaceAvailable:"ð¼",patialOverlap:"ð§",noOverlap:"ð§",false:"â"}[""+he.status]}example(){const he=this.MDL.frame.data.concept,ge=removeDulicates(this._getMarkerSpaceAvailability().filter((ge=>ge.space.includes(he)))),me=this.model.data.space;return ge.map((he=>he.space)).flat().filter((he=>!me.includes(he)))[0]||""}updateApplyCancelButtons(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.proposedSpace;const ge=!he||spacesAreEqual(he.space,this.model.data.space);this.DOM.buttoncancel.classed("vzb-hidden",ge).on("click",(()=>{this.cancelChanges()})),this.DOM.buttonapply.classed("vzb-hidden",ge).classed("vzb-disabled",!this.goodToGo).on("click",(()=>{this.applyChanges(he)}))}cancelChanges(){this.parent.toggleFullscreenish(),this.proposedSpace=null,this.showAllEncs=!1}applyChanges(he){he&&(be.runInAction((()=>{this.model.config.data.space=he.space,this.model.encoding.label.data.config.source=he.dsId,Object.keys(this.encNewConfig).forEach((he=>{const ge=this.encNewConfig[he];ge.concept&&(this.model.encoding[he].config.data.concept=ge.concept,this.model.encoding[he].config.scale.domain=null,this.model.encoding[he].config.scale.type=null,this.model.encoding[he].config.scale.zoomed=null,this.model.encoding[he].config.scale.palette={}),ge.space?this.model.encoding[he].config.data.space=ge.space:ge.hasOwnProperty("space")&&delete this.model.encoding[he].config.data.space,ge.filter?this.model.encoding[he].config.data.filter=ge.filter:ge.hasOwnProperty("filter")&&delete this.model.encoding[he].config.data.filter}))})),this.parent.toggleFullscreenish(),this.proposedSpace=null,this.showAllEncs=!1)}_getItemId(he){return this.id+"--radioitem--"+he.space.toSorted().join("-")}_getText(he){const ge=this._getAllDataSources();return he.space.map((he=>{var me;return(null===(me=ge.find((ge=>ge.getConcept(he))).getConcept(he))||void 0===me?void 0:me.name)||he})).map((he=>he.length>10?he.substring(0,10)+"â¦":he)).join(", ")}_getAllDataSources(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root.model.config.dataSources;return Object.keys(he).map((he=>this.services.Vizabi.Vizabi.stores.dataSources.get(he)))}updateSearch(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",ge=0;const me=this.DOM.list.selectAll(".vzb-item").classed("vzb-hidden",(me=>{const be=spacesAreEqual(me.space,this.model.data.space)&&!this.parent.isFullscreenish()||he&&!this._getText(me).toString().toLowerCase().includes(he)&&!me.space.includes(he);return ge+=+be,be}));this.showHideHeader(me.size()-ge)}},{MDL:be.computed,showAllEncs:be.observable,proposedSpace:be.observable,goodToGo:be.observable}),Ei=Symbol.for("key");class _MarkerControls extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="markercontrols" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="markercontrols" data-click="dragDialog"></span>\n        <div class="vzb-dialog-header">\n          <span class="vzb-dialog-title"></span>\n\n          <span class="vzb-dialog-content vzb-filter">\n            <form novalidate>\n              <input class="vzb-search" type="search" required/>\n              <button class="vzb-cancel-button" type="reset"></button>\n            </form>\n          </span>\n\n          <span class="vzb-info"></span>\n\n        </div>\n\n        <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n          <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-markercontrols vzb-active">\n            <div class="vzb-section vzb-find"></div>\n            <div class="vzb-section vzb-add"></div>\n            <div class="vzb-section vzb-remove"></div>\n            <div class="vzb-section vzb-switch"></div>\n            <div class="vzb-section vzb-slice"></div>\n          </div>\n        </div>\n\n        <div class="vzb-shortcutforswitch"></div>\n        <div class="vzb-dialog-buttons">\n          <div class="vzb-dialog-bubbleopacity vzb-dialog-control" data-panel="markercontrols"></div>\n          <div class="vzb-dialog-button vzb-deselect" data-panel="markercontrols">\n            <span data-localise="buttons/deselect"></span>\n          </div>\n\n          <div data-dialogtype="markercontrols" data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>  \n\n        <div class="vzb-info-popup vzb-hidden"></div>\n\n      </div>      \n    ',he.subcomponents=[{type:SingleHandleSlider,placeholder:".vzb-dialog-bubbleopacity",options:{value:"opacitySelectDim",submodel:"root.ui.chart"}},{type:zi,placeholder:".vzb-find"},{type:Ci,placeholder:".vzb-add"},{type:Ti,placeholder:".vzb-remove"},{type:ShortcutForSwitch,placeholder:".vzb-shortcutforswitch"}],he.default_ui.disableSwitch||he.subcomponents.push({type:Li,placeholder:".vzb-switch"}),he.default_ui.disableSlice||he.subcomponents.push({type:Ai,placeholder:".vzb-slice"}),super(he)}setup(he){super.setup(he),this.DOM.input_search=this.element.select(".vzb-search"),this.DOM.searchForm=this.element.select("form"),this.DOM.deselect_all=this.element.select(".vzb-deselect"),this.DOM.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.DOM.title=this.element.select(".vzb-dialog-title"),this.DOM.info=this.element.select(".vzb-info"),this.DOM.infoPopup=this.element.select(".vzb-info-popup"),this.sections=this.children.filter((he=>"MarkerControlsSection"===Object.getPrototypeOf(he.constructor).name)),this.sectionFind=this.children.find((he=>"SectionFind"===he.constructor.name)),this.magicCommands=this.sections.map((he=>he.magicCommand)),this._getSearchTerm=()=>{const he=this.DOM.input_search.node().value.trim().toLowerCase(),ge=this.magicCommands.find((ge=>he===ge||0===he.indexOf(ge+" ")))||!1;return{command:ge,arg:ge?he.replace(ge,"").trim():he}},this._clearSearch=()=>{this.DOM.input_search.node().value=""},this.DOM.input_search.on("keyup",(he=>{13==he.keyCode&&(this.concludeSearch(),this._clearSearch())})).on("input",(()=>{this.updateSearch()})),this.DOM.searchForm.on("reset",(()=>{this._clearSearch(),this.updateSearch()})).on("submit",(he=>(he.preventDefault(),!1))),setIcon(this.DOM.info,we).on("click",(he=>{this.toggleInfoPopup(),he.stopPropagation()})),this.DOM.infoPopup.on("click",(()=>{this.toggleInfoPopup(!1)})),this.DOM.dialog.on("click",(()=>{this.toggleInfoPopup(!1)})),this.DOM.deselect_all.on("click",(()=>this.MDL.selected.data.filter.clear()))}draw(){super.draw(),this.addReaction(this.showHideButtons),this.addReaction(this.updateSearch),this.addReaction(this.updateUIStrings)}updateUIStrings(){this.DOM.input_search.attr("placeholder",this.localise("placeholder/search")+"..."),this.DOM.title.text(this.localise("marker-plural/"+this.model.id.replace("-splash","")))}updateSearch(){let{command:he,arg:ge}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getSearchTerm();this.element.classed("vzb-clean-search",this.isCleanSearch()),this.sections.forEach((me=>{me.showHideSection(!he&&!ge&&"find"===me.magicCommand||!he&&!ge&&"add"===me.magicCommand&&this.sectionFind.getListItemCount()<10||he&&me.magicCommand===he||!he&&ge),me.updateSearch(ge)}))}toggleFullscreenish(he){const ge=this.isFullscreenish();this.element.classed("vzb-fullscreenish",!ge),this._clearSearch(),this.updateSearch({command:null==he?void 0:he.magicCommand})}isFullscreenish(){return this.element.classed("vzb-fullscreenish")}concludeSearch(){let{arg:he}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getSearchTerm();this.sections.forEach((ge=>ge.concludeSearch(he)))}isCleanSearch(){let{command:he,arg:ge}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getSearchTerm();return!he&&!ge}toggleInfoPopup(){var he,ge,me,be;let ve=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DOM.infoPopup.classed("vzb-hidden");if(this.DOM.infoPopup.classed("vzb-hidden",!ve),!ve)return;const _e=this.findChild({type:"SectionFind"}).example().toLowerCase().substr(0,5),xe=this.findChild({type:"SectionFind"}).example().toLowerCase().substr(0,7)+"...",we=this.findChild({type:"SectionAdd"}).example().toLowerCase().substr(0,7)+"...",Me=null===(he=this.findChild({type:"SectionSwitch"}))||void 0===he||null===(ge=he.example)||void 0===ge?void 0:ge.call(he).toLowerCase(),Se=null===(me=this.findChild({type:"SectionSlice"}))||void 0===me||null===(be=me.example)||void 0===be?void 0:be.call(me).toLowerCase(),De=[{text:this.localise("markercontrols/tips_header"),instruction:!0},{text:this.localise("markercontrols/tips_toptext"),instruction:!0},{action:_e,ellipsis:"..."},{text:this.localise("markercontrols/tips_middletext"),instruction:!0},{icon:"ð",action:"find",example:xe},{icon:"â",action:"add",example:we},{icon:"â",action:"remove",example:xe},{icon:"â¡ï¸",action:"switch",example:Me},{icon:"ð§©",action:"slice",example:Se}].filter((he=>!he.icon||he.example));this.DOM.infoPopup.selectAll("div").data(De,((he,ge)=>ge)).join("div").attr("class",(he=>he.instruction?"vzb-instruction":"vzb-clickable")).html((he=>'\n        <span class="vzb-icon">'.concat(he.icon||"",'</span> \n        <span class="vzb-action">').concat(he.action||he.text||"",'</span>\n        <span class = "vzb-ellipsis">').concat(he.ellipsis||"",'</span> \n        <span class="vzb-example">').concat(he.example||"","</span>"))).on("click",((he,ge)=>{ge.action&&(this.DOM.input_search.node().value=ge.action+(ge.example?" ":""),this.toggleInfoPopup(),this.updateSearch(),this.DOM.input_search.node().focus())}))}showHideButtons(){const he=this.MDL.selected.data.filter.any();this.DOM.deselect_all.classed("vzb-hidden",!he),this.DOM.opacity_nonselected.classed("vzb-hidden",!he),he&&be.runInAction((()=>{const he=this.findChild({type:"SingleHandleSlider"});he.updateSize(),he._updateView()}))}_closeClick(){}_getCompoundLabelText(he){const ge=this.model.data.space;return"object"==typeof he.label?Object.entries(he.label).filter((he=>{let[ge]=he;return ge!=this.MDL.frame.data.concept})).sort(((he,me)=>{let[be]=he,[ve]=me;return ge.indexOf(be)-ge.indexOf(ve)})).map((he=>{let[ge,me]=he;return isNumber(me)?ge+": "+me:me})).join(", "):null!=he.label?""+he.label:he[Ei]}get marksFromAllFrames(){const he=new Map,ge=this.model.data.space.filter((he=>he!==this.model.encoding.frame.data.concept));return this.model.getTransformedDataMap("filterRequired").each((me=>me.forEach(((me,be)=>{if(!he.has(be)){const ve={[Ei]:be,name:this._getCompoundLabelText(me),label:me.label||{}};ge.forEach((he=>ve[he]=me[he])),he.set(be,ve)}})))),[...he.values()]}get dimMarkersData(){const he=new Map;return(this.ui.primaryDim?[this.ui.primaryDim]:this.model.data.space.filter((he=>he!==this.model.encoding.frame.data.concept))).forEach((ge=>{this.marksFromAllFrames.forEach((me=>{const be=""+me[ge];he.has(be)||he.set(be,{[Ei]:be,name:me.label[ge],[ge]:me[ge],prop:ge,dim:ge})}))})),he}}_MarkerControls.DEFAULT_UI={disableSwitch:!1,disableSlice:!1};const ji=be.decorate(_MarkerControls,{marksFromAllFrames:be.computed,dimMarkersData:be.computed});an.add("markercontrols",ji);class Opacity extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <div class="vzb-dialog-title"> \n          <span data-localise="buttons/opacity"></span>\n        </div>\n            \n        <div class="vzb-dialog-content">\n          <p class="vzb-dialog-sublabel">\n            <span data-localise="buttons/opacityRegular"></span>\n          </p>\n          <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n          <p class="vzb-dialog-sublabel">\n            <span data-localise="buttons/opacityNonselect"></span>\n          </p>\n          <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n          </div>\n        </div>\n\n      </div>\n    ',he.subcomponents=[{type:SingleHandleSlider,placeholder:".vzb-dialog-bubbleopacity-regular",options:{value:"opacityRegular",submodel:"root.ui.chart"}},{type:SingleHandleSlider,placeholder:".vzb-dialog-bubbleopacity-selectdim",options:{value:"opacitySelectDim",submodel:"root.ui.chart"}}],super(he)}}an.add("opacity",Opacity);class Presentation extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <div class="vzb-dialog-title"> \n          <span data-localise="dialogs/presentation"></span>\n        </div>\n\n        <div class="vzb-dialog-content">\n          <div class="vzb-presentationmode-switch"></div>\n          <div class="vzb-decorations-switch"></div>\n          <div class="vzb-time-background-switch"></div>\n          <div class="vzb-titles-switch"></div>\n          <div class="vzb-time-trails-switch"></div>\n          <div class="vzb-overhang-switch"></div>\n          <div class="vzb-format-si-prefix-switch"></div>\n        </div>\n\n      </div>\n    ',he.subcomponents=[{type:SimpleCheckbox,placeholder:".vzb-presentationmode-switch",options:{checkbox:"projector",submodel:"services.layout"}},{type:SimpleCheckbox,placeholder:".vzb-decorations-switch",options:{checkbox:"enabled",prefix:"decorations",submodel:"root.ui.chart.decorations"}},{type:SimpleCheckbox,placeholder:".vzb-time-background-switch",options:{checkbox:"timeInBackground",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-titles-switch",options:{checkbox:"showTitles",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-time-trails-switch",options:{checkbox:"timeInTrails",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-overhang-switch",options:{checkbox:"overhang",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-format-si-prefix-switch",options:{checkbox:"shortNumberFormat",submodel:"root.services.locale"}}],super(he)}}an.add("presentation",Presentation);class MoreOptions extends an{constructor(he){const{moreoptions:ge=[],popup:me=[]}=he.parent.ui.dialogs,be=[],ve=[{type:OptionsButtonList,placeholder:".vzb-dialog-options-buttonlist"}];(!0===ge?me:ge).forEach((ge=>{ve.push({type:an.get(ge),placeholder:'.vzb-dialogs-dialog[data-dlg="'+ge+'"]',model:he.model,name:ge}),be.push('<div data-dlg="'.concat(ge,'" class="vzb-dialogs-dialog  vzb-moreoptions vzb-accordion-section"></div>'))})),he.subcomponents=ve,he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n        <div class="vzb-dialog-title">\n          <span></span>\n        </div>\n\n        <div class="vzb-dialog-content vzb-dialog-scrollable">\n          <div class=\'vzb-dialog-options-buttonlist\'>\n          </div>\n          <div class="vzb-accordion">\n            '.concat(be.join("\n"),'\n          </div>\n        </div>\n\n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span></span>\n          </div>\n        </div>\n\n      </div>\n    '),super(he)}setup(he){super.setup(he),this.element.on("custom-dragend",(()=>{this._setMaxHeight()}));const ge=this;if(this.DOM.accordion=this.DOM.content.select(".vzb-accordion"),this.DOM.accordion){const he=this.DOM.accordion.selectAll(".vzb-accordion-section");he.data(this.children.slice(1).map((he=>({name:he.name}))));he.select(".vzb-dialog-title>span:first-child").on("click",((he,me)=>{const be=ge.findChild({name:me.name}).element,ve=ge.DOM.accordion.select(".vzb-accordion-active");ve&&ve.classed("vzb-accordion-active",!1),be.node()!==ve.node()&&(be.classed("vzb-accordion-active",!0),ge.transitionEvents.forEach((he=>{be.on(he,(()=>{ge.transitionEvents.forEach((he=>{be.on(he,null)}))}))})))}))}}draw(){super.draw(),this.DOM.title.select("span").text(this.localise("buttons/more_options")),this.DOM.buttons.select("span").text(this.localise("buttons/ok"))}}an.add("moreoptions",MoreOptions);class Size extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n        <div class="vzb-dialog-title"> \n          <span data-localise="buttons/size"></span>\n          <div class="vzb-dialog-bubblesize"></div>\n          <span class="vzb-saxis-selector"></span>\n        </div>\n        <div class="vzb-dialog-content">\n          <span class="vzb-dialog-subtitle"></span>\n        </div>\n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n      </div>    \n    ',he.subcomponents=[{type:IndicatorPicker,placeholder:".vzb-saxis-selector",options:{submodel:"encoding",targetProp:"size",showHoverValues:!0}},{type:BubbleSize,placeholder:".vzb-dialog-bubblesize",options:{showArcs:!0,submodelFunc:()=>this.model.encoding.size.scale}}],super(he)}draw(){super.draw(),this.addReaction(this._updateSubtitle)}_updateSubtitle(){const he=this.model.encoding.size.data.conceptProps,ge=getSubtitle(null==he?void 0:he.name,null==he?void 0:he.name_short);this.element.select(".vzb-dialog-subtitle").text(ge||"")}}an.add("size",Size);const Ri=be.decorate(class Speed extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <div class="vzb-dialog-title"> \n            <span data-localise="buttons/time"></span>\n        </div>\n            \n        <div class="vzb-dialog-content">\n          <p class="vzb-dialog-sublabel">\n            <span data-localise="hints/speed"></span>\n          </p>\n            \n          <form class="vzb-dialog-paragraph">\n            <div class="vzb-speed-slider"></div>\n          </form>\n          \n          <p class="vzb-dialog-sublabel">\n            <span data-localise="hints/forecastoptions"></span>\n          </p>\n\n          <form class="vzb-dialog-paragraph">\n            <div class="vzb-showforecast-switch"></div>\n            <div class="vzb-pausebeforeforecast-switch"></div>\n            <div class="vzb-showstripedpatternwhenforecast-switch"></div>\n            <div>\n              <span data-localise="hints/endbeforeforecast"></span>\n              <input type="text" class="vzb-endbeforeforecast-field" name="endbeforeforecast"/>\n            </div>\n            <div>\n              <span class="vzb-timeformatexample-hint" data-localise="hints/timeformatexample"></span>\n              <span class="vzb-timeformatexample-label"></span>\n            </div>\n          </form>\n\n          <p class="vzb-dialog-sublabel">\n          <span data-localise="hints/sparsedata"></span>\n          </p>\n\n          <form class="vzb-dialog-paragraph">\n            <span class="vzb-extrapolate-hint"></span>\n            <div class="vzb-extrapolate-slider"></div>\n          </form>\n        </div>\n      </div>  \n    ',he.subcomponents=[{type:SingleHandleSlider,placeholder:".vzb-speed-slider",options:{value:"speed",setValueFunc:"setSpeed",domain:[1200,900,450,200,150,100],ROUND_DIGITS:0,submodel:"model.encoding.frame"}},{type:SimpleCheckbox,placeholder:".vzb-showforecast-switch",options:{checkbox:"showForecast",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-pausebeforeforecast-switch",options:{checkbox:"pauseBeforeForecast",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-showstripedpatternwhenforecast-switch",options:{checkbox:"showForecastOverlay",submodel:"root.ui.chart"}},{type:SingleHandleSlider,placeholder:".vzb-extrapolate-slider",name:"extrapolate-slider",options:{value:"extrapolate",setValueFunc:"setExtrapolate",domain:me.range(100),ROUND_DIGITS:0,submodel:"model.encoding.frame"}}],super(he)}setup(){this.DOM={timeFormatExample:this.element.select(".vzb-timeformatexample-label"),forecastField:this.element.select(".vzb-endbeforeforecast-field"),extrapolateHint:this.element.select(".vzb-extrapolate-hint")};const he=this;this.DOM.forecastField.on("keypress",(function(he){13!=he.charCode&&13!=he.keyCode||(he.preventDefault(),this.blur())})).on("change",(function(){const ge=he.MDL.frame.parseValue(this.value);isDate(ge)&&(he.root.ui.chart.endBeforeForecast=this.value)}))}get MDL(){return{frame:this.model.encoding.frame}}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.updateForecastField),this.addReaction(this.updateExtrapolateSlider)}updateForecastField(){this.DOM.forecastField.property("value",this.localise(this.root.ui.chart.endBeforeForecast)),this.DOM.timeFormatExample.text(this.localise(new Date))}updateExtrapolateSlider(){const he=this.MDL.frame.stepCount<=2?2:this.MDL.frame.stepCount;this.findChild({name:"extrapolate-slider"})._setDomain(me.range(he));const ge=this.MDL.frame.extrapolate?this.localise("hints/extendDataNSteps").replace("{n}",this.MDL.frame.extrapolate):this.localise("hints/dontExtendData");this.DOM.extrapolateHint.text(ge).attr("title",this.localise("hints/extrapolation"))}},{MDL:be.computed});an.add("speed",Ri);const Fi=be.decorate(class Repeat extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n\n        <div class="vzb-dialog-title"> \n          <span data-localise="buttons/repeat"></span>\n        </div>\n\n        <div class="vzb-dialog-content">\n          <div class="vzb-repeat-header">\n            <div class="vzb-useConnectedRowsAndColumns-switch"></div>\n          </div>\n          <div class="vzb-repeat-body">\n            <div class="vzb-repeat-grid"></div>\n          </div>\n        </div>\n    \n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span data-localise="buttons/ok"></span>\n          </div>\n        </div>\n      </div>\n    ',he.subcomponents=[{type:SimpleCheckbox,placeholder:".vzb-useConnectedRowsAndColumns-switch",options:{checkbox:"useConnectedRowsAndColumns",submodelFunc:()=>this.MDL.repeat,setCheckboxFunc:he=>this.MDL.repeat.config.useConnectedRowsAndColumns=he}}],super(he)}setup(he){super.setup(he),this.DOM.header=this.element.select(".vzb-repeat-header"),this.DOM.body=this.element.select(".vzb-repeat-body"),this.DOM.grid=this.element.select(".vzb-repeat-grid")}get MDL(){return{repeat:this.model.encoding.repeat}}draw(){super.draw(),this.addReaction(this.drawHeader),this.addReaction(this.drawBody)}drawHeader(){const he=this.DOM.header,ge=this.services.locale.auto(),{allowEnc:me,row:be,column:ve,useConnectedRowsAndColumns:_e}=this.MDL.repeat;he.selectAll("p").remove(),he.insert("p","div").attr("class","vzb-dialog-sublabel").html(ge("hint/repeat/addremovecharts")),he.select(".vzb-useConnectedRowsAndColumns-switch").classed("vzb-hidden",!(be&&be.length&&ve&&ve.length&&2===me.length)),_e&&(he.append("p").html(me[0]+" "+ge("hint/repeat/issharedacrossrows")),he.append("p").html(me[1]+" "+ge("hint/repeat/issharedacroscolumns")))}drawBody(){const{rowcolumn:he,ncolumns:ge,nrows:be}=this.MDL.repeat,ve=this.MDL.repeat,_e=this.services.locale.auto();this.DOM.grid.style("grid-template-rows","1fr ".repeat(be)+"30px").style("grid-template-columns","1fr ".repeat(ge)+"30px"),this.DOM.grid.selectAll("div").remove(),this.DOM.grid.selectAll("div").data(he,(he=>ve.getName(he))).enter().append("div").attr("class","vzb-repeat-segment").attr("title",(he=>JSON.stringify(he,null,1))).style("grid-row-start",((he,ge)=>ve.getRowIndex(ge)+1)).style("grid-column-start",((he,ge)=>ve.getColumnIndex(ge)+1)).html((()=>1==ge&&1==be?_e("hint/repeat/pressplus"):"")).on("mouseover",((he,ge)=>{this.root.element.select(".vzb-"+ve.getName(ge)).classed("vzb-chart-highlight",!0)})).on("mouseout",((he,ge)=>{this.root.element.select(".vzb-"+ve.getName(ge)).classed("vzb-chart-highlight",!1)})),ge>1&&this.DOM.grid.selectAll("div.vzb-repeat-removecolumn").data(me.range(ge)).enter().append("div").attr("class","vzb-repeat-removecolumn").html("âï¸").style("grid-column-start",((he,ge)=>ge+1)).on("click",((ge,me)=>{this._remove("column",me),this._clearHoverClasses(he)})).on("mouseover",((me,be)=>{he.forEach(((he,me)=>{me%ge==be&&this.root.element.select(".vzb-"+ve.getName(he)).classed("vzb-chart-removepreview",!0)}))})).on("mouseout",(()=>{this._clearHoverClasses(he,"vzb-chart-removepreview")})),be>1&&this.DOM.grid.selectAll("div.vzb-repeat-removerow").data(me.range(be)).enter().append("div").attr("class","vzb-repeat-removerow").html("âï¸").style("grid-row-start",((he,ge)=>ge+1)).on("click",((ge,me)=>{this._remove("row",me),this._clearHoverClasses(he)})).on("mouseover",((me,be)=>{he.forEach(((he,me)=>{Math.floor(me/ge)==be&&this.root.element.select(".vzb-"+ve.getName(he)).classed("vzb-chart-removepreview",!0)}))})).on("mouseout",(()=>{this._clearHoverClasses(he,"vzb-chart-removepreview")})),this.DOM.grid.append("div").attr("class","vzb-repeat-addcolumn").html("â").style("grid-row-start",1).style("grid-row-end",be+1).style("grid-column-start",ge+1).on("click",(()=>{this._createNew("column"),this._clearHoverClasses(he)})).on("mouseover",(()=>{he.forEach(((he,me)=>{(me+1)%ge==0&&this.root.element.select(".vzb-"+ve.getName(he)).classed("vzb-chart-addrightpreview",!0)}))})).on("mouseout",(()=>{this._clearHoverClasses(he,"vzb-chart-addrightpreview")})),this.DOM.grid.append("div").attr("class","vzb-repeat-addrow").html("â").style("grid-row-start",be+1).style("grid-column-start",1).style("grid-column-end",ge+1).on("click",(()=>{this._createNew("row"),this._clearHoverClasses(he)})).on("mouseover",(()=>{he.forEach(((he,me)=>{Math.floor(me/ge)+1==be&&this.root.element.select(".vzb-"+ve.getName(he)).classed("vzb-chart-addbelowpreview",!0)}))})).on("mouseout",(()=>{this._clearHoverClasses(he,"vzb-chart-addbelowpreview")}))}_clearHoverClasses(he,ge){he.forEach((he=>{const me=this.root.element.select(".vzb-"+this.MDL.repeat.getName(he));ge&&"vzb-chart-highlight"!=ge||me.classed("vzb-chart-highlight",!1),ge&&"vzb-chart-removepreview"!=ge||me.classed("vzb-chart-removepreview",!1),ge&&"vzb-chart-addbelowpreview"!=ge||me.classed("vzb-chart-addbelowpreview",!1),ge&&"vzb-chart-addrightpreview"!=ge||me.classed("vzb-chart-addrightpreview",!1)}))}_remove(he,ge){if("row"!==he&&"column"!==he)return console.error("incorrect use of function _remove in repeat dialog");const{ncolumns:me,nrows:ve,useConnectedRowsAndColumns:_e}=this.MDL.repeat;be.runInAction((()=>{if(_e)this.MDL.repeat.config[he].splice(ge,1);else{if("column"==he){for(let he=1;he<=ve;he++)this.MDL.repeat.config.rowcolumn.splice(he*ge,1);this.MDL.repeat.config.ncolumns=me-1}"row"==he&&this.MDL.repeat.config.rowcolumn.splice(me*ge,me)}}))}_createNew(he){if("row"!==he&&"column"!==he)return console.error("incorrect use of function _createNew in repeat dialog");const{ncolumns:ge,nrows:me,allowEnc:ve,useConnectedRowsAndColumns:_e}=this.MDL.repeat;be.runInAction((()=>{if(_e){const ge=this._generateEncodingNames(he);this.model.config.encoding[ge]={data:this._getConceptAndSourceAndSpaceOfLast(he)},this.MDL.repeat.config[he].push(ge)}else{if(this.MDL.repeat.config.rowcolumn=this.MDL.repeat.rowcolumn,"column"==he){for(let he=1;he<=me;he++){const me=this._generateEncodingNames();ve.forEach((he=>{this.model.config.encoding[me[he]]={data:this._getConceptAndSourceAndSpaceOfLast(he)}})),this.MDL.repeat.config.rowcolumn.splice(he*ge,0,me)}this.MDL.repeat.config.ncolumns=ge+1}if("row"==he)for(let he=1;he<=ge;he++){const he=this._generateEncodingNames();ve.forEach((ge=>{this.model.config.encoding[he[ge]]={data:this._getConceptAndSourceAndSpaceOfLast(ge)}})),this.MDL.repeat.config.rowcolumn.push(he)}}}))}_getConceptAndSourceAndSpaceOfLast(he){const{rowcolumn:ge,allowEnc:me}=this.MDL.repeat;let be=he;return"row"==he&&(be=me[0]),"column"==he&&(be=me[1]),ge.map((he=>{var ge;return null===(ge=this.model.encoding[he[be]])||void 0===ge?void 0:ge.data})).filter((he=>null==he?void 0:he.concept)).map((he=>Object.assign({concept:he.concept},he.config.source?{source:he.config.source}:{},he.config.space?{space:he.config.space.slice(0)}:{}))).at(-1)||{concept:"population_total"}}_generateEncodingNames(he){const{allowEnc:ge}=this.MDL.repeat;return"row"==he?this._generateEncodingName(ge[0]):"column"==he?this._generateEncodingName(ge[1]):ge.reduce(((he,ge)=>(he[ge]=this._generateEncodingName(ge),he)),{})}_generateEncodingName(he){const{rowcolumn:ge}=this.MDL.repeat,be=he;return be+(me.max(ge.map((ge=>+ge[he].replace(be,"")||0)))+1)}},{MDL:be.computed});an.add("repeat",Fi);class TimeDisplay extends an{constructor(he){he.template='\n      <div class="vzb-dialog-modal">\n        <div class="vzb-dialog-title"></div>\n        <div class="vzb-dialog-content vzb-dialog-content-fixed"></div>\n        <div class="vzb-dialog-buttons"></div>\n      </div>',he.subcomponents=[{type:tn,placeholder:".vzb-dialog-content"}],super(he)}}an.add("timedisplay",TimeDisplay);class Technical extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <div class="vzb-dialog-title"> \n          <span data-localise="dialogs/technical"></span>\n        </div>\n\n        <div class="vzb-dialog-content">\n          <div class="vzb-advancedshowandselect-switch"></div>\n          <div class="vzb-advancedmarkerspace-switch"></div>\n          <div class="vzb-showdatasources-switch"></div>\n        </div>\n\n      </div>\n    ',he.subcomponents=[{type:SimpleCheckbox,placeholder:".vzb-showdatasources-switch",options:{checkbox:"showDataSources",submodelFunc:()=>this.root.findChild({name:"tree-menu"}).ui}}],super(he)}}an.add("technical",Technical);class Zoom extends an{constructor(he){he.template='\n      <div class=\'vzb-dialog-modal\'>\n        <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n        <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n        <div class="vzb-dialog-title"> \n          <span></span>\n          <div class="vzb-dialog-zoom-buttonlist"></div>\n        </div>\n            \n            \n        <div class="vzb-dialog-content">\n          <div class="vzb-panwitharrow-switch"></div>\n          <div class="vzb-zoomonscrolling-switch"></div>\n          <div class="vzb-adaptminmaxzoom-switch"></div>\n        </div>\n      \n        <div class="vzb-dialog-buttons">\n          <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <span><span/>\n          </div>\n        </div>\n      \n      </div>    \n    ',he.subcomponents=[{type:ZoomButtonList,placeholder:".vzb-dialog-zoom-buttonlist"},{type:SimpleCheckbox,placeholder:".vzb-panwitharrow-switch",options:{checkbox:"panWithArrow",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-zoomonscrolling-switch",options:{checkbox:"zoomOnScrolling",submodel:"root.ui.chart"}},{type:SimpleCheckbox,placeholder:".vzb-adaptminmaxzoom-switch",options:{checkbox:"adaptMinMaxZoom",submodel:"root.ui.chart"}}],super(he)}draw(){super.draw(),this.DOM.title.select("span").text(this.localise("buttons/zoom")),this.DOM.buttons.select("span").text(this.localise("buttons/ok"))}}an.add("zoom",Zoom),ge.About=About,ge.AddGeo=Ye,ge.Axes=Axes,ge.BaseComponent=Ve,ge.BaseService=BaseService,ge.BrushSlider=Ze,ge.BubbleSize=BubbleSize,ge.Button=Button,ge.ButtonList=ButtonList,ge.CapitalVizabiService=class CapitalVizabiService extends BaseService{setup(){this.Vizabi=this.config.Vizabi}deconstruct(){delete this.Vizabi}},ge.Chart=Chart,ge.ColorLegend=sn,ge.Colors=Colors,ge.DataNotes=class DataNotes extends Ve{constructor(he){super(he)}setup(){this.state={},this.DOM={},this.hidden=!0,this.showNotes=!1,this.pinned=!1,this.left=0,this.top=0,this.encoding=null,this.element.classed("vzb-hidden",this.hidden),this.element.append("div").html(Me).on("click",(he=>{he.stopPropagation(),this.close()})).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),this.element.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),this.element.append("div").attr("class","vzb-data-notes-link")}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.setValues),this.addReaction(this.resize)}resize(){this.services.layout.size,this.close()}setEncoding(he){return this.encoding=he,this.setValues(),this}setValues(){if(!this.encoding)return;const{description:he,source_url:ge,source:me}=this.encoding.data.conceptProps;this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!he).text(replaceNumberSpacesToNonBreak(he));const be=this.localise("hints/source");this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!ge).html("<span>"+(me?be+": ":"")+'<a href="'+normaliseLink(ge)+'" target="_blank">'+(me||be)+"</a></span>"),this.showNotes=ge||he}setPos(he,ge,me){if(this.left=he,this.top=ge,this.pinned&&!me)return this;const be=this.parent.element.node().offsetHeight,ve=this.element.node().offsetWidth,_e=this.element.node().offsetHeight;let xe,we,Me=this.left-ve,Se=this.top;return Me<10&&(Me=10,xe=!0),Se+_e+10>be&&(Se=be-_e-10,we=!0),xe&&we&&(Se=this.top-_e-30),this.element.style("top",Se+"px"),this.element.style("left",Me+"px"),this}pin(he){return this.hidden?this:(this.pinned=!this.pinned,null!=he&&(this.pinned=he),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!this.pinned),this.element.classed("vzb-data-notes-pinned",this.pinned),this.element.select(".vzb-data-notes-body").node().scrollTop=0,this.showNotes?this.setPos(this.left,this.top,!0):this.hide())}toggle(he){return this.pinned||(null==he&&(he=!this.hidden),this.hidden=he,this.element.classed("vzb-hidden",this.hidden||!this.showNotes)),this}show(){return this.toggle(!1)}hide(){return this.toggle(!0)}close(){this.hidden||this.pin(!1).hide()}},ge.DataWarning=Qe,ge.DateTimeBackground=tn,ge.DeepLeaf=DeepLeaf,ge.Dialog=an,ge.Dialogs=class Dialogs extends Ve{constructor(he){const{sidebar:ge=[],popup:me=[]}=deepExtend(deepExtend({},he.ui.dialogs),he.default_ui.dialogs),be=[],ve=[];unique([...ge,...me]).forEach((ge=>{be.push({type:an.get(ge),placeholder:'.vzb-dialogs-dialog[data-dlg="'+ge+'"]',model:he.model,name:ge}),ve.push('<div data-dlg="'.concat(ge,'" class="vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"></div>'))})),he.subcomponents=be,he.template=ve.join("\n"),super(he)}setup(){this.DOM={};const he=this;this._curr_dialog_index=20,this.element.selectAll(".vzb-top-dialog").data(this.children.map((he=>({name:he.name})))).on("custom-dragstart",(function(ge,me){he.bringForward(me.name)})).select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']").on("click",((he,ge)=>{this.toggleDialogOpen(ge.name,!1)}))}draw(){this._buttonList=this.root.findChild({type:"ButtonList"}),this._buttonList||console.warn("Dialogs was unable to find a subcomponent of type 'ButtonList' in root component. Could be that index.js of a tool is lacking a configuration.")}resize(){const he=this,ge=this.services.layout.profile;this.children.forEach((me=>{const be=me.element;let ve=be.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"LARGE"===ge&&he.ui.dialogs.sidebar.indexOf(me.name)>-1?(ve+=he._buttonList.ui.sidebarCollapse?" vzb-popup":" vzb-sidebar",he._buttonList.ui.sidebarCollapse||be.style("z-index",null)):he.ui.dialogs.popup.indexOf(me.name)>-1&&(ve+=" vzb-popup"),be.attr("class",ve)}))}toggleDialogOpen(he,ge){be.runInAction((()=>{const me=this.findChild({name:he});if(!me)return;const be=ge||!me.getOpen();me.setOpen(be),be?this.openDialog(he):this.closeDialog(he)}))}openDialog(he){const ge="SMALL"===this.services.layout.profile;this.closeAllDialogs(ge);const me=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+he+"']");this._active_comp=this.findChild({name:he}),this._active_comp.beforeOpen(),me.classed(ln,!0),this.bringForward(he),this._active_comp.open()}closeDialog(he){const ge=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+he+"']");this._active_comp=this.findChild({name:he}),this._active_comp&&!this._active_comp.isOpen||(this._active_comp.getPin()&&this._active_comp.setPin(!1),this._active_comp&&this._active_comp.beforeClose(),ge.classed(ln,!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)}closeAllDialogs(he){const ge=this,me=he?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)";this.element.selectAll(me).each((he=>{ge.toggleDialogOpen(he.name)}))}bringForward(he){this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+he+"']").style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10}},ge.ErrorMessage=un,ge.Facet=dn,ge.Find=Si,ge.Icons=Le,ge.IndicatorPicker=IndicatorPicker,ge.Label=Label,ge.LabelSizeHelper=yi,ge.Labels=gn,ge.LayoutService=Ne,ge.LegacyUtils=Ee,ge.LocaleService=He,ge.MarkerControls=ji,ge.MarkerControlsSection=MarkerControlsSection,ge.Menu=Menu,ge.MinMaxInputs=vn,ge.MoreOptions=MoreOptions,ge.Opacity=Opacity,ge.OptionsButtonList=OptionsButtonList,ge.PlayButton=PlayButton,ge.Presentation=Presentation,ge.Repeat=Fi,ge.Repeater=mn,ge.SectionAdd=Ci,ge.SectionFind=zi,ge.SectionRemove=Ti,ge.SectionSlice=Ai,ge.SectionSwitch=Li,ge.ShortcutForSwitch=ShortcutForSwitch,ge.Show=Show,ge.SimpleCheckbox=SimpleCheckbox,ge.SingleHandleSlider=SingleHandleSlider,ge.Size=Size,ge.SizeSlider=SizeSlider,ge.SpaceConfig=_n,ge.Speed=Ri,ge.SteppedSlider=gi,ge.Technical=Technical,ge.TextEllipsis=Fe,ge.TimeDisplay=TimeDisplay,ge.TimeSlider=Sn,ge.TreeMenu=class TreeMenu extends Ve{constructor(he){super(he)}indicatorsTree(he){return arguments.length?(this._indicatorsTree=he,this):this._indicatorsTree}callback(he){return arguments.length?(this._callback=he,this):this._callback}encoding(he){return arguments.length?(this._encoding=he,this.targetModel(this.model.encoding[this._encoding]),this):this._encoding}showWhenReady(he){return arguments.length?(this._showWhenReady=he,this):this._showWhenReady}scaletypeSelectorDisabled(he){return arguments.length?(this._scaletypeSelectorDisabled=he,this):this._scaletypeSelectorDisabled}title(he){return arguments.length?(this._title=he,this):this._title}alignX(he){return arguments.length?(this._alignX=he,this):this._alignX}alignY(he){return arguments.length?(this._alignY=he,this):this._alignY}top(he){return arguments.length?(this._top=he,this):this._top}left(he){return arguments.length?(this._left=he,this):this._left}targetModel(he){return arguments.length?(this.removeReaction(this._targetModelReaction),this._targetModel=he,this._targetProp=null,this._targetProp=["data","concept"],this.addReaction(this._targetModelReaction),this):this._targetModel}targetProp(he){return arguments.length?(this._targetProp=he,this):this._targetProp}_targetModelReaction(){getProp(this._targetModel,["scale","type"]),getProp(this._targetModel,this._targetProp),this.updateView()}_buildTagFolderTree(he){let{tagsArray:ge,dataModels:me}=he;!0!==ge&&ge||(ge=[]);const be="_root",ve="advanced",_e="other_datasets",xe="spread",we=1==me.length?xe:"root",Me={};Me[be]={id:be,children:[]},Me[ve]={id:ve,name:this.localise("treemenu/advanced"),type:"folder",children:[]},Me[be].children.push(Me[ve]),Me[_e]={id:_e,name:this.localise("treemenu/other_datasets"),type:"folder",children:[]},Me[be].children.push(Me[_e]),ge.forEach((he=>{Me[he.tag]={id:he.tag,name:he.name,type:"folder",children:[]}}));const Se={};return me.forEach((he=>{const ge=getTagNameForDs(he);let me=getProp(this.ui,["folderStrategyByDataset",he.id]),ve=null;me||(me=we),me.includes(":")&&(ve=me.split(":")[1],me=me.split(":")[0]),Me[ge]={id:he.id,name:this._getDatasetName(he),type:"dataset",children:[]},"folder"==me&&Me[ve]?Me[ve].children.push(Me[ge]):me==xe?Me[ge]=Me[be]:Me[be].children.push(Me[ge]),Se[he.id]=me})),ge.forEach((he=>{he.parent&&Me[he.parent]?Me[he.parent].children.push(Me[he.tag]):Se[he.datasource.id]==xe?Me[be].children.push(Me[he.tag]):Me[getTagNameForDs(he.datasource)]?Me[getTagNameForDs(he.datasource)].children.push(Me[he.tag]):warn("Tags request to the datasource ".concat(he.datasource.id," probably didn't succeed"))})),{tags:Me,tagsRoot:Me[be]}}_addIndicatorToTheTree(he,ge,me){const be=me.children.find((ge=>ge.id==he));return be&&"folder"!==be.type?be.byDataSources.push(ge):be&&"folder"===be.type?console.warn("Treemenu: collision between folder ID and indicator ID ".concat(he)):me.children.push({id:he,concept_type:ge.concept_type,type:"indicator",scales:ge.scales,byDataSources:[ge]}),me}_buildIndicatorsTree(he){let{tagsArray:ge,dataModels:me}=he,be=!1;const{tags:ve,tagsRoot:_e}=this._buildTagFolderTree({tagsArray:ge,dataModels:me});this._addIndicatorToTheTree("_default",{spaces:[[]]},_e);const xe=this._nestAvailabilityByConcepts(this._getAvailability()),we=this._conceptsCompatibleWithMarkerSpace(xe,this.model.data.space);return this._convertConceptMapToArray(we).concat(this.model.data.space.map((he=>({spaces:[[he]],source:this.model.data.source,concept:this.model.data.source.getConcept(he)})))).filter((he=>(!he.concept.tags||"_none"!==he.concept.tags)&&he.concept.concept&&"is--"!==he.concept.concept.slice(0,4))).forEach((he=>{let{concept:ge,spaces:me,source:xe}=he;const we=ge.concept,Me={concept_type:ge.concept_type,dataSource:xe,spaces:me,name:ge.name||ge.concept,name_catalog:ge.name_catalog,description:ge.description,scales:ge.scales?JSON.parse(ge.scales).map((he=>he.trim())):null};if("time"==ge.concept_type||"_default"==ge.concept)this._addIndicatorToTheTree(we,Me,_e);else if("entity_domain"==ge.concept_type||"entity_set"==ge.concept_type){const he=xe.getConcept(me[0][0]),ge=he.concept+"_properties";ve[ge]||(ve[ge]={id:ge,name:(he.name||he.concept)+" "+this.localise("treemenu/properties"),type:"folder",children:[]},_e.children.push(ve[ge])),this._addIndicatorToTheTree(we,Me,ve[ge])}else{(ge.tags||getTagNameForDs(xe)||"_root").split(",").forEach((he=>{he=he.trim(),ve[he]?this._addIndicatorToTheTree(we,Me,ve[he]):(be||(console.groupCollapsed("Some tags were not found, so indicators went under menu root"),be=!0),warn("tag '"+he+"' for indicator '"+Me.id+"'"),this._addIndicatorToTheTree(we,Me,_e))}))}})),be&&console.groupEnd(),this._sortChildren(_e),this.indicatorsTree(_e),Promise.resolve()}_sortChildren(he,ge){const me=this;he.children&&(he.children.sort(firstBy()(((he,ge)=>(he="dataset"===he.type?1:0,(ge="dataset"===ge.type?1:0)-he))).thenBy(((he,ge)=>(he=he.children?1:0)-(ge=ge.children?1:0))).thenBy(((he,me)=>{if(!ge){if("time"==he.id)return-1;if("time"==me.id)return 1;if("other_datasets"==he.id)return 1;if("other_datasets"==me.id)return-1;if("advanced"==he.id)return 1;if("advanced"==me.id)return-1;if("_default"==he.id)return 1;if("_default"==me.id)return-1}return getItemName(he)>getItemName(me)?1:-1}))),he.children.forEach((he=>{me._sortChildren(he,!0)})))}_resize(){this.services.layout.size;const{wrapper:he,wrapperOuter:ge}=this.DOM;let me=this._top,be=this._left;if(!he)return warn("treemenu resize() abort because container is undefined");he.classed(ci,!0),he.node().scrollTop=0,this.OPTIONS.IS_MOBILE="SMALL"===this.services.layout.profile,this.menuEntity&&(this.menuEntity.setWidth(this.profileConstants.col_width,!0,!0),this.OPTIONS.IS_MOBILE?2!=this.menuEntity.direction&&(this.menuEntity.setDirection(2,!0),this.OPTIONS.MENU_DIRECTION=2):1!=this.menuEntity.direction&&(this.menuEntity.setDirection(1,!0),this.OPTIONS.MENU_DIRECTION=1)),this.width=this.element.node().offsetWidth,this.height=this.element.node().offsetHeight;const ve=ge.node().getBoundingClientRect(),_e=ve.width;let xe=ve.height;if(_e)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{let we;(me||be)&&(ge.node().offsetTop<10&&ge.style("top","10px"),this.height-ge.node().offsetTop-xe<0&&(xe>this.height&&(xe=this.height-20),ge.style("top",this.height-xe-10+"px"),ge.style("bottom","auto")),me&&(me=ge.node().offsetTop)),we=ge.classed(ti)?ge.node().offsetTop+ge.node().offsetHeight:this.height-ge.node().offsetTop,he.style("max-height",we-he.node().offsetTop-10+"px"),ge.classed(ii,"center"===this._alignX),ge.style("margin-left","center"===this._alignX?"-"+_e/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*_e-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-ge.node().offsetLeft-_e-10;const Me=this.profileConstants.col_width+2*this.OPTIONS.MIN_COL_WIDTH;let Se=ge.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<Me&&Se>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(Se<Me+10&&(Se=Me+10),this.OPTIONS.MAX_MENU_WIDTH=Se-10):this.OPTIONS.MAX_MENU_WIDTH<Me&&(Se-=Me-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=Me),be?be=Se:Se!=ge.node().offsetLeft&&(ge.style("left","auto"),ge.style("right",this.width-Se-ve.width+"px")),this._top=me,this._left=be,(be||me)&&this.setPos(),ge.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return he.node().offsetHeight,he.classed(ci,!1),this._setHorizontalMenuHeight(),this}toggle(){this.setHiddenOrVisible(!this.element.classed($n))}setHiddenOrVisible(he){const ge=this;return this.element.classed($n,he),this.DOM.wrapper.classed(ci,he),he?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):(this.setPos(),!isTouchDevice()&&this._focusSearch(),this._resize(),this._scrollToSelected()),this.root.children.forEach((be=>{"gapminder-dialogs"==be.name?me.select(be.placeholder.parentNode).classed("vzb-blur",!he):be.element.classed?be.element.classed("vzb-blur",be!=ge&&!he):me.select(be.element).classed("vzb-blur",be!=ge&&!he)})),this.width=ge.element.node().offsetWidth,this}_scrollToSelected(){if(!this.selectedNode)return;const he=this;if(2==this.menuEntity.direction)scrollToItem(this.DOM.wrapper.node(),this.selectedNode),he.menuEntity.marqueeToggleAll(!0);else{this.menuEntity.findItemById(me.select(this.selectedNode).datum().id).submenu.calculateMissingWidth(0,(()=>{he.menuEntity.marqueeToggleAll(!0)}));let ge,be=this.selectedNode;for(;!hasClass(be,Yn);)"LI"==be.tagName&&(ge=hasClass(be.parentNode,Yn)?be.parentNode.parentNode:be.parentNode,scrollToItem(ge,be)),be=be.parentNode}function scrollToItem(he,ge){he.scrollTop=0;const me=he.getBoundingClientRect(),be=ge.getBoundingClientRect().bottom-me.top-he.offsetHeight+10;he.scrollTop=be}}setPos(){const{wrapperOuter:he}=this.DOM,ge=this._top,me=this._left,be=he.node().getBoundingClientRect();if(ge&&(he.style("top",ge+"px"),he.style("bottom","auto"),he.classed(ri,ge)),me){let ge=this.element.node().offsetWidth-me-be.width;ge=ge<10?10:ge,he.style("right",ge+"px"),he.style("left","auto"),he.classed(ai,ge)}}clearPos(){const{wrapper:he,wrapperOuter:ge}=this.DOM;this._top="",this._left="",ge.attr("style",""),ge.classed(ri,""),ge.classed(ai,""),ge.classed(li,""),he.style("max-height","")}_setHorizontalMenuHeight(){const{wrapper:he}=this.DOM;let ge=null;if(this.menuEntity&&1==this.OPTIONS.MENU_DIRECTION&&this.menuEntity.menuItems.length){const me=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10)||0,be=me*this._maxChildCount,ve=Math.max(this.menuEntity.menuItems.length,3)*me+this.menuEntity.entity.node().offsetTop+parseInt(he.style("padding-bottom"),10);ge=Math.max(be,ve)+"px"}he.classed(ci,!0),he.node().offsetHeight,he.style("height",ge),he.node().offsetHeight,he.classed(ci,!1)}_enableSearch(){const he=this,ge=this.DOM.wrapperHeader.select("."+Tn);let me=!1;const be=debounce((()=>{const be=ge.node().value;(me||""!=be)&&(me=""!=be,be.length>=he.OPTIONS.SEARCH_MIN_STR?he.redraw(function(ge){const me={_id:"root",children:[]},translationMatch=function(ge,me,be){const ve=me[be];let _e="folder"==ve.type&&ve.name||"indicator"==ve.type&&ve.byDataSources.map((he=>he.name)).join();return!_e&&he.localise&&(_e=he.localise("indicator/"+me[be][he.OPTIONS.SEARCH_PROPERTY]+"/"+he._targetModel._type)||he.localise("indicator/"+me[be][he.OPTIONS.SEARCH_PROPERTY])),_e&&_e.toLowerCase().indexOf(ge.toLowerCase())>=0},matching=function(be){const ve=he.OPTIONS.SUBMENUS;for(let he=0;he<be.length;he++){let _e=!1;_e=translationMatch(ge,be,he),_e&&me.children.push(be[he]),!_e&&be[he][ve]&&matching(be[he][ve])}};return matching(he.dataFiltered.children),me.children=unique(me.children,(he=>he.id)),me}(be)):he.redraw())}),250);ge.on("input",be)}_selectIndicator(he){he.id!=this._targetModel.data.concept&&(this._setModelWhich(he),this.toggle())}_getFilteredTree(){const he=this,satisfiesAllowedSpaces=he=>{let ge=[];return he.byDataSources.forEach((he=>ge=ge.concat(he.spaces))),ge.some((he=>this._targetModel.data.allow.space.filter(he)))};return pruneTree(this._indicatorsTree,(ge=>function conceptFilter(ge){return he._targetModel.data.allow.concept.filter(ge)}(ge)&&function scaleTypeFilter(ge){const be=he._targetModel.scale.allowedTypes;if(!be||!be.length||"*"==be[0])return!0;if(ge.scales)return!!me.intersection(be,ge.scales).size;const ve=ge.concept_type;return me.intersection(be,["ordinal","point"]).size&&"_default"===ge.id||me.intersection(be,["ordinal","rank"]).size&&["entity_domain","entity_set","string"].includes(ve)||me.intersection(be,["linear","log","genericLog","pow"]).size&&["measure"].includes(ve)||"time"===ve&&be.includes("time")}(ge)&&"indicator"==ge.type&&satisfiesAllowedSpaces(ge)))}redraw(he){const ge=this,me=!!he;me||(this.dataFiltered=he=this._getFilteredTree());const{wrapper:be,wrapperHeader:ve}=this.DOM,_e=ge._targetModel.name||ge._targetModel.config.type;be.classed("vzb-hidden",!me).select("ul").remove();let xe="";xe=this._title||""===this._title?this._title:this.localise("buttons/"+_e),ve.select("."+Xn).select("span").text(xe),ve.select("."+Tn).attr("placeholder",this.localise("placeholder/search")+"..."),this._maxChildCount=0;let we=getProp(ge._targetModel,ge._targetProp);const Me=[];if(eachTree(he,((he,me)=>{he.children&&he.children.length>ge._maxChildCount&&(ge._maxChildCount=he.children.length),he.id===we&&me&&(Me.unshift(he.id),we=me.id)})),this.OPTIONS.selectedPath=Me,this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=2:this.OPTIONS.MENU_DIRECTION=1,this.OPTIONS.createSubmenu=this._createSubmenu.bind(this),this.OPTIONS.COL_WIDTH=this.profileConstants.col_width,this.selectedNode=null,be.datum(he),this.menuEntity=new Menu(this,null,be,this.OPTIONS),be.classed("vzb-hidden",!1),this._setHorizontalMenuHeight(),!me){const he=function resolveDefaultScales(he){if(he.scales)return JSON.parse(he.scales).map((he=>he.trim()));switch(he.concept_type){case"measure":default:return["linear","log"];case"string":case"entity_domain":case"entity_set":case"boolean":return["ordinal"];case"time":return["time"]}}(this._targetModel.data.conceptProps||{}).filter((he=>ge._targetModel.scale.allowedTypes?ge._targetModel.scale.allowedTypes.includes(he):!ge._targetModel.data.allow||!ge._targetModel.data.allow.scales||("*"==ge._targetModel.data.allow.scales[0]||ge._targetModel.data.allow.scales.indexOf(he)>-1)));if(0==he.length)this.element.select("."+Kn).classed($n,!0);else{let me=this.element.select("."+Kn).classed($n,!1).selectAll("span").data(he,(he=>he));me.exit().remove(),me=me.enter().append("span").on("click",((he,me)=>{he.stopPropagation(),ge._setModelScaleType(me)})).merge(me);const be=ge._targetModel.scale.type;me.classed(Zn,he.length<2||ge._scaletypeSelectorDisabled).classed(Jn,(ge=>(ge==be||"log"===ge&&"genericLog"===be)&&he.length>1)).text((he=>ge.localise("scaletype/"+he)))}}return this}_createSubmenu(he,ge,be){if(!ge.children)return;const ve=this,_e=ve._targetModel.name||ve._targetModel.config.type,xe=(be?he:he.append("div").classed(An,!0)).append("ul").classed(Ln,!be).classed(Yn,be).classed("vzb-dialog-scrollable",!0).selectAll("li").data(ge.children,(he=>he.id)).enter().append("li");xe.append("span").classed(Vn,!0).attr("children",(he=>he.children?"true":null)).attr("type",(he=>he.type?he.type:null)).style("color",(he=>this.ui.showDataSources&&"indicator"==he.type&&"_default"!==he.id&&1==he.byDataSources.length?this.dsColorScaleDark(he.byDataSources[0].dataSource.id):null)).on("click",(function(he,ge){me.select(this).attr("children")||(he.stopPropagation(),ve._selectIndicator(ge))})).append("span").text((he=>{const ge="_default"===he.id?ve.localise("indicator/_default/"+_e):getItemName(he);return ge||""===ge||warn("translation missing: NAME of "+he.id),ge||""})),xe.classed(En,!0).classed(Hn,(he=>he.children)).classed(Gn,(he=>he.special)).each((function(he){const ge=me.select(this);if(!he.children){"_default"===he.id&&(he.byDataSources[0].name=ve.localise("indicator/_default/"+_e),he.byDataSources[0].description=ve.localise("description/_default/"+_e));ge.append("div").attr("class",si+" "+An+" "+jn).on("click",((he,ge)=>{ve._selectIndicator(ge)}))}if(he.id==getProp(ve._targetModel,ve._targetProp)){let he;if(ve.selectedNode&&be)for(he=ve.selectedNode.parentNode,me.select(ve.selectedNode).select("."+jn).classed("active",!1);!hasClass(he,Yn);)"UL"==he.tagName&&me.select(he.parentNode).classed("active",!1),he=he.parentNode;if(!ve.selectedNode||be){for(he=this.parentNode,me.select(this).classed("item-active",!0).select("."+jn).classed("active",!0);!hasClass(he,Yn);)"UL"==he.tagName&&me.select(he.parentNode).classed("active",!0),"LI"==he.tagName&&me.select(he).classed("item-active",!0),he=he.parentNode;ve.selectedNode=this}}}))}updateView(){if(!this._targetModel)return;if(!this._indicatorsTree)return console.error("Tree menu: indicator tree has not been constructed (yet?)");const{wrapperHeader:he,wrapperOuter:ge}=this.DOM;return ge.classed(ri,this._top),ge.classed(Qn,"top"===this._alignY),ge.classed(ti,"bottom"===this._alignY),ge.classed(ai,this._left),ge.classed(ei,"left"===this._alignX),ge.classed(ni,"right"===this._alignX),this.redraw(),this._showWhenReady&&this.setHiddenOrVisible(!1).showWhenReady(!1),he.select("."+Tn).node().value="",this}_focusSearch(){let he=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const ge=this.DOM.wrapperHeader.select("."+Tn).node();he?ge.focus():ge.blur()}_setModelScaleType(he){this._targetModel.scale.config.type=he}_setModelWhich(he){if("_default"==he.id)this._targetModel.setWhich({key:null,value:{concept:"_default",dataSource:null}});else{const{space:ge,dataSource:me}=this.getBestFittingDataSourceAndSpace(he.byDataSources);this._targetModel.setWhich({key:ge,value:{concept:he.id,dataSource:me.id}})}}getBestFittingDataSourceAndSpace(he){const ge=he.map((he=>this.getNearestSpaceToMarkerSpace(he.spaces))),me=this.getNearestSpaceToMarkerSpace(ge),be=he.filter((he=>he.spaces.find((he=>spacesAreEqual$1(he,me))))).map((he=>he.dataSource));return be.includes(this.model.data.source)?{space:me,dataSource:this.model.data.source}:be.includes(this._targetModel.data.source)?{space:me,dataSource:this._targetModel.data.source}:{space:me,dataSource:be[0]}}getNearestSpaceToMarkerSpace(he){if(he.find((he=>spacesAreEqual$1(he,this.model.data.space))))return this.model.data.space;const ge=this.model.data.space.length;return he.concat().sort(((he,me)=>Math.abs(he.length-ge)-Math.abs(me.length-ge)))[0]}setup(){this.state={ownReadiness:ke.INIT},this.menuEntity=null,this._alignX="center",this._alignY="center",this.OPTIONS=deepClone(di),this.DOM={},this.element.classed($n,!0).append("div").attr("class",Cn).on("click",(he=>{he.stopPropagation(),this.toggle()}));const he=this.DOM.wrapperOuter=this.element.append("div").classed(On,!0).classed(ci,!0),ge=this.DOM.wrapperHeader=he.append("div").classed(zn,!0);ge.append("div").attr("class",kn).html(Me).on("click",(he=>{he.stopPropagation(),this.toggle()})).select("svg").attr("width","0px").attr("height","0px").attr("class",kn+"-icon"),ge.append("div").classed(Kn,!0).append("span"),ge.append("div").classed(Xn,!0).append("span"),ge.append("div").classed(Wn,!0).append("input").classed(Tn,!0).attr("type","search").attr("id",Tn);const be=this.DOM.wrapper=he.append("div").classed(Dn,!0).classed(ci,!0).classed("vzb-dialog-scrollable",!0);be.on("click",(he=>{he.stopPropagation()})),be.on("mouseleave",(()=>{}));const ve=this._getDataModels(this.root.model.config.dataSources);this.dsColorScaleLight=me.scaleOrdinal().range(me.schemePastel2).domain(ve.map((he=>he.id))),this.dsColorScaleDark=me.scaleOrdinal().range(me.schemeSet2).domain(ve.map((he=>he.id)))}draw(){this.localise=this.services.locale.auto(),this.addReaction(this._prepareTags,{ignoreStatus:!0}),this._updateLayoutProfile(),this.addReaction(this._resize)}_prepareTags(){be.runInAction((()=>{this.state.ownReadiness=ke.PENDING}));const he=this._getDataModels(this.root.model.config.dataSources);if("fulfilled"==this.services.Vizabi.Vizabi.utils.combineStates(he.map((he=>he.state)))){const he=this.services.locale.id;be.runInAction((()=>{this.getTags(he).then((he=>this._buildIndicatorsTree({tagsArray:he,dataModels:this._getDataModels(this.root.model.config.dataSources)}))).then(this.updateView.bind(this)).then((()=>{this._enableSearch(),this.state.ownReadiness=ke.READY}))}))}}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(hi,pi),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return"TreeMenu _updateProfile() abort: container is too little or has display:none"}_getDatasetName(he){var ge;if(he.reader.getDatasetInfo){const ge=he.reader.getDatasetInfo();return ge.name+(ge.version?" "+ge.version:"")}return null!==(ge=he.id)&&void 0!==ge?ge:"Unnamed datasource"}_getDataModels(he){return Object.keys(he).map((he=>this.services.Vizabi.Vizabi.stores.dataSources.get(he)))}_nestAvailabilityByConcepts(he){return he.reduce(((he,ge)=>{const me=ge.value,be=ge.key;return he.has(me)||he.set(me,{source:ge.source,spaces:new Set}),he.get(me).spaces.add(be),he}),new Map)}_conceptsCompatibleWithMarkerSpace(he,ge){const me=new Map,be=new Set(ge);for(const[ge,{source:ve,spaces:_e}]of he){const he=[..._e].filter((he=>{const ge=(me=be,he.filter((he=>me.has(he))));var me;return ge.length==be.size||ge.length==he.length}));he.length&&me.set(ge,{source:ve,spaces:he})}return me}_convertConceptMapToArray(he){return[...he].map((he=>{let[ge,{source:me,spaces:be}]=he;return{concept:ge,source:me,spaces:[...be]}}))}__observeDataSources(){return this._getDataModels(this.root.model.config.dataSources).map((he=>[he.state,he.config]))}_getAvailability(){const he=[];return this._getDataModels(this.root.model.config.dataSources).forEach((ge=>{ge.availability.data.forEach((me=>{he.push({key:me.key,value:ge.getConcept(me.value),source:ge})}))})),he}getTags(he){const ge={select:{key:["tag"],value:[]},language:he,from:"entities"},me=this._getDataModels(this.root.model.config.dataSources).reduce(((he,me)=>(he.set(me,deepClone(ge)),he)),new Map);this._getAvailability().filter((he=>"tag"==he.key.join())).forEach((he=>{me.get(he.source).select.value.push(he.value.concept)}));const be=[...me].filter((he=>{let[,ge]=he;return ge.select.value.length}));return be.length?Promise.all(be.map((he=>{let[ge,me]=he;return ge.query(me).then((he=>[...he.forQueryKey().values()].map((he=>(he.datasource=ge,he)))))}))).then((he=>this.mergeResults(he,["tag"]))):Promise.resolve([])}mergeResults(he,ge){const me=new Map;return he.forEach((he=>{he.forEach((he=>{const be=this.createKeyString(ge,he);me.has(be)||me.set(be,he)}))})),Array.from(me.values())}createKeyString(he,ge){return he.map((he=>ge[he])).join(",")}},ge.Utils=Ae,ge.Zoom=Zoom,ge.ZoomButtonList=ZoomButtonList,ge._AddGeo=_AddGeo,ge.axisSmart=je,ge.collisionResolver=Re,ge.updateRainbowLegend=updateRainbowLegend,ge.versionInfo={version:"1.48.1",build:1742824708094,package:{contributors:[{name:"Jasper",url:"https://github.com/jheeffer"},{name:"Angie",url:"https://github.com/angieskazka"},{name:"Dima",url:"https://github.com/dab2000"},{name:"Ola",url:"https://github.com/olarosling"}],author:{name:"Gapminder Foundation",url:"https://www.gapminder.org",email:"info@gapminder.org"},homepage:"https://github.com/vizabi/@vizabi/shared-components#readme",name:"@vizabi/shared-components",description:"Vizabi shared components"}},Object.defineProperty(ge,"__esModule",{value:!0})})),function(he,ge){"object"==typeof exports&&"undefined"!=typeof module?ge(exports,require("@vizabi/shared-components"),require("d3"),require("mobx")):"function"==typeof define&&define.amd?define(["exports","@vizabi/shared-components","d3","mobx"],ge):ge((he="undefined"!=typeof globalThis?globalThis:he||self).BubbleChart={},he.VizabiSharedComponents,he.d3,he.mobx)}(window,(function(he,ge,me,be){class PanZoom{constructor(he){this.context=he,this.dragRectangle=me.drag(),this.zoomer=me.zoom(),this.dragRectangle.filter((he=>!he.button)).subject(this.dragSubject()).on("start",this.drag().start).on("drag",this.drag().go).on("end",this.drag().stop),this.zoomer.filter(this.zoomFilter()).scaleExtent([.0625,1/0]).on("start",this.zoom().start).on("zoom",this.zoom().go).on("end",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,this.context._zoomedXYMinMax={x:{zoomedMin:null,zoomedMax:null},y:{zoomedMin:null,zoomedMax:null}}}dragSubject(){const he=this.context;return function(ge){return!ge.sourceEvent.ctrlKey&&!ge.sourceEvent.metaKey&&"plus"!==he.ui.cursorMode||"minus"===he.ui.cursorMode||("touchmove"===ge.sourceEvent.type||"touchstart"===ge.sourceEvent.type)&&(ge.sourceEvent.touches.length>1||ge.sourceEvent.targetTouches.length>1)?null:{x:me.pointer(ge,this)[0],y:me.pointer(ge,this)[1]}}}drag(){const he=this.context,ge=this;return{start(ge){this.origin={x:me.pointer(ge,this)[0],y:me.pointer(ge,this)[1]},he.DOM.zoomRect.classed("vzb-invisible",!1)},go(ge){const me=this.origin,be={x:ge.x,y:ge.y};he.DOM.zoomRect.attr("x",Math.min(be.x,me.x)).attr("y",Math.min(be.y,me.y)).attr("width",Math.abs(be.x-me.x)).attr("height",Math.abs(be.y-me.y))},stop(be){if(he.DOM.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:me.pointer(be,this)[0],y:me.pointer(be,this)[1]},Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10)return;const ve=be.sourceEvent.ctrlKey||be.sourceEvent.metaKey||"plus"===he.ui.cursorMode;ge._zoomOnRectangle(me.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,ve,500)}}}zoomFilter(){const he=this.context;return function(ge){return!ge.ctrlKey&&!ge.metaKey&&(("touchmove"===ge.type||"touchstart"===ge.type)&&(ge.touches.length>1||ge.targetTouches.length>1)||(!("wheel"!==ge.type&&"mousewheel"!==ge.type||!he.ui.zoomOnScrolling)||!("mousedown"!==ge.type&&"touchstart"!==ge.type||"plus"===he.ui.cursorMode||"minus"===he.ui.cursorMode||!he.ui.panWithArrow&&"hand"!==he.ui.cursorMode)))}}zoom(){const he=this.context,be=this.zoomer,ve=this;return{start(){"plus"!==he.ui.cursorMode&&"minus"!==he.ui.cursorMode&&he.DOM.chartSvg.classed("vzb-zooming",!0)},go(_e){const xe=_e.sourceEvent;let we=_e.transform.k,Me=[_e.transform.x,_e.transform.y],Se=be.ratioY,De=be.ratioX;he.draggingNow=!0,(isNaN(we)||null==we)&&(we=be.scale),(isNaN(we)||null==we)&&(we=1),1===we&&null!==xe&&(("wheel"===xe.type||"mousewheel"===xe.type)&&(xe.deltaY||-xe.wheelDelta)>0||"touchmove"===xe.type&&xe.touches.length>1)&&(be.ratioX=1,De=1,be.ratioY=1,Se=1),(isNaN(Me[0])||isNaN(Me[1])||null==Me[0]||null==Me[1])&&(Me=[0,0]);const ze=be.scaleExtent()[0];we*Se<ze&&(Se=ze/we,be.ratioY=Se),we*De<ze&&(De=ze/we,be.ratioX=De);const Oe=we*De<1,Ce=we*Se<1;Oe?(Me[0]<0&&(Me[0]=0),Me[0]>(1-we*De)*he.width&&(Me[0]=(1-we*De)*he.width)):(Me[0]>0&&(Me[0]=0),Me[0]<(1-we*De)*he.width&&(Me[0]=(1-we*De)*he.width)),Ce?(Me[1]<0&&(Me[1]=0),Me[1]>(1-we*Se)*he.height&&(Me[1]=(1-we*Se)*he.height)):(Me[1]>0&&(Me[1]=0),Me[1]<(1-we*Se)*he.height&&(Me[1]=(1-we*Se)*he.height)),ve.zoomSelection.property("__zoom",me.zoomIdentity.translate(Me[0],Me[1]).scale(we));const ke=he.width*we*De,Te=he.height*we*Se,Le=[0*we*De+Me[0],ke+Me[0]],Ae=[Te+Me[1],0*we*Se+Me[1]],Ee=he._rangeBump(Le),je=he._rangeBump(Ae),Re=(Ee[0]-Le[0])*we*De,Fe=(Ee[1]-Le[1])*we*De,Ie=(je[0]-Ae[0])*we*Se,Pe=(je[1]-Ae[1])*we*Se;Le[0]+=Re,Le[1]+=Fe,Ae[0]+=Ie,Ae[1]+=Pe;const Ne=[0,he.width],Be=[he.height,0],qe=he._rangeBump(Ne),Ue=he._rangeBump(Be);Oe?(Le[0]<qe[0]&&(Me[0]=qe[0]-Re),Le[1]>qe[1]&&(Me[0]=qe[1]-Fe-ke)):(Le[0]>qe[0]&&(Me[0]=qe[0]-Re),Le[1]<qe[1]&&(Me[0]=qe[1]-Fe-ke)),Ce?(Ae[0]>Ue[0]&&(Me[1]=Ue[0]-Ie-Te),Ae[1]<Ue[1]&&(Me[1]=Ue[1]-Pe)):(Ae[0]<Ue[0]&&(Me[1]=Ue[0]-Ie-Te),Ae[1]>Ue[1]&&(Me[1]=Ue[1]-Pe)),Oe?(Le[0]<qe[0]&&(Le[1]+=Math.abs(Le[0]-qe[0]),Le[0]=qe[0]),Le[1]>qe[1]&&(Le[0]-=Math.abs(Le[1]-qe[1]),Le[1]=qe[1])):(Le[0]>qe[0]&&(Le[1]-=Math.abs(Le[0]-qe[0]),Le[0]=qe[0]),Le[1]<qe[1]&&(Le[0]+=Math.abs(Le[1]-qe[1]),Le[1]=qe[1])),Ce?(Ae[0]>Ue[0]&&(Ae[1]-=Math.abs(Ae[0]-Ue[0]),Ae[0]=Ue[0]),Ae[1]<Ue[1]&&(Ae[0]+=Math.abs(Ae[1]-Ue[1]),Ae[1]=Ue[1])):(Ae[0]<Ue[0]&&(Ae[1]+=Math.abs(Ae[0]-Ue[0]),Ae[0]=Ue[0]),Ae[1]>Ue[1]&&(Ae[0]-=Math.abs(Ae[1]-Ue[1]),Ae[1]=Ue[1])),"ordinal"===he.MDL.x.scale.type?he.xScale.rangeBands(Le):he.xScale.range(Le),"ordinal"===he.MDL.y.scale.type?he.yScale.rangeBands(Ae):he.yScale.range(Ae);const formatter=function(he){return ge.LegacyUtils.isDate(he)?he:+he.toFixed(2)},He=qe,Ve=Ue;he._zoomedXYMinMax={x:{zoomedMin:formatter(he.xScale.invert(He[0])),zoomedMax:formatter(he.xScale.invert(He[1]))},y:{zoomedMin:formatter(he.yScale.invert(Ve[0])),zoomedMax:formatter(he.yScale.invert(Ve[1]))}},be.dontFeedToState||(he.MDL.x.scale.zoomed=[he._zoomedXYMinMax.x.zoomedMin,he._zoomedXYMinMax.x.zoomedMax],he.MDL.y.scale.zoomed=[he._zoomedXYMinMax.y.zoomedMin,he._zoomedXYMinMax.y.zoomedMax]);const Ye=he.yAxis.labelerOptions(),We=he.xAxis.labelerOptions();Ye.limitMaxTickNumber=we*Se<1.5?8:we*Se*8,We.limitMaxTickNumber=we*De<1.5?8:we*De*8,Ye.transitionDuration=be.duration,We.transitionDuration=be.duration,he.DOM.xAxisEl.call(he.xAxis.labelerOptions(We)),he.DOM.yAxisEl.call(he.yAxis.labelerOptions(Ye)),he.redrawData(be.duration),be.duration=0},stop(){he.DOM.chartSvg.classed("vzb-zooming",!1),be.dontFeedToState||(he.MDL.x.scale.zoomed=[he._zoomedXYMinMax.x.zoomedMin,he._zoomedXYMinMax.x.zoomedMax],he.MDL.y.scale.zoomed=[he._zoomedXYMinMax.y.zoomedMin,he._zoomedXYMinMax.y.zoomedMax]),be.dontFeedToState=null,he.draggingNow=!1}}}expandCanvas(he){const be=this.context;he||(he=be.duration);const ve=me.extent(ge.LegacyUtils.values(be.frame.x)),_e=me.extent(ge.LegacyUtils.values(be.frame.y));if(!ve[0]&&0!==ve[0]||!ve[1]&&0!==ve[1]||!_e[0]&&0!==_e[0]||!_e[1]&&0!==_e[1])return ge.LegacyUtils.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");const xe={x1:be.xScale(ve[0]),y1:be.yScale(_e[0]),x2:be.xScale(ve[1]),y2:be.yScale(_e[1])},we=[0,be.width],Me=[be.height,0],Se=we[0],De=we[1],ze=Me[0],Oe=Me[1];if(!be.isCanvasPreviouslyExpanded||xe.x1<1*Se||xe.x2>1*De||xe.y2<1*Oe||xe.y1>1*ze){if(be.isCanvasPreviouslyExpanded){const he=be._rangeBump(we),ge=be._rangeBump(Me);xe.x1>he[0]&&(xe.x1=he[0]),xe.x2<he[1]&&(xe.x2=he[1]),xe.y1<ge[0]&&(xe.y1=ge[0]),xe.y2>ge[0]&&(xe.y2=ge[1])}be.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(be.element,xe.x1,xe.y1,xe.x2,xe.y2,!1,he)}else be.redrawDataPoints(he)}zoomToMaxMin(he,ge,me,be,ve,_e){const xe=this.context;let we=he,Me=ge,Se=me,De=be;const ze=xe.xScale.domain(),Oe=xe.yScale.domain();we<ze[0]&&Me<ze[1]&&(we=ze[0]),we>ze[0]&&Me>ze[1]&&(Me=ze[1]),Se<Oe[0]&&De<Oe[1]&&(Se=Oe[0]),Se>Oe[0]&&De>Oe[1]&&(De=Oe[1]);const Ce=[xe.xScale(we),xe.xScale(Me)],ke=[xe.yScale(Se),xe.yScale(De)];this._zoomOnRectangle(xe.element,Ce[0],ke[0],Ce[1],ke[1],!1,ve,_e)}_zoomOnRectangle(he,be,ve,_e,xe,we,Me,Se){const De=this.context,ze=this.zoomer,Oe=me.zoomTransform(this.zoomSelection.node()),Ce=be,ke=ve,Te=_e,Le=xe;we&&Oe.translate(Ce-Te,ke-Le);const Ae=[0,De.width],Ee=[De.height,0],je=De._rangeBump(Ae),Re=De._rangeBump(Ee),Fe=ze.scaleExtent()[0],Ie=ze.scaleExtent()[1];let Pe,Ne,Be;if(Ce==Te||ke==Le||je[0]==je[1]||Re[0]==Re[1])return ge.LegacyUtils.warn("_zoomOnRectangle(): can not proceed because this may result in infinity zooms");Math.abs(Ce-Te)>Math.abs(ke-Le)?(Pe=Math.abs(Re[0]-Re[1])/Math.abs(ke-Le)*Oe.k,Pe<Fe&&(ze.ratioY*=Pe/Oe.k,Pe=Fe),Pe>Ie&&(Pe=Ie),Ne=Math.abs(je[0]-je[1])/Math.abs(Ce-Te)*Oe.k/Pe*ze.ratioX,Be=ze.ratioY):(Pe=Math.abs(je[0]-je[1])/Math.abs(Ce-Te)*Oe.k,Pe<Fe&&(ze.ratioX*=Pe/Oe.k,Pe=Fe),Pe>Ie&&(Pe=Ie),Be=Math.abs(Re[0]-Re[1])/Math.abs(ke-Le)*Oe.k/Pe*ze.ratioY,Ne=ze.ratioX);const qe=[(Oe.x-Math.min(Ce,Te))/Oe.k/ze.ratioX*Pe*Ne+(je[0]-Ae[0]),(Oe.y-Math.min(ke,Le))/Oe.k/ze.ratioY*Pe*Be+(Re[1]-Ee[1])];ze.dontFeedToState=Se,ze.ratioY=Be||1,ze.ratioX=Ne||1,ze.duration=Me||0,this.zoomSelection.call(ze.transform,me.zoomIdentity.translate(qe[0],qe[1]).scale(Pe))}zoomByIncrement(he,ge,be){const ve=me.zoomTransform(this.zoomSelection.node());let _e=ve.k;const xe=[ve.x,ve.y],we=me.pointer(he,this.zoomSelection.node());let Me=Math.log(_e)/Math.LN2;"plus"!=ge&&ge||(Me=Math.floor(Me)+1),"minus"==ge&&(Me=Math.ceil(Me)-1);let Se=[(we[0]-xe[0])/_e,(we[1]-xe[1])/_e];const De=this.zoomer.scaleExtent();_e==De[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),_e=Math.max(De[0],Math.min(De[1],Math.pow(2,Me))),Se=[Se[0]*_e+xe[0],Se[1]*_e+xe[1]],xe[0]+=we[0]-Se[0],xe[1]+=we[1]-Se[1],this.zoomer.duration=be||0,this.zoomSelection.call(this.zoomer.transform,me.zoomIdentity.translate(xe[0],xe[1]).scale(_e))}resetZoomState(he){this.zoomer.ratioY=1,this.zoomer.ratioX=1,(he||this.zoomSelection).property("__zoom",me.zoomIdentity)}reset(he,ge){this.context.isCanvasPreviouslyExpanded=!1,this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.duration=ge||0,(he||this.zoomSelection).call(this.zoomer.transform,me.zoomIdentity)}rerun(he){(he||this.zoomSelection).call(this.zoomer.scaleBy,1)}zoomSelection(he){this.zoomSelection=he}}const{ICON_QUESTION:ve}=ge.Icons;class BCAxisTitles extends ge.BaseComponent{constructor(he){he.template='\n      <g class="vzb-bc-axis-x-title"><text></text></g>\n      <g class="vzb-bc-axis-y-title"><text></text></g>\n      <g class="vzb-bc-axis-s-title"><text></text></g>\n      <g class="vzb-bc-axis-x-subtitle"><text></text></g>\n      <g class="vzb-bc-axis-y-subtitle"><text></text></g>\n      <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n      <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n    ',super(he)}setup(){this.DOM={xTitle:this.element.select(".vzb-bc-axis-x-title"),yTitle:this.element.select(".vzb-bc-axis-y-title"),sTitle:this.element.select(".vzb-bc-axis-s-title"),xSubTitle:this.element.select(".vzb-bc-axis-x-subtitle"),ySubTitle:this.element.select(".vzb-bc-axis-y-subtitle"),xInfo:this.element.select(".vzb-bc-axis-x-info"),yInfo:this.element.select(".vzb-bc-axis-y-info")},this.axisTitleComplimentStrings={Y:"",X:"",S:"",C:""},this.strings={title:{Y:"",X:"",S:"",C:""},title_short:{Y:"",X:"",S:"",C:""},subtitle:{Y:"",X:""}},this._initInfoElements()}draw(){this.localise=this.services.locale.auto(),this.addReaction(this.updateUIStrings),this.addReaction(this.updateTreemenu),this.addReaction(this.updateSize),this.addReaction(this.updateInfoElements)}get MDL(){var he,ge;return{y:this.model.encoding[(null===(he=this.parent.state.alias)||void 0===he?void 0:he.y)||"y"],x:this.model.encoding[(null===(ge=this.parent.state.alias)||void 0===ge?void 0:ge.x)||"x"],size:this.model.encoding.size,color:this.model.encoding.color}}updateTreemenu(){const he=this.root.findChild({type:"TreeMenu"});this.DOM.yTitle.classed("vzb-disabled",he.state.ownReadiness!==ge.Utils.STATUS.READY).on("click",(()=>{he.encoding(this.parent._alias("y")).alignX(this.services.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()})),this.DOM.xTitle.classed("vzb-disabled",he.state.ownReadiness!==ge.Utils.STATUS.READY).on("click",(()=>{he.encoding(this.parent._alias("x")).alignX(this.services.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()}))}updateUIStrings(){const{y:he,x:me,size:ve,color:_e}=this.MDL;this.strings={title:{Y:ge.Utils.getConceptName(he,this.localise),X:ge.Utils.getConceptName(me,this.localise),S:ge.Utils.getConceptName(ve,this.localise),C:ge.Utils.getConceptName(_e,this.localise)},title_short:{Y:ge.Utils.getConceptShortName(he,this.localise),X:ge.Utils.getConceptShortName(me,this.localise),S:ge.Utils.getConceptShortName(ve,this.localise),C:ge.Utils.getConceptShortName(_e,this.localise)},subtitle:{Y:ge.Utils.getConceptNameMinusShortName(he,this.localise),X:ge.Utils.getConceptNameMinusShortName(me,this.localise)}},Promise.all([ge.Utils.getConceptNameCompliment(he),ge.Utils.getConceptNameCompliment(me),ge.Utils.getConceptNameCompliment(ve),ge.Utils.getConceptNameCompliment(_e)]).then(be.action((he=>{[this.axisTitleComplimentStrings.Y,this.axisTitleComplimentStrings.X,this.axisTitleComplimentStrings.S,this.axisTitleComplimentStrings.C]=he})))}_initInfoElements(){const he=this,dataNotesDialog=()=>this.root.findChild({type:"DataNotes"}),timeSlider=()=>this.root.findChild({type:"TimeSlider"});ge.LegacyUtils.setIcon(this.DOM.yInfo,ve).on("click",(()=>{dataNotesDialog().pin()})).on("mouseover",(function(){if(timeSlider().ui.dragging)return;const me=this.getBBox(),be=ge.LegacyUtils.makeAbsoluteContext(this,this.farthestViewportElement)(me.x-10,me.y+me.height+10),ve=he.root.element.node().getBoundingClientRect(),_e=he.element.node().getBoundingClientRect();dataNotesDialog().setEncoding(he.MDL.y).show().setPos(be.x+_e.left-ve.left,be.y)})).on("mouseout",(()=>{timeSlider().ui.dragging||dataNotesDialog().hide()})),ge.LegacyUtils.setIcon(this.DOM.xInfo,ve).on("click",(()=>{dataNotesDialog().pin()})).on("mouseover",(function(){if(timeSlider().ui.dragging)return;const me=this.getBBox(),be=ge.LegacyUtils.makeAbsoluteContext(this,this.farthestViewportElement)(me.x-10,me.y+me.height+10),ve=he.root.element.node().getBoundingClientRect(),_e=he.element.node().getBoundingClientRect();dataNotesDialog().setEncoding(he.MDL.x).show().setPos(be.x+_e.left-ve.left,be.y)})).on("mouseout",(()=>{timeSlider().ui.dragging||dataNotesDialog().hide()}))}updateInfoElements(){this.services.layout.size,this.strings.title.X,this.strings.title.Y,this.axisTitleComplimentStrings.X,this.axisTitleComplimentStrings.Y;const{xInfo:he,yInfo:me,xTitle:be,yTitle:ve}=this.DOM,{x:_e,y:xe}=this.MDL,we=this.services.locale.isRTL(),Me=this.parent.profileConstants.infoElHeight,Se=this.services.layout.profile;if(me.select("svg").node()){const he=ve.node().getBBox(),be=ge.LegacyUtils.transform(ve.node()),_e=we?he.x+be.translateX-1.4*Me:he.x+be.translateX+he.width+.4*Me,De=we?be.translateY+1.4*Me+.5*he.width:be.translateY-.4*Me-.5*he.width,ze=xe.data.conceptProps;me.classed("vzb-hidden",!ze.description&&!ze.sourceLink||this.services.layout.projector).attr("transform","SMALL"!==Se?"translate(".concat(be.translateX-.8*Me,", ").concat(De,") rotate(-90)"):"translate(".concat(_e,",").concat(be.translateY-.8*Me,")")).select("svg").attr("width",Me+"px").attr("height",Me+"px")}if(he.select("svg").node()){const me=be.node().getBBox(),ve=ge.LegacyUtils.transform(be.node()),xe=we?me.x+ve.translateX-1.4*Me:me.x+ve.translateX+me.width+.4*Me,Se=_e.data.conceptProps;he.classed("vzb-hidden",!Se.description&&!Se.sourceLink||this.services.layout.projector).attr("transform","translate(".concat(xe,", ").concat(ve.translateY-.8*Me,")")).select("svg").attr("width",Me+"px").attr("height",Me+"px")}}_updateSTitle(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent.width,ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parent.height;const{sTitle:me}=this.DOM,{size:be,color:ve}=this.MDL,_e=this.axisTitleComplimentStrings,xe=this.parent.profileConstants.hideSTitle&&this.root.ui.dialogs.dialogs.sidebar.includes("colors")&&this.root.ui.dialogs.dialogs.sidebar.includes("size");if(me.classed("vzb-invisible",xe),xe)return;const we=be.data.constant?"":this.localise("buttons/size")+": "+this.strings.title.S+(_e.S?" Â· "+_e.S:""),Me=ve.data.constant?"":this.localise("buttons/colors")+": "+this.strings.title.C+(_e.C?" Â· "+_e.C:""),Se=me.attr("text-anchor","end").attr("transform","translate("+he+",20) rotate(-90)").select("text").style("font-size",null).text(we+(we&&Me?", ":"")+Me),De=Se.node().getBBox().width,ze=parseInt(Se.style("font-size"))*(ge-30)/De;Se.style("font-size",De>ge-30?ze+"px":null)}_updateYTitle(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent.width,ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parent.height;const{yTitle:me,ySubTitle:be}=this.DOM,{margin:ve,infoElHeight:_e,yAxisTitleBottomMargin:xe}=this.parent.profileConstants,we=this.services.layout.profile,Me=this.axisTitleComplimentStrings,Se=this.services.locale.isRTL();if("SMALL"!==we){be.attr("transform","translate(0,0) rotate(-90)").select("text").attr("dy",.6*_e).style("font-size",.8*_e+"px").text(this.strings.subtitle.Y);me.select("text").style("font-size",_e+"px").text(this.strings.title_short.Y+(Me.Y?" Â· "+Me.Y:"")).append("tspan").classed("vzb-noexport",!0).style("font-size",.7*_e+"px").attr("dx",(Se?-1:1)*_e*.25+"px").text("â¼");const he=me.node().getBBox().width>ge;me.attr("text-anchor",he?"start":"middle").attr("transform","translate("+(-ve.left-xe)+","+(he?Se?0:ge:ge/2)+") rotate(-90)")}else{be.select("text").text("");const ge=me.select("text").text(this.strings.title.Y+(Me.Y?" Â· "+Me.Y:""));ge.node().getBBox().width>he&&ge.text(this.strings.title_short.Y+(Me.Y?" Â· "+Me.Y:"")),me.attr("text-anchor","start").attr("transform","translate("+(Se?he:10-ve.left)+", -"+xe+")")}}_updateXTitle(){let he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent.width,ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parent.height;const{xTitle:me,xSubTitle:be}=this.DOM,{margin:ve,infoElHeight:_e,xAxisTitleBottomMargin:xe}=this.parent.profileConstants,we=this.services.layout.profile,Me=this.axisTitleComplimentStrings,Se=this.services.locale.isRTL();if("SMALL"!==we){be.attr("transform","translate("+he+","+ge+")").select("text").attr("dy",.3*-_e).style("font-size",.8*_e+"px").text(this.strings.subtitle.X);me.select("text").style("font-size",_e+"px").text(this.strings.title_short.X+(Me.X?" Â· "+Me.X:"")).append("tspan").classed("vzb-noexport",!0).style("font-size",.7*_e+"px").attr("dx",(Se?-1:1)*_e*.25+"px").text("â¼")}else be.select("text").text(""),me.select("text").text(this.strings.title.X+(Me.X?" Â· "+Me.X:""));const De=me.node().getBBox().width>he-100;me.attr("text-anchor",De?"start":"middle").attr("transform","translate("+(De?Se?he:0:he/2)+","+(ge+ve.bottom-xe)+")"),De&&"SMALL"===we&&(me.select("text").text(this.strings.title_short.X),Me.X&&Me.X)}updateSize(){this.services.layout.size;const{margin:he,leftMarginRatio:ge}=this.parent.profileConstants,me=this.parent.elementHeight-he.top-he.bottom||0,be=this.parent.elementWidth-he.left*ge-he.right||0;this._updateSTitle(be,me),this._updateYTitle(be,me),this._updateXTitle(be,me)}}const _e=be.decorate(BCAxisTitles,{MDL:be.computed,strings:be.observable,axisTitleComplimentStrings:be.observable});class BCDecorations{constructor(){}update(he){const be=this,ve=this.ui.decorations,_e=this.services.layout.profile,xe=this.profileConstants.margin,we=ve.xAxisGroups&&ve.xAxisGroups[this.MDL.x.data.concept]&&ve.enabled&&"SMALL"!==_e;if(this.DOM.xAxisGroupsEl.classed("vzb-invisible",!we),we){const _e=ge.Utils.injectIndexes(ve.xAxisGroups[this.MDL.x.data.concept]);let we=this.DOM.xAxisGroupsEl.selectAll(".vzb-bc-x-axis-group").data(_e);we.exit().remove(),we=we.enter().append("g").attr("class","vzb-bc-x-axis-group").each((function(){const he=me.select(this);he.append("text").attr("class","vzb-bc-x-axis-group-line").text("â").style("text-anchor","middle"),he.append("text").attr("class","vzb-bc-x-axis-group-text")})).merge(we);const Me=[];let Se=!1;we.each((function(he,ge){const ve=me.select(this).select("text.vzb-bc-x-axis-group-text").text(be.localise(he.label)),_e={min:he.min,max:he.max};_e.textHeight=ve.node().getBBox().height,_e.textWidth=ve.node().getBBox().width,_e.boundaryMinX_px=be.xScale(he.min||0===he.min?he.min:me.min(be.xScale.domain()))||0,_e.boundaryMaxX_px=be.xScale(he.max||0===he.max?he.max:me.max(be.xScale.domain()))||0,_e.centerX_px=(_e.boundaryMinX_px+_e.boundaryMaxX_px)/2,_e.marginX_px=(Math.abs(_e.boundaryMinX_px-_e.boundaryMaxX_px)-_e.textWidth)/2,_e.marginX_px-_e.textHeight<0&&(Se=!0),Me[ge]=_e})),Se&&we.each((function(he,ge){const ve=me.select(this).select("text.vzb-bc-x-axis-group-text").text(be.localise(he.label_short)),_e=Me[ge];_e.textWidth=ve.node().getBBox().width,_e.marginX_px=(Math.abs(_e.boundaryMinX_px-_e.boundaryMaxX_px)-_e.textWidth)/2,Me[ge]=_e})),we.each((function(ge,be){const ve=me.select(this),_e=0==be,xe=be==Me.length-1,we=Me[be],Se=we.textHeight/4;let De=we.centerX_px;_e&&(De=Me[be+1].boundaryMinX_px-Math.max(Me[be+1].marginX_px,Se)),xe&&(De=Me[be-1].boundaryMaxX_px+Math.max(Me[be-1].marginX_px,Se)),ve.select("text.vzb-bc-x-axis-group-text").style("text-anchor",_e?"end":xe?"start":"middle").transition().duration(he||0).attr("dy","-0.2em").attr("y",we.textHeight).attr("x",De),ve.select("text.vzb-bc-x-axis-group-line").classed("vzb-invisible",xe).transition().duration(he||0).attr("dy","-0.2em").attr("y",.9*we.textHeight).attr("x",we.boundaryMaxX_px)})),we.select("text.vzb-bc-x-axis-group-text").on("mouseenter",(function(he,ge){const ve=Me[ge.i],_e=me.select(this.parentNode);me.select(this).attr("font-weight","bold"),_e.append("rect").lower().attr("x",ve.boundaryMinX_px).attr("width",ve.boundaryMaxX_px-ve.boundaryMinX_px).attr("y",-xe.top).attr("height",be.height+xe.top),(ve.min||0===ve.min)&&_e.append("line").lower().attr("x1",ve.boundaryMinX_px).attr("x2",ve.boundaryMinX_px).attr("y1",-xe.top).attr("y2",be.height),(ve.max||0===ve.max)&&_e.append("line").lower().attr("x1",ve.boundaryMaxX_px).attr("x2",ve.boundaryMaxX_px).attr("y1",-xe.top).attr("y2",be.height)})).on("mouseleave",(function(){const he=me.select(this.parentNode);me.select(this).attr("font-weight",null),he.selectAll("rect").remove(),he.selectAll("line").remove()}))}const Me=this.MDL.x.data.concept==this.MDL.y.data.concept&&ve.enabled&&"SMALL"!==_e;if(this.DOM.lineEqualXY.classed("vzb-invisible",!Me),Me){this.MDL.x.scale.type,this.MDL.y.scale.type;const ge=this.yScale.domain().concat(this.xScale.domain()),be=me.min(ge),ve=me.max(ge),_e=(ve-be)/100,xe=me.range(be,ve,_e).concat(ve),we=me.line().curve(me.curveBasis).x((he=>this.xScale(he))).y((he=>this.yScale(he)));this.DOM.lineEqualXY.transition().duration(he||0).attr("d",we(xe))}}}const xe="rgb(253, 253, 253)",we="rgb(51, 51, 51)",marginScaleH=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return me=>he+me*ge},marginScaleW=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return me=>he+me*ge};function isTrailBubble(he){return!!he[Symbol.for("trailHeadKey")]}const Me=.05;class _VizabiBubbleChart extends ge.Chart{constructor(he){he.subcomponents=[{type:ge.Labels,placeholder:".vzb-bc-labels",options:{CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1},name:"labels"},{type:ge.DateTimeBackground,placeholder:".vzb-bc-date"},{type:_e,placeholder:".vzb-bc-axis-titles"}],he.template='\n      <svg class="vzb-bubblechart-svg vzb-export">\n          <svg class="vzb-bubblechart-svg-back">\n              <g class="vzb-bc-graph">\n                  <g class="vzb-bc-date"></g>\n                  <svg class="vzb-bc-axis-x"><g></g></svg>\n                  <svg class="vzb-bc-axis-y"><g></g></svg>\n                  <line class="vzb-bc-projection-x"></line>\n                  <line class="vzb-bc-projection-y"></line>\n              </g>\n          </svg>\n          <svg class="vzb-bubblechart-svg-main">\n              <g class="vzb-bc-graph">\n                  <g class="vzb-bc-axis-titles"></g>\n\n                  <svg class="vzb-bc-bubbles-crop">\n                      <g class="vzb-zoom-selection"></g>\n                      <rect class="vzb-bc-eventarea"></rect>\n                      <g class="vzb-bc-trails"></g>\n                      <g class="vzb-bc-bubbles"></g>\n                      <rect class="vzb-bc-forecastoverlay vzb-hidden" x="0" y="0" width="100%" height="100%" fill="url(#vzb-bc-pattern-lines-'.concat(he.id,')" pointer-events=\'none\'></rect>\n                  </svg>\n\n                  <rect class="vzb-bc-zoom-rect"></rect>\n              </g>\n              <g class="vzb-datawarning-button vzb-noexport"></g>\n          </svg>\n          <svg class="vzb-bubblechart-svg-front">\n              <g class="vzb-bc-graph">\n                  <svg class="vzb-bc-bubbles-crop">\n                      <g class="vzb-bc-decorations">\n                          <path class="vzb-bc-line-equal-xy vzb-invisible"></path>\n                          <g class="vzb-bc-x-axis-groups"></g>\n                      </g>   \n                      <g class="vzb-bc-lines"></g>\n                      <g class="vzb-bc-bubble-crown vzb-hidden">\n                          <circle class="vzb-crown-glow"></circle>\n                          <circle class="vzb-crown"></circle>\n                      </g>        \n                  </svg>\n                  <svg class="vzb-bc-labels-crop">\n                      <g class="vzb-bc-labels"></g>\n                  </svg>\n              </g>\n          </svg>\n          <svg width="0" height="0">\n              <defs>\n                  <filter class="vzb-noexport" id="vzb-glow-filter-').concat(he.id,'" x="-50%" y="-50%" width="200%" height="200%">\n                      <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur>\n                  </filter>\n                  <pattern class="vzb-noexport" id="vzb-bc-pattern-lines-').concat(he.id,'" x="0" y="0" patternUnits="userSpaceOnUse" width="50" height="50" viewBox="0 0 10 10"> \n                      <path d=\'M-1,1 l2,-2M0,10 l10,-10M9,11 l2,-2\' stroke=\'black\' stroke-width=\'3\' opacity=\'0.08\'/>\n                  </pattern> \n              </defs>\n          </svg>\n      </svg>\n      <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n    '),super(he)}setup(){this.DOM={element:this.element,chartSvg:this.element.select("svg.vzb-bubblechart-svg-main"),chartSvgFront:this.element.select("svg.vzb-bubblechart-svg-front"),chartSvgBack:this.element.select("svg.vzb-bubblechart-svg-back"),chartSvgAll:this.element.selectAll("svg.vzb-bubblechart-svg"),graphAll:this.element.selectAll(".vzb-bc-graph"),bubbleContainerCropAll:this.element.selectAll(".vzb-bc-bubbles-crop"),zoomRect:this.element.select(".vzb-bc-zoom-rect"),eventArea:this.element.select(".vzb-bc-eventarea"),forecastOverlay:this.element.select(".vzb-bc-forecastoverlay"),tooltipMobile:this.element.select(".vzb-tooltip-mobile"),defs:this.element.select("defs")},this.DOM.chartSvg.select(".vzb-bc-graph").call((he=>Object.assign(this.DOM,{graph:he,trailsContainer:he.select(".vzb-bc-trails"),bubbleContainer:he.select(".vzb-bc-bubbles"),bubbleContainerCrop:he.select(".vzb-bc-bubbles-crop"),zoomSelection:he.select(".vzb-zoom-selection")}))),this.DOM.chartSvgFront.select(".vzb-bc-graph").call((he=>{Object.assign(this.DOM,{graphFront:he,labelsContainer:he.select(".vzb-bc-labels"),labelsContainerCrop:he.select(".vzb-bc-labels-crop"),linesContainer:he.select(".vzb-bc-lines"),bubbleCrown:he.select(".vzb-bc-bubble-crown"),decorationsEl:he.select(".vzb-bc-decorations")}),this.DOM.lineEqualXY=this.DOM.decorationsEl.select(".vzb-bc-line-equal-xy"),this.DOM.xAxisGroupsEl=this.DOM.decorationsEl.select(".vzb-bc-x-axis-groups")})),this.DOM.chartSvgBack.select(".vzb-bc-graph").call((he=>{Object.assign(this.DOM,{yAxisElContainer:he.select(".vzb-bc-axis-y"),xAxisElContainer:he.select(".vzb-bc-axis-x"),date:he.select(".vzb-bc-date"),projectionX:he.select(".vzb-bc-projection-x"),projectionY:he.select(".vzb-bc-projection-y")}),this.DOM.yAxisEl=this.DOM.yAxisElContainer.select("g"),this.DOM.xAxisEl=this.DOM.xAxisElContainer.select("g")})),this.DOM.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url(#vzb-glow-filter-".concat(this.id,")")),this._date=this.findChild({type:"DateTimeBackground"}),this._labels=this.findChild({type:"Labels"}),this._panZoom=new PanZoom(this),this.decorations=new BCDecorations(this),this.xAxis=ge.axisSmart("bottom"),this.yAxis=ge.axisSmart("left"),this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this.hoverBubble=!1,this.__lastStep=0;const he=this;me.select("body").on("keydown",(ge=>{"arrow"!==he.ui.cursorMode&&"hand"!==he.ui.cursorMode||(ge.metaKey||ge.ctrlKey)&&he.DOM.chartSvgAll.classed("vzb-zoomin",!0)})).on("keyup",(ge=>{"arrow"!==he.ui.cursorMode&&"hand"!==he.ui.cursorMode||ge.metaKey||ge.ctrlKey||he.DOM.chartSvgAll.classed("vzb-zoomin",!1)})).on("mouseenter",(ge=>{"arrow"!==he.ui.cursorMode&&"hand"!==he.ui.cursorMode||ge.metaKey||ge.ctrlKey||he.DOM.chartSvgAll.classed("vzb-zoomin",!1)})),this.root.element.on("custom-resetZoom",(()=>{he._panZoom.reset(null,500)})),this._panZoom.zoomSelection(this.DOM.bubbleContainerCrop),this.DOM.bubbleContainerCrop.call(this._panZoom.dragRectangle).call(this._panZoom.zoomer).on("dblclick.zoom",null).on("mouseup",(()=>{he.draggingNow=!1})).on("click",(ge=>{const me=he.ui.cursorMode;ge.defaultPrevented||"arrow"===me||"hand"===me||he._panZoom.zoomByIncrement(ge,me,500)}))}get MDL(){var he,ge;return{frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted,superHighlighted:this.model.encoding.superhighlighted,y:this.model.encoding[(null===(he=this.state.alias)||void 0===he?void 0:he.y)||"y"],x:this.model.encoding[(null===(ge=this.state.alias)||void 0===ge?void 0:ge.x)||"x"],size:this.model.encoding.size,color:this.model.encoding.color,label:this.model.encoding.label,trail:this.model.encoding.trail}}draw(){this.localise=this.services.locale.auto({interval:this.MDL.frame.interval}),this.sScale=this.MDL.size.scale.d3Scale,this.trailSizeScale=this.MDL.size.scale.d3Scale.copy(),this.TIMEDIM=this.MDL.frame.data.concept,this.KEYS=this.model.data.space.filter((he=>he!==this.TIMEDIM)),this._updateLayoutProfile()||(this.addReaction(this._updateScales),this.addReaction(this._updateSize),this.addReaction(this._updateOpacity),this.addReaction(this.updateColorPatterns),this.addReaction(this._updateShowYear),this.addReaction(this._updateYear),this.addReaction(this.drawData),this.addReaction(this._zoomToMarkerMaxMin),this.addReaction(this.redrawData),this.addReaction(this._selectDataPoints),this.addReaction(this._highlightDataPoints),this.addReaction(this._blinkSuperHighlighted),this.addReaction(this._drawForecastOverlay),this.addReaction(this._setupCursorMode),this.addReaction(this.updateDecorations))}drawData(){this.processFrameData(),this._updateMarkerSizeLimits(),this._createAndDeleteBubbles()}updateColorPatterns(){if(this.MDL.color.scale.isPattern){const he=this.MDL.color.data.concept;this.DOM.defs.selectAll(".flag").data(this.MDL.color.data.domainData,(he=>he[0])).enter().append("pattern").attr("id",(he=>"flag-".concat(he[0],"-").concat(this.id))).attr("class","flag").attr("width","100%").attr("height","100%").attr("patternContentUnits","objectBoundingBox").html((ge=>ge[1][he])).each((function(){const he=me.select(this).select("svg");he.empty()||(he.attr("viewBox")||he.attr("viewBox","0 0 ".concat(he.attr("width")," ").concat(he.attr("height"))),he.attr("preserveAspectRatio")||he.attr("preserveAspectRatio","xMidYMid slice"),he.attr("width",1).attr("height",1))}))}else this.DOM.defs.selectAll(".flag").remove()}_updateShowYear(){this.DOM.date.classed("vzb-hidden",!this.ui.timeInBackground)}_updateYear(){const he=this._getDuration();this._date.setText(this.MDL.frame.value,he)}__getColor(he,me){return null==me||ge.LegacyUtils.isNaN(me)?xe:this.MDL.color.scale.isPattern?"url(#flag-".concat(this.MDL.color.data.createKeyFn()(he),"-").concat(this.id,")"):this.cScale(me)}__getColorForTrail(he,me){return null==he||ge.LegacyUtils.isNaN(he)||this.MDL.color.scale.isPattern?we:this.trailSizeScale(me)>3?this.cScale(he):this.MDL.color.scale.palette.getColorShade({colorID:he})||we}_createAndDeleteBubbles(){const he=this,ve=this._getDuration(),_e=this._getTransition(ve),xe=this.__dataProcessed;let we;be.runInAction((()=>{we=this.MDL.frame.stepScale.invert(Math.min(this.__lastStep,this.__lastStep=this.MDL.frame.step<<0)-1)})),this.bubbles=this.DOM.bubbleContainer.selectAll(".vzb-bc-entity").data(this.__dataProcessed,(he=>he[Symbol.for("key")])).join((be=>be.append((he=>{const ge=document.createElementNS("http://www.w3.org/2000/svg","g"),me=document.createElementNS("http://www.w3.org/2000/svg","circle"),be=document.createElementNS("http://www.w3.org/2000/svg","line"),ve=document.createElementNS("http://www.w3.org/2000/svg","line");return be.classList.add("vzb-trail-line"),ve.classList.add("vzb-diagonal-line"),ge.appendChild(me),ge.appendChild(ve),isTrailBubble(he)&&ge.appendChild(be),ge})).attr("class","vzb-bc-entity").attr("id",(he=>"vzb-bc-bubble-".concat(he[Symbol.for("key")],"-").concat(this.id))).style("opacity",(he=>he[Symbol.for("opacity")]=this._getBubbleOpacity(he))).call((he=>{ge.LegacyUtils.isTouchDevice()?he.onTap(((he,ge)=>{he.stopPropagation(),this._bubblesInteract().click(he,ge)})).onLongTap((()=>{})):he.on("mouseover",((he,ge)=>{"arrow"!==this.ui.cursorMode&&"hand"!==this.ui.cursorMode||this._labels.dragging||this._bubblesInteract().mouseover(he,ge)})).on("mouseout",((he,ge)=>{"arrow"!==this.ui.cursorMode&&"hand"!==this.ui.cursorMode||this._labels.dragging||this._bubblesInteract().mouseout(he,ge)})).on("click",((he,ge)=>{"arrow"!==this.ui.cursorMode&&"hand"!==this.ui.cursorMode||this._bubblesInteract().click(he,ge)}))})).each((function(be,_e){const we=xe[_e+1]||{},Me=isTrailBubble(be),Se=be[Symbol.for("extrapolated")],De=Me&&!we[Symbol.for("trailHeadKey")],ze=me.select(this),Oe=ze.select("circle"),Ce=ze.select(".vzb-diagonal-line"),ke=be[he._alias("x")],Te=be[he._alias("y")],Le=be.size,Ae=be.color;be.r=ge.LegacyUtils.areaToRadius(he.sScale(Le||0));const Ee=he.xScale(ke),je=he.yScale(Te),Re=he.__getColor(be,Ae);if((!ve||!De)&&(Oe.attr("r",be.r).attr("fill",Re).attr("cy",je).attr("cx",Ee),Se&&Ce.attr("x1",Ee+be.r/Math.sqrt(2)).attr("y1",je+be.r/Math.sqrt(2)).attr("x2",Ee-be.r/Math.sqrt(2)).attr("y2",je-be.r/Math.sqrt(2)),Ce.classed("vzb-hidden",!Se),Me)){const me=ze.select(".vzb-trail-line"),ve=he.xScale(we[he._alias("x")]),_e=he.yScale(we[he._alias("y")]),xe=he.__getColorForTrail(we.color,we.size),Me=ge.LegacyUtils.areaToRadius(he.sScale(we.size||0)),Se=Math.sqrt((Ee-ve)**2+(je-_e)**2)-be.r-Me;me.attr("x1",Ee).attr("y1",je).attr("x2",ve).attr("y2",_e).attr("stroke-dasharray","0 ".concat(be.r," ").concat(Se>0?Se:0," ").concat(Me)).style("stroke-width",he.trailSizeScale(we.size)).style("stroke",xe)}ve&&!Me&&ze.style("opacity",0).transition().duration(.9*ve).style("opacity",be[Symbol.for("opacity")]),Me||he._updateLabel(be,ke,Te,ve,!0,!1)}))),(be=>be.each((function(be,Me){const Se=isTrailBubble(be),De=be[Symbol.for("extrapolated")],ze=xe[Me+1]||{},Oe=Se&&!ze[Symbol.for("trailHeadKey")],Ce=be.size;if(be.r=ge.LegacyUtils.areaToRadius(he.sScale(Ce||0)),Se&&be.frame<we)return;const ke=be[he._alias("x")],Te=be[he._alias("y")],Le=be.color,Ae=he.xScale(ke),Ee=he.yScale(Te),je=he.__getColor(be,Le),Re=me.select(this);if(!ve||!Oe){const me=Re.select("circle");ve&&!Se?me.transition(_e).attr("r",be.r).attr("fill",je).attr("cy",Ee).attr("cx",Ae):me.interrupt().attr("r",be.r).attr("fill",je).attr("cy",Ee).attr("cx",Ae);const we=Re.select(".vzb-diagonal-line");if(ve&&De&&we.classed("vzb-hidden")){const he=+me.attr("cx"),ge=+me.attr("cy"),be=+me.attr("r");we.attr("x1",he+be/Math.sqrt(2)).attr("y1",ge+be/Math.sqrt(2)).attr("x2",he-be/Math.sqrt(2)).attr("y2",ge-be/Math.sqrt(2))}if(we.classed("vzb-hidden",!De),De&&(ve&&!Se?we.transition(_e).attr("x1",Ae+be.r/Math.sqrt(2)).attr("y1",Ee+be.r/Math.sqrt(2)).attr("x2",Ae-be.r/Math.sqrt(2)).attr("y2",Ee-be.r/Math.sqrt(2)):we.interrupt().attr("x1",Ae+be.r/Math.sqrt(2)).attr("y1",Ee+be.r/Math.sqrt(2)).attr("x2",Ae-be.r/Math.sqrt(2)).attr("y2",Ee-be.r/Math.sqrt(2))),Se){const me=Re.select(".vzb-trail-line"),we=he.xScale(ze[he._alias("x")]),Se=he.yScale(ze[he._alias("y")]),De=he.__getColorForTrail(ze.color,ze.size);me.attr("x1",Ae).attr("y1",Ee),ve&&!xe[Me+2][Symbol.for("trailHeadKey")]?me.attr("x2",Ae).attr("y2",Ee).transition(_e).attr("x2",we).attr("y2",Se):me.interrupt().attr("x2",we).attr("y2",Se);const Oe=ge.LegacyUtils.areaToRadius(he.sScale(ze.size||0)),Ce=Math.sqrt((Ae-we)**2+(Ee-Se)**2)-be.r-Oe;me.style("stroke",De).style("stroke-width",he.trailSizeScale(ze.size)).attr("stroke-dasharray","0 ".concat(be.r," ").concat(Ce>0?Ce:0," ").concat(Oe))}}Se||he._updateLabel(be,ke,Te,ve,!1,!1)}))),(ge=>ge.each((function(ge){const be=isTrailBubble(ge);(ve&&!be?me.select(this).transition(_e).duration(.9*ve).style("opacity",0):me.select(this).interrupt()).remove(),be||he._updateLabel(ge,ge[he._alias("x")],ge[he._alias("y")],ve,!0,!0)})))).order()}redrawData(he){this.MDL.color.scale.type,this.MDL.size.scale.type,this.MDL.size.scale.extent;const ve=this,_e=this.__dataProcessed,xe=this._getTransition(he);this.bubbles&&this.bubbles.each((function(be,we){const Me=isTrailBubble(be),Se=_e[we+1]||{},De=Me&&!Se[Symbol.for("trailHeadKey")],ze=be[Symbol.for("extrapolated")],Oe=be[ve._alias("x")],Ce=be[ve._alias("y")],ke=be.size,Te=be.color;be.r=ge.LegacyUtils.areaToRadius(ve.sScale(ke||0));const Le=ve.xScale(Oe),Ae=ve.yScale(Ce),Ee=ve.__getColor(be,Te),je=me.select(this);he&&De&&je.style("opacity",0).transition().delay(he).duration(0).style("opacity",be[Symbol.for("opacity")]);const Re=je.select("circle");he&&!De?Re.transition(xe).attr("r",be.r).attr("fill",Ee).attr("cy",Ae).attr("cx",Le):Re.interrupt().attr("r",be.r).attr("fill",Ee).attr("cy",Ae).attr("cx",Le);const Fe=je.select(".vzb-diagonal-line");if(Fe.classed("vzb-hidden",!ze),ze&&(he&&!De?Fe.transition(xe).attr("x1",Le+be.r/Math.sqrt(2)).attr("y1",Ae+be.r/Math.sqrt(2)).attr("x2",Le-be.r/Math.sqrt(2)).attr("y2",Ae-be.r/Math.sqrt(2)):Fe.interrupt().attr("x1",Le+be.r/Math.sqrt(2)).attr("y1",Ae+be.r/Math.sqrt(2)).attr("x2",Le-be.r/Math.sqrt(2)).attr("y2",Ae-be.r/Math.sqrt(2))),Me){const me=he&&!De?je.select(".vzb-trail-line").transition(xe):je.select(".vzb-trail-line").interrupt(),Me=_e[we+1],Se=ve.xScale(Me[ve._alias("x")]),ze=ve.yScale(Me[ve._alias("y")]),Oe=ve.__getColorForTrail(Me.color,Me.size),Ce=ge.LegacyUtils.areaToRadius(ve.sScale(Me.size||0)),ke=Math.sqrt((Le-Se)**2+(Ae-ze)**2)-be.r-Ce;me.attr("x1",Le).attr("y1",Ae).attr("x2",Se).attr("y2",ze).style("stroke",Oe).style("stroke-width",ve.trailSizeScale(Me.size)).attr("stroke-dasharray","0 ".concat(be.r," ").concat(ke>0?ke:0," ").concat(Ce))}})),be.runInAction((()=>ve._updateLabels(he)))}__getZoomed(he,ge,be){return me[he.toLowerCase()](null!==ge?ge:be)}__getZoomedMin(he,ge){return this.__getZoomed("Min",he,ge)}__getZoomedMax(he,ge){return this.__getZoomed("Max",he,ge)}_zoomToMarkerMaxMin(){this.services.layout.size,this.MDL.x.scale.type,this.MDL.y.scale.type;const he={x:this.MDL.x.scale.zoomed,y:this.MDL.y.scale.zoomed},ge=this.MDL.x.data.domain,me=this.MDL.y.data.domain;if(this.draggingNow)return;this._panZoom.resetZoomState(),this.yScale.range(this._rangeBump([this.height,0])),this.xScale.range(this._rangeBump([0,this.width]));const ve=this.__getZoomedMin(he.x,ge),_e=this.__getZoomedMax(he.x,ge),xe=this.__getZoomedMin(he.y,me),we=this.__getZoomedMax(he.y,me);be.runInAction((()=>{this._panZoom.zoomToMaxMin(ve,_e,xe,we,0,"don't feed these zoom values back to state")}))}_resetZoomMinMaxXReaction(){return{concept:this.MDL.x.data.concept}}_resetZoomMinMaxX(){this.ui.panzoom.x={zoomedMin:null,zoomedMax:null}}_resetZoomMinMaxYReaction(){return{concept:this.MDL.y.data.concept}}_resetZoomMinMaxY(){this.ui.panzoom.y={zoomedMin:null,zoomedMax:null}}_drawForecastOverlay(){this.DOM.forecastOverlay.classed("vzb-hidden",!this.ui.showForecast||!this.ui.showForecastOverlay||!this.ui.endBeforeForecast||this.MDL.frame.value<=this.MDL.frame.parseValue(this.ui.endBeforeForecast))}_updateLayoutProfile(){var he,me;if(this.services.layout.size,this.elementHeight=this.element.node().clientHeight||0,this.elementWidth=this.element.node().clientWidth||0,this.profileConstants=this.services.layout.getProfileConstants((he=this.elementWidth,me=this.elementHeight,{SMALL:{margin:{top:30,bottom:35,left:30,right:10},leftMarginRatio:1,padding:2,minRadiusPx:.5,maxRadiusPx:Math.max(.5,Me*ge.LegacyUtils.hypotenuse(he,me)),minTrailThicknessPx:1,maxTrailThicknessPx:4,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},MEDIUM:{margin:{top:15,bottom:40,left:40,right:15},leftMarginRatio:1.6,padding:2,minRadiusPx:1,maxRadiusPx:Math.max(.5,Me*ge.LegacyUtils.hypotenuse(he,me)),minTrailThicknessPx:2,maxTrailThicknessPx:6,infoElHeight:20,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4},LARGE:{margin:{top:15,bottom:marginScaleH(30,.03)(me),left:marginScaleW(31,.015)(he),right:20},leftMarginRatio:1.8,padding:2,minRadiusPx:1,maxRadiusPx:Math.max(.5,Me*ge.LegacyUtils.hypotenuse(he,me)),minTrailThicknessPx:2,maxTrailThicknessPx:8,infoElHeight:22,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:marginScaleH(0,.01)(me),hideSTitle:!0}}),((he,ge)=>({MEDIUM:{margin:{top:20,bottom:55,left:50,right:20},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4,infoElHeight:26},LARGE:{margin:{top:30,bottom:marginScaleH(45,.03)(ge),left:marginScaleW(35,.025)(he),right:30},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:marginScaleH(-5,.01)(ge),infoElHeight:32,hideSTitle:!0}}))(this.elementWidth,this.elementHeight)),!this.elementHeight||!this.elementWidth)return ge.LegacyUtils.warn("Chart _updateProfile() abort: container is too little or has display:none")}_getDuration(){return this.MDL.frame.playing&&this.MDL.frame.speed||0}_updateScales(){this.yScale=this.MDL.y.scale.d3Scale,this.xScale=this.MDL.x.scale.d3Scale,this._labels.setScales(this.xScale,this.yScale)}get cScale(){return this.MDL.color.scale.d3Scale}_updateSize(){var he,ge,me,be;this.services.layout.size;const{x:ve,y:_e}=this.MDL;this.model.encoding.y.scale.d3Scale;const{graphAll:xe,eventArea:we,bubbleContainerCropAll:Me,labelsContainerCrop:Se,xAxisElContainer:De,xAxisEl:ze,yAxisElContainer:Oe,yAxisEl:Ce,projectionX:ke,projectionY:Te,xAxisGroupsEl:Le}=this.DOM,Ae=this.services.layout.profile,Ee=this.profileConstants.margin,je=this.profileConstants.infoElHeight,Re=this.profileConstants.xAxisTitleBottomMargin,Fe=this.height=this.elementHeight-Ee.top-Ee.bottom||0,Ie=this.width=this.elementWidth-Ee.left*this.profileConstants.leftMarginRatio-Ee.right||0;xe.attr("transform","translate("+Ee.left*this.profileConstants.leftMarginRatio+","+Ee.top+")"),this._date.resizeText(Ie,Fe),we.attr("width",Ie).attr("height",Math.max(0,Fe)),this.yScale.range(this._rangeBump([Fe,0])),this.xScale.range(this._rangeBump([0,Ie]));const Pe="rank"===_e.scale.type?{ticks:_e.rollup.map((he=>he.tickPosition)),formatter:he=>_e.rollup.find((ge=>ge.tickPosition===he)).name,textAnchor:"start",repositionLabels:Object.fromEntries(_e.rollup.map((he=>[he.tickPosition,{x:1.5*je,y:-je}])))}:{};this.yAxis.scale(this.yScale).tickSizeInner(-Ie).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-Ie,0).labelerOptions(Object.assign({scaleType:_e.scale.type,toolMargin:Ee,limitMaxTickNumber:6,bump:this.profileConstants.maxRadiusPx/2,viewportLength:Fe,formatter:this.services.locale.auto({shareOrPercent:null===(he=_e.data)||void 0===he||null===(ge=he.conceptProps)||void 0===ge?void 0:ge.format})},Pe)),this.xAxis.scale(this.xScale).tickSizeInner(-Fe).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-Fe,0).labelerOptions({scaleType:ve.scale.type,toolMargin:Ee,bump:this.profileConstants.maxRadiusPx/2,viewportLength:Ie,formatter:this.services.locale.auto({shareOrPercent:null===(me=ve.data)||void 0===me||null===(be=me.conceptProps)||void 0===be?void 0:be.format})}),Me.attr("width",Ie).attr("height",Math.max(0,Fe)),Se.attr("width",Ie).attr("height",Math.max(0,Fe)),De.attr("width",Ie+1).attr("height",this.profileConstants.margin.bottom+Fe).attr("y",-1).attr("x",-1),ze.attr("transform","translate(1,"+(1+Fe)+")"),Oe.attr("width",this.profileConstants.margin.left+Ie).attr("height",Math.max(0,Fe)).attr("x",-this.profileConstants.margin.left),Ce.attr("transform","translate("+(this.profileConstants.margin.left-1)+",0)"),Ce.call(this.yAxis),ze.call(this.xAxis);const Ne=this.profileConstants.maxRadiusPx;ke.attr("y1",this.yScale.range()[0]+Ne),Te.attr("x2",this.xScale.range()[0]-Ne),Le.style("font-size",.8*je+"px"),this.root.findChild({type:"_DataWarning"}).setOptions({width:this.elementWidth,height:this.elementHeight,vertical:"bottom",horizontal:"right",right:Ee.right,bottom:Re,wLimit:("SMALL"!==Ae?.5:1)*(this.elementWidth-this.DOM.graph.select(".vzb-bc-axis-x-title").node().getBBox().width-3*je)})}_rangeBump(he,me){const be=this.profileConstants.maxRadiusPx;if(me=me?-1:1,ge.LegacyUtils.isArray(he)&&he.length>1){let ge=he[0],ve=he[he.length-1];return ge<ve?(ge+=be*me,ve-=be*me,ge>ve&&(ge=ve=(ge+ve)/2)):ge>ve&&(ge-=be*me,ve+=be*me,ge<ve&&(ge=ve=(ge+ve)/2)),[ge,ve]}ge.LegacyUtils.warn("rangeBump error: input is not an array or empty")}processFrameData(){return this.__dataProcessed=this.model.dataArray}_getTransition(he){return he?me.transition().duration(he).ease(me.easeLinear):me.transition()}_bubblesInteract(){const he=this;return{mouseover(ge,me){he.hoverBubble=!0,he.MDL.highlighted.data.filter.set(me),he._labels.showCloseCross(me,!0)},mouseout(ge,me){he.hoverBubble=!1,he.MDL.highlighted.data.filter.delete(me),he._labels.showCloseCross(me,!1)},click(ge,me){he.draggingNow||isTrailBubble(me)||he.MDL.selected.data.filter.toggle(me)}}}_updateMarkerSizeLimits(){this.services.layout.size,this.MDL.size.scale.domain;const{minRadiusPx:he,maxRadiusPx:me,minTrailThicknessPx:be,maxTrailThicknessPx:ve}=this.profileConstants;this.root.ui.minMaxRadius={min:he,max:me};const _e=this.MDL.size.scale.extent||[0,1];let xe=ge.LegacyUtils.radiusToArea(Math.max(me*_e[0],he)),we=ge.LegacyUtils.radiusToArea(Math.max(me*_e[1],he));this.sScale.range([xe,we]),this.trailSizeScale.domain(this.MDL.size.scale.domain).range([be,ve])}_setTooltip(he,ge,me,be,ve,_e){if(he){const ve={};_e&&(ve.valueY=_e[this._alias("y")],ve.valueX=_e[this._alias("x")],ve.valueS=_e.size,ve.valueC=_e.color,ve.valueLST=_e.size_label||null,ve.labelText=this.__labelWithoutFrame(_e,this.localise));const xe={};xe.labelX0=this.xScale.invert?this.xScale.invert(ge):_e.x,xe.labelY0=this.yScale.invert?this.yScale.invert(me):_e.y,xe.scaledS0=be,xe.scaledC0=null,this._labels.setTooltip(_e,he,xe,ve)}else this._labels.setTooltip()}_getLabelText(he){return this.KEYS.map((ge=>he.label[ge])).join(",")}_updateOpacity(he){const ge=this.MDL.highlighted.data.filter,me=this.MDL.selected.data.filter;this.__highlightedMarkers=new Map(ge.markers),this.__selectedMarkers=new Map(me.markers),this.__someSelected=0!=this.__selectedMarkers.size,this.__someHighlighted=0!=this.__highlightedMarkers.size;const be=he||this.bubbles;be&&be.style("opacity",(he=>this._getBubbleOpacity(he,this.ui))).style("pointer-events",(he=>0===this._getBubbleOpacity(he,this.ui)?"none":"visible"))}_getBubbleOpacity(he){const ge=this.ui;return this.__highlightedMarkers.has(he[Symbol.for("key")])?ge.opacityHighlight:isTrailBubble(he)?ge.opacityRegular:this.__selectedMarkers.has(he[Symbol.for("key")])?ge.opacitySelect:this.__someSelected?ge.opacitySelectDim:this.__someHighlighted?ge.opacityHighlightDim:ge.opacityRegular}_setBubbleCrown(he,ge,me,be,ve){const _e=this.DOM.bubbleCrown;null!=he?(_e.classed("vzb-hidden",!1),_e.select(".vzb-crown").attr("cx",he).attr("cy",ge).attr("r",me).attr("fill",ve?"none":be),_e.selectAll(".vzb-crown-glow").attr("cx",he).attr("cy",ge).attr("r",me+10).attr("stroke",be)):_e.classed("vzb-hidden",!0)}_axisProjections(he){const{projectionX:ge,projectionY:me,xAxisEl:be,yAxisEl:ve}=this.DOM;if(null!=he){const _e=he[this._alias("y")],xe=he[this._alias("x")],we=he.r;this.ui.whenHovering.showProjectionLineX&&this.xScale(xe)>0&&this.xScale(xe)<this.width&&this.yScale(_e)+we<this.height&&ge.style("opacity",1).attr("y2",this.yScale(_e)+we).attr("x1",this.xScale(xe)).attr("x2",this.xScale(xe)),this.ui.whenHovering.showProjectionLineY&&this.yScale(_e)>0&&this.yScale(_e)<this.height&&this.xScale(xe)-we>0&&me.style("opacity",1).attr("y1",this.yScale(_e)).attr("y2",this.yScale(_e)).attr("x1",this.xScale(xe)-we),this.ui.whenHovering.higlightValueX&&"rank"!==this.MDL.x.scale.type&&be.call(this.xAxis.highlightValue(xe)),this.ui.whenHovering.higlightValueY&&"rank"!==this.MDL.y.scale.type&&ve.call(this.yAxis.highlightValue(_e))}else ge.style("opacity",0),me.style("opacity",0),be.call(this.xAxis.highlightValue("none")),ve.call(this.yAxis.highlightValue("none"))}_highlightDataPoints(){const he=this,ge=this.MDL.highlighted.data.filter,me=this.MDL.selected.data.filter;this.someHighlighted=ge.any();const be=this.MDL.trail.show,ve=this.MDL.trail.starts,_e=this.MDL.trail.groupDim;if(1===ge.markers.size){const xe=ge.markers.keys().next().value,we=Object.assign(this.model.dataMap.getByStr(xe)),Me=we[Symbol.for("trailHeadKey")]||we[Symbol.for("key")],Se=he.xScale(we[he._alias("x")]),De=he.yScale(we[he._alias("y")]),ze=we.r,Oe=he.__getColor(we,we.color);let Ce=!1;(Se+ze<0||Se-ze>this.width||De+ze<0||De-ze>this.height)&&(Ce=!0);const ke=me.has(Me),Te=!(ve[Me]-we[_e]),Le=isTrailBubble(we);let Ae="";if(Ae=ke?!be||Te||!Le&&!this.hoverBubble?"":this.localise(we[_e]):this.__labelWithoutFrame(we),he._labels.highlight(null,!1),he._labels.highlight({[Symbol.for("key")]:Me},!0),ke){const ge=!Le;
//!d.trailStartTime || d.trailStartTime == _this.model.time.formatDate(_this.time);
he._setBubbleCrown(Se,De,ze,Oe,ge)}Ce||he._axisProjections(we),Ae&&!Ce&&he._setTooltip(Ae,Se,De,ze+3,Oe,we)}else this._axisProjections(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1)}_blinkSuperHighlighted(){if(!this.MDL.superHighlighted)return;const he=this.MDL.superHighlighted.data.filter;this.bubbles.classed("vzb-super-highlighted",(ge=>he.has(ge)))}_selectDataPoints(){const he=this,me=this.MDL.selected.data.filter;ge.LegacyUtils.isTouchDevice()?(he.MDL.highlighted.data.filter.clear(),he._labels.showCloseCross(null,!1)):he._setTooltip(),he.someSelected=me.any(),he.nonSelectedOpacityZero=!1}_setupCursorMode(){const he=this.DOM.chartSvgAll;"plus"===this.ui.cursorMode?(he.classed("vzb-zoomin",!0),he.classed("vzb-zoomout",!1),he.classed("vzb-panhand",!1)):"minus"===this.ui.cursorMode?(he.classed("vzb-zoomin",!1),he.classed("vzb-zoomout",!0),he.classed("vzb-panhand",!1)):"hand"===this.ui.cursorMode?(he.classed("vzb-zoomin",!1),he.classed("vzb-zoomout",!1),he.classed("vzb-panhand",!0)):(he.classed("vzb-zoomin",!1),he.classed("vzb-zoomout",!1),he.classed("vzb-panhand",!1))}updateDecorations(){this.services.layout.size,this.MDL.x.scale.zoomed,this.MDL.y.scale.zoomed,this.decorations.update.bind(this)(this._getDuration())}_updateLabel(he,me,be,ve,_e,we){const Me=this.MDL.selected.data.filter.markers,Se=he[Symbol.for("key")];if(Me.has(Se)){const Me=this.MDL.trail,De={};let ze="";if(we&&!Me.show&&(_e=!0),Me.show&&Se in Me.starts){const he=Me.starts[Se];if(he>=this.MDL.frame.value||_e){const me=this.model.getDataMapByFrameValue(he,"trail.addTrails").getByStr(Se);De.labelText=ze=this.__labelWithFrame(me),De.labelX0=me[this._alias("x")],De.labelY0=me[this._alias("y")],De.scaledC0=null!=me.color?this.cScale(me.color):xe,De.scaledS0=me.size||0===me.size?ge.LegacyUtils.areaToRadius(this.sScale(me.size)):null,De.valueS0=me.size,me.hidden=we,this._labels.updateLabel(me,De,De.labelX0,De.labelY0,me.size,me.color,ze,me.size_label,ve,_e)}}else De.labelText=ze=this.__labelWithoutFrame(he),De.labelX0=me,De.labelY0=be,De.scaledC0=null!=he.color?this.cScale(he.color):xe,De.scaledS0=he.size||0===he.size?ge.LegacyUtils.areaToRadius(this.sScale(he.size)):null,De.valueS0=he.size,he.hidden=we,this._labels.updateLabel(he,De,me,be,he.size,he.color,ze,he.size_label,ve,_e)}}_updateLabels(he){const me=this.MDL.selected.data.filter,be=this.MDL.trail;for(const ve of me.markers.keys()){if(!(ve in be.starts))continue;this._labels.cached[ve]||(this._labels.cached[ve]={});const me=this._labels.cached[ve],_e=be.show?this.model.getDataMapByFrameValue(be.starts[ve],"trail.addTrails"):this.model.dataMap;if(!_e.hasByStr(ve))continue;const we=_e.getByStr(ve);me.labelText=this[be.show&&this.ui.timeInTrails?"__labelWithFrame":"__labelWithoutFrame"](we),me.labelX0=we[this._alias("x")],me.labelY0=we[this._alias("y")],me.scaledC0=null!=we.color?this.cScale(we.color):xe,me.scaledS0=we.size||0===we.size?ge.LegacyUtils.areaToRadius(this.sScale(we.size)):null,me.valueS0=we.size,me.initTextBBox=null,me.initFontSize=null,this._labels.updateLabel({[Symbol.for("key")]:ve},null,null,null,null,null,null,we.size_label,he)}}__labelWithoutFrame(he){const me=this.model.data.space;return"object"==typeof he.label?Object.entries(he.label).filter((he=>{let[ge,me]=he;return ge!=this.MDL.frame.data.concept})).sort(((he,ge)=>{let[be,ve]=he,[_e,xe]=ge;return me.indexOf(be)-me.indexOf(_e)})).map((he=>{let[me,be]=he;return ge.LegacyUtils.isNumber(be)?me+": "+be:be})).join(", "):null!=he.label?""+he.label:he[Symbol.for("key")]}__labelWithFrame(he){const ge=this.MDL.frame.data.concept;return this.__labelWithoutFrame(he)+" "+this.localise(he&&he.label&&he.label[ge]||he&&he.frame||this.MDL.frame.value)}_alias(he){var ge;return(null===(ge=this.state.alias)||void 0===ge?void 0:ge[he])||he}}_VizabiBubbleChart.DEFAULT_UI={};const Se=be.decorate(_VizabiBubbleChart,{MDL:be.computed,cScale:be.computed});ge.Chart.add("bubblechart",Se);class BubbleChart extends ge.BaseComponent{constructor(he){var me,be;const ve=(null===(me=he.options)||void 0===me||null===(be=me.markerNames)||void 0===be?void 0:be.bubble)||"bubble",_e=he.model.markers[ve];he.Vizabi.utils.applyDefaults(_e.config,BubbleChart.DEFAULT_CORE(ve));const xe=he.Vizabi.stores.encodings.modelTypes.frame,{marker:we,splashMarker:Me}=xe.splashMarker(_e);he.model.markers[ve]=we,he.name="bubblechart",he.subcomponents=[{type:ge.Repeater,placeholder:".vzb-repeater",model:we,options:{repeatedComponent:Se,repeatedComponentCssClass:"vzb-bubblechart"},name:"chart"},{type:ge.TimeSlider,placeholder:".vzb-timeslider",model:we,name:"time-slider"},{type:ge.SteppedSlider,placeholder:".vzb-speedslider",model:we,name:"speed-slider"},{type:ge.TreeMenu,placeholder:".vzb-treemenu",model:we,name:"tree-menu"},{type:ge.DataWarning,placeholder:".vzb-datawarning",options:{button:".vzb-datawarning-button"},model:we,name:"data-warning"},{type:ge.DataNotes,placeholder:".vzb-datanotes",model:we},{type:ge.Dialogs,placeholder:".vzb-dialogs",model:we,name:"dialogs"},{type:ge.ButtonList,placeholder:".vzb-buttonlist",model:we,name:"buttons"},{type:ge.SpaceConfig,placeholder:".vzb-spaceconfig",options:{button:".vzb-spaceconfig-button"},model:we,name:"space-config"},{type:ge.ErrorMessage,placeholder:".vzb-errormessage",model:we,name:"error-message"}],he.template='\n      <div class="vzb-repeater"></div>\n      <div class="vzb-animationcontrols">\n        <div class="vzb-timeslider"></div>\n        <div class="vzb-speedslider"></div>\n      </div>\n      <div class="vzb-sidebar">\n        <div class="vzb-dialogs"></div>\n        <div class="vzb-buttonlist"></div>\n      </div>\n      <div class="vzb-treemenu"></div>\n      <div class="vzb-datawarning"></div>\n      <div class="vzb-spaceconfig"></div>\n      <div class="vzb-datanotes"></div>\n      <div class="vzb-errormessage"></div>\n    ',he.locale.Vizabi=he.Vizabi,he.layout.Vizabi=he.Vizabi,he.services={Vizabi:new ge.CapitalVizabiService({Vizabi:he.Vizabi}),locale:new ge.LocaleService(he.locale),layout:new ge.LayoutService(he.layout)},super(he),this.splashMarker=Me}}BubbleChart.DEFAULT_UI={buttons:{buttons:["colors","markercontrols","trails","moreoptions","presentation","sidebarcollapse","fullscreen"]},dialogs:{dialogs:{popup:["colors","markercontrols","moreoptions"],sidebar:["colors","markercontrols","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","technical","repeat","presentation","about"]},markercontrols:{}},chart:{show_ticks:!0,showForecast:!1,showForecastOverlay:!0,pauseBeforeForecast:!0,opacityHighlight:1,opacitySelect:1,opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:.8,timeInBackground:!0,timeInTrails:!0,lockNonSelected:0,panWithArrow:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!0,decorations:{enabled:!0,xAxisGroups:null},superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{enabled:!0,dragging:!0,removeLabelBox:!1},margin:{left:0,top:0}}},BubbleChart.mainComponent=Se,BubbleChart.DEFAULT_CORE=he=>({requiredEncodings:["x","y","size"],encoding:{show:{modelType:"selection"},selected:{modelType:"selection",data:{filter:{ref:"markers.".concat(he,".encoding.trail.data.filter")}}},highlighted:{modelType:"selection"},superhighlighted:{modelType:"selection"},x:{scale:{allowedTypes:["linear","log","genericLog","pow","time"]}},y:{modelType:"lane",scale:{allowedTypes:["linear","log","genericLog","pow","time","rank"]}},order:{modelType:"order",data:{ref:"markers.".concat(he,".encoding.size.data.config")}},size:{scale:{modelType:"size",allowedTypes:["linear","point"],range:[0,50]}},color:{scale:{modelType:"color"}},label:{data:{modelType:"entityPropertyDataConfig"}},frame:{modelType:"frame"},trail:{modelType:"trail"},size_label:{data:{constant:"_default"},scale:{extent:[0,.35],modelType:"size",allowedTypes:["linear","point"]}},repeat:{modelType:"repeat",allowEnc:["y","x"]}}}),BubbleChart.versionInfo={version:"4.3.0",build:1742823486243,package:{homepage:"https://github.com/vizabi/bubblechart#readme",name:"@vizabi/bubblechart",description:"Vizabi bubble chart"},sharedComponents:ge.versionInfo},he.Base=BubbleChart,Object.defineProperty(he,"__esModule",{value:!0})})),function(he,ge){"object"==typeof exports&&"undefined"!=typeof module?ge(exports,require("@vizabi/shared-components"),require("d3"),require("mobx")):"function"==typeof define&&define.amd?define(["exports","@vizabi/shared-components","d3","mobx"],ge):ge((he="undefined"!=typeof globalThis?globalThis:he||self).LineChart={},he.VizabiSharedComponents,he.d3,he.mobx)}(window,(function(he,ge,me,be){const{ICON_QUESTION:ve}=ge.Icons,_e={SMALL:{margin:{top:30,right:100,left:40,bottom:20},infoElHeight:16,yAxisTitleBottomMargin:6,tick_spacing:60,text_padding:12,lollipopRadius:6,limitMaxTickNumberX:5},MEDIUM:{margin:{top:40,right:125,left:60,bottom:25},infoElHeight:20,yAxisTitleBottomMargin:6,tick_spacing:80,text_padding:15,lollipopRadius:7,limitMaxTickNumberX:10},LARGE:{margin:{top:50,right:150,left:75,bottom:30},infoElHeight:22,yAxisTitleBottomMargin:6,tick_spacing:100,text_padding:20,lollipopRadius:9,limitMaxTickNumberX:0}},xe={MEDIUM:{margin:{top:70,bottom:40,left:70,right:180},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26,text_padding:30},LARGE:{margin:{top:70,bottom:50,left:70,right:220},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,text_padding:36,hideSTitle:!0}};class _VizabiLineChart extends ge.BaseComponent{constructor(he){he.template='\n      <svg class="vzb-linechart-svg vzb-export">\n          <g class="vzb-lc-graph">\n\n              <svg class="vzb-lc-axis-x"><g></g></svg>\n              <svg class="vzb-lc-axis-y"><g></g></svg>\n              <text class="vzb-lc-axis-x-value"></text>\n              <text class="vzb-lc-axis-y-value"></text>\n              <svg class="vzb-lc-lines-crop">\n                  <svg class="vzb-lc-lines"></svg>\n                  <line class="vzb-lc-projection-x"></line>\n                  <line class="vzb-lc-projection-y"></line>\n              </svg>\n              <svg class="vzb-lc-labels-crop">\n                  <g class="vzb-lc-labels">\n                      <line class="vzb-lc-vertical-now"></line>\n                  </g>\n              </svg>\n\n              <g class="vzb-lc-axis-y-title">\n                <text></text>\n              </g>\n              <g class="vzb-lc-axis-x-title">\n                <text></text>\n              </g>\n              <g class="vzb-lc-axis-y-info vzb-noexport"></g>\n\n              <g class="no-data-message vzb-hidden">                  \n                  <text></text>\n              </g>\n\n              \x3c!--filter id="vzb-lc-filter-dropshadow"> \n                <feOffset result="offOut" in="SourceGraphic" dx="0" dy="2" />\n                <feColorMatrix result = "matrixOut" in = "offOut" type = "matrix"\n                              values = "0.3 .0 .0 .0 .0\n                                        .0 .3 .0 .0 .0\n                                        .0 .0 .3 .0 .0\n                                        1.0 1.0 1.0 1.0 .0"/>\n                <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="0.8" />\n                <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n              </filter--\x3e\n\n              <rect class="vzb-lc-forecastoverlay vzb-hidden" fill="url(#vzb-lc-pattern-lines-'.concat(he.id,')" pointer-events=\'none\'></rect>\n          </g>\n          <g class="vzb-datawarning-button vzb-noexport"></g>\n      </svg>\n      <div class="vzb-tooltip vzb-hidden"></div>\n      <svg>\n        <defs>\n            <pattern class="vzb-noexport" id="vzb-lc-pattern-lines-').concat(he.id,'" x="0" y="0" patternUnits="userSpaceOnUse" width="50" height="50" viewBox="0 0 10 10"> \n                <path d=\'M-1,1 l2,-2M0,10 l10,-10M9,11 l2,-2\' stroke=\'red\' stroke-width=\'3\' opacity=\'0.08\'/>\n            </pattern> \n        </defs>\n      </svg>\n    '),super(he)}setup(){this.DOM={element:this.element,graph:this.element.select(".vzb-lc-graph"),xAxisElContainer:this.element.select(".vzb-lc-axis-x"),yAxisElContainer:this.element.select(".vzb-lc-axis-y"),xTitle:this.element.select(".vzb-lc-axis-x-title"),yTitle:this.element.select(".vzb-lc-axis-y-title"),yInfo:this.element.select(".vzb-lc-axis-y-info"),linesContainerCrop:this.element.select(".vzb-lc-lines-crop"),linesContainer:this.element.select(".vzb-lc-lines"),labelsContainerCrop:this.element.select(".vzb-lc-labels-crop"),labelsContainer:this.element.select(".vzb-lc-labels"),noDataMessage:this.element.select(".no-data-message"),tooltip:this.element.select(".vzb-tooltip"),projectionX:this.element.select(".vzb-lc-projection-x"),projectionY:this.element.select(".vzb-lc-projection-y"),forecastOverlay:this.element.select(".vzb-lc-forecastoverlay")},this.DOM.xAxisEl=this.DOM.xAxisElContainer.select("g"),this.DOM.yAxisEl=this.DOM.yAxisElContainer.select("g"),this.DOM.verticalNow=this.DOM.labelsContainer.select(".vzb-lc-vertical-now"),this.totalLength_1={},this.KEY=Symbol.for("key"),this.collisionResolver=ge.collisionResolver().selector(".vzb-lc-label").value("valueY").filter((function(he,ge){return he.valueX-ge==0&&!he.hidden})).KEY(this.KEY),this._initInfoElements(),this.line=me.line().curve(me[this.isFrameOnXaxis&&this.ui.curve?this.ui.curve:"curveLinear"]).x((he=>this.xScale(he[0]))).y((he=>this.yScale(he[1]))),this.lineWidthScale=me.scaleLinear().domain([0,20]).range([7,1]).clamp(!0),this.xAxis=ge.axisSmart("bottom"),this.yAxis=ge.axisSmart("left"),this.DOM.graph.on("click",(()=>{const{selected:{data:{filter:he}},highlighted:{data:{filter:ge}}}=this.MDL;ge.any()&&he.toggle(ge.markers.keys().next().value)})),this.DOM.linesContainerCrop.on("mousemove",this._entityMousemove.bind(this)).on("mouseleave",this._entityMouseout.bind(this))}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected,highlighted:this.model.encoding.highlighted,x:this.model.encoding[this.state.alias.x||"x"],y:this.model.encoding[this.state.alias.y||"y"],color:this.model.encoding.color,label:this.model.encoding.label,repeat:this.model.encoding.repeat}}get profileConstants(){return this.services.layout.size,this.services.layout.getProfileConstants(_e,xe)}get height(){return this.services.layout.size,this.element.node().clientHeight||0}get width(){return this.services.layout.size,this.element.node().clientWidth||0}checkLayout(){if(!this.height||!this.width)return ge.LegacyUtils.warn("Chart _updateProfile() abort: container is too little or has display:none")}draw(){this.localise=this.services.locale.auto({interval:this.MDL.frame.interval}),this.TIMEDIM=this.MDL.frame.data.concept,this.checkLayout()||(this.addReaction(this.updateTime),this.addReaction(this.updateUIStrings),this.addReaction(this.addOrRemoveLinesAndLabels),this.addReaction(this.updateColors),this.addReaction(this.updateSize,{throttle_ms:50}),this.addReaction(this.drawForecastOverlay),this.addReaction(this.redrawDataPoints),this.addReaction(this.highlightLines),this.addReaction(this.updateNoDataMessage))}drawForecastOverlay(){if(this.services.layout.size,this.MDL.x.scale.zoomed,this.MDL.y.scale.zoomed,this.checkLayout())return;this.DOM.forecastOverlay.classed("vzb-hidden",!this.ui.showForecast||!this.ui.showForecastOverlay||!this.ui.endBeforeForecast||this.MDL.frame.value<=this.MDL.frame.parseValue(this.ui.endBeforeForecast));const he=this.isFrameOnXaxis?Math.min(this.xScale.range()[1],this.xScale(this.MDL.frame.parseValue(this.ui.endBeforeForecast))):this.xScale.range()[0],ge=this.xScale.range()[1]-he;this.DOM.forecastOverlay.attr("x",he).attr("width",ge).attr("y",this.yScale.range()[1]).attr("height",this.yScale.range()[0])}_initInfoElements(){const he=this,dataNotesDialog=()=>this.root.findChild({type:"DataNotes"}),timeSlider=()=>this.root.findChild({type:"TimeSlider"});ge.LegacyUtils.setIcon(this.DOM.yInfo,ve).on("click",(()=>{dataNotesDialog().pin()})).on("mouseover",(function(){if(timeSlider().ui.dragging)return;const me=this.getBBox(),be=ge.LegacyUtils.makeAbsoluteContext(this,this.farthestViewportElement)(me.x-10,me.y+me.height+10),ve=he.root.element.node().getBoundingClientRect(),_e=he.element.node().getBoundingClientRect();dataNotesDialog().setEncoding(he.MDL.y).show().setPos(be.x+_e.left-ve.left,be.y)})).on("mouseout",(()=>{timeSlider().ui.dragging||dataNotesDialog().hide()}))}_getLabelText(he){return he.values&&(he=he.values[0]),"object"==typeof he.label?Object.entries(he.label).filter((he=>he[0]!=this.MDL.frame.data.concept)).map((he=>ge.LegacyUtils.isNumber(he[1])?he[0]+": "+he[1]:he[1])).join(", "):null!=he.label?""+he.label:he[Symbol.for("key")]}updateUIStrings(){const he={title:{Y:ge.Utils.getConceptName(this.MDL.y,this.localise),X:ge.Utils.getConceptName(this.MDL.x,this.localise)}},me=this.root.findChild({type:"TreeMenu"});this.DOM.yTitle.classed("vzb-disabled",me.state.ownReadiness!==ge.Utils.STATUS.READY).on("click",(()=>{me.encoding(this._alias("y")).alignX("left").alignY("top").updateView().toggle()})).select("text").text(he.title.Y),this.DOM.xTitle.classed("vzb-disabled",me.state.ownReadiness!==ge.Utils.STATUS.READY).on("click",(()=>{me.encoding(this._alias("x")).alignX("right").alignY("bottom").updateView().toggle()})).select("text").text(he.title.X);const be=this.MDL.y.data.conceptProps;this.DOM.yInfo.classed("vzb-hidden",!be.description&&!be.sourceLink)}updateTime(){const{frame:he}=this.MDL,ge=null===this.time?he.value:this.time;this.time=he.value,this.duration=he.playing&&this.time-ge>0&&he.speed||0,this.stepIndex=he.stepScale(this.time)}updateColors(){const he=this,{color:ge}=this.MDL;ge.scale.d3Scale,this.labels.each((function(ge){const{color:me,colorShadow:be}=he._getColorsByValue(ge.values[0].color);this.circle.style("fill",me),this.labelGroup.style("fill",be)})),this.lines.each((function(ge){const{color:me,colorShadow:be}=he._getColorsByValue(ge.values[0].color);this.path1&&this.path1.style("stroke",be),this.path2.style("stroke",he.shadowWidth?me:be)}))}_getColorsByValue(he){const me=this.MDL.color.scale.d3Scale;return{color:null==he||ge.LegacyUtils.isNaN(he)?"#888":me(he),colorShadow:this.MDL.color.scale.palette.getColorShade({colorID:he})||"#333"}}_processFramesData(){const he=this.KEY,ge=new Map;return this.model.getTransformedDataMap("filterRequired").each((me=>me.forEach(((me,be)=>{ge.has(be)||ge.set(be,{[he]:be,values:[]}),ge.get(be).values.push(me)})))),[...ge.values()].map((he=>(he.shiftIndex=this.MDL.frame.stepScale(he.values[0][this.TIMEDIM]),he)))}updateNoDataMessage(){this.services.layout.size,this.DOM.noDataMessage.classed("vzb-hidden",this._processFramesData().length),this._processFramesData().length||this.DOM.noDataMessage.attr("transform","translate(".concat(this.width/2-this.profileConstants.margin.left,", ").concat(this.height/2,")")).select("text").text(this.localise("hints/no-data-available"))}get isFrameOnXaxis(){return this.MDL.frame.data.concept===this.MDL.x.data.concept}addOrRemoveLinesAndLabels(){this.MDL.x.scale.zoomed;const he=this,ge=this.KEY;this.cached={},this.data=this._processFramesData(),this.lineWidth=this.lineWidthScale(this.data.length),this.shadowWidth=this.lineWidth>=2?1.3*this.lineWidth:null,this.DOM.labelsContainer.classed("small",!this.shadowWidth),be.runInAction((()=>{this.lines&&this.lines.remove(),this.lines=this.DOM.linesContainer.selectAll(".vzb-lc-entity").data(this.data,(he=>he[ge])).enter().append("g").attr("class",(he=>"vzb-lc-entity vzb-lc-entity-"+he[ge])).each((function(){this.view=me.select(this),he.shadowWidth&&(this.path1=this.view.append("path").attr("class","vzb-lc-line-shadow")),this.path2=this.view.append("path").attr("class","vzb-lc-line")})),this.labels&&this.labels.remove(),this.labels=this.DOM.labelsContainer.selectAll(".vzb-lc-entity").data(this.data,(he=>he[ge])).enter().append("g").attr("class","vzb-lc-entity").on("mouseover",((ge,me)=>{he.MDL.highlighted.data.filter.set(me,JSON.stringify(me.values[me.values.length-1]))})).on("mouseout",((ge,me)=>{he.MDL.highlighted.data.filter.delete(me)})).each((function(){this.view=me.select(this),this.title=this.view.append("title"),this.circle=this.view.append("circle").attr("class","vzb-lc-circle").attr("cx",0),this.labelGroup=this.view.append("g").attr("class","vzb-lc-label"),this.labelText=this.labelGroup.append("text").attr("class","vzb-lc-labeltext").attr("dy",".35em")}))}))}redrawDataPoints(){this.services.layout.size,this.MDL.x.scale.type,this.MDL.y.scale.type,this.MDL.x.scale.zoomed,this.MDL.y.scale.zoomed;const he=this.xScale.domain(),be=this.yScale.domain();if(!he.length||!be.length||[...he,...be].some((he=>null==he||isNaN(he))))return ge.LegacyUtils.warn("Line chart redrawDataPoints() short circuit because scale domain looks bad",he,be);const ve=this,_e=this.KEY,{verticalNow:xe,xAxisEl:we}=this.DOM,{frame:Me}=this.MDL;this.lines.each((function(he){const ge=he.values.slice(0,Math.ceil(ve.stepIndex-he.shiftIndex<=0?0:ve.stepIndex-he.shiftIndex)).map((he=>[he[ve._alias("x")],he[ve._alias("y")]])).filter((he=>he[1]||0===he[1]));let be=ve.model.dataMap.getByStr(he[_e])||{};if(be={x:be[ve._alias("x")],y:be[ve._alias("y")]},!be.y&&0!==be.y||!be.x&&0!==be.x||ge.push([be.x,be.y]),ge.length>0?ve.cached[he[_e]]={valueX:ge[ge.length-1][0],valueY:ge[ge.length-1][1]}:delete ve.cached[he[_e]],this.path1&&this.path1.style("stroke-width",ve.shadowWidth+"px").attr("transform","translate(0, "+(ve.shadowWidth-ve.lineWidth)+")").attr("d",ve.line(ge)||""),this.path2.style("stroke-width",ve.lineWidth+"px").attr("d",ve.line(ge)||""),Me.playing&&null===ve.totalLength_1[he[_e]]&&(ve.totalLength_1[he[_e]]=this.path2.node().getTotalLength()),Me.playing){const ge=this.path2.node().getTotalLength();this.path1&&this.path1.interrupt().attr("stroke-dasharray",ge).attr("stroke-dashoffset",ge-ve.totalLength_1[he[_e]]).transition().delay(0).duration(ve.duration).ease(me.easeLinear).attr("stroke-dashoffset",0),this.path2.interrupt().attr("stroke-dasharray",ge).attr("stroke-dashoffset",ge-ve.totalLength_1[he[_e]]).transition().delay(0).duration(ve.duration).ease(me.easeLinear).attr("stroke-dashoffset",0),ve.totalLength_1[he[_e]]=ge}else ve.totalLength_1[he[_e]]=null,this.path1&&this.path1.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"),this.path2.attr("stroke-dasharray","none").attr("stroke-dashoffset","none")}));const Se=this.data.length<this.ui.labels.min_number_of_entities_when_values_hide;this.labels.each((function(he){if(ve.cached[he[_e]])if(ve.isFrameOnXaxis&&ve.time>me.max(ve.xScale.domain()))this.view.classed("vzb-hidden",!0);else{const ge=ve._getLabelText(he),be=Se?7:13,xe=ge.length<=be?ge:ge.substring(0,be).trim()+"â¦";he.valueX=ve.xScale(ve.cached[he[_e]].valueX),he.valueY=ve.yScale(ve.cached[he[_e]].valueY),this.view.classed("vzb-hidden",!1).transition().duration(ve.duration).ease(me.easeLinear).attr("transform","translate("+he.valueX+",0)"),this.circle.transition().duration(ve.duration).ease(me.easeLinear).attr("cy",he.valueY+1);const we=xe+" "+ve.yAxis.tickFormat()(ve.cached[he[_e]].valueY);this.labelText.text(Se?we:xe),this.title.text(we),this.labelGroup.transition().duration(ve.duration).ease(me.easeLinear).attr("transform","translate(0,"+he.valueY+")")}else this.view.classed("vzb-hidden",!0)})),this.isFrameOnXaxis&&xe.transition().duration(ve.duration).ease(me.easeLinear).attr("transform","translate("+ve.xScale(ve.time)+",0)"),this.isFrameOnXaxis&&!this.hoveringNow&&this.time-Me.start!=0&&this.time<=me.max(ve.xScale.domain())?(ve.ui.hideXAxisValue||we.call(this.xAxis.highlightTransDuration(this.duration).highlightValue(this.time)),xe.style("opacity",1)):(this.ui.hideXAxisValue||we.call(this.xAxis.highlightValue("none")),xe.style("opacity",0)),0==this.duration&&me.timerFlush(),clearTimeout(this.collisionTimeout),this.collisionTimeout=setTimeout((()=>{this.labels.call(this.collisionResolver.time(this.xScale(this.time)))}),1.5*this.duration)}get xScale(){this.services.layout.size;const{margin:he}=this.profileConstants,ge=this.width-he.left-he.right||0;let me=this.MDL.x.scale.zoomed;return me&&"time"===this.MDL.x.scale.type&&(me=me.map((he=>this.MDL.frame.parseValue(he)))),this.MDL.x.scale.d3Scale.domain(me).range([0,ge])}get yScale(){this.services.layout.size;const{margin:he,lollipopRadius:ge}=this.profileConstants,me=this.height-he.top-he.bottom||0,be=this.MDL.y.scale.zoomed;return this.MDL.y.scale.d3Scale.domain(be).range([me-ge,ge])}updateSize(){if(this.services.layout.size,this.MDL.x.scale.zoomed,this.MDL.y.scale.zoomed,this.checkLayout())return;const{x:he,y:be}=this.MDL,{graph:ve,linesContainerCrop:_e,labelsContainerCrop:xe,xAxisElContainer:we,xAxisEl:Me,yAxisElContainer:Se,yAxisEl:De,xTitle:ze,yTitle:Oe,yInfo:Ce,tooltip:ke,verticalNow:Te,projectionX:Le,projectionY:Ae}=this.DOM,{margin:Ee,text_padding:je,lollipopRadius:Re,limitMaxTickNumberX:Fe,yAxisTitleBottomMargin:Ie,infoElHeight:Pe}=this.profileConstants,Ne=this.services.locale.isRTL();this.labels.selectAll(".vzb-lc-circle").attr("r",this.shadowWidth?Re:.8*Re),this.labels.selectAll(".vzb-lc-labeltext").attr("dx",this.shadowWidth?2*Re:.8*Re*2),1==this.MDL.repeat.ncolumns&&this.services.layout.setHGrid([this.width-Ee.right]),this.cropHeight=this.height-Ee.top-Ee.bottom||0,this.cropWidth=this.width-Ee.left-Ee.right||0,_e.attr("width",this.cropWidth).attr("height",Math.max(0,this.cropHeight)),xe.attr("width",this.cropWidth+Ee.right).attr("height",Math.max(0,this.cropHeight)),this.collisionResolver.scale(this.yScale).height(this.cropHeight),ve.attr("transform","translate("+Ee.left+","+Ee.top+")"),this.yAxis.scale(this.yScale).tickSizeInner(-this.cropWidth).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.cropWidth,0).labelerOptions({scaleType:be.scale.type,toolMargin:Ee,limitMaxTickNumber:6,viewportLength:this.cropHeight,formatter:this.localise}),this.xAxis.scale(this.xScale).tickSizeInner(-this.cropHeight).tickSizeOuter(0).tickSizeMinor(-this.cropHeight,0).tickPadding(6).labelerOptions({scaleType:he.scale.type,limitMaxTickNumber:Fe,toolMargin:Ee,bump:2*je,formatter:this.localise}),we.attr("width",this.cropWidth+2*je).attr("height",Ee.bottom+this.cropHeight).attr("y",-1).attr("x",-je),Me.attr("transform","translate("+(je-1)+","+(this.cropHeight+1)+")"),Se.attr("width",Ee.left+this.cropWidth).attr("height",Math.max(0,this.cropHeight)).attr("x",-Ee.left),De.attr("transform","translate("+(Ee.left-1)+",0)"),De.call(this.yAxis),Me.call(this.xAxis);const Be=this.DOM.xTitle.select("text").node().getBBox(),qe=Be.width+je+Ie>Ee.right;ze.style("font-size",Pe+"px").style("text-anchor",qe?"end":"start").attr("transform","translate("+(this.cropWidth+je+Ie)+","+(this.cropHeight+Be.height*(qe?-.3:.72))+")"),Oe.style("font-size",Pe+"px").attr("transform","translate("+(10-Ee.left+(Ne?1.4*Pe:0))+", -"+Ie+")");const Ue=Oe.node().getBBox(),He=ge.LegacyUtils.transform(Oe.node());Ce.attr("transform","translate("+(Ne?10-Ee.left:Ue.x+He.translateX+Ue.width+.4*Pe)+","+(He.translateY-.8*Pe)+")").select("svg").attr("width",Pe+"px").attr("height",Pe+"px"),Te.attr("y1",this.yScale.range()[0]).attr("y2",this.yScale.range()[1]).attr("x1",0).attr("x2",0),Le.attr("y1",this.yScale.range()[0]),Ae.attr("x2",this.xScale.range()[0]),ge.LegacyUtils.isTouchDevice()&&(ke.classed("vzb-hidden",!0),Te.style("opacity",1),Le.style("opacity",0),Ae.style("opacity",0),Me.call(this.xAxis.highlightValue(this.isFrameOnXaxis?this.time:"none")),De.call(this.yAxis.highlightValue("none")),ve.selectAll(".vzb-lc-entity").each((function(){me.select(this).classed("vzb-dimmed",!1).classed("vzb-hovered",!1)})),this.hoveringNow=null),this.root.findChild({type:"_DataWarning"}).setOptions({width:this.width,height:this.height,vertical:"top",horizontal:"right",right:30,top:Ee.top+Ue.y,wLimit:this.width-Ue.width-2*Pe})}_entityMousemove(he){const ve=this,_e=ve.KEY,{frame:xe,highlighted:{data:{filter:we}}}=this.MDL,Me=me.pointer(he,ve.element.node());let Se=ve.xScale.invert(Me[0]-ve.profileConstants.margin.left);ve.time-Se<0?Se=ve.time:Se<xe.scale.domain[0]&&(Se=xe.scale.domain[0]);const De=Me[1]-ve.profileConstants.margin.top,ze=ve.model.getDataMapByFrameValue(Se),Oe=ve._getNearestKey(De,ze,ve._alias("y"),ve.yScale.bind(ve));if(!ze.hasByStr(Oe))return;const Ce=ze.getByStr(Oe)[ve._alias("y")],ke={[_e]:Oe};if(we.has(ke)||be.runInAction((()=>{we.config.markers={},we.set(ke)})),ve.hoveringNow=ke,ge.LegacyUtils.isNaN(Ce))return;const Te=ve.xScale(Se),Le=ve.yScale(Ce),{tooltip:Ae,verticalNow:Ee,projectionX:je,projectionY:Re,xAxisEl:Fe,yAxisEl:Ie}=this.DOM;ve.ui.whenHovering.showTooltip&&Ae.style("left",Te+ve.profileConstants.margin.left+"px").style("bottom",ve.cropHeight-Le+ve.profileConstants.margin.bottom+"px").text(ve.yAxis.tickFormat()(Ce)).classed("vzb-hidden",!1),ve.ui.whenHovering.hideVerticalNow&&Ee.style("opacity",0),ve.ui.whenHovering.showProjectionLineX&&je.style("opacity",1).attr("y2",Le).attr("x1",Te).attr("x2",Te),ve.ui.whenHovering.showProjectionLineY&&Re.style("opacity",1).attr("y1",Le).attr("y2",Le).attr("x1",Te),ve.ui.whenHovering.higlightValueX&&Fe.call(ve.xAxis.highlightValue(this.isFrameOnXaxis?Se:"none").highlightTransDuration(0)),ve.ui.whenHovering.higlightValueY&&Ie.call(ve.yAxis.highlightValue(this.isFrameOnXaxis?Ce:"none").highlightTransDuration(0)),clearTimeout(ve.unhoverTimeout)}_entityMouseout(he){const ge=this;he.relatedTarget&&me.select(he.relatedTarget).classed("vzb-tooltip")||(ge.unhoverTimeout=setTimeout((()=>{const he=ge.DOM;he.tooltip.classed("vzb-hidden",!0),he.verticalNow.style("opacity",1),he.projectionX.style("opacity",0),he.projectionY.style("opacity",0),he.xAxisEl.call(ge.xAxis.highlightValue(this.isFrameOnXaxis?ge.time:"none")),he.yAxisEl.call(ge.yAxis.highlightValue("none")),ge.hoveringNow&&ge.MDL.highlighted.data.filter.delete(ge.hoveringNow),ge.hoveringNow=null}),300))}highlightLines(){const he=this,ge=this.KEY,be=this.ui.opacityRegular,ve=this.ui.opacitySelectDim,{selected:{data:{filter:_e}},highlighted:{data:{filter:xe}}}=this.MDL,we=xe.any();this.someSelected=_e.any(),this.nonSelectedOpacityZero=ve<.01;const Me={};_e.markers.forEach(((he,ge)=>{Me[ge]=!0})),this.lines.style("opacity",(me=>xe.has(me)?1:he.someSelected?Me[me[ge]]?1:ve:we?.3:be)),this.labels.style("opacity",(me=>xe.has(me)?(me.sortValue=1,1):(me.sortValue=0,he.someSelected?Me[me[ge]]?1:ve:we?.3:be))).attr("pointer-events",(me=>he.someSelected&&he.nonSelectedOpacityZero&&!Me[me[ge]]?(me.hidden=!0,"none"):(me.hidden=!1,"visible"))).sort((function(he,ge){return me.ascending(he.sortValue,ge.sortValue)}))}_getNearestKey(he,ge,me,be){const ve=this.someSelected&&this.nonSelectedOpacityZero?[...this.MDL.selected.data.filter.markers.keys()].filter((he=>ge.hasByStr(he))):[...ge.keys()];let _e=ve[0];for(let xe=1;xe<ve.length;xe++){let we=ve[xe];Math.abs((be?be(ge.getByStr(we)[me]):ge.getByStr(we)[me])-he)<Math.abs((be?be(ge.getByStr(_e)[me]):ge.getByStr(_e)[me])-he)&&(_e=we)}return _e}_alias(he){return this.state.alias[he]||he}}_VizabiLineChart.DEFAULT_UI={showForecast:!1,showForecastOverlay:!0,pauseBeforeForecast:!0,opacityHighlight:1,opacitySelect:1,opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:.5,hideXAxisValue:!1,curve:"curveMonotoneX",whenHovering:{showTooltip:!1,hideVerticalNow:!1,showProjectionLineX:!1,showProjectionLineY:!1,higlightValueX:!1,higlightValueY:!1},labels:{min_number_of_entities_when_values_hide:3}};const we=be.decorate(_VizabiLineChart,{MDL:be.computed,height:be.computed,width:be.computed,xScale:be.computed,yScale:be.computed,lines:be.observable,labels:be.observable,profileConstants:be.computed,isFrameOnXaxis:be.computed});class LineChart extends ge.BaseComponent{constructor(he){var me,be;const ve=(null===(me=he.options)||void 0===me||null===(be=me.markerNames)||void 0===be?void 0:be.line)||"line";he.Vizabi.utils.applyDefaults(he.model.markers[ve].config,LineChart.DEFAULT_CORE(ve));const _e=he.model.markers[ve];he.name="linechart",he.subcomponents=[{type:ge.Repeater,placeholder:".vzb-repeater",model:_e,options:{repeatedComponent:we,repeatedComponentCssClass:"vzb-linechart"},name:"chart"},{type:ge.TimeSlider,placeholder:".vzb-timeslider",model:_e,name:"time-slider"},{type:ge.SteppedSlider,placeholder:".vzb-speedslider",model:_e,name:"speed-slider"},{type:ge.TreeMenu,placeholder:".vzb-treemenu",model:_e,name:"tree-menu"},{type:ge.DataWarning,placeholder:".vzb-datawarning",options:{button:".vzb-datawarning-button"},model:_e,name:"data-warning"},{type:ge.DataNotes,placeholder:".vzb-datanotes",model:_e},{type:ge.Dialogs,placeholder:".vzb-dialogs",model:_e,name:"dialogs"},{type:ge.ButtonList,placeholder:".vzb-buttonlist",model:_e,name:"buttons"},{type:ge.SpaceConfig,placeholder:".vzb-spaceconfig",options:{button:".vzb-spaceconfig-button"},model:_e,name:"space-config"},{type:ge.ErrorMessage,placeholder:".vzb-errormessage",model:_e,name:"error-message"}],he.template='\n      <div class="vzb-repeater"></div>\n      <div class="vzb-animationcontrols">\n        <div class="vzb-timeslider"></div>\n        <div class="vzb-speedslider"></div>\n      </div>\n      <div class="vzb-sidebar">\n        <div class="vzb-dialogs"></div>\n        <div class="vzb-buttonlist"></div>\n      </div>\n      <div class="vzb-treemenu"></div>\n      <div class="vzb-datawarning"></div>\n      <div class="vzb-spaceconfig"></div>\n      <div class="vzb-datanotes"></div>\n      <div class="vzb-errormessage"></div>\n    ',he.locale.Vizabi=he.Vizabi,he.layout.Vizabi=he.Vizabi,he.services={Vizabi:new ge.CapitalVizabiService({Vizabi:he.Vizabi}),locale:new ge.LocaleService(he.locale),layout:new ge.LayoutService(he.layout)},super(he)}}LineChart.DEFAULT_UI={chart:{}},LineChart.DEFAULT_CORE=he=>({requiredEncodings:["x","y"],encoding:{selected:{modelType:"selection"},highlighted:{modelType:"selection"},y:{scale:{allowedTypes:["linear","log","genericLog","pow"]}},x:{data:{concept:{ref:"markers.".concat(he,".encoding.frame.data.concept")}},scale:{allowedTypes:["linear","log","genericLog","pow","time"]}},color:{data:{concept:{filter:{concept_type:{$in:["entity_set","entity_domain"]}}},allow:{space:{filter:{concept_type:{$ne:"time"}}}}},scale:{modelType:"color"}},label:{data:{modelType:"entityPropertyDataConfig"}},repeat:{modelType:"repeat",allowEnc:["y","x"]},frame:{modelType:"frame"}}}),LineChart.versionInfo={version:"4.2.0",build:1741193500393,package:{homepage:"https://github.com/vizabi/linechart#readme",name:"@vizabi/linechart",description:"Vizabi line chart"},sharedComponents:ge.versionInfo},he.Base=LineChart,Object.defineProperty(he,"__esModule",{value:!0})})),function(he,ge){"object"==typeof exports&&"undefined"!=typeof module?ge(exports,require("@vizabi/shared-components"),require("mobx"),require("d3")):"function"==typeof define&&define.amd?define(["exports","@vizabi/shared-components","mobx","d3"],ge):ge((he="undefined"!=typeof globalThis?globalThis:he||self).BarRank={},he.VizabiSharedComponents,he.mobx,he.d3)}(window,(function(he,ge,me,be){const{ICON_QUESTION:ve}=ge.Icons,_e="rgb(51, 51, 51)",xe={SMALL:{margin:{top:60,right:20,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:18,barMargin:3,barLabelMargin:5,barValueMargin:5,barRankMargin:6,scrollMargin:25,longestLabelLength:12},MEDIUM:{margin:{top:60,right:25,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:21,barMargin:3,barLabelMargin:5,barValueMargin:5,barRankMargin:10,scrollMargin:30,longestLabelLength:12},LARGE:{margin:{top:60,right:30,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:28,barMargin:4,barLabelMargin:5,barValueMargin:5,barRankMargin:10,scrollMargin:30,longestLabelLength:12}},we={MEDIUM:{margin:{top:60,right:30,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:25,infoElMargin:10,barHeight:25,barMargin:6},LARGE:{margin:{top:60,right:35,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:10,barHeight:30,barMargin:6}};class _VizabiBarRank extends ge.BaseComponent{constructor(he){he.template='\n      <svg class="vzb-br-header">\n        <g class="vzb-br-title">\n          <text></text>\n        </g>\n        <g class="vzb-br-total">\n          <text></text>\n        </g>\n        <g class="vzb-br-axis-info vzb-noexport"></g>\n      </svg>\n\n      <div class="vzb-br-barsviewport vzb-dialog-scrollable">\n        <svg class="vzb-br-bars-svg vzb-export">\n          <g class="vzb-br-bars"></g>\n          <rect class="vzb-br-forecastoverlay vzb-hidden" x="0" y="0" width="100%" height="100%" fill="url(#vzb-br-pattern-lines-'.concat(he.id,')" pointer-events=\'none\'></rect>\n        </svg>\n      </div>\n\n      <svg class="vzb-br-footer">\n        <g class="vzb-datawarning-button vzb-noexport"></g>\n      </svg>\n\n      <svg class="vzb-br-tooltip-svg vzb-hidden">\n        <g class="vzb-br-tooltip vzb-hidden">\n          <rect class="vzb-tooltip-border"></rect>\n          <text class="vzb-tooltip-text"></text>\n        </g>\n      </svg>\n      \n      <svg>\n        <defs>\n            <pattern class="vzb-noexport" id="vzb-br-pattern-lines-').concat(he.id,'" x="0" y="0" patternUnits="userSpaceOnUse" width="50" height="50" viewBox="0 0 10 10"> \n                <path d=\'M-1,1 l2,-2M0,10 l10,-10M9,11 l2,-2\' stroke=\'black\' stroke-width=\'3\' opacity=\'0.08\'/>\n            </pattern> \n        </defs>\n      </svg>\n    '),super(he)}setup(){this.DOM={header:this.element.select(".vzb-br-header"),title:this.element.select(".vzb-br-title"),lilFrameDisplay:this.element.select(".vzb-br-total"),info:this.element.select(".vzb-br-axis-info"),barViewport:this.element.select(".vzb-br-barsviewport"),barSvg:this.element.select(".vzb-br-bars-svg"),barContainer:this.element.select(".vzb-br-bars"),forecastOverlay:this.element.select(".vzb-br-forecastoverlay"),footer:this.element.select(".vzb-br-footer"),tooltipSvg:this.element.select(".vzb-br-tooltip-svg"),tooltip:this.element.select(".vzb-br-tooltip")},this._cache={}}get MDL(){return{frame:this.model.encoding.frame,selected:this.model.encoding.selected.data.filter,highlighted:this.model.encoding.highlighted.data.filter,x:this.model.encoding[this.state.alias.x||"x"],color:this.model.encoding.color,label:this.model.encoding.label}}draw(){this.localise=this.services.locale.auto({interval:this.MDL.frame.interval}),this.addReaction(this._drawForecastOverlay),this._updateLayoutProfile()||(this.addReaction(this._getDuration),this.addReaction(this._drawHeader),this.addReaction(this._drawInfoEl),this.addReaction(this._drawFooter),this.addReaction(this._estimateLabelAndValueWidth),this.addReaction(this._drawData),this.addReaction(this._updateOpacity),this.addReaction(this._resizeSvg),this.addReaction(this._scroll),this.addReaction(this._drawForecastOverlay),this.addReaction(this._updateFrameDisplay))}_getDuration(){return this.MDL.frame?(this.frameValue_1=this.frameValue,this.frameValue=this.MDL.frame.value,this.__duration=this.MDL.frame.playing&&this.frameValue-this.frameValue_1>0?this.MDL.frame.speed:0):0}_drawForecastOverlay(){this.DOM.forecastOverlay.classed("vzb-hidden",!this.ui.showForecast||!this.ui.showForecastOverlay||!this.ui.endBeforeForecast||this.MDL.frame.value<=this.MDL.frame.parseValue(this.ui.endBeforeForecast))}_updateLayoutProfile(){if(this.services.layout.size,this.profileConstants=this.services.layout.getProfileConstants(xe,we),this.height=this.element.node().clientHeight||0,this.width=this.element.node().clientWidth||0,!this.height||!this.width)return ge.LegacyUtils.warn("Chart _updateProfile() abort: container is too little or has display:none")}_updateFrameDisplay(){const he=this._getDuration();he?this.DOM.lilFrameDisplay.select("text").transition("text").delay(he).text(this.localise(this.MDL.frame.value)):this.DOM.lilFrameDisplay.select("text").interrupt().text(this.localise(this.MDL.frame.value))}_drawHeader(){const{margin:he,headerMargin:me,infoElHeight:be,infoElMargin:ve}=this.profileConstants;this.services.layout.size,this.services.layout.projector,this.DOM.header.attr("height",he.top);const _e=this.DOM.title;_e.select("text").text(ge.Utils.getConceptName(this.MDL.x,this.localise));const xe=_e.node().getBBox(),we=me.left,Me=me.top+xe.height;_e.attr("transform","translate(".concat(we,", ").concat(Me,")"));const Se=this.DOM.info;Se.select("svg").attr("width","".concat(be,"px")).attr("height","".concat(be,"px"));const De=we+_e.node().getBBox().width+ve,ze=me.top+be/4;Se.attr("transform","translate(".concat(De,", ").concat(ze,")"));const Oe=this.DOM.lilFrameDisplay.node().getBBox(),Ce=this.width-me.right-Oe.width,ke=me.top+Oe.height;this.DOM.lilFrameDisplay.attr("transform","translate(".concat(Ce,", ").concat(ke,")")).classed("vzb-hidden",this.ui.lilFrameDisplayAlwaysHidden||"LARGE"!==this.services.layout.profile||xe.width+Oe.width+10>this.width),this.treemenu=this.root.findChild({type:"TreeMenu"}),_e.classed("vzb-disabled",this.treemenu.state.ownReadiness!==ge.Utils.STATUS.READY).on("click",(()=>this.treemenu.encoding(this._alias("x")).alignX("left").alignY("top").updateView().toggle()))}_drawInfoEl(){const he=this.root.findChild({type:"DataNotes"}),me=this.MDL.x.data.conceptProps,be=this.profileConstants.infoElHeight,_e=this;this.DOM.info.on("click",(()=>{he.pin()})).on("mouseover",(function(){const me=this.getBBox(),be=ge.LegacyUtils.makeAbsoluteContext(this,this.farthestViewportElement)(me.x-10,me.y+me.height+10);he.setEncoding(_e.MDL.x).show().setPos(be.x,be.y)})).on("mouseout",(()=>{he.hide()})).html(ve).select("svg").attr("width",be+"px").attr("height",be+"px").classed("vzb-hidden",!me.description&&!me.sourceLink)}_drawFooter(){const{margin:he}=this.profileConstants;this.services.layout.size,this.services.layout.projector,this.DOM.footer.style("height","".concat(he.bottom,"px")),this.root.findChild({type:"_DataWarning"}).setOptions({width:this.width,height:this.height,vertical:"top",horizontal:"right",right:he.right})}_getLabelText(he){const me=this.model.data.space;return"object"==typeof he.label?Object.entries(he.label).filter((he=>{let[ge,me]=he;return ge!=this.MDL.frame.data.concept})).sort(((he,ge)=>{let[be,ve]=he,[_e,xe]=ge;return me.indexOf(be)-me.indexOf(_e)})).map((he=>{let[me,be]=he;return ge.LegacyUtils.isNumber(be)?me+": "+be:be})).join(", "):null!=he.label?""+he.label:he[Symbol.for("key")]}_getShortLabelText(he){let ge=this._getLabelText(he);const me=this.profileConstants.longestLabelLength;return ge.length>me?ge.substring(0,me-1)+"â¦":ge}get __dataProcessed(){return this.nullValuesCount=0,Object.keys(this._cache).forEach((he=>{this.model.dataMap.hasByStr(he)||delete this._cache[he]})),this.model.dataArray.concat().sort(((he,ge)=>be.descending(he[this._alias("x")],ge[this._alias("x")]))).reduce(((he,ge,me)=>{const be=ge[Symbol.for("key")],ve=this._cache[be],_e=ge[this._alias("x")],xe=ge.color,we=_e||0===_e;we||this.nullValuesCount++;const Me=we?this.localise(_e):this.localise("hints/nodata"),Se=this._getShortLabelText(ge),De=me&&he[me-1].formattedValue===Me?he[me-1].rank:me+1;return ve?he.push(Object.assign(ve,{value:_e,formattedValue:Me,shortLabelText:Se,index:me,rank:De,color:xe,changedFormattedValue:Me!==ve.formattedValue,changedShortLabelText:Se!==ve.shortLabelText,changedValue:_e!==ve.value,changedIndex:me!==ve.index,changedColor:xe!==ve.color,isNew:!1})):he.push(this._cache[be]=Object.assign({},ge,{value:_e,formattedValue:Me,shortLabelText:Se,index:me,rank:De,color:xe,changedFormattedValue:!0,changedShortLabelText:!0,changedValue:!0,changedIndex:!0,changedColor:!0,isNew:!0})),he}),[])}_drawData(){const he=JSON.stringify(this.services.layout.size)+this.width+this.height+this.services.layout.projector,ge=he!==this.sizes_1;this.sizes_1=he,this._createAndDeleteBars();const{barLabelMargin:me,barValueMargin:ve,barRankMargin:_e,scrollMargin:xe,margin:we,longestLabelLength:Me}=this.profileConstants;let Se=this.MDL.x.scale.domain;Se={min:be.min(Se),max:be.max(Se)};const De=Math.abs(Se.max)>=Math.abs(Se.min),ze=De?Se.min<0:Se.max>0,Oe=this.__labelCharWidth*Me,Ce=(this.width-we.right-we.left-me-xe-(ze?0:Oe))/(ze?2:1),ke=this.MDL.x.scale.d3Scale;ke.range([0,Ce]),"log"!==this.MDL.x.scale.type&&ke.domain([0,Math.max(...ke.domain())]);const Te=ze?Ce:Oe,isLtrValue=he=>De?he>=0:he>0,transition=he=>this.__duration?he.transition().duration(this.__duration).ease(be.easeLinear):he.interrupt(),valueAnchor=he=>isLtrValue(he)?"start":"end";this.DOM.barContainer.attr("transform","translate(".concat(Te+(De?we.left:we.right)+me,", 0)")),this.__dataProcessed.forEach((he=>{const{value:be}=he,{barHeight:xe}=this.profileConstants,we=Math.max(0,be&&ke(Math.abs(be)))||0;(he.isNew||ge||he.changedValue)&&he.DOM.label.attr("x",(he=>isLtrValue(he)?-me:me)(be)).attr("y",xe/2).attr("text-anchor",(he=>isLtrValue(he)?"end":"start")(be)),(he.isNew||he.changedShortLabelText)&&(he.DOM.label.text(he.shortLabelText),he.DOM.title.text(this._getLabelText(he))),(he.isNew||ge)&&he.DOM.rect.attr("rx",xe/4).attr("ry",xe/4).attr("height",xe),(he.isNew||ge||he.changedValue)&&he.DOM.value.attr("x",(he=>isLtrValue(he)?ve:-ve)(be)).attr("y",xe/2).attr("text-anchor",valueAnchor(be)),(he.isNew||ge||he.changedFormattedValue)&&(he.DOM.value.text(he.formattedValue),he.valueWidth=ve+he.formattedValue.length*this.__valueCharWidth),(he.isNew||ge||he.changedIndex||he.changedValue)&&he.DOM.rank.text(be||0===be?"#"+he.rank:"").attr("y",xe/2).attr("text-anchor",valueAnchor(be)),(he.isNew||ge||he.changedIndex)&&transition(he.DOM.group).attr("transform","translate(0, ".concat(this._getBarPosition(he.index),")")),(he.isNew||ge||he.changedValue)&&transition(he.DOM.rect).attr("width",we).attr("x",be<0?-we:0),(he.isNew||ge||he.changedValue)&&transition(he.DOM.rank).attr("x",(Math.max(we,he.valueWidth||0)+_e)*(isLtrValue(be)?1:-1)),(he.isNew||he.changedColor)&&this._updateColor(he)}))}_createAndDeleteBars(){const he=this,ge=this.DOM.barContainer.selectAll(".vzb-br-bar").data(this.__dataProcessed,(he=>he[Symbol.for("key")]));ge.exit().remove(),ge.enter().append("g").each((function(ge){const me=ge[Symbol.for("key")],ve=be.select(this).attr("class","vzb-br-bar").attr("id","vzb-br-bar-".concat(me,"-").concat(he.id)).classed("vzb-selected",(()=>he.MDL.selected.has(ge))).on("mousemove",(()=>he.MDL.highlighted.set(ge))).on("mouseout",(()=>he.MDL.highlighted.delete(ge))).on("click",(()=>he.MDL.selected.toggle(ge))),_e=ve.append("text").attr("class","vzb-br-label").attr("dy",".325em"),xe=ve.append("rect").attr("stroke","transparent"),we=ve.append("text").attr("class","vzb-br-value").attr("dy",".325em"),Me=ve.append("text").attr("class","vzb-br-rank").attr("dy",".325em"),Se=ve.append("title");Object.assign(ge,{DOM:{group:ve,label:_e,rect:xe,value:we,rank:Me,title:Se}})}))}_estimateLabelAndValueWidth(){this.services.layout.size,this.services.layout.projector;const he=this.DOM.barContainer.append("g").attr("class","vzb-br-bar vzb-br-probe vzb-invisible");this.__labelCharWidth=he.append("text").attr("class","vzb-br-label").text("0").node().getBBox().width,this.__valueCharWidth=he.append("text").attr("class","vzb-br-value").text("~").node().getBBox().width,he.remove()}_getBarPosition(he){return(this.profileConstants.barHeight+this.profileConstants.barMargin)*he}_resizeSvg(){const{barHeight:he,barMargin:ge}=this.profileConstants;this.DOM.barSvg.attr("height","".concat((he+ge)*this.__dataProcessed.length,"px"))}_scroll(){const he=this.DOM.barContainer.select(".vzb-selected");if(!he.empty()){const ge=he.datum(),me=this._getBarPosition(ge.index),{margin:be}=this.profileConstants,ve=me-(this.height-be.top-be.bottom+this.profileConstants.barHeight)/2;this.DOM.barViewport.transition().duration(this.__duration).tween("scrollfor"+ge.entity,this._scrollTopTween(ve))}}_scrollTopTween(he){return function(){const ge=this,me=be.interpolateNumber(this.scrollTop,he);return function(he){ge.scrollTop=me(he)}}}_updateColor(he){const ge=he.color,me=ge||0===ge,be=me?this._getColor(ge):"rgb(253, 253, 253)",ve=me?"transparent":_e,xe=me?this._getDarkerColor(he.color):_e;he.DOM.rect.style("fill",be).style("stroke",ve),he.DOM.value.style("fill",xe),he.DOM.label.style("fill",xe),he.DOM.rank.style("fill",xe)}_getColor(he){return be.rgb(this.MDL.color.scale.d3Scale(he))}_getDarkerColor(he){return this._getColor(he).darker(2)}_updateOpacity(){const he=this,{opacityHighlightDim:ge,opacitySelectDim:me,opacityRegular:be}=this.ui,ve=this.MDL.highlighted.markers.size>0,_e=this.MDL.selected.markers.size>0;this.DOM.barContainer.selectAll(".vzb-br-bar").style("opacity",(xe=>he.MDL.highlighted.has(xe)||he.MDL.selected.has(xe)?be:_e?me:ve?ge:be))}_alias(he){return this.state.alias[he]||he}}_VizabiBarRank.DEFAULT_UI={lilFrameDisplayAlwaysHidden:!1,showForecast:!1,showForecastOverlay:!0,pauseBeforeForecast:!0,opacityHighlight:1,opacitySelect:1,opacityHighlightDim:.3,opacitySelectDim:.5,opacityRegular:1};const Me=me.decorate(_VizabiBarRank,{MDL:me.computed,__dataProcessed:me.computed});class BarRank extends ge.BaseComponent{constructor(he){var me,be;const ve=(null===(me=he.options)||void 0===me||null===(be=me.markerNames)||void 0===be?void 0:be.bar)||"bar",_e=he.model.markers[ve];he.Vizabi.utils.applyDefaults(_e.config,BarRank.DEFAULT_CORE(ve));const xe=he.Vizabi.stores.encodings.modelTypes.frame,{marker:we,splashMarker:Se}=xe.splashMarker(_e);he.model.markers[ve]=we,he.name="barrank",he.subcomponents=[{type:ge.Repeater,placeholder:".vzb-repeater",model:we,options:{repeatedComponent:Me,repeatedComponentCssClass:"vzb-barrank"},name:"chart"},{type:ge.TimeSlider,placeholder:".vzb-timeslider",name:"time-slider",model:we},{type:ge.SteppedSlider,placeholder:".vzb-speedslider",name:"speed-slider",model:we},{type:ge.TreeMenu,placeholder:".vzb-treemenu",name:"tree-menu",model:we},{type:ge.DataWarning,placeholder:".vzb-datawarning",options:{button:".vzb-datawarning-button"},model:we,name:"data-warning"},{type:ge.DataNotes,placeholder:".vzb-datanotes",model:we},{type:ge.Dialogs,placeholder:".vzb-dialogs",model:we,name:"dialogs"},{type:ge.ButtonList,placeholder:".vzb-buttonlist",name:"buttons",model:we},{type:ge.SpaceConfig,placeholder:".vzb-spaceconfig",options:{button:".vzb-spaceconfig-button"},model:we,name:"space-config"},{type:ge.ErrorMessage,placeholder:".vzb-errormessage",model:we,name:"error-message"}],he.template='\n      <div class="vzb-repeater"></div>\n      <div class="vzb-animationcontrols">\n        <div class="vzb-timeslider"></div>\n        <div class="vzb-speedslider"></div>\n      </div>\n      <div class="vzb-sidebar">\n        <div class="vzb-dialogs"></div>\n        <div class="vzb-buttonlist"></div>\n      </div>\n      <div class="vzb-treemenu"></div>\n      <div class="vzb-datanotes"></div>\n      <div class="vzb-datawarning"></div>\n      <div class="vzb-spaceconfig"></div>\n      <div class="vzb-errormessage"></div>\n    ',he.locale.Vizabi=he.Vizabi,he.layout.Vizabi=he.Vizabi,he.services={Vizabi:new ge.CapitalVizabiService({Vizabi:he.Vizabi}),locale:new ge.LocaleService(he.locale),layout:new ge.LayoutService(he.layout)},super(he),this.splashMarker=Se}}BarRank.DEFAULT_UI={chart:{}},BarRank.DEFAULT_CORE=()=>({encoding:{selected:{modelType:"selection"},highlighted:{modelType:"selection"},x:{scale:{allowedTypes:["linear","log","genericLog","pow"]}},color:{scale:{modelType:"color"}},label:{data:{modelType:"entityPropertyDataConfig"}},frame:{modelType:"frame"},repeat:{modelType:"repeat",allowEnc:["x"]}}}),BarRank.versionInfo={version:"4.1.0",build:1738001559667,package:{homepage:"https://github.com/vizabi/barrank#readme",name:"@vizabi/barrank",description:"Vizabi bar rank chart"},sharedComponents:ge.versionInfo},he.Base=BarRank,Object.defineProperty(he,"__esModule",{value:!0})})),function webpackUniversalModuleDefinition(he,ge){"object"==typeof exports&&"object"==typeof module?module.exports=ge():"function"==typeof define&&define.amd?define([],ge):"object"==typeof exports?exports["reader-ddfservice"]=ge():he.DDFServiceReader=ge()}(window,(function(){return(()=>{var he={"./node_modules/urlon/lib/urlon.js":
/*!*****************************************!*\
          !*** ./node_modules/urlon/lib/urlon.js ***!
          \*****************************************/
he=>{function _typeof(he){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(he){return typeof he}:function _typeof(he){return he&&"function"==typeof Symbol&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},_typeof(he)}var ge={stringify:function stringify(he){function encodeString(he){return encodeURI(he.replace(/([=:&@_;/])/g,"/$1"))}function stringify(he){if("number"==typeof he||!0===he||!1===he||null===he)return":"+he;var ge=[];if(he instanceof Array){for(var me=0;me<he.length;++me)ge.push(stringify(he[me]));return"@"+ge.join("&")+";"}if("object"===_typeof(he)){for(var be in he)ge.push(encodeString(be)+stringify(he[be]));return"_"+ge.join("&")+";"}return"="+encodeString((null!==he?void 0!==he?he:"undefined":"null").toString())}return stringify(he).replace(/;+$/g,"")},parse:function parse(he){var ge=0;function read(){for(var me="";ge!==he.length;++ge){if("/"===he.charAt(ge)){if((ge+=1)===he.length){me+=";";break}}else if(he.charAt(ge).match(/[=:&@_;]/))break;me+=he.charAt(ge)}return me}function parse(){var me,be=he.charAt(ge++);if("="===be)return read();if(":"===be){var ve=read();return"true"===ve||"false"!==ve&&(ve=parseFloat(ve),isNaN(ve)?null:ve)}if("@"===be){me=[];t:if(!(ge>=he.length||";"===he.charAt(ge)))for(;;){if(me.push(parse()),ge>=he.length||";"===he.charAt(ge))break t;ge+=1}return ge+=1,me}if("_"===be){me={};t:if(!(ge>=he.length||";"===he.charAt(ge)))for(;;){if(me[read()]=parse(),ge>=he.length||";"===he.charAt(ge))break t;ge+=1}return ge+=1,me}throw new Error("Unexpected char "+be)}return he=decodeURI(he),parse()}};he.exports=ge},"./node_modules/whatwg-fetch/fetch.js":
/*!********************************************!*\
          !*** ./node_modules/whatwg-fetch/fetch.js ***!
          \********************************************/
(he,ge,me)=>{function _typeof(he){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(he){return typeof he}:function _typeof(he){return he&&"function"==typeof Symbol&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},_typeof(he)}me.r(ge),me.d(ge,{Headers:()=>Headers,Request:()=>Request,Response:()=>Response,DOMException:()=>Se,fetch:()=>fetch});var be="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==be&&be,ve={searchParams:"URLSearchParams"in be,iterable:"Symbol"in be&&"iterator"in Symbol,blob:"FileReader"in be&&"Blob"in be&&function(){try{return new Blob,!0}catch(he){return!1}}(),formData:"FormData"in be,arrayBuffer:"ArrayBuffer"in be};if(ve.arrayBuffer)var _e=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],xe=ArrayBuffer.isView||function(he){return he&&_e.indexOf(Object.prototype.toString.call(he))>-1};function normalizeName(he){if("string"!=typeof he&&(he=String(he)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(he)||""===he)throw new TypeError('Invalid character in header field name: "'+he+'"');return he.toLowerCase()}function normalizeValue(he){return"string"!=typeof he&&(he=String(he)),he}function iteratorFor(he){var ge={next:function next(){var ge=he.shift();return{done:void 0===ge,value:ge}}};return ve.iterable&&(ge[Symbol.iterator]=function(){return ge}),ge}function Headers(he){this.map={},he instanceof Headers?he.forEach((function(he,ge){this.append(ge,he)}),this):Array.isArray(he)?he.forEach((function(he){this.append(he[0],he[1])}),this):he&&Object.getOwnPropertyNames(he).forEach((function(ge){this.append(ge,he[ge])}),this)}function consumed(he){if(he.bodyUsed)return Promise.reject(new TypeError("Already read"));he.bodyUsed=!0}function fileReaderReady(he){return new Promise((function(ge,me){he.onload=function(){ge(he.result)},he.onerror=function(){me(he.error)}}))}function readBlobAsArrayBuffer(he){var ge=new FileReader,me=fileReaderReady(ge);return ge.readAsArrayBuffer(he),me}function bufferClone(he){if(he.slice)return he.slice(0);var ge=new Uint8Array(he.byteLength);return ge.set(new Uint8Array(he)),ge.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(he){this.bodyUsed=this.bodyUsed,this._bodyInit=he,he?"string"==typeof he?this._bodyText=he:ve.blob&&Blob.prototype.isPrototypeOf(he)?this._bodyBlob=he:ve.formData&&FormData.prototype.isPrototypeOf(he)?this._bodyFormData=he:ve.searchParams&&URLSearchParams.prototype.isPrototypeOf(he)?this._bodyText=he.toString():ve.arrayBuffer&&ve.blob&&function isDataView(he){return he&&DataView.prototype.isPrototypeOf(he)}(he)?(this._bodyArrayBuffer=bufferClone(he.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ve.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(he)||xe(he))?this._bodyArrayBuffer=bufferClone(he):this._bodyText=he=Object.prototype.toString.call(he):this._bodyText="",this.headers.get("content-type")||("string"==typeof he?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ve.searchParams&&URLSearchParams.prototype.isPrototypeOf(he)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ve.blob&&(this.blob=function(){var he=consumed(this);if(he)return he;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var he=consumed(this);return he||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var he=consumed(this);if(he)return he;if(this._bodyBlob)return function readBlobAsText(he){var ge=new FileReader,me=fileReaderReady(ge);return ge.readAsText(he),me}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function readArrayBufferAsText(he){for(var ge=new Uint8Array(he),me=new Array(ge.length),be=0;be<ge.length;be++)me[be]=String.fromCharCode(ge[be]);return me.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ve.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(he,ge){he=normalizeName(he),ge=normalizeValue(ge);var me=this.map[he];this.map[he]=me?me+", "+ge:ge},Headers.prototype.delete=function(he){delete this.map[normalizeName(he)]},Headers.prototype.get=function(he){return he=normalizeName(he),this.has(he)?this.map[he]:null},Headers.prototype.has=function(he){return this.map.hasOwnProperty(normalizeName(he))},Headers.prototype.set=function(he,ge){this.map[normalizeName(he)]=normalizeValue(ge)},Headers.prototype.forEach=function(he,ge){for(var me in this.map)this.map.hasOwnProperty(me)&&he.call(ge,this.map[me],me,this)},Headers.prototype.keys=function(){var he=[];return this.forEach((function(ge,me){he.push(me)})),iteratorFor(he)},Headers.prototype.values=function(){var he=[];return this.forEach((function(ge){he.push(ge)})),iteratorFor(he)},Headers.prototype.entries=function(){var he=[];return this.forEach((function(ge,me){he.push([me,ge])})),iteratorFor(he)},ve.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var we=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(he,ge){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var me=(ge=ge||{}).body;if(he instanceof Request){if(he.bodyUsed)throw new TypeError("Already read");this.url=he.url,this.credentials=he.credentials,ge.headers||(this.headers=new Headers(he.headers)),this.method=he.method,this.mode=he.mode,this.signal=he.signal,me||null==he._bodyInit||(me=he._bodyInit,he.bodyUsed=!0)}else this.url=String(he);if(this.credentials=ge.credentials||this.credentials||"same-origin",!ge.headers&&this.headers||(this.headers=new Headers(ge.headers)),this.method=function normalizeMethod(he){var ge=he.toUpperCase();return we.indexOf(ge)>-1?ge:he}(ge.method||this.method||"GET"),this.mode=ge.mode||this.mode||null,this.signal=ge.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&me)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(me),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==ge.cache&&"no-cache"!==ge.cache)){var be=/([?&])_=[^&]*/;if(be.test(this.url))this.url=this.url.replace(be,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(he){var ge=new FormData;return he.trim().split("&").forEach((function(he){if(he){var me=he.split("="),be=me.shift().replace(/\+/g," "),ve=me.join("=").replace(/\+/g," ");ge.append(decodeURIComponent(be),decodeURIComponent(ve))}})),ge}function Response(he,ge){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');ge||(ge={}),this.type="default",this.status=void 0===ge.status?200:ge.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===ge.statusText?"":""+ge.statusText,this.headers=new Headers(ge.headers),this.url=ge.url||"",this._initBody(he)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var he=new Response(null,{status:0,statusText:""});return he.type="error",he};var Me=[301,302,303,307,308];Response.redirect=function(he,ge){if(-1===Me.indexOf(ge))throw new RangeError("Invalid status code");return new Response(null,{status:ge,headers:{location:he}})};var Se=be.DOMException;try{new Se}catch(he){(Se=function DOMException(he,ge){this.message=he,this.name=ge;var me=Error(he);this.stack=me.stack}).prototype=Object.create(Error.prototype),Se.prototype.constructor=Se}function fetch(he,ge){return new Promise((function(me,_e){var xe=new Request(he,ge);if(xe.signal&&xe.signal.aborted)return _e(new Se("Aborted","AbortError"));var we=new XMLHttpRequest;function abortXhr(){we.abort()}we.onload=function(){var he,ge,be={status:we.status,statusText:we.statusText,headers:(he=we.getAllResponseHeaders()||"",ge=new Headers,he.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(he){return 0===he.indexOf("\n")?he.substr(1,he.length):he})).forEach((function(he){var me=he.split(":"),be=me.shift().trim();if(be){var ve=me.join(":").trim();ge.append(be,ve)}})),ge)};be.url="responseURL"in we?we.responseURL:be.headers.get("X-Request-URL");var ve="response"in we?we.response:we.responseText;setTimeout((function(){me(new Response(ve,be))}),0)},we.onerror=function(){setTimeout((function(){_e(new TypeError("Network request failed"))}),0)},we.ontimeout=function(){setTimeout((function(){_e(new TypeError("Network request failed"))}),0)},we.onabort=function(){setTimeout((function(){_e(new Se("Aborted","AbortError"))}),0)},we.open(xe.method,function fixUrl(he){try{return""===he&&be.location.href?be.location.href:he}catch(ge){return he}}(xe.url),!0),"include"===xe.credentials?we.withCredentials=!0:"omit"===xe.credentials&&(we.withCredentials=!1),"responseType"in we&&(ve.blob?we.responseType="blob":ve.arrayBuffer&&xe.headers.get("Content-Type")&&-1!==xe.headers.get("Content-Type").indexOf("application/octet-stream")&&(we.responseType="arraybuffer")),!ge||"object"!==_typeof(ge.headers)||ge.headers instanceof Headers?xe.headers.forEach((function(he,ge){we.setRequestHeader(ge,he)})):Object.getOwnPropertyNames(ge.headers).forEach((function(he){we.setRequestHeader(he,normalizeValue(ge.headers[he]))})),xe.signal&&(xe.signal.addEventListener("abort",abortXhr),we.onreadystatechange=function(){4===we.readyState&&xe.signal.removeEventListener("abort",abortXhr)}),we.send(void 0===xe._bodyInit?null:xe._bodyInit)}))}fetch.polyfill=!0,be.fetch||(be.fetch=fetch,be.Headers=Headers,be.Request=Request,be.Response=Response)},"./node_modules/d3-time-format/src/defaultLocale.js":
/*!**********************************************************!*\
          !*** ./node_modules/d3-time-format/src/defaultLocale.js ***!
          \**********************************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{timeFormat:()=>ve,timeParse:()=>_e,utcFormat:()=>xe,utcParse:()=>we,default:()=>defaultLocale});var be,ve,_e,xe,we,Me=me(/*! ./locale.js */"./node_modules/d3-time-format/src/locale.js");function defaultLocale(he){return be=(0,Me.default)(he),ve=be.format,_e=be.parse,xe=be.utcFormat,we=be.utcParse,be}defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},"./node_modules/d3-time-format/src/locale.js":
/*!***************************************************!*\
          !*** ./node_modules/d3-time-format/src/locale.js ***!
          \***************************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>formatLocale});var be=me(/*! d3-time */"./node_modules/d3-time/src/utcWeek.js"),ve=me(/*! d3-time */"./node_modules/d3-time/src/utcDay.js"),_e=me(/*! d3-time */"./node_modules/d3-time/src/week.js"),xe=me(/*! d3-time */"./node_modules/d3-time/src/day.js"),we=me(/*! d3-time */"./node_modules/d3-time/src/year.js"),Me=me(/*! d3-time */"./node_modules/d3-time/src/utcYear.js");function localDate(he){if(0<=he.y&&he.y<100){var ge=new Date(-1,he.m,he.d,he.H,he.M,he.S,he.L);return ge.setFullYear(he.y),ge}return new Date(he.y,he.m,he.d,he.H,he.M,he.S,he.L)}function utcDate(he){if(0<=he.y&&he.y<100){var ge=new Date(Date.UTC(-1,he.m,he.d,he.H,he.M,he.S,he.L));return ge.setUTCFullYear(he.y),ge}return new Date(Date.UTC(he.y,he.m,he.d,he.H,he.M,he.S,he.L))}function newDate(he,ge,me){return{y:he,m:ge,d:me,H:0,M:0,S:0,L:0}}function formatLocale(he){var ge=he.dateTime,me=he.date,we=he.time,Me=he.periods,De=he.days,ze=he.shortDays,Oe=he.months,Ce=he.shortMonths,ke=formatRe(Me),Te=formatLookup(Me),Le=formatRe(De),Ae=formatLookup(De),Ee=formatRe(ze),je=formatLookup(ze),Re=formatRe(Oe),Fe=formatLookup(Oe),Ie=formatRe(Ce),Pe=formatLookup(Ce),Ne={a:function formatShortWeekday(he){return ze[he.getDay()]},A:function formatWeekday(he){return De[he.getDay()]},b:function formatShortMonth(he){return Ce[he.getMonth()]},B:function formatMonth(he){return Oe[he.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function formatPeriod(he){return Me[+(he.getHours()>=12)]},q:function formatQuarter(he){return 1+~~(he.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},Be={a:function formatUTCShortWeekday(he){return ze[he.getUTCDay()]},A:function formatUTCWeekday(he){return De[he.getUTCDay()]},b:function formatUTCShortMonth(he){return Ce[he.getUTCMonth()]},B:function formatUTCMonth(he){return Oe[he.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function formatUTCPeriod(he){return Me[+(he.getUTCHours()>=12)]},q:function formatUTCQuarter(he){return 1+~~(he.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},qe={a:function parseShortWeekday(he,ge,me){var be=Ee.exec(ge.slice(me));return be?(he.w=je.get(be[0].toLowerCase()),me+be[0].length):-1},A:function parseWeekday(he,ge,me){var be=Le.exec(ge.slice(me));return be?(he.w=Ae.get(be[0].toLowerCase()),me+be[0].length):-1},b:function parseShortMonth(he,ge,me){var be=Ie.exec(ge.slice(me));return be?(he.m=Pe.get(be[0].toLowerCase()),me+be[0].length):-1},B:function parseMonth(he,ge,me){var be=Re.exec(ge.slice(me));return be?(he.m=Fe.get(be[0].toLowerCase()),me+be[0].length):-1},c:function parseLocaleDateTime(he,me,be){return parseSpecifier(he,ge,me,be)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function parsePeriod(he,ge,me){var be=ke.exec(ge.slice(me));return be?(he.p=Te.get(be[0].toLowerCase()),me+be[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function parseLocaleDate(he,ge,be){return parseSpecifier(he,me,ge,be)},X:function parseLocaleTime(he,ge,me){return parseSpecifier(he,we,ge,me)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function newFormat(he,ge){return function(me){var be,ve,_e,xe=[],we=-1,Me=0,De=he.length;for(me instanceof Date||(me=new Date(+me));++we<De;)37===he.charCodeAt(we)&&(xe.push(he.slice(Me,we)),null!=(ve=Se[be=he.charAt(++we)])?be=he.charAt(++we):ve="e"===be?" ":"0",(_e=ge[be])&&(be=_e(me,ve)),xe.push(be),Me=we+1);return xe.push(he.slice(Me,we)),xe.join("")}}function newParse(he,ge){return function(me){var we,Me,Se=newDate(1900,void 0,1);if(parseSpecifier(Se,he,me+="",0)!=me.length)return null;if("Q"in Se)return new Date(Se.Q);if("s"in Se)return new Date(1e3*Se.s+("L"in Se?Se.L:0));if(ge&&!("Z"in Se)&&(Se.Z=0),"p"in Se&&(Se.H=Se.H%12+12*Se.p),void 0===Se.m&&(Se.m="q"in Se?Se.q:0),"V"in Se){if(Se.V<1||Se.V>53)return null;"w"in Se||(Se.w=1),"Z"in Se?(Me=(we=utcDate(newDate(Se.y,0,1))).getUTCDay(),we=Me>4||0===Me?be.utcMonday.ceil(we):(0,be.utcMonday)(we),we=ve.default.offset(we,7*(Se.V-1)),Se.y=we.getUTCFullYear(),Se.m=we.getUTCMonth(),Se.d=we.getUTCDate()+(Se.w+6)%7):(Me=(we=localDate(newDate(Se.y,0,1))).getDay(),we=Me>4||0===Me?_e.monday.ceil(we):(0,_e.monday)(we),we=xe.default.offset(we,7*(Se.V-1)),Se.y=we.getFullYear(),Se.m=we.getMonth(),Se.d=we.getDate()+(Se.w+6)%7)}else("W"in Se||"U"in Se)&&("w"in Se||(Se.w="u"in Se?Se.u%7:"W"in Se?1:0),Me="Z"in Se?utcDate(newDate(Se.y,0,1)).getUTCDay():localDate(newDate(Se.y,0,1)).getDay(),Se.m=0,Se.d="W"in Se?(Se.w+6)%7+7*Se.W-(Me+5)%7:Se.w+7*Se.U-(Me+6)%7);return"Z"in Se?(Se.H+=Se.Z/100|0,Se.M+=Se.Z%100,utcDate(Se)):localDate(Se)}}function parseSpecifier(he,ge,me,be){for(var ve,_e,xe=0,we=ge.length,Me=me.length;xe<we;){if(be>=Me)return-1;if(37===(ve=ge.charCodeAt(xe++))){if(ve=ge.charAt(xe++),!(_e=qe[ve in Se?ge.charAt(xe++):ve])||(be=_e(he,me,be))<0)return-1}else if(ve!=me.charCodeAt(be++))return-1}return be}return Ne.x=newFormat(me,Ne),Ne.X=newFormat(we,Ne),Ne.c=newFormat(ge,Ne),Be.x=newFormat(me,Be),Be.X=newFormat(we,Be),Be.c=newFormat(ge,Be),{format:function format(he){var ge=newFormat(he+="",Ne);return ge.toString=function(){return he},ge},parse:function parse(he){var ge=newParse(he+="",!1);return ge.toString=function(){return he},ge},utcFormat:function utcFormat(he){var ge=newFormat(he+="",Be);return ge.toString=function(){return he},ge},utcParse:function utcParse(he){var ge=newParse(he+="",!0);return ge.toString=function(){return he},ge}}}var Se={"-":"",_:" ",0:"0"},De=/^\s*\d+/,ze=/^%/,Oe=/[\\^$*+?|[\]().{}]/g;function pad(he,ge,me){var be=he<0?"-":"",ve=(be?-he:he)+"",_e=ve.length;return be+(_e<me?new Array(me-_e+1).join(ge)+ve:ve)}function requote(he){return he.replace(Oe,"\\$&")}function formatRe(he){return new RegExp("^(?:"+he.map(requote).join("|")+")","i")}function formatLookup(he){return new Map(he.map((function(he,ge){return[he.toLowerCase(),ge]})))}function parseWeekdayNumberSunday(he,ge,me){var be=De.exec(ge.slice(me,me+1));return be?(he.w=+be[0],me+be[0].length):-1}function parseWeekdayNumberMonday(he,ge,me){var be=De.exec(ge.slice(me,me+1));return be?(he.u=+be[0],me+be[0].length):-1}function parseWeekNumberSunday(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.U=+be[0],me+be[0].length):-1}function parseWeekNumberISO(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.V=+be[0],me+be[0].length):-1}function parseWeekNumberMonday(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.W=+be[0],me+be[0].length):-1}function parseFullYear(he,ge,me){var be=De.exec(ge.slice(me,me+4));return be?(he.y=+be[0],me+be[0].length):-1}function parseYear(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.y=+be[0]+(+be[0]>68?1900:2e3),me+be[0].length):-1}function parseZone(he,ge,me){var be=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(ge.slice(me,me+6));return be?(he.Z=be[1]?0:-(be[2]+(be[3]||"00")),me+be[0].length):-1}function parseQuarter(he,ge,me){var be=De.exec(ge.slice(me,me+1));return be?(he.q=3*be[0]-3,me+be[0].length):-1}function parseMonthNumber(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.m=be[0]-1,me+be[0].length):-1}function parseDayOfMonth(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.d=+be[0],me+be[0].length):-1}function parseDayOfYear(he,ge,me){var be=De.exec(ge.slice(me,me+3));return be?(he.m=0,he.d=+be[0],me+be[0].length):-1}function parseHour24(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.H=+be[0],me+be[0].length):-1}function parseMinutes(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.M=+be[0],me+be[0].length):-1}function parseSeconds(he,ge,me){var be=De.exec(ge.slice(me,me+2));return be?(he.S=+be[0],me+be[0].length):-1}function parseMilliseconds(he,ge,me){var be=De.exec(ge.slice(me,me+3));return be?(he.L=+be[0],me+be[0].length):-1}function parseMicroseconds(he,ge,me){var be=De.exec(ge.slice(me,me+6));return be?(he.L=Math.floor(be[0]/1e3),me+be[0].length):-1}function parseLiteralPercent(he,ge,me){var be=ze.exec(ge.slice(me,me+1));return be?me+be[0].length:-1}function parseUnixTimestamp(he,ge,me){var be=De.exec(ge.slice(me));return be?(he.Q=+be[0],me+be[0].length):-1}function parseUnixTimestampSeconds(he,ge,me){var be=De.exec(ge.slice(me));return be?(he.s=+be[0],me+be[0].length):-1}function formatDayOfMonth(he,ge){return pad(he.getDate(),ge,2)}function formatHour24(he,ge){return pad(he.getHours(),ge,2)}function formatHour12(he,ge){return pad(he.getHours()%12||12,ge,2)}function formatDayOfYear(he,ge){return pad(1+xe.default.count((0,we.default)(he),he),ge,3)}function formatMilliseconds(he,ge){return pad(he.getMilliseconds(),ge,3)}function formatMicroseconds(he,ge){return formatMilliseconds(he,ge)+"000"}function formatMonthNumber(he,ge){return pad(he.getMonth()+1,ge,2)}function formatMinutes(he,ge){return pad(he.getMinutes(),ge,2)}function formatSeconds(he,ge){return pad(he.getSeconds(),ge,2)}function formatWeekdayNumberMonday(he){var ge=he.getDay();return 0===ge?7:ge}function formatWeekNumberSunday(he,ge){return pad(_e.sunday.count((0,we.default)(he)-1,he),ge,2)}function dISO(he){var ge=he.getDay();return ge>=4||0===ge?(0,_e.thursday)(he):_e.thursday.ceil(he)}function formatWeekNumberISO(he,ge){return he=dISO(he),pad(_e.thursday.count((0,we.default)(he),he)+(4===(0,we.default)(he).getDay()),ge,2)}function formatWeekdayNumberSunday(he){return he.getDay()}function formatWeekNumberMonday(he,ge){return pad(_e.monday.count((0,we.default)(he)-1,he),ge,2)}function formatYear(he,ge){return pad(he.getFullYear()%100,ge,2)}function formatYearISO(he,ge){return pad((he=dISO(he)).getFullYear()%100,ge,2)}function formatFullYear(he,ge){return pad(he.getFullYear()%1e4,ge,4)}function formatFullYearISO(he,ge){var me=he.getDay();return pad((he=me>=4||0===me?(0,_e.thursday)(he):_e.thursday.ceil(he)).getFullYear()%1e4,ge,4)}function formatZone(he){var ge=he.getTimezoneOffset();return(ge>0?"-":(ge*=-1,"+"))+pad(ge/60|0,"0",2)+pad(ge%60,"0",2)}function formatUTCDayOfMonth(he,ge){return pad(he.getUTCDate(),ge,2)}function formatUTCHour24(he,ge){return pad(he.getUTCHours(),ge,2)}function formatUTCHour12(he,ge){return pad(he.getUTCHours()%12||12,ge,2)}function formatUTCDayOfYear(he,ge){return pad(1+ve.default.count((0,Me.default)(he),he),ge,3)}function formatUTCMilliseconds(he,ge){return pad(he.getUTCMilliseconds(),ge,3)}function formatUTCMicroseconds(he,ge){return formatUTCMilliseconds(he,ge)+"000"}function formatUTCMonthNumber(he,ge){return pad(he.getUTCMonth()+1,ge,2)}function formatUTCMinutes(he,ge){return pad(he.getUTCMinutes(),ge,2)}function formatUTCSeconds(he,ge){return pad(he.getUTCSeconds(),ge,2)}function formatUTCWeekdayNumberMonday(he){var ge=he.getUTCDay();return 0===ge?7:ge}function formatUTCWeekNumberSunday(he,ge){return pad(be.utcSunday.count((0,Me.default)(he)-1,he),ge,2)}function UTCdISO(he){var ge=he.getUTCDay();return ge>=4||0===ge?(0,be.utcThursday)(he):be.utcThursday.ceil(he)}function formatUTCWeekNumberISO(he,ge){return he=UTCdISO(he),pad(be.utcThursday.count((0,Me.default)(he),he)+(4===(0,Me.default)(he).getUTCDay()),ge,2)}function formatUTCWeekdayNumberSunday(he){return he.getUTCDay()}function formatUTCWeekNumberMonday(he,ge){return pad(be.utcMonday.count((0,Me.default)(he)-1,he),ge,2)}function formatUTCYear(he,ge){return pad(he.getUTCFullYear()%100,ge,2)}function formatUTCYearISO(he,ge){return pad((he=UTCdISO(he)).getUTCFullYear()%100,ge,2)}function formatUTCFullYear(he,ge){return pad(he.getUTCFullYear()%1e4,ge,4)}function formatUTCFullYearISO(he,ge){var me=he.getUTCDay();return pad((he=me>=4||0===me?(0,be.utcThursday)(he):be.utcThursday.ceil(he)).getUTCFullYear()%1e4,ge,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(he){return+he}function formatUnixTimestampSeconds(he){return Math.floor(+he/1e3)}},"./node_modules/d3-time/src/day.js":
/*!*****************************************!*\
          !*** ./node_modules/d3-time/src/day.js ***!
          \*****************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>xe,days:()=>we});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=me(/*! ./duration.js */"./node_modules/d3-time/src/duration.js"),_e=(0,be.default)((function(he){return he.setHours(0,0,0,0)}),(function(he,ge){return he.setDate(he.getDate()+ge)}),(function(he,ge){return(ge-he-(ge.getTimezoneOffset()-he.getTimezoneOffset())*ve.durationMinute)/ve.durationDay}),(function(he){return he.getDate()-1}));const xe=_e;var we=_e.range},"./node_modules/d3-time/src/duration.js":
/*!**********************************************!*\
          !*** ./node_modules/d3-time/src/duration.js ***!
          \**********************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{durationSecond:()=>be,durationMinute:()=>ve,durationHour:()=>_e,durationDay:()=>xe,durationWeek:()=>we,durationMonth:()=>Me,durationYear:()=>Se});var be=1e3,ve=60*be,_e=60*ve,xe=24*_e,we=7*xe,Me=30*xe,Se=365*xe},"./node_modules/d3-time/src/interval.js":
/*!**********************************************!*\
          !*** ./node_modules/d3-time/src/interval.js ***!
          \**********************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>newInterval});var be=new Date,ve=new Date;function newInterval(he,ge,me,_e){function interval(ge){return he(ge=0===arguments.length?new Date:new Date(+ge)),ge}return interval.floor=function(ge){return he(ge=new Date(+ge)),ge},interval.ceil=function(me){return he(me=new Date(me-1)),ge(me,1),he(me),me},interval.round=function(he){var ge=interval(he),me=interval.ceil(he);return he-ge<me-he?ge:me},interval.offset=function(he,me){return ge(he=new Date(+he),null==me?1:Math.floor(me)),he},interval.range=function(me,be,ve){var _e,xe=[];if(me=interval.ceil(me),ve=null==ve?1:Math.floor(ve),!(me<be&&ve>0))return xe;do{xe.push(_e=new Date(+me)),ge(me,ve),he(me)}while(_e<me&&me<be);return xe},interval.filter=function(me){return newInterval((function(ge){if(ge>=ge)for(;he(ge),!me(ge);)ge.setTime(ge-1)}),(function(he,be){if(he>=he)if(be<0)for(;++be<=0;)for(;ge(he,-1),!me(he););else for(;--be>=0;)for(;ge(he,1),!me(he););}))},me&&(interval.count=function(ge,_e){return be.setTime(+ge),ve.setTime(+_e),he(be),he(ve),Math.floor(me(be,ve))},interval.every=function(he){return he=Math.floor(he),isFinite(he)&&he>0?he>1?interval.filter(_e?function(ge){return _e(ge)%he==0}:function(ge){return interval.count(0,ge)%he==0}):interval:null}),interval}},"./node_modules/d3-time/src/utcDay.js":
/*!********************************************!*\
          !*** ./node_modules/d3-time/src/utcDay.js ***!
          \********************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>xe,utcDays:()=>we});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=me(/*! ./duration.js */"./node_modules/d3-time/src/duration.js"),_e=(0,be.default)((function(he){he.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCDate(he.getUTCDate()+ge)}),(function(he,ge){return(ge-he)/ve.durationDay}),(function(he){return he.getUTCDate()-1}));const xe=_e;var we=_e.range},"./node_modules/d3-time/src/utcWeek.js":
/*!*********************************************!*\
          !*** ./node_modules/d3-time/src/utcWeek.js ***!
          \*********************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{utcSunday:()=>_e,utcMonday:()=>xe,utcTuesday:()=>we,utcWednesday:()=>Me,utcThursday:()=>Se,utcFriday:()=>De,utcSaturday:()=>ze,utcSundays:()=>Oe,utcMondays:()=>Ce,utcTuesdays:()=>ke,utcWednesdays:()=>Te,utcThursdays:()=>Le,utcFridays:()=>Ae,utcSaturdays:()=>Ee});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=me(/*! ./duration.js */"./node_modules/d3-time/src/duration.js");function utcWeekday(he){return(0,be.default)((function(ge){ge.setUTCDate(ge.getUTCDate()-(ge.getUTCDay()+7-he)%7),ge.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCDate(he.getUTCDate()+7*ge)}),(function(he,ge){return(ge-he)/ve.durationWeek}))}var _e=utcWeekday(0),xe=utcWeekday(1),we=utcWeekday(2),Me=utcWeekday(3),Se=utcWeekday(4),De=utcWeekday(5),ze=utcWeekday(6),Oe=_e.range,Ce=xe.range,ke=we.range,Te=Me.range,Le=Se.range,Ae=De.range,Ee=ze.range},"./node_modules/d3-time/src/utcYear.js":
/*!*********************************************!*\
          !*** ./node_modules/d3-time/src/utcYear.js ***!
          \*********************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>_e,utcYears:()=>xe});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=(0,be.default)((function(he){he.setUTCMonth(0,1),he.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCFullYear(he.getUTCFullYear()+ge)}),(function(he,ge){return ge.getUTCFullYear()-he.getUTCFullYear()}),(function(he){return he.getUTCFullYear()}));ve.every=function(he){return isFinite(he=Math.floor(he))&&he>0?(0,be.default)((function(ge){ge.setUTCFullYear(Math.floor(ge.getUTCFullYear()/he)*he),ge.setUTCMonth(0,1),ge.setUTCHours(0,0,0,0)}),(function(ge,me){ge.setUTCFullYear(ge.getUTCFullYear()+me*he)})):null};const _e=ve;var xe=ve.range},"./node_modules/d3-time/src/week.js":
/*!******************************************!*\
          !*** ./node_modules/d3-time/src/week.js ***!
          \******************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{sunday:()=>_e,monday:()=>xe,tuesday:()=>we,wednesday:()=>Me,thursday:()=>Se,friday:()=>De,saturday:()=>ze,sundays:()=>Oe,mondays:()=>Ce,tuesdays:()=>ke,wednesdays:()=>Te,thursdays:()=>Le,fridays:()=>Ae,saturdays:()=>Ee});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=me(/*! ./duration.js */"./node_modules/d3-time/src/duration.js");function weekday(he){return(0,be.default)((function(ge){ge.setDate(ge.getDate()-(ge.getDay()+7-he)%7),ge.setHours(0,0,0,0)}),(function(he,ge){he.setDate(he.getDate()+7*ge)}),(function(he,ge){return(ge-he-(ge.getTimezoneOffset()-he.getTimezoneOffset())*ve.durationMinute)/ve.durationWeek}))}var _e=weekday(0),xe=weekday(1),we=weekday(2),Me=weekday(3),Se=weekday(4),De=weekday(5),ze=weekday(6),Oe=_e.range,Ce=xe.range,ke=we.range,Te=Me.range,Le=Se.range,Ae=De.range,Ee=ze.range},"./node_modules/d3-time/src/year.js":
/*!******************************************!*\
          !*** ./node_modules/d3-time/src/year.js ***!
          \******************************************/
(he,ge,me)=>{me.r(ge),me.d(ge,{default:()=>_e,years:()=>xe});var be=me(/*! ./interval.js */"./node_modules/d3-time/src/interval.js"),ve=(0,be.default)((function(he){he.setMonth(0,1),he.setHours(0,0,0,0)}),(function(he,ge){he.setFullYear(he.getFullYear()+ge)}),(function(he,ge){return ge.getFullYear()-he.getFullYear()}),(function(he){return he.getFullYear()}));ve.every=function(he){return isFinite(he=Math.floor(he))&&he>0?(0,be.default)((function(ge){ge.setFullYear(Math.floor(ge.getFullYear()/he)*he),ge.setMonth(0,1),ge.setHours(0,0,0,0)}),(function(ge,me){ge.setFullYear(ge.getFullYear()+me*he)})):null};const _e=ve;var xe=ve.range}},ge={};function __webpack_require__(me){var be=ge[me];if(void 0!==be)return be.exports;var ve=ge[me]={exports:{}};return he[me](ve,ve.exports,__webpack_require__),ve.exports}__webpack_require__.n=he=>{var ge=he&&he.__esModule?()=>he.default:()=>he;return __webpack_require__.d(ge,{a:ge}),ge},__webpack_require__.d=(he,ge)=>{for(var me in ge)__webpack_require__.o(ge,me)&&!__webpack_require__.o(he,me)&&Object.defineProperty(he,me,{enumerable:!0,get:ge[me]})},__webpack_require__.o=(he,ge)=>Object.prototype.hasOwnProperty.call(he,ge),__webpack_require__.r=he=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(he,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(he,"__esModule",{value:!0})};var me={};return(()=>{
/*!**********************!*\
          !*** ./src/index.js ***!
          \**********************/
__webpack_require__.r(me),__webpack_require__.d(me,{getReader:()=>ve}),__webpack_require__(/*! whatwg-fetch */"./node_modules/whatwg-fetch/fetch.js");var he=__webpack_require__(/*! d3-time-format */"./node_modules/d3-time-format/src/defaultLocale.js"),ge=__webpack_require__(/*! urlon */"./node_modules/urlon/lib/urlon.js"),be={YYYYMMDD:function YYYYMMDD(he){return new Date(Date.UTC(Math.floor(he/1e4),Math.floor(he%1e4/100)-1,he%100))},"YYYY-MM":function YYYYMM(he){return new Date(Date.UTC(+he.slice(0,4),+he.slice(-2)-1))},YYYY:function YYYY(he){return new Date(Date.UTC(he,0))},YYYYqQ:(0,he.utcParse)("%Yq%q"),YYYYwWW:(0,he.utcParse)("%Yw%W")},ve=function getReader(){var he=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{init:function init(ge){var me={service:"https://big-waffle.gapminder.org"};this.service=he.service||ge.service||me.service,this.dataset=ge.name||me.name,this.version=ge.version||me.version,this.headers={},ge.password&&(this.headers.Authorization="Basic "+btoa(this.dataset+":"+he.password)),Object.assign(this.parsers,ge.parsers||{})},checkIfAssetExists:function checkIfAssetExists(he){var ge=this,me=he.replace(/^assets\//,""),be="".concat(this.service,"/").concat(this.dataset).concat(this.version?"/".concat(this.version):"","/assets/").concat(me);return fetch(be,{method:"HEAD",credentials:"same-origin",redirect:"follow"}).then((function(he){return Promise.resolve(he)})).catch((function(he){throw he.name="reader/error/asset",he.details=me,he.message="connection/error",he.endpoint="".concat(ge.service,"/").concat(ge.dataset).concat(ge.version?"/"+ge.version:""),he}))},getAsset:function getAsset(he){var ge=this,me=he.replace(/^assets\//,""),be="".concat(this.service,"/").concat(this.dataset).concat(this.version?"/".concat(this.version):"","/assets/").concat(me);return fetch(be,{credentials:"same-origin",redirect:"follow"}).then((function(he){if(he.ok){var ge=he.headers.get("Content-Type");return/application\/json/.test(ge)?he.json().then((function(he){return he})):Promise.resolve(he)}return he.text().then((function(ge){var me=new Error(ge||"DDF Service responded with ".concat(he.status));return me.code="HTTP_".concat(he.status),me}))})).catch((function(he){throw he.name="reader/error/asset",he.details=me,he.message="connection/error",he.endpoint="".concat(ge.service,"/").concat(ge.dataset).concat(ge.version?"/"+ge.version:""),he}))},parsers:{time:function time(he){if(Number.isInteger(he)){if(he>=0&&he<1e4)return be.YYYY(he);if(he>=1e6&&he<1e8)return be.YYYYMMDD(he)}else{if("string"!=typeof he)return;if("-"===he[4]&&7==he.length)return be["YYYY-MM"](he);if("q"===he[4]||"Q"===he[4])return be.YYYYqQ(he);if("w"===he[4]||"W"===he[4])return be.YYYYwWW(he)}},year:function year(he){return be.YYYY(he)},month:function month(he){return be["YYYY-MM"](he)},day:function day(he){return be.YYYYMMDD(he)},week:function week(he){return be.YYYYwWW(he)},quarter:function quarter(he){return be.YYYYqQ(he)}},read:function read(he){var ge=this,me="".concat(this.service,"/").concat(this.dataset).concat(this.version?"/".concat(this.version):"","?").concat(this._queryAsParams(he));return fetch(me,{credentials:"same-origin",headers:this.headers,redirect:"follow"}).then((function(he){return he.ok?he.json().then((function(he){he.version&&(ge.version=he.version),["info","warn","error"].forEach((function(ge){(he[ge]||[]).forEach((function(he){var me=he&&he.msg?he.msg:he;console[ge](me)}))}));var me=he.header,be=me.map((function(he){return ge.parsers[he]}));return(he.rows||[]).map((function(he){return he.reduce((function(he,ge,ve){return he[me[ve]]=be[ve]?be[ve](ge):ge,he}),{})}))})):he.text().then((function(ge){var me=new Error(he.text()||"DDF Service responded with ".concat(he.status));return me.code="HTTP_".concat(he.status),me}))})).catch((function(me){throw me.name="reader/error/generic",me.details=he,me.message="connection/error",me.endpoint="".concat(ge.service,"/").concat(ge.dataset).concat(ge.version?"/"+ge.version:""),me}))},_queryAsParams:function _queryAsParams(he){var me={};return["language","select","from","where","join","order_by"].filter((function(ge){return he[ge]})).forEach((function(ge){me[ge]=he[ge]})),ge.stringify(me)}}}})(),me})()})),be=window,ve=function(){return function(he){var ge={};function r(me){if(ge[me])return ge[me].exports;var be=ge[me]={i:me,l:!1,exports:{}};return he[me].call(be.exports,be,be.exports,r),be.l=!0,be.exports}return r.m=he,r.c=ge,r.d=function(he,ge,me){r.o(he,ge)||Object.defineProperty(he,ge,{configurable:!1,enumerable:!0,get:me})},r.r=function(he){Object.defineProperty(he,"__esModule",{value:!0})},r.n=function(he){var ge=he&&he.__esModule?function(){return he.default}:function(){return he};return r.d(ge,"a",ge),ge},r.o=function(he,ge){return Object.prototype.hasOwnProperty.call(he,ge)},r.p="",r(r.s=49)}([function(he,ge){var me;me=function(){return this}();try{me=me||Function("return this")()||(0,eval)("this")}catch(he){"object"==typeof window&&(me=window)}he.exports=me},function(he,ge){var me=1/0,be=9007199254740991,ve="[object Arguments]",_e="[object Function]",xe="[object GeneratorFunction]",we=/^\s+|\s+$/g,Me=/^[-+]0x[0-9a-f]+$/i,Se=/^0b[01]+$/i,De=/^0o[0-7]+$/i,ze=/^(?:0|[1-9]\d*)$/,Oe=parseInt;function g(he){return he!=he}var Ce,ke,Te=Object.prototype,Le=Te.hasOwnProperty,Ae=Te.toString,Ee=Te.propertyIsEnumerable,je=(Ce=Object.keys,ke=Object,function(he){return Ce(ke(he))}),Re=Math.max;function R(he,ge){var me=Fe(he)||function(he){return function(he){return P(he)&&D(he)}(he)&&Le.call(he,"callee")&&(!Ee.call(he,"callee")||Ae.call(he)==ve)}(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,_e=!!be;for(var xe in he)!ge&&!Le.call(he,xe)||_e&&("length"==xe||T(xe,be))||me.push(xe);return me}function T(he,ge){return!!(ge=null==ge?be:ge)&&("number"==typeof he||ze.test(he))&&he>-1&&he%1==0&&he<ge}var Fe=Array.isArray;function D(he){return null!=he&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=be}(he.length)&&!function(he){var ge=F(he)?Ae.call(he):"";return ge==_e||ge==xe}(he)}function F(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function P(he){return!!he&&"object"==typeof he}he.exports=function(he,ge,be,ve){var _e;he=D(he)?he:(_e=he)?function _(he,ge){return function(he,ge){for(var me=-1,be=he?he.length:0,ve=Array(be);++me<be;)ve[me]=ge(he[me]);return ve}(ge,(function(ge){return he[ge]}))}(_e,function(he){return D(he)?R(he):function k(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||Te))return je(he);var ge,me,be=[];for(var ve in Object(he))Le.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}(_e)):[],be=be&&!ve?function(he){var ge=function(he){return he?(he=function(he){if("number"==typeof he)return he;if(function(he){return"symbol"==typeof he||P(he)&&"[object Symbol]"==Ae.call(he)}(he))return NaN;if(F(he)){var ge="function"==typeof he.valueOf?he.valueOf():he;he=F(ge)?ge+"":ge}if("string"!=typeof he)return 0===he?he:+he;he=he.replace(we,"");var me=Se.test(he);return me||De.test(he)?Oe(he.slice(2),me?2:8):Me.test(he)?NaN:+he}(he))===me||he===-me?17976931348623157e292*(he<0?-1:1):he==he?he:0:0===he?he:0}(he),be=ge%1;return ge==ge?be?ge-be:ge:0}(be):0;var xe=he.length;return be<0&&(be=Re(xe+be,0)),function(he){return"string"==typeof he||!Fe(he)&&P(he)&&"[object String]"==Ae.call(he)}(he)?be<=xe&&he.indexOf(ge,be)>-1:!!xe&&function(he,ge,me){if(ge!=ge)return function(he,ge,me,be){for(var ve=he.length,_e=me+-1;++_e<ve;)if(ge(he[_e],_e,he))return _e;return-1}(he,g,me);for(var be=me-1,ve=he.length;++be<ve;)if(he[be]===ge)return be;return-1}(he,ge,be)>-1}},function(he,ge){he.exports=function(he){return he.webpackPolyfill||(he.deprecate=function(){},he.paths=[],he.children||(he.children=[]),Object.defineProperty(he,"loaded",{enumerable:!0,get:function(){return he.l}}),Object.defineProperty(he,"id",{enumerable:!0,get:function(){return he.i}}),he.webpackPolyfill=1),he}},function(he,ge,me){(function(he){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(4),ve=me(1);ge.SCHEMAS=new Set(["concepts.schema","entities.schema","datapoints.schema","*.schema"]),ge.DATAPOINTS="datapoints",ge.ENTITIES="entities",ge.CONCEPTS="concepts",ge.CONCEPT_TYPE_MEASURE="measure",ge.CONCEPT_TYPE_STRING="string",ge.CONCEPT_TYPE_ENTITY_DOMAIN="entity_domain",ge.CONCEPT_TYPE_ENTITY_SET="entity_set",ge.CONCEPT_TYPE_TIME="time",ge.RESERVED_CONCEPT="concept",ge.RESERVED_CONCEPT_TYPE="concept_type",ge.RESERVED_DOMAIN="domain",ge.RESERVED_UNIT="unit",ge.RESERVED_DRILL_UP="drill_up",ge.RESERVED_KEY="key",ge.RESERVED_VALUE="value",ge.AVAILABLE_QUERY_OPERATORS=new Set(["$eq","$gt","$gte","$lt","$lte","$ne","$in","$nin","$or","$and","$not","$nor","$size","$all","$elemMatch"]),ge.AVAILABLE_FROM_CLAUSE_VALUES=new Set([ge.CONCEPTS,ge.ENTITIES,ge.DATAPOINTS,...ge.SCHEMAS]),ge.AVAILABLE_ORDER_BY_CLAUSE_VALUES=new Set(["asc","desc",1,-1]),ge.DEFAULT_REPOSITORY_NAME=he.env.DEFAULT_REPOSITORY_NAME||"systema_globalis",ge.DEFAULT_REPOSITORY_BRANCH=he.env.DEFAULT_REPOSITORY_BRANCH||"master",ge.DEFAULT_REPOSITORY_HASH="HEAD",ge.isSchemaQuery=function(he){const me=be(he,"from");return ge.SCHEMAS.has(me)},ge.isDatapointsQuery=function(he){return be(he,"from")===ge.DATAPOINTS},ge.isEntitiesQuery=function(he){return be(he,"from")===ge.ENTITIES},ge.isConceptsQuery=function(he){return be(he,"from")===ge.CONCEPTS},ge.isEntityDomainOrSet=function(he,ge){return ve(ge,he)},ge.isMeasure=function(he){return ve([ge.CONCEPT_TYPE_MEASURE],he)},ge.isIndicator=function(he){return ve([ge.CONCEPT_TYPE_MEASURE,ge.CONCEPT_TYPE_STRING],he)}}).call(this,me(8))},function(he,ge,me){(function(ge){var me,be="Expected a function",ve="__lodash_hash_undefined__",_e=1/0,xe="[object Function]",we="[object GeneratorFunction]",Me="[object Symbol]",Se=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,De=/^\w*$/,ze=/^\./,Oe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ce=/\\(\\)?/g,ke=/^\[object .+?Constructor\]$/,Te="object"==typeof ge&&ge&&ge.Object===Object&&ge,Le="object"==typeof self&&self&&self.Object===Object&&self,Ae=Te||Le||Function("return this")(),Ee=Array.prototype,je=Function.prototype,Re=Object.prototype,Fe=Ae["__core-js_shared__"],Ie=(me=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||""))?"Symbol(src)_1."+me:"",Pe=je.toString,Ne=Re.hasOwnProperty,Be=Re.toString,qe=RegExp("^"+Pe.call(Ne).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=Ae.Symbol,He=Ee.splice,Ve=N(Ae,"Map"),Ye=N(Object,"create"),We=Ue?Ue.prototype:void 0,Ge=We?We.toString:void 0;function P(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function $(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function x(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function L(he,ge){for(var me,be,ve=he.length;ve--;)if((me=he[ve][0])===(be=ge)||me!=me&&be!=be)return ve;return-1}function U(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function N(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function I(he){return!(!V(he)||Ie&&Ie in he)&&(function(he){var ge=V(he)?Be.call(he):"";return ge==xe||ge==we}(he)||function(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}(he)?qe:ke).test(function(he){if(null!=he){try{return Pe.call(he)}catch(he){}try{return he+""}catch(he){}}return""}(he))}(me)?me:void 0}P.prototype.clear=function(){this.__data__=Ye?Ye(null):{}},P.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},P.prototype.get=function(he){var ge=this.__data__;if(Ye){var me=ge[he];return me===ve?void 0:me}return Ne.call(ge,he)?ge[he]:void 0},P.prototype.has=function(he){var ge=this.__data__;return Ye?void 0!==ge[he]:Ne.call(ge,he)},P.prototype.set=function(he,ge){return this.__data__[he]=Ye&&void 0===ge?ve:ge,this},$.prototype.clear=function(){this.__data__=[]},$.prototype.delete=function(he){var ge=this.__data__,me=L(ge,he);return!(me<0||(me==ge.length-1?ge.pop():He.call(ge,me,1),0))},$.prototype.get=function(he){var ge=this.__data__,me=L(ge,he);return me<0?void 0:ge[me][1]},$.prototype.has=function(he){return L(this.__data__,he)>-1},$.prototype.set=function(he,ge){var me=this.__data__,be=L(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},x.prototype.clear=function(){this.__data__={hash:new P,map:new(Ve||$),string:new P}},x.prototype.delete=function(he){return U(this,he).delete(he)},x.prototype.get=function(he){return U(this,he).get(he)},x.prototype.has=function(he){return U(this,he).has(he)},x.prototype.set=function(he,ge){return U(this,he).set(he,ge),this};var $e=B((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(q(he))return Ge?Ge.call(he):"";var ge=he+"";return"0"==ge&&1/he==-_e?"-0":ge}(ge);var me=[];return ze.test(he)&&me.push(""),he.replace(Oe,(function(he,ge,be,ve){me.push(be?ve.replace(Ce,"$1"):ge||he)})),me}));function z(he){if("string"==typeof he||q(he))return he;var ge=he+"";return"0"==ge&&1/he==-_e?"-0":ge}function B(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var n=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=n.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return n.cache=ve.set(be,_e),_e};return n.cache=new(B.Cache||x),n}B.Cache=x;var Xe=Array.isArray;function V(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function q(he){return"symbol"==typeof he||function(he){return!!he&&"object"==typeof he}(he)&&Be.call(he)==Me}he.exports=function(he,ge,me){var be=null==he?void 0:function M(he,ge){for(var me,be=0,ve=(ge=function(he,ge){if(Xe(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!q(he))||De.test(he)||!Se.test(he)||null!=ge&&he in Object(ge)}(ge,he)?[ge]:Xe(me=ge)?me:$e(me)).length;null!=he&&be<ve;)he=he[z(ge[be++])];return be&&be==ve?he:void 0}(he,ge);return void 0===be?me:be}}).call(this,me(0))},function(he,ge,me){(function(he,me){var be,ve,_e,xe=9007199254740991,we="[object Arguments]",Me="[object Function]",Se="[object GeneratorFunction]",De="[object Map]",ze="[object Set]",Oe=/^\[object .+?Constructor\]$/,Ce="object"==typeof he&&he&&he.Object===Object&&he,ke="object"==typeof self&&self&&self.Object===Object&&self,Te=Ce||ke||Function("return this")(),Le="object"==typeof ge&&ge&&!ge.nodeType&&ge,Ae=Le&&"object"==typeof me&&me&&!me.nodeType&&me,Ee=Ae&&Ae.exports===Le,je=Function.prototype,Re=Object.prototype,Fe=Te["__core-js_shared__"],Ie=(be=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||""))?"Symbol(src)_1."+be:"",Pe=je.toString,Ne=Re.hasOwnProperty,Be=Re.toString,qe=RegExp("^"+Pe.call(Ne).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=Ee?Te.Buffer:void 0,He=Re.propertyIsEnumerable,Ve=Ue?Ue.isBuffer:void 0,Ye=(ve=Object.keys,_e=Object,function(he){return ve(_e(he))}),We=B(Te,"DataView"),Ge=B(Te,"Map"),$e=B(Te,"Promise"),Xe=B(Te,"Set"),Ke=B(Te,"WeakMap"),Ze=!He.call({valueOf:1},"valueOf"),Je=V(We),Qe=V(Ge),tn=V($e),en=V(Xe),nn=V(Ke);function B(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function z(he){return!(!K(he)||Ie&&Ie in he)&&(J(he)||function(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}(he)?qe:Oe).test(V(he))}(me)?me:void 0}var H=function(he){return Be.call(he)};function V(he){if(null!=he){try{return Pe.call(he)}catch(he){}try{return he+""}catch(he){}}return""}(We&&"[object DataView]"!=H(new We(new ArrayBuffer(1)))||Ge&&H(new Ge)!=De||$e&&"[object Promise]"!=H($e.resolve())||Xe&&H(new Xe)!=ze||Ke&&"[object WeakMap]"!=H(new Ke))&&(H=function(he){var ge=Be.call(he),me="[object Object]"==ge?he.constructor:void 0,be=me?V(me):void 0;if(be)switch(be){case Je:return"[object DataView]";case Qe:return De;case tn:return"[object Promise]";case en:return ze;case nn:return"[object WeakMap]"}return ge});var sn=Array.isArray;function G(he){return null!=he&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=xe}(he.length)&&!J(he)}var on=Ve||function(){return!1};function J(he){var ge=K(he)?Be.call(he):"";return ge==Me||ge==Se}function K(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}me.exports=function(he){if(G(he)&&(sn(he)||"string"==typeof he||"function"==typeof he.splice||on(he)||function q(he){return function(he){return function(he){return!!he&&"object"==typeof he}(he)&&G(he)}(he)&&Ne.call(he,"callee")&&(!He.call(he,"callee")||Be.call(he)==we)}(he)))return!he.length;var ge=H(he);if(ge==De||ge==ze)return!he.size;if(Ze||function(he){var ge=he&&he.constructor;return he===("function"==typeof ge&&ge.prototype||Re)}(he))return!Ye(he).length;for(var me in he)if(Ne.call(he,me))return!1;return!0}}).call(this,me(0),me(2)(he))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.DdfCsvError=ge.DDF_ERROR=ge.CSV_PARSING_ERROR=ge.JSON_PARSING_ERROR=ge.FILE_READING_ERROR=void 0,ge.FILE_READING_ERROR="File reading error",ge.JSON_PARSING_ERROR="JSON parsing error",ge.CSV_PARSING_ERROR="CSV parsing error",ge.DDF_ERROR="DDF error",ge.DdfCsvError=class extends Error{constructor(he,ge,me){super(),this.name="DdfCsvError",this.message="".concat(he," [filepath: ").concat(me,"]. ").concat(ge,"."),this.details=ge,this.file=me}}},function(he,ge){he.exports=function(he){return null==he}},function(he,ge){var me,be,ve=he.exports={};function i(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function a(he){if(me===setTimeout)return setTimeout(he,0);if((me===i||!me)&&setTimeout)return me=setTimeout,setTimeout(he,0);try{return me(he,0)}catch(ge){try{return me.call(null,he,0)}catch(ge){return me.call(this,he,0)}}}!function(){try{me="function"==typeof setTimeout?setTimeout:i}catch(he){me=i}try{be="function"==typeof clearTimeout?clearTimeout:u}catch(he){be=u}}();var _e,xe=[],we=!1,Me=-1;function p(){we&&_e&&(we=!1,_e.length?xe=_e.concat(xe):Me=-1,xe.length&&h())}function h(){if(!we){var he=a(p);we=!0;for(var ge=xe.length;ge;){for(_e=xe,xe=[];++Me<ge;)_e&&_e[Me].run();Me=-1,ge=xe.length}_e=null,we=!1,function(he){if(be===clearTimeout)return clearTimeout(he);if((be===u||!be)&&clearTimeout)return be=clearTimeout,clearTimeout(he);try{be(he)}catch(ge){try{return be.call(null,he)}catch(ge){return be.call(this,he)}}}(he)}}function d(he,ge){this.fun=he,this.array=ge}function y(){}ve.nextTick=function(he){var ge=new Array(arguments.length-1);if(arguments.length>1)for(var me=1;me<arguments.length;me++)ge[me-1]=arguments[me];xe.push(new d(he,ge)),1!==xe.length||we||a(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},ve.title="browser",ve.browser=!0,ve.env={},ve.argv=[],ve.version="",ve.versions={},ve.on=y,ve.addListener=y,ve.once=y,ve.off=y,ve.removeListener=y,ve.removeAllListeners=y,ve.emit=y,ve.prependListener=y,ve.prependOnceListener=y,ve.listeners=function(he){return[]},ve.binding=function(he){throw new Error("process.binding is not supported")},ve.cwd=function(){return"/"},ve.chdir=function(he){throw new Error("process.chdir is not supported")},ve.umask=function(){return 0}},function(he,ge){he.exports=function(he){for(var ge=-1,me=he?he.length:0,be=0,ve=[];++ge<me;){var _e=he[ge];_e&&(ve[be++]=_e)}return ve}},function(he,ge,me){(function(ge){var me=1/0,be=17976931348623157e292,ve=NaN,_e="[object Symbol]",xe=/^\s+|\s+$/g,we=/^[-+]0x[0-9a-f]+$/i,Me=/^0b[01]+$/i,Se=/^0o[0-7]+$/i,De=parseInt,ze="object"==typeof ge&&ge&&ge.Object===Object&&ge,Oe="object"==typeof self&&self&&self.Object===Object&&self,Ce=ze||Oe||Function("return this")(),ke=Object.prototype.toString,Te=Ce.Symbol,Le=Te?Te.prototype:void 0,Ae=Le?Le.toString:void 0;function _(he){if("string"==typeof he)return he;if(m(he))return Ae?Ae.call(he):"";var ge=he+"";return"0"==ge&&1/he==-me?"-0":ge}function b(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function m(he){return"symbol"==typeof he||function(he){return!!he&&"object"==typeof he}(he)&&ke.call(he)==_e}function j(he){return he?(he=function(he){if("number"==typeof he)return he;if(m(he))return ve;if(b(he)){var ge="function"==typeof he.valueOf?he.valueOf():he;he=b(ge)?ge+"":ge}if("string"!=typeof he)return 0===he?he:+he;he=he.replace(xe,"");var me=Me.test(he);return me||Se.test(he)?De(he.slice(2),me?2:8):we.test(he)?ve:+he}(he))===me||he===-me?(he<0?-1:1)*be:he==he?he:0:0===he?he:0}he.exports=function(he,ge,me){var be,ve,_e;return he=null==(be=he)?"":_(be),ve=function(he){var ge=j(he),me=ge%1;return ge==ge?me?ge-me:ge:0}(me),_e=he.length,ve==ve&&(void 0!==_e&&(ve=ve<=_e?ve:_e),ve=ve>=0?ve:0),me=ve,ge=_(ge),he.slice(me,me+ge.length)==ge}}).call(this,me(0))},function(he,ge){var me,be,ve=9007199254740991,_e="[object Arguments]",xe="[object Function]",we="[object GeneratorFunction]",Me=/^(?:0|[1-9]\d*)$/,Se=Object.prototype,De=Se.hasOwnProperty,ze=Se.toString,Oe=Se.propertyIsEnumerable,Ce=(me=Object.keys,be=Object,function(he){return me(be(he))});function v(he,ge){return!!(ge=null==ge?ve:ge)&&("number"==typeof he||Me.test(he))&&he>-1&&he%1==0&&he<ge}var ke=Array.isArray;function _(he){return null!=he&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=ve}(he.length)&&!function(he){var ge=function(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}(he)?ze.call(he):"";return ge==xe||ge==we}(he)}he.exports=function(he){return _(he)?function d(he,ge){var me=ke(he)||function(he){return function(he){return function(he){return!!he&&"object"==typeof he}(he)&&_(he)}(he)&&De.call(he,"callee")&&(!Oe.call(he,"callee")||ze.call(he)==_e)}(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var xe in he)!ge&&!De.call(he,xe)||ve&&("length"==xe||v(xe,be))||me.push(xe);return me}(he):function y(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||Se))return Ce(he);var ge,me,be=[];for(var ve in Object(he))De.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}},function(he,ge){he.exports=function(he){return he&&he.length?he[0]:void 0}},function(he,ge,me){var be;Object.defineProperty(ge,"__esModule",{value:!0}),function(he){he[he.OFF=0]="OFF",he[he.FATAL=1]="FATAL",he[he.ERROR=2]="ERROR",he[he.WARNING=4]="WARNING",he[he.DEBUG=8]="DEBUG",he[he.ALL=15]="ALL"}(be=ge.Level||(ge.Level={})),ge.getLevelByLabel=he=>{switch(he){case"off":default:return be.OFF;case"fatal":return be.FATAL;case"error":return be.ERROR;case"warning":return be.WARNING;case"debug":return be.DEBUG;case"all":return be.ALL}},ge.getLabelByLevel=he=>{switch(he){case be.OFF:return"off";case be.FATAL:return"fatal";case be.ERROR:return"error";case be.WARNING:return"warning";case be.DEBUG:return"debug";case be.ALL:return"all";default:return"off"}}},function(he,ge,me){function n(he){for(var me in he)ge.hasOwnProperty(me)||(ge[me]=he[me])}Object.defineProperty(ge,"__esModule",{value:!0}),n(me(13)),n(me(24))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),function(he){he.WhereClauseBasedOnConjunction="WhereClauseBasedOnConjunction",he.ConjunctionPartFromWhereClauseCorrespondsToJoin="ConjunctionPartFromWhereClauseCorrespondsToJoin"}(ge.QueryFeature||(ge.QueryFeature={}))},function(he,ge){he.exports=function(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}},function(he,ge,me){(function(he){var be=Object.getOwnPropertyDescriptors||function(he){for(var ge=Object.keys(he),me={},be=0;be<ge.length;be++)me[ge[be]]=Object.getOwnPropertyDescriptor(he,ge[be]);return me},ve=/%[sdj%]/g;ge.format=function(he){if(!g(he)){for(var ge=[],me=0;me<arguments.length;me++)ge.push(a(arguments[me]));return ge.join(" ")}me=1;for(var be=arguments,_e=be.length,xe=String(he).replace(ve,(function(he){if("%%"===he)return"%";if(me>=_e)return he;switch(he){case"%s":return String(be[me++]);case"%d":return Number(be[me++]);case"%j":try{return JSON.stringify(be[me++])}catch(he){return"[Circular]"}default:return he}})),we=be[me];me<_e;we=be[++me])y(we)||!m(we)?xe+=" "+we:xe+=" "+a(we);return xe},ge.deprecate=function(me,be){if(void 0!==he&&!0===he.noDeprecation)return me;if(void 0===he)return function(){return ge.deprecate(me,be).apply(this,arguments)};var ve=!1;return function(){if(!ve){if(he.throwDeprecation)throw new Error(be);he.traceDeprecation?console.trace(be):console.error(be),ve=!0}return me.apply(this,arguments)}};var _e,xe={};function a(he,me){var be={seen:[],stylize:s};return arguments.length>=3&&(be.depth=arguments[2]),arguments.length>=4&&(be.colors=arguments[3]),d(me)?be.showHidden=me:me&&ge._extend(be,me),_(be.showHidden)&&(be.showHidden=!1),_(be.depth)&&(be.depth=2),_(be.colors)&&(be.colors=!1),_(be.customInspect)&&(be.customInspect=!0),be.colors&&(be.stylize=c),f(be,he,be.depth)}function c(he,ge){var me=a.styles[ge];return me?"["+a.colors[me][0]+"m"+he+"["+a.colors[me][1]+"m":he}function s(he,ge){return he}function f(he,me,be){if(he.customInspect&&me&&O(me.inspect)&&me.inspect!==ge.inspect&&(!me.constructor||me.constructor.prototype!==me)){var ve=me.inspect(be,he);return g(ve)||(ve=f(he,ve,be)),ve}var _e=function(he,ge){if(_(ge))return he.stylize("undefined","undefined");if(g(ge)){var me="'"+JSON.stringify(ge).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return he.stylize(me,"string")}return v(ge)?he.stylize(""+ge,"number"):d(ge)?he.stylize(""+ge,"boolean"):y(ge)?he.stylize("null","null"):void 0}(he,me);if(_e)return _e;var xe=Object.keys(me),we=function(he){var ge={};return he.forEach((function(he,me){ge[he]=!0})),ge}(xe);if(he.showHidden&&(xe=Object.getOwnPropertyNames(me)),w(me)&&(xe.indexOf("message")>=0||xe.indexOf("description")>=0))return l(me);if(0===xe.length){if(O(me)){var Me=me.name?": "+me.name:"";return he.stylize("[Function"+Me+"]","special")}if(b(me))return he.stylize(RegExp.prototype.toString.call(me),"regexp");if(j(me))return he.stylize(Date.prototype.toString.call(me),"date");if(w(me))return l(me)}var Se,De="",ze=!1,Oe=["{","}"];return h(me)&&(ze=!0,Oe=["[","]"]),O(me)&&(De=" [Function"+(me.name?": "+me.name:"")+"]"),b(me)&&(De=" "+RegExp.prototype.toString.call(me)),j(me)&&(De=" "+Date.prototype.toUTCString.call(me)),w(me)&&(De=" "+l(me)),0!==xe.length||ze&&0!=me.length?be<0?b(me)?he.stylize(RegExp.prototype.toString.call(me),"regexp"):he.stylize("[Object]","special"):(he.seen.push(me),Se=ze?function(he,ge,me,be,ve){for(var _e=[],xe=0,we=ge.length;xe<we;++xe)R(ge,String(xe))?_e.push(p(he,ge,me,be,String(xe),!0)):_e.push("");return ve.forEach((function(ve){ve.match(/^\d+$/)||_e.push(p(he,ge,me,be,ve,!0))})),_e}(he,me,be,we,xe):xe.map((function(ge){return p(he,me,be,we,ge,ze)})),he.seen.pop(),function(he,ge,me){return he.reduce((function(he,ge){return ge.indexOf("\n"),he+ge.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?me[0]+(""===ge?"":ge+"\n ")+" "+he.join(",\n  ")+" "+me[1]:me[0]+ge+" "+he.join(", ")+" "+me[1]}(Se,De,Oe)):Oe[0]+De+Oe[1]}function l(he){return"["+Error.prototype.toString.call(he)+"]"}function p(he,ge,me,be,ve,_e){var xe,we,Me;if((Me=Object.getOwnPropertyDescriptor(ge,ve)||{value:ge[ve]}).get?we=Me.set?he.stylize("[Getter/Setter]","special"):he.stylize("[Getter]","special"):Me.set&&(we=he.stylize("[Setter]","special")),R(be,ve)||(xe="["+ve+"]"),we||(he.seen.indexOf(Me.value)<0?(we=y(me)?f(he,Me.value,null):f(he,Me.value,me-1)).indexOf("\n")>-1&&(we=_e?we.split("\n").map((function(he){return"  "+he})).join("\n").substr(2):"\n"+we.split("\n").map((function(he){return"   "+he})).join("\n")):we=he.stylize("[Circular]","special")),_(xe)){if(_e&&ve.match(/^\d+$/))return we;(xe=JSON.stringify(""+ve)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(xe=xe.substr(1,xe.length-2),xe=he.stylize(xe,"name")):(xe=xe.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),xe=he.stylize(xe,"string"))}return xe+": "+we}function h(he){return Array.isArray(he)}function d(he){return"boolean"==typeof he}function y(he){return null===he}function v(he){return"number"==typeof he}function g(he){return"string"==typeof he}function _(he){return void 0===he}function b(he){return m(he)&&"[object RegExp]"===E(he)}function m(he){return"object"==typeof he&&null!==he}function j(he){return m(he)&&"[object Date]"===E(he)}function w(he){return m(he)&&("[object Error]"===E(he)||he instanceof Error)}function O(he){return"function"==typeof he}function E(he){return Object.prototype.toString.call(he)}function S(he){return he<10?"0"+he.toString(10):he.toString(10)}ge.debuglog=function(me){if(_(_e)&&(_e=he.env.NODE_DEBUG||""),me=me.toUpperCase(),!xe[me])if(new RegExp("\\b"+me+"\\b","i").test(_e)){var be=he.pid;xe[me]=function(){var he=ge.format.apply(ge,arguments);console.error("%s %d: %s",me,be,he)}}else xe[me]=function(){};return xe[me]},ge.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},ge.isArray=h,ge.isBoolean=d,ge.isNull=y,ge.isNullOrUndefined=function(he){return null==he},ge.isNumber=v,ge.isString=g,ge.isSymbol=function(he){return"symbol"==typeof he},ge.isUndefined=_,ge.isRegExp=b,ge.isObject=m,ge.isDate=j,ge.isError=w,ge.isFunction=O,ge.isPrimitive=function(he){return null===he||"boolean"==typeof he||"number"==typeof he||"string"==typeof he||"symbol"==typeof he||void 0===he},ge.isBuffer=me(39);var we=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(he,ge){return Object.prototype.hasOwnProperty.call(he,ge)}ge.log=function(){var he,me;console.log("%s - %s",(me=[S((he=new Date).getHours()),S(he.getMinutes()),S(he.getSeconds())].join(":"),[he.getDate(),we[he.getMonth()],me].join(" ")),ge.format.apply(ge,arguments))},ge.inherits=me(38),ge._extend=function(he,ge){if(!ge||!m(ge))return he;for(var me=Object.keys(ge),be=me.length;be--;)he[me[be]]=ge[me[be]];return he};var Me="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function T(he,ge){if(!he){var me=new Error("Promise was rejected with a falsy value");me.reason=he,he=me}return ge(he)}ge.promisify=function(he){if("function"!=typeof he)throw new TypeError('The "original" argument must be of type Function');if(Me&&he[Me]){var ge;if("function"!=typeof(ge=he[Me]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(ge,Me,{value:ge,enumerable:!1,writable:!1,configurable:!0}),ge}function ge(){for(var ge,me,be=new Promise((function(he,be){ge=he,me=be})),ve=[],_e=0;_e<arguments.length;_e++)ve.push(arguments[_e]);ve.push((function(he,be){he?me(he):ge(be)}));try{he.apply(this,ve)}catch(he){me(he)}return be}return Object.setPrototypeOf(ge,Object.getPrototypeOf(he)),Me&&Object.defineProperty(ge,Me,{value:ge,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(ge,be(he))},ge.promisify.custom=Me,ge.callbackify=function(ge){if("function"!=typeof ge)throw new TypeError('The "original" argument must be of type Function');function r(){for(var me=[],be=0;be<arguments.length;be++)me.push(arguments[be]);var ve=me.pop();if("function"!=typeof ve)throw new TypeError("The last argument must be of type Function");var _e=this,u=function(){return ve.apply(_e,arguments)};ge.apply(this,me).then((function(ge){he.nextTick(u,null,ge)}),(function(ge){he.nextTick(T,ge,u)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(ge)),Object.defineProperties(r,be(ge)),r}}).call(this,me(8))},function(he,ge,me){(function(he,me){var be="Expected a function",ve="__lodash_hash_undefined__",_e=1,xe=2,we=1/0,Me=9007199254740991,Se="[object Arguments]",De="[object Array]",ze="[object Boolean]",Oe="[object Date]",Ce="[object Error]",ke="[object Function]",Te="[object GeneratorFunction]",Le="[object Map]",Ae="[object Number]",Ee="[object Object]",je="[object RegExp]",Re="[object Set]",Fe="[object String]",Ie="[object Symbol]",Pe="[object ArrayBuffer]",Ne="[object DataView]",Be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qe=/^\w*$/,Ue=/^\./,He=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,Ye=/^\[object .+?Constructor\]$/,We=/^(?:0|[1-9]\d*)$/,Ge={};Ge["[object Float32Array]"]=Ge["[object Float64Array]"]=Ge["[object Int8Array]"]=Ge["[object Int16Array]"]=Ge["[object Int32Array]"]=Ge["[object Uint8Array]"]=Ge["[object Uint8ClampedArray]"]=Ge["[object Uint16Array]"]=Ge["[object Uint32Array]"]=!0,Ge[Se]=Ge[De]=Ge[Pe]=Ge[ze]=Ge[Ne]=Ge[Oe]=Ge[Ce]=Ge[ke]=Ge[Le]=Ge[Ae]=Ge[Ee]=Ge[je]=Ge[Re]=Ge[Fe]=Ge["[object WeakMap]"]=!1;var $e="object"==typeof he&&he&&he.Object===Object&&he,Xe="object"==typeof self&&self&&self.Object===Object&&self,Ke=$e||Xe||Function("return this")(),Ze="object"==typeof ge&&ge&&!ge.nodeType&&ge,Je=Ze&&"object"==typeof me&&me&&!me.nodeType&&me,Qe=Je&&Je.exports===Ze&&$e.process,tn=function(){try{return Qe&&Qe.binding("util")}catch(he){}}(),en=tn&&tn.isTypedArray;function z(he,ge){for(var me=-1,be=he?he.length:0,ve=Array(be);++me<be;)ve[me]=ge(he[me],me,he);return ve}function B(he,ge){for(var me=-1,be=ge.length,ve=he.length;++me<be;)he[ve+me]=ge[me];return he}function H(he,ge){for(var me=-1,be=he?he.length:0;++me<be;)if(ge(he[me],me,he))return!0;return!1}function V(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}function q(he){var ge=-1,me=Array(he.size);return he.forEach((function(he,be){me[++ge]=[be,he]})),me}function W(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var nn,sn,on,rn=Array.prototype,an=Function.prototype,ln=Object.prototype,cn=Ke["__core-js_shared__"],un=(nn=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||""))?"Symbol(src)_1."+nn:"",dn=an.toString,hn=ln.hasOwnProperty,pn=ln.toString,fn=RegExp("^"+dn.call(hn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gn=Ke.Symbol,mn=Ke.Uint8Array,bn=ln.propertyIsEnumerable,vn=rn.splice,yn=gn?gn.isConcatSpreadable:void 0,_n=(sn=Object.keys,on=Object,function(he){return sn(on(he))}),xn=Wt(Ke,"DataView"),wn=Wt(Ke,"Map"),Mn=Wt(Ke,"Promise"),Sn=Wt(Ke,"Set"),Dn=Wt(Ke,"WeakMap"),zn=Wt(Object,"create"),On=re(xn),Cn=re(wn),kn=re(Mn),Tn=re(Sn),Ln=re(Dn),An=gn?gn.prototype:void 0,En=An?An.valueOf:void 0,jn=An?An.toString:void 0;function At(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Rt(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function kt(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Tt(he){var ge=-1,me=he?he.length:0;for(this.__data__=new kt;++ge<me;)this.add(he[ge])}function Ct(he){this.__data__=new Rt(he)}function Ft(he,ge){for(var me=he.length;me--;)if(oe(he[me][0],ge))return me;return-1}At.prototype.clear=function(){this.__data__=zn?zn(null):{}},At.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},At.prototype.get=function(he){var ge=this.__data__;if(zn){var me=ge[he];return me===ve?void 0:me}return hn.call(ge,he)?ge[he]:void 0},At.prototype.has=function(he){var ge=this.__data__;return zn?void 0!==ge[he]:hn.call(ge,he)},At.prototype.set=function(he,ge){return this.__data__[he]=zn&&void 0===ge?ve:ge,this},Rt.prototype.clear=function(){this.__data__=[]},Rt.prototype.delete=function(he){var ge=this.__data__,me=Ft(ge,he);return!(me<0||(me==ge.length-1?ge.pop():vn.call(ge,me,1),0))},Rt.prototype.get=function(he){var ge=this.__data__,me=Ft(ge,he);return me<0?void 0:ge[me][1]},Rt.prototype.has=function(he){return Ft(this.__data__,he)>-1},Rt.prototype.set=function(he,ge){var me=this.__data__,be=Ft(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},kt.prototype.clear=function(){this.__data__={hash:new At,map:new(wn||Rt),string:new At}},kt.prototype.delete=function(he){return qt(this,he).delete(he)},kt.prototype.get=function(he){return qt(this,he).get(he)},kt.prototype.has=function(he){return qt(this,he).has(he)},kt.prototype.set=function(he,ge){return qt(this,he).set(he,ge),this},Tt.prototype.add=Tt.prototype.push=function(he){return this.__data__.set(he,ve),this},Tt.prototype.has=function(he){return this.__data__.has(he)},Ct.prototype.clear=function(){this.__data__=new Rt},Ct.prototype.delete=function(he){return this.__data__.delete(he)},Ct.prototype.get=function(he){return this.__data__.get(he)},Ct.prototype.has=function(he){return this.__data__.has(he)},Ct.prototype.set=function(he,ge){var me=this.__data__;if(me instanceof Rt){var be=me.__data__;if(!wn||be.length<199)return be.push([he,ge]),this;me=this.__data__=new kt(be)}return me.set(he,ge),this};var Rn,Fn=(Rn=function(he,ge){return he&&Lt(he,ge,de)},function(he,ge){if(null==he)return he;if(!ae(he))return Rn(he,ge);for(var me=he.length,be=-1,ve=Object(he);++be<me&&!1!==ge(ve[be],be,ve););return he}),Lt=function(he,ge,me){for(var be=-1,ve=Object(he),_e=me(he),xe=_e.length;xe--;){var we=_e[++be];if(!1===ge(ve[we],we,ve))break}return he};function Mt(he,ge){for(var me=0,be=(ge=Kt(ge,he)?[ge]:Ht(ge)).length;null!=he&&me<be;)he=he[ee(ge[me++])];return me&&me==be?he:void 0}function It(he,ge){return null!=he&&ge in Object(he)}function Ut(he,ge,me,be,ve){return he===ge||(null==he||null==ge||!fe(he)&&!le(ge)?he!=he&&ge!=ge:function(he,ge,me,be,ve,we){var Me=Pn(he),ke=Pn(ge),Te=De,Be=De;Me||(Te=(Te=Gt(he))==Se?Ee:Te),ke||(Be=(Be=Gt(ge))==Se?Ee:Be);var qe=Te==Ee&&!V(he),Ue=Be==Ee&&!V(ge),He=Te==Be;if(He&&!qe)return we||(we=new Ct),Me||Nn(he)?Vt(he,ge,me,be,ve,we):function(he,ge,me,be,ve,we,Me){switch(me){case Ne:if(he.byteLength!=ge.byteLength||he.byteOffset!=ge.byteOffset)return!1;he=he.buffer,ge=ge.buffer;case Pe:return!(he.byteLength!=ge.byteLength||!be(new mn(he),new mn(ge)));case ze:case Oe:case Ae:return oe(+he,+ge);case Ce:return he.name==ge.name&&he.message==ge.message;case je:case Fe:return he==ge+"";case Le:var Se=q;case Re:var De=we&xe;if(Se||(Se=W),he.size!=ge.size&&!De)return!1;var ke=Me.get(he);if(ke)return ke==ge;we|=_e,Me.set(he,ge);var Te=Vt(Se(he),Se(ge),be,ve,we,Me);return Me.delete(he),Te;case Ie:if(En)return En.call(he)==En.call(ge)}return!1}(he,ge,Te,me,be,ve,we);if(!(ve&xe)){var Ve=qe&&hn.call(he,"__wrapped__"),Ye=Ue&&hn.call(ge,"__wrapped__");if(Ve||Ye){var We=Ve?he.value():he,Ge=Ye?ge.value():ge;return we||(we=new Ct),me(We,Ge,be,ve,we)}}return!!He&&(we||(we=new Ct),function(he,ge,me,be,ve,_e){var we=ve&xe,Me=de(he),Se=Me.length;if(Se!=de(ge).length&&!we)return!1;for(var De=Se;De--;){var ze=Me[De];if(!(we?ze in ge:hn.call(ge,ze)))return!1}var Oe=_e.get(he);if(Oe&&_e.get(ge))return Oe==ge;var Ce=!0;_e.set(he,ge),_e.set(ge,he);for(var ke=we;++De<Se;){var Te=he[ze=Me[De]],Le=ge[ze];if(be)var Ae=we?be(Le,Te,ze,ge,he,_e):be(Te,Le,ze,he,ge,_e);if(!(void 0===Ae?Te===Le||me(Te,Le,be,ve,_e):Ae)){Ce=!1;break}ke||(ke="constructor"==ze)}if(Ce&&!ke){var Ee=he.constructor,je=ge.constructor;Ee!=je&&"constructor"in he&&"constructor"in ge&&!("function"==typeof Ee&&Ee instanceof Ee&&"function"==typeof je&&je instanceof je)&&(Ce=!1)}return _e.delete(he),_e.delete(ge),Ce}(he,ge,me,be,ve,we))}(he,ge,Ut,me,be,ve))}function Bt(he,ge){var me=-1,be=ae(he)?Array(he.length):[];return Fn(he,(function(he,ve,_e){be[++me]=ge(he,ve,_e)})),be}function Ht(he){return Pn(he)?he:In(he)}function Vt(he,ge,me,be,ve,we){var Me=ve&xe,Se=he.length,De=ge.length;if(Se!=De&&!(Me&&De>Se))return!1;var ze=we.get(he);if(ze&&we.get(ge))return ze==ge;var Oe=-1,Ce=!0,ke=ve&_e?new Tt:void 0;for(we.set(he,ge),we.set(ge,he);++Oe<Se;){var Te=he[Oe],Le=ge[Oe];if(be)var Ae=Me?be(Le,Te,Oe,ge,he,we):be(Te,Le,Oe,he,ge,we);if(void 0!==Ae){if(Ae)continue;Ce=!1;break}if(ke){if(!H(ge,(function(he,ge){if(!ke.has(ge)&&(Te===he||me(Te,he,be,ve,we)))return ke.add(ge)}))){Ce=!1;break}}else if(Te!==Le&&!me(Te,Le,be,ve,we)){Ce=!1;break}}return we.delete(he),we.delete(ge),Ce}function qt(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function Wt(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function Nt(he){return!(!fe(he)||un&&un in he)&&(ce(he)||V(he)?fn:Ye).test(re(he))}(me)?me:void 0}var Gt=function(he){return pn.call(he)};function Qt(he){return Pn(he)||ie(he)||!!(yn&&he&&he[yn])}function Jt(he,ge){return!!(ge=null==ge?Me:ge)&&("number"==typeof he||We.test(he))&&he>-1&&he%1==0&&he<ge}function Kt(he,ge){if(Pn(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!pe(he))||qe.test(he)||!Be.test(he)||null!=ge&&he in Object(ge)}function Zt(he){return he==he&&!fe(he)}function Xt(he,ge){return function(me){return null!=me&&me[he]===ge&&(void 0!==ge||he in Object(me))}}(xn&&Gt(new xn(new ArrayBuffer(1)))!=Ne||wn&&Gt(new wn)!=Le||Mn&&"[object Promise]"!=Gt(Mn.resolve())||Sn&&Gt(new Sn)!=Re||Dn&&"[object WeakMap]"!=Gt(new Dn))&&(Gt=function(he){var ge=pn.call(he),me=ge==Ee?he.constructor:void 0,be=me?re(me):void 0;if(be)switch(be){case On:return Ne;case Cn:return Le;case kn:return"[object Promise]";case Tn:return Re;case Ln:return"[object WeakMap]"}return ge});var In=ne((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(pe(he))return jn?jn.call(he):"";var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}(ge);var me=[];return Ue.test(he)&&me.push(""),he.replace(He,(function(he,ge,be,ve){me.push(be?ve.replace(Ve,"$1"):ge||he)})),me}));function ee(he){if("string"==typeof he||pe(he))return he;var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}function re(he){if(null!=he){try{return dn.call(he)}catch(he){}try{return he+""}catch(he){}}return""}function ne(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var r=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=r.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return r.cache=ve.set(be,_e),_e};return r.cache=new(ne.Cache||kt),r}function oe(he,ge){return he===ge||he!=he&&ge!=ge}function ie(he){return function(he){return le(he)&&ae(he)}(he)&&hn.call(he,"callee")&&(!bn.call(he,"callee")||pn.call(he)==Se)}ne.Cache=kt;var Pn=Array.isArray;function ae(he){return null!=he&&se(he.length)&&!ce(he)}function ce(he){var ge=fe(he)?pn.call(he):"";return ge==ke||ge==Te}function se(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=Me}function fe(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function le(he){return!!he&&"object"==typeof he}function pe(he){return"symbol"==typeof he||le(he)&&pn.call(he)==Ie}var Nn=en?function(he){return function(ge){return he(ge)}}(en):function(he){return le(he)&&se(he.length)&&!!Ge[pn.call(he)]};function de(he){return ae(he)?function Dt(he,ge){var me=Pn(he)||ie(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var _e in he)!ge&&!hn.call(he,_e)||ve&&("length"==_e||Jt(_e,be))||me.push(_e);return me}(he):function zt(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||ln))return _n(he);var ge,me,be=[];for(var ve in Object(he))hn.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}function ye(he){return he}me.exports=function(he,ge){return function t(he,ge,me,be,ve){var _e=-1,xe=he.length;for(me||(me=Qt),ve||(ve=[]);++_e<xe;){var we=he[_e];ge>0&&me(we)?ge>1?t(we,ge-1,me,be,ve):B(ve,we):be||(ve[ve.length]=we)}return ve}(function(he,ge){return(Pn(he)?z:Bt)(he,function Yt(he){return"function"==typeof he?he:null==he?ye:"object"==typeof he?Pn(he)?function(he,ge){return Kt(he)&&Zt(ge)?Xt(ee(he),ge):function(me){var be=function(he,ge,me){var be=null==he?void 0:Mt(he,ge);return void 0===be?void 0:be}(me,he);return void 0===be&&be===ge?function(he,ge){return null!=he&&function(he,ge,me){for(var be,ve=-1,_e=(ge=Kt(ge,he)?[ge]:Ht(ge)).length;++ve<_e;){var xe=ee(ge[ve]);if(!(be=null!=he&&me(he,xe)))break;he=he[xe]}return be||!!(_e=he?he.length:0)&&se(_e)&&Jt(xe,_e)&&(Pn(he)||ie(he))}(he,ge,It)}(me,he):Ut(ge,be,void 0,_e|xe)}}(he[0],he[1]):function(he){var ge=function(he){for(var ge=de(he),me=ge.length;me--;){var be=ge[me],ve=he[be];ge[me]=[be,ve,Zt(ve)]}return ge}(he);return 1==ge.length&&ge[0][2]?Xt(ge[0][0],ge[0][1]):function(me){return me===he||function(he,ge,me,be){var ve=me.length,we=ve;if(null==he)return!we;for(he=Object(he);ve--;){var Me=me[ve];if(Me[2]?Me[1]!==he[Me[0]]:!(Me[0]in he))return!1}for(;++ve<we;){var Se=(Me=me[ve])[0],De=he[Se],ze=Me[1];if(Me[2]){if(void 0===De&&!(Se in he))return!1}else{var Oe,Ce=new Ct;if(!(void 0===Oe?Ut(ze,De,be,_e|xe,Ce):Oe))return!1}}return!0}(me,0,ge)}}(he):Kt(ge=he)?(me=ee(ge),function(he){return null==he?void 0:he[me]}):function(he){return function(ge){return Mt(ge,he)}}(ge);var ge,me}(ge))}(he,ge),1)}}).call(this,me(0),me(2)(he))},function(he,ge,me){(function(he,me){var be="Expected a function",ve="__lodash_hash_undefined__",_e=1,xe=2,we=1/0,Me=9007199254740991,Se="[object Arguments]",De="[object Array]",ze="[object Boolean]",Oe="[object Date]",Ce="[object Error]",ke="[object Function]",Te="[object GeneratorFunction]",Le="[object Map]",Ae="[object Number]",Ee="[object Object]",je="[object RegExp]",Re="[object Set]",Fe="[object String]",Ie="[object Symbol]",Pe="[object ArrayBuffer]",Ne="[object DataView]",Be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qe=/^\w*$/,Ue=/^\./,He=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,Ye=/^\[object .+?Constructor\]$/,We=/^(?:0|[1-9]\d*)$/,Ge={};Ge["[object Float32Array]"]=Ge["[object Float64Array]"]=Ge["[object Int8Array]"]=Ge["[object Int16Array]"]=Ge["[object Int32Array]"]=Ge["[object Uint8Array]"]=Ge["[object Uint8ClampedArray]"]=Ge["[object Uint16Array]"]=Ge["[object Uint32Array]"]=!0,Ge[Se]=Ge[De]=Ge[Pe]=Ge[ze]=Ge[Ne]=Ge[Oe]=Ge[Ce]=Ge[ke]=Ge[Le]=Ge[Ae]=Ge[Ee]=Ge[je]=Ge[Re]=Ge[Fe]=Ge["[object WeakMap]"]=!1;var $e="object"==typeof he&&he&&he.Object===Object&&he,Xe="object"==typeof self&&self&&self.Object===Object&&self,Ke=$e||Xe||Function("return this")(),Ze="object"==typeof ge&&ge&&!ge.nodeType&&ge,Je=Ze&&"object"==typeof me&&me&&!me.nodeType&&me,Qe=Je&&Je.exports===Ze&&$e.process,tn=function(){try{return Qe&&Qe.binding("util")}catch(he){}}(),en=tn&&tn.isTypedArray;function z(he,ge){for(var me=-1,be=he?he.length:0,ve=Array(be);++me<be;)ve[me]=ge(he[me],me,he);return ve}function B(he,ge){for(var me=-1,be=he?he.length:0;++me<be;)if(ge(he[me],me,he))return!0;return!1}function H(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}function V(he){var ge=-1,me=Array(he.size);return he.forEach((function(he,be){me[++ge]=[be,he]})),me}function q(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var nn,sn,on,rn=Array.prototype,an=Function.prototype,ln=Object.prototype,cn=Ke["__core-js_shared__"],un=(nn=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||""))?"Symbol(src)_1."+nn:"",dn=an.toString,hn=ln.hasOwnProperty,pn=ln.toString,fn=RegExp("^"+dn.call(hn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gn=Ke.Symbol,mn=Ke.Uint8Array,bn=ln.propertyIsEnumerable,vn=rn.splice,yn=(sn=Object.keys,on=Object,function(he){return sn(on(he))}),_n=Vt(Ke,"DataView"),xn=Vt(Ke,"Map"),wn=Vt(Ke,"Promise"),Mn=Vt(Ke,"Set"),Sn=Vt(Ke,"WeakMap"),Dn=Vt(Object,"create"),zn=Xt(_n),On=Xt(xn),Cn=Xt(wn),kn=Xt(Mn),Tn=Xt(Sn),Ln=gn?gn.prototype:void 0,An=Ln?Ln.valueOf:void 0,En=Ln?Ln.toString:void 0;function Et(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function St(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function At(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Rt(he){var ge=-1,me=he?he.length:0;for(this.__data__=new At;++ge<me;)this.add(he[ge])}function kt(he){this.__data__=new St(he)}function Ct(he,ge){for(var me=he.length;me--;)if(ee(he[me][0],ge))return me;return-1}Et.prototype.clear=function(){this.__data__=Dn?Dn(null):{}},Et.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},Et.prototype.get=function(he){var ge=this.__data__;if(Dn){var me=ge[he];return me===ve?void 0:me}return hn.call(ge,he)?ge[he]:void 0},Et.prototype.has=function(he){var ge=this.__data__;return Dn?void 0!==ge[he]:hn.call(ge,he)},Et.prototype.set=function(he,ge){return this.__data__[he]=Dn&&void 0===ge?ve:ge,this},St.prototype.clear=function(){this.__data__=[]},St.prototype.delete=function(he){var ge=this.__data__,me=Ct(ge,he);return!(me<0||(me==ge.length-1?ge.pop():vn.call(ge,me,1),0))},St.prototype.get=function(he){var ge=this.__data__,me=Ct(ge,he);return me<0?void 0:ge[me][1]},St.prototype.has=function(he){return Ct(this.__data__,he)>-1},St.prototype.set=function(he,ge){var me=this.__data__,be=Ct(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},At.prototype.clear=function(){this.__data__={hash:new Et,map:new(xn||St),string:new Et}},At.prototype.delete=function(he){return Ht(this,he).delete(he)},At.prototype.get=function(he){return Ht(this,he).get(he)},At.prototype.has=function(he){return Ht(this,he).has(he)},At.prototype.set=function(he,ge){return Ht(this,he).set(he,ge),this},Rt.prototype.add=Rt.prototype.push=function(he){return this.__data__.set(he,ve),this},Rt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.clear=function(){this.__data__=new St},kt.prototype.delete=function(he){return this.__data__.delete(he)},kt.prototype.get=function(he){return this.__data__.get(he)},kt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.set=function(he,ge){var me=this.__data__;if(me instanceof St){var be=me.__data__;if(!xn||be.length<199)return be.push([he,ge]),this;me=this.__data__=new At(be)}return me.set(he,ge),this};var jn,Rn=(jn=function(he,ge){return he&&$t(he,ge,le)},function(he,ge){if(null==he)return he;if(!oe(he))return jn(he,ge);for(var me=he.length,be=-1,ve=Object(he);++be<me&&!1!==ge(ve[be],be,ve););return he}),$t=function(he,ge,me){for(var be=-1,ve=Object(he),_e=me(he),xe=_e.length;xe--;){var we=_e[++be];if(!1===ge(ve[we],we,ve))break}return he};function xt(he,ge){for(var me=0,be=(ge=Gt(ge,he)?[ge]:zt(ge)).length;null!=he&&me<be;)he=he[Zt(ge[me++])];return me&&me==be?he:void 0}function Lt(he,ge){return null!=he&&ge in Object(he)}function Mt(he,ge,me,be,ve){return he===ge||(null==he||null==ge||!ae(he)&&!ce(ge)?he!=he&&ge!=ge:function(he,ge,me,be,ve,we){var Me=In(he),ke=In(ge),Te=De,Be=De;Me||(Te=(Te=qt(he))==Se?Ee:Te),ke||(Be=(Be=qt(ge))==Se?Ee:Be);var qe=Te==Ee&&!H(he),Ue=Be==Ee&&!H(ge),He=Te==Be;if(He&&!qe)return we||(we=new kt),Me||Pn(he)?Bt(he,ge,me,be,ve,we):function(he,ge,me,be,ve,we,Me){switch(me){case Ne:if(he.byteLength!=ge.byteLength||he.byteOffset!=ge.byteOffset)return!1;he=he.buffer,ge=ge.buffer;case Pe:return!(he.byteLength!=ge.byteLength||!be(new mn(he),new mn(ge)));case ze:case Oe:case Ae:return ee(+he,+ge);case Ce:return he.name==ge.name&&he.message==ge.message;case je:case Fe:return he==ge+"";case Le:var Se=V;case Re:var De=we&xe;if(Se||(Se=q),he.size!=ge.size&&!De)return!1;var ke=Me.get(he);if(ke)return ke==ge;we|=_e,Me.set(he,ge);var Te=Bt(Se(he),Se(ge),be,ve,we,Me);return Me.delete(he),Te;case Ie:if(An)return An.call(he)==An.call(ge)}return!1}(he,ge,Te,me,be,ve,we);if(!(ve&xe)){var Ve=qe&&hn.call(he,"__wrapped__"),Ye=Ue&&hn.call(ge,"__wrapped__");if(Ve||Ye){var We=Ve?he.value():he,Ge=Ye?ge.value():ge;return we||(we=new kt),me(We,Ge,be,ve,we)}}return!!He&&(we||(we=new kt),function(he,ge,me,be,ve,_e){var we=ve&xe,Me=le(he),Se=Me.length;if(Se!=le(ge).length&&!we)return!1;for(var De=Se;De--;){var ze=Me[De];if(!(we?ze in ge:hn.call(ge,ze)))return!1}var Oe=_e.get(he);if(Oe&&_e.get(ge))return Oe==ge;var Ce=!0;_e.set(he,ge),_e.set(ge,he);for(var ke=we;++De<Se;){var Te=he[ze=Me[De]],Le=ge[ze];if(be)var Ae=we?be(Le,Te,ze,ge,he,_e):be(Te,Le,ze,he,ge,_e);if(!(void 0===Ae?Te===Le||me(Te,Le,be,ve,_e):Ae)){Ce=!1;break}ke||(ke="constructor"==ze)}if(Ce&&!ke){var Ee=he.constructor,je=ge.constructor;Ee!=je&&"constructor"in he&&"constructor"in ge&&!("function"==typeof Ee&&Ee instanceof Ee&&"function"==typeof je&&je instanceof je)&&(Ce=!1)}return _e.delete(he),_e.delete(ge),Ce}(he,ge,me,be,ve,we))}(he,ge,Mt,me,be,ve))}function Yt(he,ge){var me=-1,be=oe(he)?Array(he.length):[];return Rn(he,(function(he,ve,_e){be[++me]=ge(he,ve,_e)})),be}function zt(he){return In(he)?he:Fn(he)}function Bt(he,ge,me,be,ve,we){var Me=ve&xe,Se=he.length,De=ge.length;if(Se!=De&&!(Me&&De>Se))return!1;var ze=we.get(he);if(ze&&we.get(ge))return ze==ge;var Oe=-1,Ce=!0,ke=ve&_e?new Rt:void 0;for(we.set(he,ge),we.set(ge,he);++Oe<Se;){var Te=he[Oe],Le=ge[Oe];if(be)var Ae=Me?be(Le,Te,Oe,ge,he,we):be(Te,Le,Oe,he,ge,we);if(void 0!==Ae){if(Ae)continue;Ce=!1;break}if(ke){if(!B(ge,(function(he,ge){if(!ke.has(ge)&&(Te===he||me(Te,he,be,ve,we)))return ke.add(ge)}))){Ce=!1;break}}else if(Te!==Le&&!me(Te,Le,be,ve,we)){Ce=!1;break}}return we.delete(he),we.delete(ge),Ce}function Ht(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function Vt(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function It(he){return!(!ae(he)||un&&un in he)&&(ie(he)||H(he)?fn:Ye).test(Xt(he))}(me)?me:void 0}var qt=function(he){return pn.call(he)};function Wt(he,ge){return!!(ge=null==ge?Me:ge)&&("number"==typeof he||We.test(he))&&he>-1&&he%1==0&&he<ge}function Gt(he,ge){if(In(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!se(he))||qe.test(he)||!Be.test(he)||null!=ge&&he in Object(ge)}function Qt(he){return he==he&&!ae(he)}function Jt(he,ge){return function(me){return null!=me&&me[he]===ge&&(void 0!==ge||he in Object(me))}}(_n&&qt(new _n(new ArrayBuffer(1)))!=Ne||xn&&qt(new xn)!=Le||wn&&"[object Promise]"!=qt(wn.resolve())||Mn&&qt(new Mn)!=Re||Sn&&"[object WeakMap]"!=qt(new Sn))&&(qt=function(he){var ge=pn.call(he),me=ge==Ee?he.constructor:void 0,be=me?Xt(me):void 0;if(be)switch(be){case zn:return Ne;case On:return Le;case Cn:return"[object Promise]";case kn:return Re;case Tn:return"[object WeakMap]"}return ge});var Fn=te((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(se(he))return En?En.call(he):"";var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}(ge);var me=[];return Ue.test(he)&&me.push(""),he.replace(He,(function(he,ge,be,ve){me.push(be?ve.replace(Ve,"$1"):ge||he)})),me}));function Zt(he){if("string"==typeof he||se(he))return he;var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}function Xt(he){if(null!=he){try{return dn.call(he)}catch(he){}try{return he+""}catch(he){}}return""}function te(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var r=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=r.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return r.cache=ve.set(be,_e),_e};return r.cache=new(te.Cache||At),r}function ee(he,ge){return he===ge||he!=he&&ge!=ge}function re(he){return function(he){return ce(he)&&oe(he)}(he)&&hn.call(he,"callee")&&(!bn.call(he,"callee")||pn.call(he)==Se)}te.Cache=At;var In=Array.isArray;function oe(he){return null!=he&&ue(he.length)&&!ie(he)}function ie(he){var ge=ae(he)?pn.call(he):"";return ge==ke||ge==Te}function ue(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=Me}function ae(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function ce(he){return!!he&&"object"==typeof he}function se(he){return"symbol"==typeof he||ce(he)&&pn.call(he)==Ie}var Pn=en?function(he){return function(ge){return he(ge)}}(en):function(he){return ce(he)&&ue(he.length)&&!!Ge[pn.call(he)]};function le(he){return oe(he)?function Tt(he,ge){var me=In(he)||re(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var _e in he)!ge&&!hn.call(he,_e)||ve&&("length"==_e||Wt(_e,be))||me.push(_e);return me}(he):function Nt(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||ln))return yn(he);var ge,me,be=[];for(var ve in Object(he))hn.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}function pe(he){return he}me.exports=function(he,ge){return(In(he)?z:Yt)(he,function Ut(he){return"function"==typeof he?he:null==he?pe:"object"==typeof he?In(he)?function(he,ge){return Gt(he)&&Qt(ge)?Jt(Zt(he),ge):function(me){var be=function(he,ge,me){var be=null==he?void 0:xt(he,ge);return void 0===be?void 0:be}(me,he);return void 0===be&&be===ge?function(he,ge){return null!=he&&function(he,ge,me){for(var be,ve=-1,_e=(ge=Gt(ge,he)?[ge]:zt(ge)).length;++ve<_e;){var xe=Zt(ge[ve]);if(!(be=null!=he&&me(he,xe)))break;he=he[xe]}return be||!!(_e=he?he.length:0)&&ue(_e)&&Wt(xe,_e)&&(In(he)||re(he))}(he,ge,Lt)}(me,he):Mt(ge,be,void 0,_e|xe)}}(he[0],he[1]):function(he){var ge=function(he){for(var ge=le(he),me=ge.length;me--;){var be=ge[me],ve=he[be];ge[me]=[be,ve,Qt(ve)]}return ge}(he);return 1==ge.length&&ge[0][2]?Jt(ge[0][0],ge[0][1]):function(me){return me===he||function(he,ge,me,be){var ve=me.length,we=ve;if(null==he)return!we;for(he=Object(he);ve--;){var Me=me[ve];if(Me[2]?Me[1]!==he[Me[0]]:!(Me[0]in he))return!1}for(;++ve<we;){var Se=(Me=me[ve])[0],De=he[Se],ze=Me[1];if(Me[2]){if(void 0===De&&!(Se in he))return!1}else{var Oe,Ce=new kt;if(!(void 0===Oe?Mt(ze,De,be,_e|xe,Ce):Oe))return!1}}return!0}(me,0,ge)}}(he):Gt(ge=he)?(me=Zt(ge),function(he){return null==he?void 0:he[me]}):function(he){return function(ge){return xt(ge,he)}}(ge);var ge,me}(ge))}}).call(this,me(0),me(2)(he))},function(he,ge,me){(function(he,me){var be="Expected a function",ve="__lodash_hash_undefined__",_e=1,xe=2,we=1/0,Me=9007199254740991,Se="[object Arguments]",De="[object Array]",ze="[object Boolean]",Oe="[object Date]",Ce="[object Error]",ke="[object Function]",Te="[object GeneratorFunction]",Le="[object Map]",Ae="[object Number]",Ee="[object Object]",je="[object RegExp]",Re="[object Set]",Fe="[object String]",Ie="[object Symbol]",Pe="[object ArrayBuffer]",Ne="[object DataView]",Be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qe=/^\w*$/,Ue=/^\./,He=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,Ye=/^\[object .+?Constructor\]$/,We=/^(?:0|[1-9]\d*)$/,Ge={};Ge["[object Float32Array]"]=Ge["[object Float64Array]"]=Ge["[object Int8Array]"]=Ge["[object Int16Array]"]=Ge["[object Int32Array]"]=Ge["[object Uint8Array]"]=Ge["[object Uint8ClampedArray]"]=Ge["[object Uint16Array]"]=Ge["[object Uint32Array]"]=!0,Ge[Se]=Ge[De]=Ge[Pe]=Ge[ze]=Ge[Ne]=Ge[Oe]=Ge[Ce]=Ge[ke]=Ge[Le]=Ge[Ae]=Ge[Ee]=Ge[je]=Ge[Re]=Ge[Fe]=Ge["[object WeakMap]"]=!1;var $e="object"==typeof he&&he&&he.Object===Object&&he,Xe="object"==typeof self&&self&&self.Object===Object&&self,Ke=$e||Xe||Function("return this")(),Ze="object"==typeof ge&&ge&&!ge.nodeType&&ge,Je=Ze&&"object"==typeof me&&me&&!me.nodeType&&me,Qe=Je&&Je.exports===Ze&&$e.process,tn=function(){try{return Qe&&Qe.binding("util")}catch(he){}}(),en=tn&&tn.isTypedArray;function z(he,ge){for(var me=-1,be=he?he.length:0,ve=0,_e=[];++me<be;){var xe=he[me];ge(xe,me,he)&&(_e[ve++]=xe)}return _e}function B(he,ge){for(var me=-1,be=he?he.length:0;++me<be;)if(ge(he[me],me,he))return!0;return!1}function H(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}function V(he){var ge=-1,me=Array(he.size);return he.forEach((function(he,be){me[++ge]=[be,he]})),me}function q(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var nn,sn,on,rn=Array.prototype,an=Function.prototype,ln=Object.prototype,cn=Ke["__core-js_shared__"],un=(nn=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||""))?"Symbol(src)_1."+nn:"",dn=an.toString,hn=ln.hasOwnProperty,pn=ln.toString,fn=RegExp("^"+dn.call(hn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gn=Ke.Symbol,mn=Ke.Uint8Array,bn=ln.propertyIsEnumerable,vn=rn.splice,yn=(sn=Object.keys,on=Object,function(he){return sn(on(he))}),_n=Vt(Ke,"DataView"),xn=Vt(Ke,"Map"),wn=Vt(Ke,"Promise"),Mn=Vt(Ke,"Set"),Sn=Vt(Ke,"WeakMap"),Dn=Vt(Object,"create"),zn=Xt(_n),On=Xt(xn),Cn=Xt(wn),kn=Xt(Mn),Tn=Xt(Sn),Ln=gn?gn.prototype:void 0,An=Ln?Ln.valueOf:void 0,En=Ln?Ln.toString:void 0;function Et(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function St(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function At(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Rt(he){var ge=-1,me=he?he.length:0;for(this.__data__=new At;++ge<me;)this.add(he[ge])}function kt(he){this.__data__=new St(he)}function Ct(he,ge){for(var me=he.length;me--;)if(ee(he[me][0],ge))return me;return-1}Et.prototype.clear=function(){this.__data__=Dn?Dn(null):{}},Et.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},Et.prototype.get=function(he){var ge=this.__data__;if(Dn){var me=ge[he];return me===ve?void 0:me}return hn.call(ge,he)?ge[he]:void 0},Et.prototype.has=function(he){var ge=this.__data__;return Dn?void 0!==ge[he]:hn.call(ge,he)},Et.prototype.set=function(he,ge){return this.__data__[he]=Dn&&void 0===ge?ve:ge,this},St.prototype.clear=function(){this.__data__=[]},St.prototype.delete=function(he){var ge=this.__data__,me=Ct(ge,he);return!(me<0||(me==ge.length-1?ge.pop():vn.call(ge,me,1),0))},St.prototype.get=function(he){var ge=this.__data__,me=Ct(ge,he);return me<0?void 0:ge[me][1]},St.prototype.has=function(he){return Ct(this.__data__,he)>-1},St.prototype.set=function(he,ge){var me=this.__data__,be=Ct(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},At.prototype.clear=function(){this.__data__={hash:new Et,map:new(xn||St),string:new Et}},At.prototype.delete=function(he){return Ht(this,he).delete(he)},At.prototype.get=function(he){return Ht(this,he).get(he)},At.prototype.has=function(he){return Ht(this,he).has(he)},At.prototype.set=function(he,ge){return Ht(this,he).set(he,ge),this},Rt.prototype.add=Rt.prototype.push=function(he){return this.__data__.set(he,ve),this},Rt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.clear=function(){this.__data__=new St},kt.prototype.delete=function(he){return this.__data__.delete(he)},kt.prototype.get=function(he){return this.__data__.get(he)},kt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.set=function(he,ge){var me=this.__data__;if(me instanceof St){var be=me.__data__;if(!xn||be.length<199)return be.push([he,ge]),this;me=this.__data__=new At(be)}return me.set(he,ge),this};var jn,Rn=(jn=function(he,ge){return he&&xt(he,ge,le)},function(he,ge){if(null==he)return he;if(!oe(he))return jn(he,ge);for(var me=he.length,be=-1,ve=Object(he);++be<me&&!1!==ge(ve[be],be,ve););return he});function $t(he,ge){var me=[];return Rn(he,(function(he,be,ve){ge(he,be,ve)&&me.push(he)})),me}var xt=function(he,ge,me){for(var be=-1,ve=Object(he),_e=me(he),xe=_e.length;xe--;){var we=_e[++be];if(!1===ge(ve[we],we,ve))break}return he};function Lt(he,ge){for(var me=0,be=(ge=Gt(ge,he)?[ge]:zt(ge)).length;null!=he&&me<be;)he=he[Zt(ge[me++])];return me&&me==be?he:void 0}function Mt(he,ge){return null!=he&&ge in Object(he)}function It(he,ge,me,be,ve){return he===ge||(null==he||null==ge||!ae(he)&&!ce(ge)?he!=he&&ge!=ge:function(he,ge,me,be,ve,we){var Me=In(he),ke=In(ge),Te=De,Be=De;Me||(Te=(Te=qt(he))==Se?Ee:Te),ke||(Be=(Be=qt(ge))==Se?Ee:Be);var qe=Te==Ee&&!H(he),Ue=Be==Ee&&!H(ge),He=Te==Be;if(He&&!qe)return we||(we=new kt),Me||Pn(he)?Bt(he,ge,me,be,ve,we):function(he,ge,me,be,ve,we,Me){switch(me){case Ne:if(he.byteLength!=ge.byteLength||he.byteOffset!=ge.byteOffset)return!1;he=he.buffer,ge=ge.buffer;case Pe:return!(he.byteLength!=ge.byteLength||!be(new mn(he),new mn(ge)));case ze:case Oe:case Ae:return ee(+he,+ge);case Ce:return he.name==ge.name&&he.message==ge.message;case je:case Fe:return he==ge+"";case Le:var Se=V;case Re:var De=we&xe;if(Se||(Se=q),he.size!=ge.size&&!De)return!1;var ke=Me.get(he);if(ke)return ke==ge;we|=_e,Me.set(he,ge);var Te=Bt(Se(he),Se(ge),be,ve,we,Me);return Me.delete(he),Te;case Ie:if(An)return An.call(he)==An.call(ge)}return!1}(he,ge,Te,me,be,ve,we);if(!(ve&xe)){var Ve=qe&&hn.call(he,"__wrapped__"),Ye=Ue&&hn.call(ge,"__wrapped__");if(Ve||Ye){var We=Ve?he.value():he,Ge=Ye?ge.value():ge;return we||(we=new kt),me(We,Ge,be,ve,we)}}return!!He&&(we||(we=new kt),function(he,ge,me,be,ve,_e){var we=ve&xe,Me=le(he),Se=Me.length;if(Se!=le(ge).length&&!we)return!1;for(var De=Se;De--;){var ze=Me[De];if(!(we?ze in ge:hn.call(ge,ze)))return!1}var Oe=_e.get(he);if(Oe&&_e.get(ge))return Oe==ge;var Ce=!0;_e.set(he,ge),_e.set(ge,he);for(var ke=we;++De<Se;){var Te=he[ze=Me[De]],Le=ge[ze];if(be)var Ae=we?be(Le,Te,ze,ge,he,_e):be(Te,Le,ze,he,ge,_e);if(!(void 0===Ae?Te===Le||me(Te,Le,be,ve,_e):Ae)){Ce=!1;break}ke||(ke="constructor"==ze)}if(Ce&&!ke){var Ee=he.constructor,je=ge.constructor;Ee!=je&&"constructor"in he&&"constructor"in ge&&!("function"==typeof Ee&&Ee instanceof Ee&&"function"==typeof je&&je instanceof je)&&(Ce=!1)}return _e.delete(he),_e.delete(ge),Ce}(he,ge,me,be,ve,we))}(he,ge,It,me,be,ve))}function zt(he){return In(he)?he:Fn(he)}function Bt(he,ge,me,be,ve,we){var Me=ve&xe,Se=he.length,De=ge.length;if(Se!=De&&!(Me&&De>Se))return!1;var ze=we.get(he);if(ze&&we.get(ge))return ze==ge;var Oe=-1,Ce=!0,ke=ve&_e?new Rt:void 0;for(we.set(he,ge),we.set(ge,he);++Oe<Se;){var Te=he[Oe],Le=ge[Oe];if(be)var Ae=Me?be(Le,Te,Oe,ge,he,we):be(Te,Le,Oe,he,ge,we);if(void 0!==Ae){if(Ae)continue;Ce=!1;break}if(ke){if(!B(ge,(function(he,ge){if(!ke.has(ge)&&(Te===he||me(Te,he,be,ve,we)))return ke.add(ge)}))){Ce=!1;break}}else if(Te!==Le&&!me(Te,Le,be,ve,we)){Ce=!1;break}}return we.delete(he),we.delete(ge),Ce}function Ht(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function Vt(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function Ut(he){return!(!ae(he)||un&&un in he)&&(ie(he)||H(he)?fn:Ye).test(Xt(he))}(me)?me:void 0}var qt=function(he){return pn.call(he)};function Wt(he,ge){return!!(ge=null==ge?Me:ge)&&("number"==typeof he||We.test(he))&&he>-1&&he%1==0&&he<ge}function Gt(he,ge){if(In(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!se(he))||qe.test(he)||!Be.test(he)||null!=ge&&he in Object(ge)}function Qt(he){return he==he&&!ae(he)}function Jt(he,ge){return function(me){return null!=me&&me[he]===ge&&(void 0!==ge||he in Object(me))}}(_n&&qt(new _n(new ArrayBuffer(1)))!=Ne||xn&&qt(new xn)!=Le||wn&&"[object Promise]"!=qt(wn.resolve())||Mn&&qt(new Mn)!=Re||Sn&&"[object WeakMap]"!=qt(new Sn))&&(qt=function(he){var ge=pn.call(he),me=ge==Ee?he.constructor:void 0,be=me?Xt(me):void 0;if(be)switch(be){case zn:return Ne;case On:return Le;case Cn:return"[object Promise]";case kn:return Re;case Tn:return"[object WeakMap]"}return ge});var Fn=te((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(se(he))return En?En.call(he):"";var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}(ge);var me=[];return Ue.test(he)&&me.push(""),he.replace(He,(function(he,ge,be,ve){me.push(be?ve.replace(Ve,"$1"):ge||he)})),me}));function Zt(he){if("string"==typeof he||se(he))return he;var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}function Xt(he){if(null!=he){try{return dn.call(he)}catch(he){}try{return he+""}catch(he){}}return""}function te(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var r=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=r.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return r.cache=ve.set(be,_e),_e};return r.cache=new(te.Cache||At),r}function ee(he,ge){return he===ge||he!=he&&ge!=ge}function re(he){return function(he){return ce(he)&&oe(he)}(he)&&hn.call(he,"callee")&&(!bn.call(he,"callee")||pn.call(he)==Se)}te.Cache=At;var In=Array.isArray;function oe(he){return null!=he&&ue(he.length)&&!ie(he)}function ie(he){var ge=ae(he)?pn.call(he):"";return ge==ke||ge==Te}function ue(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=Me}function ae(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function ce(he){return!!he&&"object"==typeof he}function se(he){return"symbol"==typeof he||ce(he)&&pn.call(he)==Ie}var Pn=en?function(he){return function(ge){return he(ge)}}(en):function(he){return ce(he)&&ue(he.length)&&!!Ge[pn.call(he)]};function le(he){return oe(he)?function Tt(he,ge){var me=In(he)||re(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var _e in he)!ge&&!hn.call(he,_e)||ve&&("length"==_e||Wt(_e,be))||me.push(_e);return me}(he):function Yt(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||ln))return yn(he);var ge,me,be=[];for(var ve in Object(he))hn.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}function pe(he){return he}me.exports=function(he,ge){return(In(he)?z:$t)(he,function Nt(he){return"function"==typeof he?he:null==he?pe:"object"==typeof he?In(he)?function(he,ge){return Gt(he)&&Qt(ge)?Jt(Zt(he),ge):function(me){var be=function(he,ge,me){var be=null==he?void 0:Lt(he,ge);return void 0===be?void 0:be}(me,he);return void 0===be&&be===ge?function(he,ge){return null!=he&&function(he,ge,me){for(var be,ve=-1,_e=(ge=Gt(ge,he)?[ge]:zt(ge)).length;++ve<_e;){var xe=Zt(ge[ve]);if(!(be=null!=he&&me(he,xe)))break;he=he[xe]}return be||!!(_e=he?he.length:0)&&ue(_e)&&Wt(xe,_e)&&(In(he)||re(he))}(he,ge,Mt)}(me,he):It(ge,be,void 0,_e|xe)}}(he[0],he[1]):function(he){var ge=function(he){for(var ge=le(he),me=ge.length;me--;){var be=ge[me],ve=he[be];ge[me]=[be,ve,Qt(ve)]}return ge}(he);return 1==ge.length&&ge[0][2]?Jt(ge[0][0],ge[0][1]):function(me){return me===he||function(he,ge,me,be){var ve=me.length,we=ve;if(null==he)return!we;for(he=Object(he);ve--;){var Me=me[ve];if(Me[2]?Me[1]!==he[Me[0]]:!(Me[0]in he))return!1}for(;++ve<we;){var Se=(Me=me[ve])[0],De=he[Se],ze=Me[1];if(Me[2]){if(void 0===De&&!(Se in he))return!1}else{var Oe,Ce=new kt;if(!(void 0===Oe?It(ze,De,be,_e|xe,Ce):Oe))return!1}}return!0}(me,0,ge)}}(he):Gt(ge=he)?(me=Zt(ge),function(he){return null==he?void 0:he[me]}):function(he){return function(ge){return Lt(ge,he)}}(ge);var ge,me}(ge))}}).call(this,me(0),me(2)(he))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.FrontendFileReader=void 0,ge.FrontendFileReader=class{setRecordTransformer(he){this.recordTransformer=he}checkFile(he){fetch(he,{method:"HEAD",credentials:"same-origin",redirect:"follow"}).then((he=>Promise.resolve(he)))}readText(he,ge,me){fetch(he).then((he=>he.text())).then((he=>{ge(null,he)})).catch((me=>{ge("".concat(he," read error: ").concat(me))}))}}},function(he,ge,me){me.r(ge);var be=new Date,ve=new Date;function i(he,ge,me,_e){function a(ge){return he(ge=0===arguments.length?new Date:new Date(+ge)),ge}return a.floor=function(ge){return he(ge=new Date(+ge)),ge},a.ceil=function(me){return he(me=new Date(me-1)),ge(me,1),he(me),me},a.round=function(he){var ge=a(he),me=a.ceil(he);return he-ge<me-he?ge:me},a.offset=function(he,me){return ge(he=new Date(+he),null==me?1:Math.floor(me)),he},a.range=function(me,be,ve){var _e,xe=[];if(me=a.ceil(me),ve=null==ve?1:Math.floor(ve),!(me<be&&ve>0))return xe;do{xe.push(_e=new Date(+me)),ge(me,ve),he(me)}while(_e<me&&me<be);return xe},a.filter=function(me){return i((function(ge){if(ge>=ge)for(;he(ge),!me(ge);)ge.setTime(ge-1)}),(function(he,be){if(he>=he)if(be<0)for(;++be<=0;)for(;ge(he,-1),!me(he););else for(;--be>=0;)for(;ge(he,1),!me(he););}))},me&&(a.count=function(ge,_e){return be.setTime(+ge),ve.setTime(+_e),he(be),he(ve),Math.floor(me(be,ve))},a.every=function(he){return he=Math.floor(he),isFinite(he)&&he>0?he>1?a.filter(_e?function(ge){return _e(ge)%he==0}:function(ge){return a.count(0,ge)%he==0}):a:null}),a}var _e=6e4,xe=6048e5;function c(he){return i((function(ge){ge.setUTCDate(ge.getUTCDate()-(ge.getUTCDay()+7-he)%7),ge.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCDate(he.getUTCDate()+7*ge)}),(function(he,ge){return(ge-he)/xe}))}var we=c(0),Me=c(1),Se=c(2),De=c(3),ze=c(4),Oe=c(5),Ce=c(6),ke=(we.range,Me.range,Se.range,De.range,ze.range,Oe.range,Ce.range,i((function(he){he.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCDate(he.getUTCDate()+ge)}),(function(he,ge){return(ge-he)/864e5}),(function(he){return he.getUTCDate()-1}))),Te=ke;function _(he){return i((function(ge){ge.setDate(ge.getDate()-(ge.getDay()+7-he)%7),ge.setHours(0,0,0,0)}),(function(he,ge){he.setDate(he.getDate()+7*ge)}),(function(he,ge){return(ge-he-(ge.getTimezoneOffset()-he.getTimezoneOffset())*_e)/xe}))}ke.range;var Le=_(0),Ae=_(1),Ee=_(2),je=_(3),Re=_(4),Fe=_(5),Ie=_(6),Pe=(Le.range,Ae.range,Ee.range,je.range,Re.range,Fe.range,Ie.range,i((function(he){he.setHours(0,0,0,0)}),(function(he,ge){he.setDate(he.getDate()+ge)}),(function(he,ge){return(ge-he-(ge.getTimezoneOffset()-he.getTimezoneOffset())*_e)/864e5}),(function(he){return he.getDate()-1}))),Ne=Pe,Be=(Pe.range,i((function(he){he.setMonth(0,1),he.setHours(0,0,0,0)}),(function(he,ge){he.setFullYear(he.getFullYear()+ge)}),(function(he,ge){return ge.getFullYear()-he.getFullYear()}),(function(he){return he.getFullYear()})));Be.every=function(he){return isFinite(he=Math.floor(he))&&he>0?i((function(ge){ge.setFullYear(Math.floor(ge.getFullYear()/he)*he),ge.setMonth(0,1),ge.setHours(0,0,0,0)}),(function(ge,me){ge.setFullYear(ge.getFullYear()+me*he)})):null};var qe=Be,Ue=(Be.range,i((function(he){he.setUTCMonth(0,1),he.setUTCHours(0,0,0,0)}),(function(he,ge){he.setUTCFullYear(he.getUTCFullYear()+ge)}),(function(he,ge){return ge.getUTCFullYear()-he.getUTCFullYear()}),(function(he){return he.getUTCFullYear()})));Ue.every=function(he){return isFinite(he=Math.floor(he))&&he>0?i((function(ge){ge.setUTCFullYear(Math.floor(ge.getUTCFullYear()/he)*he),ge.setUTCMonth(0,1),ge.setUTCHours(0,0,0,0)}),(function(ge,me){ge.setUTCFullYear(ge.getUTCFullYear()+me*he)})):null};var He=Ue;function F(he){if(0<=he.y&&he.y<100){var ge=new Date(-1,he.m,he.d,he.H,he.M,he.S,he.L);return ge.setFullYear(he.y),ge}return new Date(he.y,he.m,he.d,he.H,he.M,he.S,he.L)}function P(he){if(0<=he.y&&he.y<100){var ge=new Date(Date.UTC(-1,he.m,he.d,he.H,he.M,he.S,he.L));return ge.setUTCFullYear(he.y),ge}return new Date(Date.UTC(he.y,he.m,he.d,he.H,he.M,he.S,he.L))}function $(he,ge,me){return{y:he,m:ge,d:me,H:0,M:0,S:0,L:0}}function x(he){var ge=he.dateTime,me=he.date,be=he.time,ve=he.periods,_e=he.days,xe=he.shortDays,we=he.months,Se=he.shortMonths,De=W(ve),ze=G(ve),Oe=W(_e),Ce=G(_e),ke=W(xe),Le=G(xe),Ee=W(we),je=G(we),Re=W(Se),Fe=G(Se),Ie={a:function(he){return xe[he.getDay()]},A:function(he){return _e[he.getDay()]},b:function(he){return Se[he.getMonth()]},B:function(he){return we[he.getMonth()]},c:null,d:yt,e:yt,f:mt,g:Dt,G:Pt,H:vt,I:gt,j:_t,L:bt,m:jt,M:wt,p:function(he){return ve[+(he.getHours()>=12)]},q:function(he){return 1+~~(he.getMonth()/3)},Q:re,s:ne,S:Ot,u:Et,U:St,V:Rt,w:kt,W:Tt,x:null,X:null,y:Ct,Y:Ft,Z:$t,"%":ee},Pe={a:function(he){return xe[he.getUTCDay()]},A:function(he){return _e[he.getUTCDay()]},b:function(he){return Se[he.getUTCMonth()]},B:function(he){return we[he.getUTCMonth()]},c:null,d:xt,e:xt,f:Nt,g:Kt,G:Xt,H:Lt,I:Mt,j:It,L:Ut,m:Yt,M:zt,p:function(he){return ve[+(he.getUTCHours()>=12)]},q:function(he){return 1+~~(he.getUTCMonth()/3)},Q:re,s:ne,S:Bt,u:Ht,U:Vt,V:Wt,w:Gt,W:Qt,x:null,X:null,y:Jt,Y:Zt,Z:te,"%":ee},Be={a:function(he,ge,me){var be=ke.exec(ge.slice(me));return be?(he.w=Le[be[0].toLowerCase()],me+be[0].length):-1},A:function(he,ge,me){var be=Oe.exec(ge.slice(me));return be?(he.w=Ce[be[0].toLowerCase()],me+be[0].length):-1},b:function(he,ge,me){var be=Re.exec(ge.slice(me));return be?(he.m=Fe[be[0].toLowerCase()],me+be[0].length):-1},B:function(he,ge,me){var be=Ee.exec(ge.slice(me));return be?(he.m=je[be[0].toLowerCase()],me+be[0].length):-1},c:function(he,me,be){return k(he,ge,me,be)},d:it,e:it,f:lt,g:et,G:tt,H:at,I:at,j:ut,L:ft,m:ot,M:ct,p:function(he,ge,me){var be=De.exec(ge.slice(me));return be?(he.p=ze[be[0].toLowerCase()],me+be[0].length):-1},q:nt,Q:ht,s:dt,S:st,u:J,U:K,V:Z,w:Q,W:X,x:function(he,ge,be){return k(he,me,ge,be)},X:function(he,ge,me){return k(he,be,ge,me)},y:et,Y:tt,Z:rt,"%":pt};function S(he,ge){return function(me){var be,ve,_e,xe=[],we=-1,Me=0,Se=he.length;for(me instanceof Date||(me=new Date(+me));++we<Se;)37===he.charCodeAt(we)&&(xe.push(he.slice(Me,we)),null!=(ve=Xe[be=he.charAt(++we)])?be=he.charAt(++we):ve="e"===be?" ":"0",(_e=ge[be])&&(be=_e(me,ve)),xe.push(be),Me=we+1);return xe.push(he.slice(Me,we)),xe.join("")}}function A(he,ge){return function(me){var be,ve,_e=$(1900,void 0,1);if(k(_e,he,me+="",0)!=me.length)return null;if("Q"in _e)return new Date(_e.Q);if("s"in _e)return new Date(1e3*_e.s+("L"in _e?_e.L:0));if(!ge||"Z"in _e||(_e.Z=0),"p"in _e&&(_e.H=_e.H%12+12*_e.p),void 0===_e.m&&(_e.m="q"in _e?_e.q:0),"V"in _e){if(_e.V<1||_e.V>53)return null;"w"in _e||(_e.w=1),"Z"in _e?(be=(ve=(be=P($(_e.y,0,1))).getUTCDay())>4||0===ve?Me.ceil(be):Me(be),be=Te.offset(be,7*(_e.V-1)),_e.y=be.getUTCFullYear(),_e.m=be.getUTCMonth(),_e.d=be.getUTCDate()+(_e.w+6)%7):(be=(ve=(be=F($(_e.y,0,1))).getDay())>4||0===ve?Ae.ceil(be):Ae(be),be=Ne.offset(be,7*(_e.V-1)),_e.y=be.getFullYear(),_e.m=be.getMonth(),_e.d=be.getDate()+(_e.w+6)%7)}else("W"in _e||"U"in _e)&&("w"in _e||(_e.w="u"in _e?_e.u%7:"W"in _e?1:0),ve="Z"in _e?P($(_e.y,0,1)).getUTCDay():F($(_e.y,0,1)).getDay(),_e.m=0,_e.d="W"in _e?(_e.w+6)%7+7*_e.W-(ve+5)%7:_e.w+7*_e.U-(ve+6)%7);return"Z"in _e?(_e.H+=_e.Z/100|0,_e.M+=_e.Z%100,P(_e)):F(_e)}}function k(he,ge,me,be){for(var ve,_e,xe=0,we=ge.length,Me=me.length;xe<we;){if(be>=Me)return-1;if(37===(ve=ge.charCodeAt(xe++))){if(ve=ge.charAt(xe++),!(_e=Be[ve in Xe?ge.charAt(xe++):ve])||(be=_e(he,me,be))<0)return-1}else if(ve!=me.charCodeAt(be++))return-1}return be}return Ie.x=S(me,Ie),Ie.X=S(be,Ie),Ie.c=S(ge,Ie),Pe.x=S(me,Pe),Pe.X=S(be,Pe),Pe.c=S(ge,Pe),{format:function(he){var ge=S(he+="",Ie);return ge.toString=function(){return he},ge},parse:function(he){var ge=A(he+="",!1);return ge.toString=function(){return he},ge},utcFormat:function(he){var ge=S(he+="",Pe);return ge.toString=function(){return he},ge},utcParse:function(he){var ge=A(he+="",!0);return ge.toString=function(){return he},ge}}}Ue.range;var Ve,Ye,We,Ge,$e,Xe={"-":"",_:" ",0:"0"},Ke=/^\s*\d+/,Ze=/^%/,Je=/[\\^$*+?|[\]().{}]/g;function V(he,ge,me){var be=he<0?"-":"",ve=(be?-he:he)+"",_e=ve.length;return be+(_e<me?new Array(me-_e+1).join(ge)+ve:ve)}function q(he){return he.replace(Je,"\\$&")}function W(he){return new RegExp("^(?:"+he.map(q).join("|")+")","i")}function G(he){for(var ge={},me=-1,be=he.length;++me<be;)ge[he[me].toLowerCase()]=me;return ge}function Q(he,ge,me){var be=Ke.exec(ge.slice(me,me+1));return be?(he.w=+be[0],me+be[0].length):-1}function J(he,ge,me){var be=Ke.exec(ge.slice(me,me+1));return be?(he.u=+be[0],me+be[0].length):-1}function K(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.U=+be[0],me+be[0].length):-1}function Z(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.V=+be[0],me+be[0].length):-1}function X(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.W=+be[0],me+be[0].length):-1}function tt(he,ge,me){var be=Ke.exec(ge.slice(me,me+4));return be?(he.y=+be[0],me+be[0].length):-1}function et(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.y=+be[0]+(+be[0]>68?1900:2e3),me+be[0].length):-1}function rt(he,ge,me){var be=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(ge.slice(me,me+6));return be?(he.Z=be[1]?0:-(be[2]+(be[3]||"00")),me+be[0].length):-1}function nt(he,ge,me){var be=Ke.exec(ge.slice(me,me+1));return be?(he.q=3*be[0]-3,me+be[0].length):-1}function ot(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.m=be[0]-1,me+be[0].length):-1}function it(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.d=+be[0],me+be[0].length):-1}function ut(he,ge,me){var be=Ke.exec(ge.slice(me,me+3));return be?(he.m=0,he.d=+be[0],me+be[0].length):-1}function at(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.H=+be[0],me+be[0].length):-1}function ct(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.M=+be[0],me+be[0].length):-1}function st(he,ge,me){var be=Ke.exec(ge.slice(me,me+2));return be?(he.S=+be[0],me+be[0].length):-1}function ft(he,ge,me){var be=Ke.exec(ge.slice(me,me+3));return be?(he.L=+be[0],me+be[0].length):-1}function lt(he,ge,me){var be=Ke.exec(ge.slice(me,me+6));return be?(he.L=Math.floor(be[0]/1e3),me+be[0].length):-1}function pt(he,ge,me){var be=Ze.exec(ge.slice(me,me+1));return be?me+be[0].length:-1}function ht(he,ge,me){var be=Ke.exec(ge.slice(me));return be?(he.Q=+be[0],me+be[0].length):-1}function dt(he,ge,me){var be=Ke.exec(ge.slice(me));return be?(he.s=+be[0],me+be[0].length):-1}function yt(he,ge){return V(he.getDate(),ge,2)}function vt(he,ge){return V(he.getHours(),ge,2)}function gt(he,ge){return V(he.getHours()%12||12,ge,2)}function _t(he,ge){return V(1+Ne.count(qe(he),he),ge,3)}function bt(he,ge){return V(he.getMilliseconds(),ge,3)}function mt(he,ge){return bt(he,ge)+"000"}function jt(he,ge){return V(he.getMonth()+1,ge,2)}function wt(he,ge){return V(he.getMinutes(),ge,2)}function Ot(he,ge){return V(he.getSeconds(),ge,2)}function Et(he){var ge=he.getDay();return 0===ge?7:ge}function St(he,ge){return V(Le.count(qe(he)-1,he),ge,2)}function At(he){var ge=he.getDay();return ge>=4||0===ge?Re(he):Re.ceil(he)}function Rt(he,ge){return he=At(he),V(Re.count(qe(he),he)+(4===qe(he).getDay()),ge,2)}function kt(he){return he.getDay()}function Tt(he,ge){return V(Ae.count(qe(he)-1,he),ge,2)}function Ct(he,ge){return V(he.getFullYear()%100,ge,2)}function Dt(he,ge){return V((he=At(he)).getFullYear()%100,ge,2)}function Ft(he,ge){return V(he.getFullYear()%1e4,ge,4)}function Pt(he,ge){var me=he.getDay();return V((he=me>=4||0===me?Re(he):Re.ceil(he)).getFullYear()%1e4,ge,4)}function $t(he){var ge=he.getTimezoneOffset();return(ge>0?"-":(ge*=-1,"+"))+V(ge/60|0,"0",2)+V(ge%60,"0",2)}function xt(he,ge){return V(he.getUTCDate(),ge,2)}function Lt(he,ge){return V(he.getUTCHours(),ge,2)}function Mt(he,ge){return V(he.getUTCHours()%12||12,ge,2)}function It(he,ge){return V(1+Te.count(He(he),he),ge,3)}function Ut(he,ge){return V(he.getUTCMilliseconds(),ge,3)}function Nt(he,ge){return Ut(he,ge)+"000"}function Yt(he,ge){return V(he.getUTCMonth()+1,ge,2)}function zt(he,ge){return V(he.getUTCMinutes(),ge,2)}function Bt(he,ge){return V(he.getUTCSeconds(),ge,2)}function Ht(he){var ge=he.getUTCDay();return 0===ge?7:ge}function Vt(he,ge){return V(we.count(He(he)-1,he),ge,2)}function qt(he){var ge=he.getUTCDay();return ge>=4||0===ge?ze(he):ze.ceil(he)}function Wt(he,ge){return he=qt(he),V(ze.count(He(he),he)+(4===He(he).getUTCDay()),ge,2)}function Gt(he){return he.getUTCDay()}function Qt(he,ge){return V(Me.count(He(he)-1,he),ge,2)}function Jt(he,ge){return V(he.getUTCFullYear()%100,ge,2)}function Kt(he,ge){return V((he=qt(he)).getUTCFullYear()%100,ge,2)}function Zt(he,ge){return V(he.getUTCFullYear()%1e4,ge,4)}function Xt(he,ge){var me=he.getUTCDay();return V((he=me>=4||0===me?ze(he):ze.ceil(he)).getUTCFullYear()%1e4,ge,4)}function te(){return"+0000"}function ee(){return"%"}function re(he){return+he}function ne(he){return Math.floor(+he/1e3)}function oe(he){return Ve=x(he),Ye=Ve.format,We=Ve.parse,Ge=Ve.utcFormat,$e=Ve.utcParse,Ve}oe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Qe=Date.prototype.toISOString?function(he){return he.toISOString()}:Ge("%Y-%m-%dT%H:%M:%S.%LZ"),tn=+new Date("2000-01-01T00:00:00.000Z")?function(he){var ge=new Date(he);return isNaN(ge)?null:ge}:$e("%Y-%m-%dT%H:%M:%S.%LZ");me.d(ge,"timeFormatDefaultLocale",(function(){return oe})),me.d(ge,"timeFormat",(function(){return Ye})),me.d(ge,"timeParse",(function(){return We})),me.d(ge,"utcFormat",(function(){return Ge})),me.d(ge,"utcParse",(function(){return $e})),me.d(ge,"timeFormatLocale",(function(){return x})),me.d(ge,"isoFormat",(function(){return Qe})),me.d(ge,"isoParse",(function(){return tn}))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.githubPathAdapter=function(he){const e=he=>(he.match(/\//g)||[]).length;return he.startsWith("https://raw.githubusercontent.com/")?(he.endsWith("/datapackage.json")&&(he=he.replace("/datapackage.json","")),he.endsWith("/")&&(he=he.replace(/.$/,"")),4===e(he)&&(he+="/master"),he):he.startsWith("https://github.com/")?(he.endsWith(".git")&&(he=he.replace(".git","")),he.endsWith("/datapackage.json")&&(he=he.replace("/datapackage.json","")),he.endsWith("/")&&(he=he.replace(/.$/,"")),(he=he.replace("https://github.com/","https://raw.githubusercontent.com/")).includes("/blob")&&(he=he.replace("/blob","")),4===e(he)&&(he+="/master"),he):he}},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(13);ge.getLevelAvailability=(he,ge)=>{const me=[be.Level.OFF,be.Level.FATAL,be.Level.ERROR,be.Level.WARNING,be.Level.DEBUG,be.Level.ALL];let ve=be.Level.OFF;for(const ge of me)if(ve|=ge,ge===he)break;return 0!=(ve&ge)};class o{constructor(he){this.diagnosticDescriptor=he,this.parents=[],this.diagnosticDescriptor.level||(this.diagnosticDescriptor.level=be.Level.ERROR)}addOutputTo(he){this.parents.push(he)}getFatalListener(){return this.onFatal}setFatalListener(he){this.onFatal=he}fatal(he,me,ve){if(ge.getLevelAvailability(this.diagnosticDescriptor.level,be.Level.FATAL)){const ge=ve instanceof Error?ve.stack:ve;this.onFatal&&this.onFatal(ge),this.addRecord(this.prepareRecord({funName:he,message:me,attachment:ge},be.Level.FATAL))}}error(he,me,ve){if(ge.getLevelAvailability(this.diagnosticDescriptor.level,be.Level.ERROR)){const ge=ve instanceof Error?ve.stack:ve;this.addRecord(this.prepareRecord({funName:he,message:me,attachment:ge},be.Level.ERROR))}}warning(he,me,ve){ge.getLevelAvailability(this.diagnosticDescriptor.level,be.Level.WARNING)&&this.addRecord(this.prepareRecord({funName:he,message:me,attachment:ve},be.Level.WARNING))}debug(he,me,ve){ge.getLevelAvailability(this.diagnosticDescriptor.level,be.Level.DEBUG)&&this.addRecord(this.prepareRecord({funName:he,message:me,attachment:ve},be.Level.DEBUG))}prepareDiagnosticFor(he){return{fatal:this.prepareFatalFor(he),error:this.prepareErrorFor(he),warning:this.prepareWarningFor(he),debug:this.prepareDebugFor(he)}}addRecord(he){if(this.parents.length<=0)throw Error("parents are missing for ".concat(this.diagnosticDescriptor.module,"@").concat(this.diagnosticDescriptor.version," on ").concat(this.diagnosticDescriptor.requestId));for(const ge of this.parents)ge.addRecord(he)}prepareFatalFor(he){return(ge,me)=>{this.fatal(he,ge,me)}}prepareErrorFor(he){return(ge,me)=>{this.error(he,ge,me)}}prepareWarningFor(he){return(ge,me)=>{this.warning(he,ge,me)}}prepareDebugFor(he){return(ge,me)=>{this.debug(he,ge,me)}}prepareRecord(he,ge){const{funName:me,message:ve,attachment:_e}=he,xe={time:(new Date).toISOString(),module:this.diagnosticDescriptor.module,version:this.diagnosticDescriptor.version,requestId:this.diagnosticDescriptor.requestId,funName:me,message:ve,level:be.getLabelByLevel(ge)};return _e&&(xe.attachment=_e),xe}}ge.LiftingDiagnosticManager=o;class i extends o{constructor(){super(...arguments),this.content=[]}addRecord(he){this.content.push(he)}putDiagnosticContentInto(he){he._diagnostic=this.content}extractDiagnosticContentFrom(he){const ge=JSON.parse(he);if(!ge._diagnostic)throw Error('"_diagnostic" field is NOT defined');this.content.push(...ge._diagnostic)}}ge.EndpointDiagnosticManager=i,ge.createDiagnosticManagerOn=function(he,ge){return{forRequest:me=>{const be={module:he,version:ge,requestId:me,level:null};return{withSeverityLevel:he=>(be.level=he,new i(be))}},basedOn:me=>{const be={module:he,version:ge,requestId:me.diagnosticDescriptor.requestId,level:me.diagnosticDescriptor.level},ve=new o(be);return ve.addOutputTo(me),me.getFatalListener()&&ve.setFatalListener(me.getFatalListener()),ve}}}},function(he,ge,me){var be,ve;
/* @license
    Papa Parse
    v5.3.2
    https://github.com/mholt/PapaParse
    License: MIT
    */void 0===(ve="function"==typeof(be=function t(){var he="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==he?he:{},ge=!he.document&&!!he.postMessage,me=ge&&/blob:/i.test((he.location||{}).protocol),be={},ve=0,_e={parse:function(ge,me){var xe=(me=me||{}).dynamicTyping||!1;if(j(xe)&&(me.dynamicTypingFunction=xe,xe={}),me.dynamicTyping=xe,me.transform=!!j(me.transform)&&me.transform,me.worker&&_e.WORKERS_SUPPORTED){var we=function(){if(!_e.WORKERS_SUPPORTED)return!1;var ge,me,xe=(ge=he.URL||he.webkitURL||null,me=t.toString(),_e.BLOB_URL||(_e.BLOB_URL=ge.createObjectURL(new Blob(["(",me,")();"],{type:"text/javascript"})))),we=new he.Worker(xe);return we.onmessage=v,we.id=ve++,be[we.id]=we}();return we.userStep=me.step,we.userChunk=me.chunk,we.userComplete=me.complete,we.userError=me.error,me.step=j(me.step),me.chunk=j(me.chunk),me.complete=j(me.complete),me.error=j(me.error),delete me.worker,void we.postMessage({input:ge,config:me,workerId:we.id})}var Me=null;return _e.NODE_STREAM_INPUT,"string"==typeof ge?Me=me.download?new s(me):new l(me):!0===ge.readable&&j(ge.read)&&j(ge.on)?Me=new p(me):(he.File&&ge instanceof File||ge instanceof Object)&&(Me=new f(me)),Me.stream(ge)},unparse:function(he,ge){var me=!1,be=!0,ve=",",xe="\r\n",we='"',Me=we+we,Se=!1,De=null,ze=!1;!function(){if("object"==typeof ge){if("string"!=typeof ge.delimiter||_e.BAD_DELIMITERS.filter((function(he){return-1!==ge.delimiter.indexOf(he)})).length||(ve=ge.delimiter),("boolean"==typeof ge.quotes||"function"==typeof ge.quotes||Array.isArray(ge.quotes))&&(me=ge.quotes),"boolean"!=typeof ge.skipEmptyLines&&"string"!=typeof ge.skipEmptyLines||(Se=ge.skipEmptyLines),"string"==typeof ge.newline&&(xe=ge.newline),"string"==typeof ge.quoteChar&&(we=ge.quoteChar),"boolean"==typeof ge.header&&(be=ge.header),Array.isArray(ge.columns)){if(0===ge.columns.length)throw new Error("Option columns is empty");De=ge.columns}void 0!==ge.escapeChar&&(Me=ge.escapeChar+we),("boolean"==typeof ge.escapeFormulae||ge.escapeFormulae instanceof RegExp)&&(ze=ge.escapeFormulae instanceof RegExp?ge.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var Oe=new RegExp(d(we),"g");if("string"==typeof he&&(he=JSON.parse(he)),Array.isArray(he)){if(!he.length||Array.isArray(he[0]))return h(null,he,Se);if("object"==typeof he[0])return h(De||Object.keys(he[0]),he,Se)}else if("object"==typeof he)return"string"==typeof he.data&&(he.data=JSON.parse(he.data)),Array.isArray(he.data)&&(he.fields||(he.fields=he.meta&&he.meta.fields||De),he.fields||(he.fields=Array.isArray(he.data[0])?he.fields:"object"==typeof he.data[0]?Object.keys(he.data[0]):[]),Array.isArray(he.data[0])||"object"==typeof he.data[0]||(he.data=[he.data])),h(he.fields||[],he.data||[],Se);throw new Error("Unable to serialize unrecognized input");function h(he,ge,me){var _e="";"string"==typeof he&&(he=JSON.parse(he)),"string"==typeof ge&&(ge=JSON.parse(ge));var we=Array.isArray(he)&&0<he.length,Me=!Array.isArray(ge[0]);if(we&&be){for(var Se=0;Se<he.length;Se++)0<Se&&(_e+=ve),_e+=y(he[Se],Se);0<ge.length&&(_e+=xe)}for(var De=0;De<ge.length;De++){var ze=we?he.length:ge[De].length,Oe=!1,Ce=we?0===Object.keys(ge[De]).length:0===ge[De].length;if(me&&!we&&(Oe="greedy"===me?""===ge[De].join("").trim():1===ge[De].length&&0===ge[De][0].length),"greedy"===me&&we){for(var ke=[],Te=0;Te<ze;Te++){var Le=Me?he[Te]:Te;ke.push(ge[De][Le])}Oe=""===ke.join("").trim()}if(!Oe){for(var Ae=0;Ae<ze;Ae++){0<Ae&&!Ce&&(_e+=ve);var Ee=we&&Me?he[Ae]:Ae;_e+=y(ge[De][Ee],Ae)}De<ge.length-1&&(!me||0<ze&&!Ce)&&(_e+=xe)}}return _e}function y(he,ge){if(null==he)return"";if(he.constructor===Date)return JSON.stringify(he).slice(1,25);var be=!1;ze&&"string"==typeof he&&ze.test(he)&&(he="'"+he,be=!0);var xe=he.toString().replace(Oe,Me);return(be=be||!0===me||"function"==typeof me&&me(he,ge)||Array.isArray(me)&&me[ge]||function(he,ge){for(var me=0;me<ge.length;me++)if(-1<he.indexOf(ge[me]))return!0;return!1}(xe,_e.BAD_DELIMITERS)||-1<xe.indexOf(ve)||" "===xe.charAt(0)||" "===xe.charAt(xe.length-1))?we+xe+we:xe}}};if(_e.RECORD_SEP=String.fromCharCode(30),_e.UNIT_SEP=String.fromCharCode(31),_e.BYTE_ORDER_MARK="\ufeff",_e.BAD_DELIMITERS=["\r","\n",'"',_e.BYTE_ORDER_MARK],_e.WORKERS_SUPPORTED=!ge&&!!he.Worker,_e.NODE_STREAM_INPUT=1,_e.LocalChunkSize=10485760,_e.RemoteChunkSize=5242880,_e.DefaultDelimiter=",",_e.Parser=y,_e.ParserHandle=h,_e.NetworkStreamer=s,_e.FileStreamer=f,_e.StringStreamer=l,_e.ReadableStreamStreamer=p,he.jQuery){var xe=he.jQuery;xe.fn.parse=function(ge){var me=ge.config||{},be=[];return this.each((function(ge){if("INPUT"!==xe(this).prop("tagName").toUpperCase()||"file"!==xe(this).attr("type").toLowerCase()||!he.FileReader||!this.files||0===this.files.length)return!0;for(var ve=0;ve<this.files.length;ve++)be.push({file:this.files[ve],inputElem:this,instanceConfig:xe.extend({},me)})})),o(),this;function o(){if(0!==be.length){var he,me,ve,we=be[0];if(j(ge.before)){var Me=ge.before(we.file,we.inputElem);if("object"==typeof Me){if("abort"===Me.action)return he=we.file,me=we.inputElem,ve=Me.reason,void(j(ge.error)&&ge.error({name:"AbortError"},he,me,ve));if("skip"===Me.action)return void i();"object"==typeof Me.config&&(we.instanceConfig=xe.extend(we.instanceConfig,Me.config))}else if("skip"===Me)return void i()}var Se=we.instanceConfig.complete;we.instanceConfig.complete=function(he){j(Se)&&Se(he,we.file,we.inputElem),i()},_e.parse(we.file,we.instanceConfig)}else j(ge.complete)&&ge.complete()}function i(){be.splice(0,1),o()}}}function c(ge){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(he){var ge=b(he);ge.chunkSize=parseInt(ge.chunkSize),he.step||he.chunk||(ge.chunkSize=null),this._handle=new h(ge),(this._handle.streamer=this)._config=ge}.call(this,ge),this.parseChunk=function(ge,be){if(this.isFirstChunk&&j(this._config.beforeFirstChunk)){var ve=this._config.beforeFirstChunk(ge);void 0!==ve&&(ge=ve)}this.isFirstChunk=!1,this._halted=!1;var xe=this._partialLine+ge;this._partialLine="";var we=this._handle.parse(xe,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var Me=we.meta.cursor;this._finished||(this._partialLine=xe.substring(Me-this._baseIndex),this._baseIndex=Me),we&&we.data&&(this._rowCount+=we.data.length);var Se=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(me)he.postMessage({results:we,workerId:_e.WORKER_ID,finished:Se});else if(j(this._config.chunk)&&!be){if(this._config.chunk(we,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);we=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(we.data),this._completeResults.errors=this._completeResults.errors.concat(we.errors),this._completeResults.meta=we.meta),this._completed||!Se||!j(this._config.complete)||we&&we.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),Se||we&&we.meta.paused||this._nextChunk(),we}this._halted=!0},this._sendError=function(ge){j(this._config.error)?this._config.error(ge):me&&this._config.error&&he.postMessage({workerId:_e.WORKER_ID,error:ge,finished:!1})}}function s(he){var me;(he=he||{}).chunkSize||(he.chunkSize=_e.RemoteChunkSize),c.call(this,he),this._nextChunk=ge?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(he){this._input=he,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(me=new XMLHttpRequest,this._config.withCredentials&&(me.withCredentials=this._config.withCredentials),ge||(me.onload=m(this._chunkLoaded,this),me.onerror=m(this._chunkError,this)),me.open(this._config.downloadRequestBody?"POST":"GET",this._input,!ge),this._config.downloadRequestHeaders){var he=this._config.downloadRequestHeaders;for(var be in he)me.setRequestHeader(be,he[be])}if(this._config.chunkSize){var ve=this._start+this._config.chunkSize-1;me.setRequestHeader("Range","bytes="+this._start+"-"+ve)}try{me.send(this._config.downloadRequestBody)}catch(he){this._chunkError(he.message)}ge&&0===me.status&&this._chunkError()}},this._chunkLoaded=function(){var he;4===me.readyState&&(me.status<200||400<=me.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:me.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(he=me.getResponseHeader("Content-Range"))?-1:parseInt(he.substring(he.lastIndexOf("/")+1))),this.parseChunk(me.responseText)))},this._chunkError=function(he){var ge=me.statusText||he;this._sendError(new Error(ge))}}function f(he){var ge,me;(he=he||{}).chunkSize||(he.chunkSize=_e.LocalChunkSize),c.call(this,he);var be="undefined"!=typeof FileReader;this.stream=function(he){this._input=he,me=he.slice||he.webkitSlice||he.mozSlice,be?((ge=new FileReader).onload=m(this._chunkLoaded,this),ge.onerror=m(this._chunkError,this)):ge=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var he=this._input;if(this._config.chunkSize){var ve=Math.min(this._start+this._config.chunkSize,this._input.size);he=me.call(he,this._start,ve)}var _e=ge.readAsText(he,this._config.encoding);be||this._chunkLoaded({target:{result:_e}})},this._chunkLoaded=function(he){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(he.target.result)},this._chunkError=function(){this._sendError(ge.error)}}function l(he){var ge;c.call(this,he=he||{}),this.stream=function(he){return ge=he,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var he,me=this._config.chunkSize;return me?(he=ge.substring(0,me),ge=ge.substring(me)):(he=ge,ge=""),this._finished=!ge,this.parseChunk(he)}}}function p(he){c.call(this,he=he||{});var ge=[],me=!0,be=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(he){this._input=he,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){be&&1===ge.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),ge.length?this.parseChunk(ge.shift()):me=!0},this._streamData=m((function(he){try{ge.push("string"==typeof he?he:he.toString(this._config.encoding)),me&&(me=!1,this._checkIsFinished(),this.parseChunk(ge.shift()))}catch(he){this._streamError(he)}}),this),this._streamError=m((function(he){this._streamCleanUp(),this._sendError(he)}),this),this._streamEnd=m((function(){this._streamCleanUp(),be=!0,this._streamData("")}),this),this._streamCleanUp=m((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function h(he){var ge,me,be,ve=Math.pow(2,53),xe=-ve,we=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Me=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,Se=this,De=0,ze=0,Oe=!1,Ce=!1,ke=[],Te={data:[],errors:[],meta:{}};if(j(he.step)){var Le=he.step;he.step=function(ge){if(Te=ge,O())w();else{if(w(),0===Te.data.length)return;De+=ge.data.length,he.preview&&De>he.preview?me.abort():(Te.data=Te.data[0],Le(Te,Se))}}}function m(ge){return"greedy"===he.skipEmptyLines?""===ge.join("").trim():1===ge.length&&0===ge[0].length}function w(){return Te&&be&&(S("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+_e.DefaultDelimiter+"'"),be=!1),he.skipEmptyLines&&(Te.data=Te.data.filter((function(he){return!m(he)}))),O()&&function(){if(Te)if(Array.isArray(Te.data[0])){for(var ge=0;O()&&ge<Te.data.length;ge++)Te.data[ge].forEach(r);Te.data.splice(0,1)}else Te.data.forEach(r);function r(ge,me){j(he.transformHeader)&&(ge=he.transformHeader(ge,me)),ke.push(ge)}}(),function(){if(!Te||!he.header&&!he.dynamicTyping&&!he.transform)return Te;function e(ge,me){var be,ve=he.header?{}:[];for(be=0;be<ge.length;be++){var _e=be,xe=ge[be];he.header&&(_e=be>=ke.length?"__parsed_extra":ke[be]),he.transform&&(xe=he.transform(xe,_e)),xe=E(_e,xe),"__parsed_extra"===_e?(ve[_e]=ve[_e]||[],ve[_e].push(xe)):ve[_e]=xe}return he.header&&(be>ke.length?S("FieldMismatch","TooManyFields","Too many fields: expected "+ke.length+" fields but parsed "+be,ze+me):be<ke.length&&S("FieldMismatch","TooFewFields","Too few fields: expected "+ke.length+" fields but parsed "+be,ze+me)),ve}var ge=1;return!Te.data.length||Array.isArray(Te.data[0])?(Te.data=Te.data.map(e),ge=Te.data.length):Te.data=e(Te.data,0),he.header&&Te.meta&&(Te.meta.fields=ke),ze+=ge,Te}()}function O(){return he.header&&0===ke.length}function E(ge,me){return be=ge,he.dynamicTypingFunction&&void 0===he.dynamicTyping[be]&&(he.dynamicTyping[be]=he.dynamicTypingFunction(be)),!0===(he.dynamicTyping[be]||he.dynamicTyping)?"true"===me||"TRUE"===me||"false"!==me&&"FALSE"!==me&&(function(he){if(we.test(he)){var ge=parseFloat(he);if(xe<ge&&ge<ve)return!0}return!1}(me)?parseFloat(me):Me.test(me)?new Date(me):""===me?null:me):me;var be}function S(he,ge,me,be){var ve={type:he,code:ge,message:me};void 0!==be&&(ve.row=be),Te.errors.push(ve)}this.parse=function(ve,xe,we){var Me=he.quoteChar||'"';if(he.newline||(he.newline=function(he,ge){he=he.substring(0,1048576);var me=new RegExp(d(ge)+"([^]*?)"+d(ge),"gm"),be=(he=he.replace(me,"")).split("\r"),ve=he.split("\n"),_e=1<ve.length&&ve[0].length<be[0].length;if(1===be.length||_e)return"\n";for(var xe=0,we=0;we<be.length;we++)"\n"===be[we][0]&&xe++;return xe>=be.length/2?"\r\n":"\r"}(ve,Me)),be=!1,he.delimiter)j(he.delimiter)&&(he.delimiter=he.delimiter(ve),Te.meta.delimiter=he.delimiter);else{var Se=function(ge,me,be,ve,xe){var we,Me,Se,De;xe=xe||[",","\t","|",";",_e.RECORD_SEP,_e.UNIT_SEP];for(var ze=0;ze<xe.length;ze++){var Oe=xe[ze],Ce=0,ke=0,Te=0;Se=void 0;for(var Le=new y({comments:ve,delimiter:Oe,newline:me,preview:10}).parse(ge),Ae=0;Ae<Le.data.length;Ae++)if(be&&m(Le.data[Ae]))Te++;else{var Ee=Le.data[Ae].length;ke+=Ee,void 0!==Se?0<Ee&&(Ce+=Math.abs(Ee-Se),Se=Ee):Se=Ee}0<Le.data.length&&(ke/=Le.data.length-Te),(void 0===Me||Ce<=Me)&&(void 0===De||De<ke)&&1.99<ke&&(Me=Ce,we=Oe,De=ke)}return{successful:!!(he.delimiter=we),bestDelimiter:we}}(ve,he.newline,he.skipEmptyLines,he.comments,he.delimitersToGuess);Se.successful?he.delimiter=Se.bestDelimiter:(be=!0,he.delimiter=_e.DefaultDelimiter),Te.meta.delimiter=he.delimiter}var De=b(he);return he.preview&&he.header&&De.preview++,ge=ve,me=new y(De),Te=me.parse(ge,xe,we),w(),Oe?{meta:{paused:!0}}:Te||{meta:{paused:!1}}},this.paused=function(){return Oe},this.pause=function(){Oe=!0,me.abort(),ge=j(he.chunk)?"":ge.substring(me.getCharIndex())},this.resume=function(){Se.streamer._halted?(Oe=!1,Se.streamer.parseChunk(ge,!0)):setTimeout(Se.resume,3)},this.aborted=function(){return Ce},this.abort=function(){Ce=!0,me.abort(),Te.meta.aborted=!0,j(he.complete)&&he.complete(Te),ge=""}}function d(he){return he.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(he){var ge,me=(he=he||{}).delimiter,be=he.newline,ve=he.comments,xe=he.step,we=he.preview,Me=he.fastMode,Se=ge=void 0===he.quoteChar||null===he.quoteChar?'"':he.quoteChar;if(void 0!==he.escapeChar&&(Se=he.escapeChar),("string"!=typeof me||-1<_e.BAD_DELIMITERS.indexOf(me))&&(me=","),ve===me)throw new Error("Comment character same as delimiter");!0===ve?ve="#":("string"!=typeof ve||-1<_e.BAD_DELIMITERS.indexOf(ve))&&(ve=!1),"\n"!==be&&"\r"!==be&&"\r\n"!==be&&(be="\n");var De=0,ze=!1;this.parse=function(he,_e,Oe){if("string"!=typeof he)throw new Error("Input must be a string");var Ce=he.length,ke=me.length,Te=be.length,Le=ve.length,Ae=j(xe),Ee=[],je=[],Re=[],Fe=De=0;if(!he)return L();if(Me||!1!==Me&&-1===he.indexOf(ge)){for(var Ie=he.split(be),Pe=0;Pe<Ie.length;Pe++){if(Re=Ie[Pe],De+=Re.length,Pe!==Ie.length-1)De+=be.length;else if(Oe)return L();if(!ve||Re.substring(0,Le)!==ve){if(Ae){if(Ee=[],F(Re.split(me)),M(),ze)return L()}else F(Re.split(me));if(we&&we<=Pe)return Ee=Ee.slice(0,we),L(!0)}}return L()}for(var Ne=he.indexOf(me,De),Be=he.indexOf(be,De),qe=new RegExp(d(Se)+d(ge),"g"),Ue=he.indexOf(ge,De);;)if(he[De]!==ge)if(ve&&0===Re.length&&he.substring(De,De+Le)===ve){if(-1===Be)return L();De=Be+Te,Be=he.indexOf(be,De),Ne=he.indexOf(me,De)}else if(-1!==Ne&&(Ne<Be||-1===Be))Re.push(he.substring(De,Ne)),De=Ne+ke,Ne=he.indexOf(me,De);else{if(-1===Be)break;if(Re.push(he.substring(De,Be)),x(Be+Te),Ae&&(M(),ze))return L();if(we&&Ee.length>=we)return L(!0)}else for(Ue=De,De++;;){if(-1===(Ue=he.indexOf(ge,Ue+1)))return Oe||je.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Ee.length,index:De}),$();if(Ue===Ce-1)return $(he.substring(De,Ue).replace(qe,ge));if(ge!==Se||he[Ue+1]!==Se){if(ge===Se||0===Ue||he[Ue-1]!==Se){-1!==Ne&&Ne<Ue+1&&(Ne=he.indexOf(me,Ue+1)),-1!==Be&&Be<Ue+1&&(Be=he.indexOf(be,Ue+1));var He=P(-1===Be?Ne:Math.min(Ne,Be));if(he.substr(Ue+1+He,ke)===me){Re.push(he.substring(De,Ue).replace(qe,ge)),he[De=Ue+1+He+ke]!==ge&&(Ue=he.indexOf(ge,De)),Ne=he.indexOf(me,De),Be=he.indexOf(be,De);break}var Ve=P(Be);if(he.substring(Ue+1+Ve,Ue+1+Ve+Te)===be){if(Re.push(he.substring(De,Ue).replace(qe,ge)),x(Ue+1+Ve+Te),Ne=he.indexOf(me,De),Ue=he.indexOf(ge,De),Ae&&(M(),ze))return L();if(we&&Ee.length>=we)return L(!0);break}je.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Ee.length,index:De}),Ue++}}else Ue++}return $();function F(he){Ee.push(he),Fe=De}function P(ge){var me=0;if(-1!==ge){var be=he.substring(Ue+1,ge);be&&""===be.trim()&&(me=be.length)}return me}function $(ge){return Oe||(void 0===ge&&(ge=he.substring(De)),Re.push(ge),De=Ce,F(Re),Ae&&M()),L()}function x(ge){De=ge,F(Re),Re=[],Be=he.indexOf(be,De)}function L(he){return{data:Ee,errors:je,meta:{delimiter:me,linebreak:be,aborted:ze,truncated:!!he,cursor:Fe+(_e||0)}}}function M(){xe(L()),Ee=[],je=[]}},this.abort=function(){ze=!0},this.getCharIndex=function(){return De}}function v(he){var ge=he.data,me=be[ge.workerId],ve=!1;if(ge.error)me.userError(ge.error,ge.file);else if(ge.results&&ge.results.data){var _e={abort:function(){ve=!0,g(ge.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_,resume:_};if(j(me.userStep)){for(var xe=0;xe<ge.results.data.length&&(me.userStep({data:ge.results.data[xe],errors:ge.results.errors,meta:ge.results.meta},_e),!ve);xe++);delete ge.results}else j(me.userChunk)&&(me.userChunk(ge.results,_e,ge.file),delete ge.results)}ge.finished&&!ve&&g(ge.workerId,ge.results)}function g(he,ge){var me=be[he];j(me.userComplete)&&me.userComplete(ge),me.terminate(),delete be[he]}function _(){throw new Error("Not implemented.")}function b(he){if("object"!=typeof he||null===he)return he;var ge=Array.isArray(he)?[]:{};for(var me in he)ge[me]=b(he[me]);return ge}function m(he,ge){return function(){he.apply(ge,arguments)}}function j(he){return"function"==typeof he}return me&&(he.onmessage=function(ge){var me=ge.data;if(void 0===_e.WORKER_ID&&me&&(_e.WORKER_ID=me.workerId),"string"==typeof me.input)he.postMessage({workerId:_e.WORKER_ID,results:_e.parse(me.input,me.config),finished:!0});else if(he.File&&me.input instanceof File||me.input instanceof Object){var be=_e.parse(me.input,me.config);be&&he.postMessage({workerId:_e.WORKER_ID,results:be,finished:!0})}}),(s.prototype=Object.create(c.prototype)).constructor=s,(f.prototype=Object.create(c.prototype)).constructor=f,(l.prototype=Object.create(l.prototype)).constructor=l,(p.prototype=Object.create(c.prototype)).constructor=p,_e})?be.apply(ge,[]):be)||(he.exports=ve)},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(11),ve=me(16),_e=me(12),xe=me(3),we=me(15);function c(he){return xe.isDatapointsQuery(he)&&1===be(he.where).length&&ve(he.where)&&he.where.$and?we.QueryFeature.WhereClauseBasedOnConjunction:null}ge.featureDetectors=[c,(he,ge)=>{if(!c(he))return null;for(const me of he.where.$and){const ve=be(me);if(1===ve.length){const xe=_e(ve),Me=me[xe];if(he.join&&he.join[Me]){const me=he.join[Me],ve=me.where,Se=_e(be(ve));if(me.key===xe&&me.key===Se&&1===be(ve).length){const he=ve[Se],_e=ge.get(me.key),xe=!!he.$in||!!he.$nin,Me="entity_set"===_e.concept_type||"entity_domain"===_e.concept_type;if(1===be(he).length&&xe&&Me)return we.QueryFeature.ConjunctionPartFromWhereClauseCorrespondsToJoin}}}}return null}]},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(7),ve=me(1),_e=me(4),xe=me(3);function a(he,ge){const{dataset:me,branch:be,commit:ve}=ge;return"".concat(he).concat(me,"/").concat(be,"/").concat(ve)}function c(he){return he?"default ":""}function s(he,ge){return"".concat(c(ge),"dataset '").concat(he,"'")}ge.getRepositoryPath=a,ge.getFilePath=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datapackage.json";return"".concat(he,"/").concat(ge)},ge.extendQueryWithRepository=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{repositoryDescriptors:{}};const me=_e(ge,"repositoryDescriptors",{}),we=be(he.dataset);if(!we){const[ge,me]=he.dataset.split("#");!he.branch&&me&&(he.branch=me,he.dataset=ge)}const Me=be(he.branch)||he.branch===ge.defaultRepositoryBranch,Se=be(he.commit)||he.commit===ge.defaultRepositoryCommit,{dataset:De=_e(ge,"defaultRepository",xe.DEFAULT_REPOSITORY_NAME),branch:ze=_e(ge,"defaultRepositoryBranch",xe.DEFAULT_REPOSITORY_BRANCH)}=he;if(be(me[De]))throw new Error("No ".concat(s(De,we)," was found"));if(be(me[De][ze]))throw new Error("No ".concat(function(he,ge){return"".concat(c(ge),"branch '").concat(he,"'")}(ze,Me)," in ").concat(s(De,we)," was found"));"HEAD"===he.commit&&(he.commit=_e(me,"".concat(De,".").concat(ze,".0"))||_e(ge,"defaultRepositoryCommit",xe.DEFAULT_REPOSITORY_HASH));const{commit:Oe=_e(me,"".concat(De,".").concat(ze,".0"))||_e(ge,"defaultRepositoryCommit",xe.DEFAULT_REPOSITORY_HASH)}=he;if(!ve(me[De][ze],Oe))throw new Error("No ".concat(function(he,ge){return"".concat(c(ge),"commit '").concat(he,"'")}(Oe,Se)," in ").concat(c(Me),"branch '").concat(ze,"' in ").concat(s(De,we)," was found"));const Ce=a("",{dataset:De,branch:ze,commit:Oe});return Object.assign(he,{repositoryPath:Ce}),{dataset:De,branch:ze,commit:Oe,isDefaultBranch:Me,isDefaultCommit:Se}}},function(he,ge,me){(function(ge){var me="__lodash_hash_undefined__",be="[object Function]",ve="[object GeneratorFunction]",_e=/^\[object .+?Constructor\]$/,xe="object"==typeof ge&&ge&&ge.Object===Object&&ge,we="object"==typeof self&&self&&self.Object===Object&&self,Me=xe||we||Function("return this")();function f(he,ge){return!(!he||!he.length)&&function(he,ge,me){if(ge!=ge)return function(he,ge,me,be){for(var ve=he.length,_e=-1;++_e<ve;)if(ge(he[_e],_e,he))return _e;return-1}(he,p);for(var be=-1,ve=he.length;++be<ve;)if(he[be]===ge)return be;return-1}(he,ge)>-1}function p(he){return he!=he}function h(he,ge){return he.has(ge)}function d(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var Se,De=Array.prototype,ze=Function.prototype,Oe=Object.prototype,Ce=Me["__core-js_shared__"],ke=(Se=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||""))?"Symbol(src)_1."+Se:"",Te=ze.toString,Le=Oe.hasOwnProperty,Ae=Oe.toString,Ee=RegExp("^"+Te.call(Le).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=De.splice,Re=M(Me,"Map"),Fe=M(Me,"Set"),Ie=M(Object,"create");function T(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function C(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function D(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function F(he){var ge=-1,me=he?he.length:0;for(this.__data__=new D;++ge<me;)this.add(he[ge])}function P(he,ge){for(var me,be,ve=he.length;ve--;)if((me=he[ve][0])===(be=ge)||me!=me&&be!=be)return ve;return-1}T.prototype.clear=function(){this.__data__=Ie?Ie(null):{}},T.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},T.prototype.get=function(he){var ge=this.__data__;if(Ie){var be=ge[he];return be===me?void 0:be}return Le.call(ge,he)?ge[he]:void 0},T.prototype.has=function(he){var ge=this.__data__;return Ie?void 0!==ge[he]:Le.call(ge,he)},T.prototype.set=function(he,ge){return this.__data__[he]=Ie&&void 0===ge?me:ge,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(he){var ge=this.__data__,me=P(ge,he);return!(me<0||(me==ge.length-1?ge.pop():je.call(ge,me,1),0))},C.prototype.get=function(he){var ge=this.__data__,me=P(ge,he);return me<0?void 0:ge[me][1]},C.prototype.has=function(he){return P(this.__data__,he)>-1},C.prototype.set=function(he,ge){var me=this.__data__,be=P(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},D.prototype.clear=function(){this.__data__={hash:new T,map:new(Re||C),string:new T}},D.prototype.delete=function(he){return L(this,he).delete(he)},D.prototype.get=function(he){return L(this,he).get(he)},D.prototype.has=function(he){return L(this,he).has(he)},D.prototype.set=function(he,ge){return L(this,he).set(he,ge),this},F.prototype.add=F.prototype.push=function(he){return this.__data__.set(he,me),this},F.prototype.has=function(he){return this.__data__.has(he)};var Pe=Fe&&1/d(new Fe([,-0]))[1]==1/0?function(he){return new Fe(he)}:function(){};function L(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function M(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function $(he){return!(!I(he)||ke&&ke in he)&&(function(he){var ge=I(he)?Ae.call(he):"";return ge==be||ge==ve}(he)||function(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}(he)?Ee:_e).test(function(he){if(null!=he){try{return Te.call(he)}catch(he){}try{return he+""}catch(he){}}return""}(he))}(me)?me:void 0}function I(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}he.exports=function(he){return he&&he.length?function(he,ge,me){var be=-1,ve=f,_e=he.length,xe=!0,we=[],Me=we;if(_e>=200){var Se=Pe(he);if(Se)return d(Se);xe=!1,ve=h,Me=new F}else Me=we;t:for(;++be<_e;){var De=he[be],ze=De;if(De=0!==De?De:0,xe&&ze==ze){for(var Oe=Me.length;Oe--;)if(Me[Oe]===ze)continue t;we.push(De)}else ve(Me,ze,me)||(Me!==we&&Me.push(ze),we.push(De))}return we}(he):[]}}).call(this,me(0))},function(he,ge){var me=Object.prototype.toString,be=Array.isArray;he.exports=function(he){return"string"==typeof he||!be(he)&&function(he){return!!he&&"object"==typeof he}(he)&&"[object String]"==me.call(he)}},function(he,ge,me){(function(he,me){var be="Expected a function",ve="__lodash_hash_undefined__",_e=1,xe=2,we=1/0,Me=9007199254740991,Se="[object Arguments]",De="[object Array]",ze="[object Boolean]",Oe="[object Date]",Ce="[object Error]",ke="[object Function]",Te="[object GeneratorFunction]",Le="[object Map]",Ae="[object Number]",Ee="[object Object]",je="[object RegExp]",Re="[object Set]",Fe="[object String]",Ie="[object Symbol]",Pe="[object ArrayBuffer]",Ne="[object DataView]",Be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qe=/^\w*$/,Ue=/^\./,He=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,Ye=/^\[object .+?Constructor\]$/,We=/^(?:0|[1-9]\d*)$/,Ge={};Ge["[object Float32Array]"]=Ge["[object Float64Array]"]=Ge["[object Int8Array]"]=Ge["[object Int16Array]"]=Ge["[object Int32Array]"]=Ge["[object Uint8Array]"]=Ge["[object Uint8ClampedArray]"]=Ge["[object Uint16Array]"]=Ge["[object Uint32Array]"]=!0,Ge[Se]=Ge[De]=Ge[Pe]=Ge[ze]=Ge[Ne]=Ge[Oe]=Ge[Ce]=Ge[ke]=Ge[Le]=Ge[Ae]=Ge[Ee]=Ge[je]=Ge[Re]=Ge[Fe]=Ge["[object WeakMap]"]=!1;var $e="object"==typeof he&&he&&he.Object===Object&&he,Xe="object"==typeof self&&self&&self.Object===Object&&self,Ke=$e||Xe||Function("return this")(),Ze="object"==typeof ge&&ge&&!ge.nodeType&&ge,Je=Ze&&"object"==typeof me&&me&&!me.nodeType&&me,Qe=Je&&Je.exports===Ze&&$e.process,tn=function(){try{return Qe&&Qe.binding("util")}catch(he){}}(),en=tn&&tn.isTypedArray;function z(he,ge){for(var me=-1,be=he?he.length:0;++me<be;)if(!ge(he[me],me,he))return!1;return!0}function B(he,ge){for(var me=-1,be=he?he.length:0;++me<be;)if(ge(he[me],me,he))return!0;return!1}function H(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}function V(he){var ge=-1,me=Array(he.size);return he.forEach((function(he,be){me[++ge]=[be,he]})),me}function q(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var nn,sn,on,rn=Array.prototype,an=Function.prototype,ln=Object.prototype,cn=Ke["__core-js_shared__"],un=(nn=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||""))?"Symbol(src)_1."+nn:"",dn=an.toString,hn=ln.hasOwnProperty,pn=ln.toString,fn=RegExp("^"+dn.call(hn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gn=Ke.Symbol,mn=Ke.Uint8Array,bn=ln.propertyIsEnumerable,vn=rn.splice,yn=(sn=Object.keys,on=Object,function(he){return sn(on(he))}),_n=Vt(Ke,"DataView"),xn=Vt(Ke,"Map"),wn=Vt(Ke,"Promise"),Mn=Vt(Ke,"Set"),Sn=Vt(Ke,"WeakMap"),Dn=Vt(Object,"create"),zn=Xt(_n),On=Xt(xn),Cn=Xt(wn),kn=Xt(Mn),Tn=Xt(Sn),Ln=gn?gn.prototype:void 0,An=Ln?Ln.valueOf:void 0,En=Ln?Ln.toString:void 0;function Et(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function St(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function At(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Rt(he){var ge=-1,me=he?he.length:0;for(this.__data__=new At;++ge<me;)this.add(he[ge])}function kt(he){this.__data__=new St(he)}function Ct(he,ge){for(var me=he.length;me--;)if(ee(he[me][0],ge))return me;return-1}Et.prototype.clear=function(){this.__data__=Dn?Dn(null):{}},Et.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},Et.prototype.get=function(he){var ge=this.__data__;if(Dn){var me=ge[he];return me===ve?void 0:me}return hn.call(ge,he)?ge[he]:void 0},Et.prototype.has=function(he){var ge=this.__data__;return Dn?void 0!==ge[he]:hn.call(ge,he)},Et.prototype.set=function(he,ge){return this.__data__[he]=Dn&&void 0===ge?ve:ge,this},St.prototype.clear=function(){this.__data__=[]},St.prototype.delete=function(he){var ge=this.__data__,me=Ct(ge,he);return!(me<0||(me==ge.length-1?ge.pop():vn.call(ge,me,1),0))},St.prototype.get=function(he){var ge=this.__data__,me=Ct(ge,he);return me<0?void 0:ge[me][1]},St.prototype.has=function(he){return Ct(this.__data__,he)>-1},St.prototype.set=function(he,ge){var me=this.__data__,be=Ct(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},At.prototype.clear=function(){this.__data__={hash:new Et,map:new(xn||St),string:new Et}},At.prototype.delete=function(he){return Ht(this,he).delete(he)},At.prototype.get=function(he){return Ht(this,he).get(he)},At.prototype.has=function(he){return Ht(this,he).has(he)},At.prototype.set=function(he,ge){return Ht(this,he).set(he,ge),this},Rt.prototype.add=Rt.prototype.push=function(he){return this.__data__.set(he,ve),this},Rt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.clear=function(){this.__data__=new St},kt.prototype.delete=function(he){return this.__data__.delete(he)},kt.prototype.get=function(he){return this.__data__.get(he)},kt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.set=function(he,ge){var me=this.__data__;if(me instanceof St){var be=me.__data__;if(!xn||be.length<199)return be.push([he,ge]),this;me=this.__data__=new At(be)}return me.set(he,ge),this};var jn,Rn=(jn=function(he,ge){return he&&xt(he,ge,le)},function(he,ge){if(null==he)return he;if(!oe(he))return jn(he,ge);for(var me=he.length,be=-1,ve=Object(he);++be<me&&!1!==ge(ve[be],be,ve););return he});function $t(he,ge){var me=!0;return Rn(he,(function(he,be,ve){return me=!!ge(he,be,ve)})),me}var xt=function(he,ge,me){for(var be=-1,ve=Object(he),_e=me(he),xe=_e.length;xe--;){var we=_e[++be];if(!1===ge(ve[we],we,ve))break}return he};function Lt(he,ge){for(var me=0,be=(ge=Gt(ge,he)?[ge]:zt(ge)).length;null!=he&&me<be;)he=he[Zt(ge[me++])];return me&&me==be?he:void 0}function Mt(he,ge){return null!=he&&ge in Object(he)}function It(he,ge,me,be,ve){return he===ge||(null==he||null==ge||!ae(he)&&!ce(ge)?he!=he&&ge!=ge:function(he,ge,me,be,ve,we){var Me=In(he),ke=In(ge),Te=De,Be=De;Me||(Te=(Te=qt(he))==Se?Ee:Te),ke||(Be=(Be=qt(ge))==Se?Ee:Be);var qe=Te==Ee&&!H(he),Ue=Be==Ee&&!H(ge),He=Te==Be;if(He&&!qe)return we||(we=new kt),Me||Pn(he)?Bt(he,ge,me,be,ve,we):function(he,ge,me,be,ve,we,Me){switch(me){case Ne:if(he.byteLength!=ge.byteLength||he.byteOffset!=ge.byteOffset)return!1;he=he.buffer,ge=ge.buffer;case Pe:return!(he.byteLength!=ge.byteLength||!be(new mn(he),new mn(ge)));case ze:case Oe:case Ae:return ee(+he,+ge);case Ce:return he.name==ge.name&&he.message==ge.message;case je:case Fe:return he==ge+"";case Le:var Se=V;case Re:var De=we&xe;if(Se||(Se=q),he.size!=ge.size&&!De)return!1;var ke=Me.get(he);if(ke)return ke==ge;we|=_e,Me.set(he,ge);var Te=Bt(Se(he),Se(ge),be,ve,we,Me);return Me.delete(he),Te;case Ie:if(An)return An.call(he)==An.call(ge)}return!1}(he,ge,Te,me,be,ve,we);if(!(ve&xe)){var Ve=qe&&hn.call(he,"__wrapped__"),Ye=Ue&&hn.call(ge,"__wrapped__");if(Ve||Ye){var We=Ve?he.value():he,Ge=Ye?ge.value():ge;return we||(we=new kt),me(We,Ge,be,ve,we)}}return!!He&&(we||(we=new kt),function(he,ge,me,be,ve,_e){var we=ve&xe,Me=le(he),Se=Me.length;if(Se!=le(ge).length&&!we)return!1;for(var De=Se;De--;){var ze=Me[De];if(!(we?ze in ge:hn.call(ge,ze)))return!1}var Oe=_e.get(he);if(Oe&&_e.get(ge))return Oe==ge;var Ce=!0;_e.set(he,ge),_e.set(ge,he);for(var ke=we;++De<Se;){var Te=he[ze=Me[De]],Le=ge[ze];if(be)var Ae=we?be(Le,Te,ze,ge,he,_e):be(Te,Le,ze,he,ge,_e);if(!(void 0===Ae?Te===Le||me(Te,Le,be,ve,_e):Ae)){Ce=!1;break}ke||(ke="constructor"==ze)}if(Ce&&!ke){var Ee=he.constructor,je=ge.constructor;Ee!=je&&"constructor"in he&&"constructor"in ge&&!("function"==typeof Ee&&Ee instanceof Ee&&"function"==typeof je&&je instanceof je)&&(Ce=!1)}return _e.delete(he),_e.delete(ge),Ce}(he,ge,me,be,ve,we))}(he,ge,It,me,be,ve))}function zt(he){return In(he)?he:Fn(he)}function Bt(he,ge,me,be,ve,we){var Me=ve&xe,Se=he.length,De=ge.length;if(Se!=De&&!(Me&&De>Se))return!1;var ze=we.get(he);if(ze&&we.get(ge))return ze==ge;var Oe=-1,Ce=!0,ke=ve&_e?new Rt:void 0;for(we.set(he,ge),we.set(ge,he);++Oe<Se;){var Te=he[Oe],Le=ge[Oe];if(be)var Ae=Me?be(Le,Te,Oe,ge,he,we):be(Te,Le,Oe,he,ge,we);if(void 0!==Ae){if(Ae)continue;Ce=!1;break}if(ke){if(!B(ge,(function(he,ge){if(!ke.has(ge)&&(Te===he||me(Te,he,be,ve,we)))return ke.add(ge)}))){Ce=!1;break}}else if(Te!==Le&&!me(Te,Le,be,ve,we)){Ce=!1;break}}return we.delete(he),we.delete(ge),Ce}function Ht(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function Vt(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function Ut(he){return!(!ae(he)||un&&un in he)&&(ie(he)||H(he)?fn:Ye).test(Xt(he))}(me)?me:void 0}var qt=function(he){return pn.call(he)};function Wt(he,ge){return!!(ge=null==ge?Me:ge)&&("number"==typeof he||We.test(he))&&he>-1&&he%1==0&&he<ge}function Gt(he,ge){if(In(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!se(he))||qe.test(he)||!Be.test(he)||null!=ge&&he in Object(ge)}function Qt(he){return he==he&&!ae(he)}function Jt(he,ge){return function(me){return null!=me&&me[he]===ge&&(void 0!==ge||he in Object(me))}}(_n&&qt(new _n(new ArrayBuffer(1)))!=Ne||xn&&qt(new xn)!=Le||wn&&"[object Promise]"!=qt(wn.resolve())||Mn&&qt(new Mn)!=Re||Sn&&"[object WeakMap]"!=qt(new Sn))&&(qt=function(he){var ge=pn.call(he),me=ge==Ee?he.constructor:void 0,be=me?Xt(me):void 0;if(be)switch(be){case zn:return Ne;case On:return Le;case Cn:return"[object Promise]";case kn:return Re;case Tn:return"[object WeakMap]"}return ge});var Fn=te((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(se(he))return En?En.call(he):"";var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}(ge);var me=[];return Ue.test(he)&&me.push(""),he.replace(He,(function(he,ge,be,ve){me.push(be?ve.replace(Ve,"$1"):ge||he)})),me}));function Zt(he){if("string"==typeof he||se(he))return he;var ge=he+"";return"0"==ge&&1/he==-we?"-0":ge}function Xt(he){if(null!=he){try{return dn.call(he)}catch(he){}try{return he+""}catch(he){}}return""}function te(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var r=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=r.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return r.cache=ve.set(be,_e),_e};return r.cache=new(te.Cache||At),r}function ee(he,ge){return he===ge||he!=he&&ge!=ge}function re(he){return function(he){return ce(he)&&oe(he)}(he)&&hn.call(he,"callee")&&(!bn.call(he,"callee")||pn.call(he)==Se)}te.Cache=At;var In=Array.isArray;function oe(he){return null!=he&&ue(he.length)&&!ie(he)}function ie(he){var ge=ae(he)?pn.call(he):"";return ge==ke||ge==Te}function ue(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=Me}function ae(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function ce(he){return!!he&&"object"==typeof he}function se(he){return"symbol"==typeof he||ce(he)&&pn.call(he)==Ie}var Pn=en?function(he){return function(ge){return he(ge)}}(en):function(he){return ce(he)&&ue(he.length)&&!!Ge[pn.call(he)]};function le(he){return oe(he)?function Tt(he,ge){var me=In(he)||re(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var _e in he)!ge&&!hn.call(he,_e)||ve&&("length"==_e||Wt(_e,be))||me.push(_e);return me}(he):function Yt(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||ln))return yn(he);var ge,me,be=[];for(var ve in Object(he))hn.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}function pe(he){return he}me.exports=function(he,ge,me){var be=In(he)?z:$t;return me&&function(he,ge,me){if(!ae(me))return!1;var be=typeof ge;return!!("number"==be?oe(me)&&Wt(ge,me.length):"string"==be&&ge in me)&&ee(me[ge],he)}(he,ge,me)&&(ge=void 0),be(he,function Nt(he){return"function"==typeof he?he:null==he?pe:"object"==typeof he?In(he)?function(he,ge){return Gt(he)&&Qt(ge)?Jt(Zt(he),ge):function(me){var be=function(he,ge,me){var be=null==he?void 0:Lt(he,ge);return void 0===be?void 0:be}(me,he);return void 0===be&&be===ge?function(he,ge){return null!=he&&function(he,ge,me){for(var be,ve=-1,_e=(ge=Gt(ge,he)?[ge]:zt(ge)).length;++ve<_e;){var xe=Zt(ge[ve]);if(!(be=null!=he&&me(he,xe)))break;he=he[xe]}return be||!!(_e=he?he.length:0)&&ue(_e)&&Wt(xe,_e)&&(In(he)||re(he))}(he,ge,Mt)}(me,he):It(ge,be,void 0,_e|xe)}}(he[0],he[1]):function(he){var ge=function(he){for(var ge=le(he),me=ge.length;me--;){var be=ge[me],ve=he[be];ge[me]=[be,ve,Qt(ve)]}return ge}(he);return 1==ge.length&&ge[0][2]?Jt(ge[0][0],ge[0][1]):function(me){return me===he||function(he,ge,me,be){var ve=me.length,we=ve;if(null==he)return!we;for(he=Object(he);ve--;){var Me=me[ve];if(Me[2]?Me[1]!==he[Me[0]]:!(Me[0]in he))return!1}for(;++ve<we;){var Se=(Me=me[ve])[0],De=he[Se],ze=Me[1];if(Me[2]){if(void 0===De&&!(Se in he))return!1}else{var Oe,Ce=new kt;if(!(void 0===Oe?It(ze,De,be,_e|xe,Ce):Oe))return!1}}return!0}(me,0,ge)}}(he):Gt(ge=he)?(me=Zt(ge),function(he){return null==he?void 0:he[me]}):function(he){return function(ge){return Lt(ge,he)}}(ge);var ge,me}(ge))}}).call(this,me(0),me(2)(he))},function(he,ge,me){(function(ge){var me,be="Expected a function",ve="__lodash_hash_undefined__",_e=1/0,xe=9007199254740991,we="[object Arguments]",Me="[object Function]",Se="[object GeneratorFunction]",De="[object Symbol]",ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Oe=/^\w*$/,Ce=/^\./,ke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Te=/\\(\\)?/g,Le=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,Ee="object"==typeof ge&&ge&&ge.Object===Object&&ge,je="object"==typeof self&&self&&self.Object===Object&&self,Re=Ee||je||Function("return this")(),Fe=Array.prototype,Ie=Function.prototype,Pe=Object.prototype,Ne=Re["__core-js_shared__"],Be=(me=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||""))?"Symbol(src)_1."+me:"",qe=Ie.toString,Ue=Pe.hasOwnProperty,He=Pe.toString,Ve=RegExp("^"+qe.call(Ue).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ye=Re.Symbol,We=Pe.propertyIsEnumerable,Ge=Fe.splice,$e=H(Re,"Map"),Xe=H(Object,"create"),Ke=Ye?Ye.prototype:void 0,Ze=Ke?Ke.toString:void 0;function M(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function I(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function U(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function N(he,ge){for(var me,be,ve=he.length;ve--;)if((me=he[ve][0])===(be=ge)||me!=me&&be!=be)return ve;return-1}function Y(he,ge){return null!=he&&Ue.call(he,ge)}function B(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function H(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function z(he){return!(!Z(he)||Be&&Be in he)&&(J(he)||function(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}(he)?Ve:Le).test(function(he){if(null!=he){try{return qe.call(he)}catch(he){}try{return he+""}catch(he){}}return""}(he))}(me)?me:void 0}M.prototype.clear=function(){this.__data__=Xe?Xe(null):{}},M.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},M.prototype.get=function(he){var ge=this.__data__;if(Xe){var me=ge[he];return me===ve?void 0:me}return Ue.call(ge,he)?ge[he]:void 0},M.prototype.has=function(he){var ge=this.__data__;return Xe?void 0!==ge[he]:Ue.call(ge,he)},M.prototype.set=function(he,ge){return this.__data__[he]=Xe&&void 0===ge?ve:ge,this},I.prototype.clear=function(){this.__data__=[]},I.prototype.delete=function(he){var ge=this.__data__,me=N(ge,he);return!(me<0||(me==ge.length-1?ge.pop():Ge.call(ge,me,1),0))},I.prototype.get=function(he){var ge=this.__data__,me=N(ge,he);return me<0?void 0:ge[me][1]},I.prototype.has=function(he){return N(this.__data__,he)>-1},I.prototype.set=function(he,ge){var me=this.__data__,be=N(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},U.prototype.clear=function(){this.__data__={hash:new M,map:new($e||I),string:new M}},U.prototype.delete=function(he){return B(this,he).delete(he)},U.prototype.get=function(he){return B(this,he).get(he)},U.prototype.has=function(he){return B(this,he).has(he)},U.prototype.set=function(he,ge){return B(this,he).set(he,ge),this};var Je=G((function(he){var ge;he=null==(ge=he)?"":function(he){if("string"==typeof he)return he;if(tt(he))return Ze?Ze.call(he):"";var ge=he+"";return"0"==ge&&1/he==-_e?"-0":ge}(ge);var me=[];return Ce.test(he)&&me.push(""),he.replace(ke,(function(he,ge,be,ve){me.push(be?ve.replace(Te,"$1"):ge||he)})),me}));function W(he){if("string"==typeof he||tt(he))return he;var ge=he+"";return"0"==ge&&1/he==-_e?"-0":ge}function G(he,ge){if("function"!=typeof he||ge&&"function"!=typeof ge)throw new TypeError(be);var n=function(){var me=arguments,be=ge?ge.apply(this,me):me[0],ve=n.cache;if(ve.has(be))return ve.get(be);var _e=he.apply(this,me);return n.cache=ve.set(be,_e),_e};return n.cache=new(G.Cache||U),n}G.Cache=U;var Qe=Array.isArray;function J(he){var ge=Z(he)?He.call(he):"";return ge==Me||ge==Se}function K(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=xe}function Z(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function X(he){return!!he&&"object"==typeof he}function tt(he){return"symbol"==typeof he||X(he)&&He.call(he)==De}he.exports=function(he,ge){return null!=he&&function V(he,ge,me){for(var be,ve,_e=-1,Me=(ge=function(he,ge){if(Qe(he))return!1;var me=typeof he;return!("number"!=me&&"symbol"!=me&&"boolean"!=me&&null!=he&&!tt(he))||Oe.test(he)||!ze.test(he)||null!=ge&&he in Object(ge)}(ge,he)?[ge]:Qe(be=ge)?be:Je(be)).length;++_e<Me;){var Se=W(ge[_e]);if(!(ve=null!=he&&me(he,Se)))break;he=he[Se]}return ve||!!(Me=he?he.length:0)&&K(Me)&&function(he,ge){return!!(ge=null==ge?xe:ge)&&("number"==typeof he||Ae.test(he))&&he>-1&&he%1==0&&he<ge}(Se,Me)&&(Qe(he)||function(he){return function(he){return X(he)&&function(he){return null!=he&&K(he.length)&&!J(he)}(he)}(he)&&Ue.call(he,"callee")&&(!We.call(he,"callee")||He.call(he)==we)}(he))}(he,ge,Y)}}).call(this,me(0))},function(he,ge){he.exports=function(he){return he?he[0]:void 0}},function(he,ge){var me,be,ve=9007199254740991,_e="[object Arguments]",xe="[object Function]",we="[object GeneratorFunction]",Me=/^(?:0|[1-9]\d*)$/,Se=Object.prototype,De=Se.hasOwnProperty,ze=Se.toString,Oe=Se.propertyIsEnumerable,Ce=(me=Object.keys,be=Object,function(he){return me(be(he))});function g(he,ge){return!!(ge=null==ge?ve:ge)&&("number"==typeof he||Me.test(he))&&he>-1&&he%1==0&&he<ge}var ke=Array.isArray;function b(he){return null!=he&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=ve}(he.length)&&!function(he){var ge=function(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}(he)?ze.call(he):"";return ge==xe||ge==we}(he)}he.exports=function(he){return he?function a(he,ge){return function(he,ge){for(var me=-1,be=he?he.length:0,ve=Array(be);++me<be;)ve[me]=ge(he[me]);return ve}(ge,(function(ge){return he[ge]}))}(he,function(he){return b(he)?function y(he,ge){var me=ke(he)||function(he){return function(he){return function(he){return!!he&&"object"==typeof he}(he)&&b(he)}(he)&&De.call(he,"callee")&&(!Oe.call(he,"callee")||ze.call(he)==_e)}(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var xe in he)!ge&&!De.call(he,xe)||ve&&("length"==xe||g(xe,be))||me.push(xe);return me}(he):function v(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||Se))return Ce(he);var ge,me,be=[];for(var ve in Object(he))De.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he)}(he)):[]}},function(he,ge,me){(function(he,me){var be="__lodash_hash_undefined__",ve=9007199254740991,_e="[object Arguments]",xe="[object Boolean]",we="[object Date]",Me="[object Function]",Se="[object GeneratorFunction]",De="[object Map]",ze="[object Number]",Oe="[object Object]",Ce="[object RegExp]",ke="[object Set]",Te="[object String]",Le="[object Symbol]",Ae="[object ArrayBuffer]",Ee="[object DataView]",je="[object Float32Array]",Re="[object Float64Array]",Fe="[object Int8Array]",Ie="[object Int16Array]",Pe="[object Int32Array]",Ne="[object Uint8Array]",Be="[object Uint8ClampedArray]",qe="[object Uint16Array]",Ue="[object Uint32Array]",He=/\w*$/,Ve=/^\[object .+?Constructor\]$/,Ye=/^(?:0|[1-9]\d*)$/,We={};We[_e]=We["[object Array]"]=We[Ae]=We[Ee]=We[xe]=We[we]=We[je]=We[Re]=We[Fe]=We[Ie]=We[Pe]=We[De]=We[ze]=We[Oe]=We[Ce]=We[ke]=We[Te]=We[Le]=We[Ne]=We[Be]=We[qe]=We[Ue]=!0,We["[object Error]"]=We[Me]=We["[object WeakMap]"]=!1;var Ge="object"==typeof he&&he&&he.Object===Object&&he,$e="object"==typeof self&&self&&self.Object===Object&&self,Xe=Ge||$e||Function("return this")(),Ke="object"==typeof ge&&ge&&!ge.nodeType&&ge,Ze=Ke&&"object"==typeof me&&me&&!me.nodeType&&me,Je=Ze&&Ze.exports===Ke;function U(he,ge){return he.set(ge[0],ge[1]),he}function N(he,ge){return he.add(ge),he}function Y(he,ge,me,be){var ve=-1,_e=he?he.length:0;for(be&&_e&&(me=he[++ve]);++ve<_e;)me=ge(me,he[ve],ve,he);return me}function z(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}function B(he){var ge=-1,me=Array(he.size);return he.forEach((function(he,be){me[++ge]=[be,he]})),me}function H(he,ge){return function(me){return he(ge(me))}}function V(he){var ge=-1,me=Array(he.size);return he.forEach((function(he){me[++ge]=he})),me}var Qe,tn=Array.prototype,en=Function.prototype,nn=Object.prototype,sn=Xe["__core-js_shared__"],on=(Qe=/[^.]+$/.exec(sn&&sn.keys&&sn.keys.IE_PROTO||""))?"Symbol(src)_1."+Qe:"",rn=en.toString,an=nn.hasOwnProperty,ln=nn.toString,cn=RegExp("^"+rn.call(an).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),un=Je?Xe.Buffer:void 0,dn=Xe.Symbol,hn=Xe.Uint8Array,pn=H(Object.getPrototypeOf,Object),fn=Object.create,gn=nn.propertyIsEnumerable,mn=tn.splice,bn=Object.getOwnPropertySymbols,vn=un?un.isBuffer:void 0,yn=H(Object.keys,Object),_n=Mt(Xe,"DataView"),xn=Mt(Xe,"Map"),wn=Mt(Xe,"Promise"),Mn=Mt(Xe,"Set"),Sn=Mt(Xe,"WeakMap"),Dn=Mt(Object,"create"),zn=zt(_n),On=zt(xn),Cn=zt(wn),kn=zt(Mn),Tn=zt(Sn),Ln=dn?dn.prototype:void 0,An=Ln?Ln.valueOf:void 0;function St(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function At(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function Rt(he){var ge=-1,me=he?he.length:0;for(this.clear();++ge<me;){var be=he[ge];this.set(be[0],be[1])}}function kt(he){this.__data__=new At(he)}function Ct(he,ge,me){var be=he[ge];an.call(he,ge)&&Bt(be,me)&&(void 0!==me||ge in he)||(he[ge]=me)}function Dt(he,ge){for(var me=he.length;me--;)if(Bt(he[me][0],ge))return me;return-1}function Ft(he,ge,me,be,ve,Ve,Ye){var Ge;if(be&&(Ge=Ve?be(he,ve,Ve,Ye):be(he)),void 0!==Ge)return Ge;if(!Gt(he))return he;var $e=jn(he);if($e){if(Ge=function(he){var ge=he.length,me=he.constructor(ge);return ge&&"string"==typeof he[0]&&an.call(he,"index")&&(me.index=he.index,me.input=he.input),me}(he),!ge)return function(he,ge){var me=-1,be=he.length;for(ge||(ge=Array(be));++me<be;)ge[me]=he[me];return ge}(he,Ge)}else{var Xe=Ut(he),Ke=Xe==Me||Xe==Se;if(Rn(he))return function(he,ge){if(ge)return he.slice();var me=new he.constructor(he.length);return he.copy(me),me}(he,ge);if(Xe==Oe||Xe==_e||Ke&&!Ve){if(z(he))return Ve?he:{};if(Ge=function(he){return"function"!=typeof he.constructor||Yt(he)?{}:Gt(ge=pn(he))?fn(ge):{};var ge}(Ke?{}:he),!ge)return function(he,ge){return xt(he,En(he),ge)}(he,function(he,ge){return he&&xt(ge,Qt(ge),he)}(Ge,he))}else{if(!We[Xe])return Ve?he:{};Ge=function(he,ge,me,be){var ve,_e,Me,Se=he.constructor;switch(ge){case Ae:return $t(he);case xe:case we:return new Se(+he);case Ee:return function(he,ge){var me=ge?$t(he.buffer):he.buffer;return new he.constructor(me,he.byteOffset,he.byteLength)}(he,be);case je:case Re:case Fe:case Ie:case Pe:case Ne:case Be:case qe:case Ue:return function(he,ge){var me=ge?$t(he.buffer):he.buffer;return new he.constructor(me,he.byteOffset,he.length)}(he,be);case De:return function(he,ge,me){return Y(ge?me(B(he),!0):B(he),U,new he.constructor)}(he,be,me);case ze:case Te:return new Se(he);case Ce:return(Me=new(_e=he).constructor(_e.source,He.exec(_e))).lastIndex=_e.lastIndex,Me;case ke:return function(he,ge,me){return Y(ge?me(V(he),!0):V(he),N,new he.constructor)}(he,be,me);case Le:return ve=he,An?Object(An.call(ve)):{}}}(he,Xe,Ft,ge)}}Ye||(Ye=new kt);var Ze=Ye.get(he);if(Ze)return Ze;if(Ye.set(he,Ge),!$e)var Je=me?function(he){return function(he,ge,me){var be=ge(he);return jn(he)?be:function(he,ge){for(var me=-1,be=ge.length,ve=he.length;++me<be;)he[ve+me]=ge[me];return he}(be,me(he))}(he,Qt,En)}(he):Qt(he);return function(he,ge){for(var me=-1,be=he?he.length:0;++me<be&&!1!==ge(he[me],me););}(Je||he,(function(ve,_e){Je&&(ve=he[_e=ve]),Ct(Ge,_e,Ft(ve,ge,me,be,_e,he,Ye))})),Ge}function $t(he){var ge=new he.constructor(he.byteLength);return new hn(ge).set(new hn(he)),ge}function xt(he,ge,me,be){me||(me={});for(var ve=-1,_e=ge.length;++ve<_e;){var xe=ge[ve],we=be?be(me[xe],he[xe],xe,me,he):void 0;Ct(me,xe,void 0===we?he[xe]:we)}return me}function Lt(he,ge){var me,be,ve=he.__data__;return("string"==(be=typeof(me=ge))||"number"==be||"symbol"==be||"boolean"==be?"__proto__"!==me:null===me)?ve["string"==typeof ge?"string":"hash"]:ve.map}function Mt(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function Pt(he){return!(!Gt(he)||on&&on in he)&&(Wt(he)||z(he)?cn:Ve).test(zt(he))}(me)?me:void 0}St.prototype.clear=function(){this.__data__=Dn?Dn(null):{}},St.prototype.delete=function(he){return this.has(he)&&delete this.__data__[he]},St.prototype.get=function(he){var ge=this.__data__;if(Dn){var me=ge[he];return me===be?void 0:me}return an.call(ge,he)?ge[he]:void 0},St.prototype.has=function(he){var ge=this.__data__;return Dn?void 0!==ge[he]:an.call(ge,he)},St.prototype.set=function(he,ge){return this.__data__[he]=Dn&&void 0===ge?be:ge,this},At.prototype.clear=function(){this.__data__=[]},At.prototype.delete=function(he){var ge=this.__data__,me=Dt(ge,he);return!(me<0||(me==ge.length-1?ge.pop():mn.call(ge,me,1),0))},At.prototype.get=function(he){var ge=this.__data__,me=Dt(ge,he);return me<0?void 0:ge[me][1]},At.prototype.has=function(he){return Dt(this.__data__,he)>-1},At.prototype.set=function(he,ge){var me=this.__data__,be=Dt(me,he);return be<0?me.push([he,ge]):me[be][1]=ge,this},Rt.prototype.clear=function(){this.__data__={hash:new St,map:new(xn||At),string:new St}},Rt.prototype.delete=function(he){return Lt(this,he).delete(he)},Rt.prototype.get=function(he){return Lt(this,he).get(he)},Rt.prototype.has=function(he){return Lt(this,he).has(he)},Rt.prototype.set=function(he,ge){return Lt(this,he).set(he,ge),this},kt.prototype.clear=function(){this.__data__=new At},kt.prototype.delete=function(he){return this.__data__.delete(he)},kt.prototype.get=function(he){return this.__data__.get(he)},kt.prototype.has=function(he){return this.__data__.has(he)},kt.prototype.set=function(he,ge){var me=this.__data__;if(me instanceof At){var be=me.__data__;if(!xn||be.length<199)return be.push([he,ge]),this;me=this.__data__=new Rt(be)}return me.set(he,ge),this};var En=bn?H(bn,Object):function(){return[]},Ut=function(he){return ln.call(he)};function Nt(he,ge){return!!(ge=null==ge?ve:ge)&&("number"==typeof he||Ye.test(he))&&he>-1&&he%1==0&&he<ge}function Yt(he){var ge=he&&he.constructor;return he===("function"==typeof ge&&ge.prototype||nn)}function zt(he){if(null!=he){try{return rn.call(he)}catch(he){}try{return he+""}catch(he){}}return""}function Bt(he,ge){return he===ge||he!=he&&ge!=ge}(_n&&Ut(new _n(new ArrayBuffer(1)))!=Ee||xn&&Ut(new xn)!=De||wn&&"[object Promise]"!=Ut(wn.resolve())||Mn&&Ut(new Mn)!=ke||Sn&&"[object WeakMap]"!=Ut(new Sn))&&(Ut=function(he){var ge=ln.call(he),me=ge==Oe?he.constructor:void 0,be=me?zt(me):void 0;if(be)switch(be){case zn:return Ee;case On:return De;case Cn:return"[object Promise]";case kn:return ke;case Tn:return"[object WeakMap]"}return ge});var jn=Array.isArray;function Vt(he){return null!=he&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=ve}(he.length)&&!Wt(he)}var Rn=vn||function(){return!1};function Wt(he){var ge=Gt(he)?ln.call(he):"";return ge==Me||ge==Se}function Gt(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}function Qt(he){return Vt(he)?function Tt(he,ge){var me=jn(he)||function(he){return function(he){return function(he){return!!he&&"object"==typeof he}(he)&&Vt(he)}(he)&&an.call(he,"callee")&&(!gn.call(he,"callee")||ln.call(he)==_e)}(he)?function(he,ge){for(var me=-1,be=Array(he);++me<he;)be[me]=ge(me);return be}(he.length,String):[],be=me.length,ve=!!be;for(var xe in he)!ge&&!an.call(he,xe)||ve&&("length"==xe||Nt(xe,be))||me.push(xe);return me}(he):function(he){if(!Yt(he))return yn(he);var ge=[];for(var me in Object(he))an.call(he,me)&&"constructor"!=me&&ge.push(me);return ge}(he)}me.exports=function(he){return Ft(he,!0,!0)}}).call(this,me(0),me(2)(he))},function(he,ge,me){(function(ge){var me,be,ve,_e="[object Function]",xe="[object GeneratorFunction]",we="[object Map]",Me="[object Set]",Se=/^\[object .+?Constructor\]$/,De="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",ze="\\ud83c[\\udffb-\\udfff]",Oe="[^\\ud800-\\udfff]",Ce="(?:\\ud83c[\\udde6-\\uddff]){2}",ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Te="(?:"+De+"|"+ze+")?",Le="[\\ufe0e\\ufe0f]?"+Te+"(?:\\u200d(?:"+[Oe,Ce,ke].join("|")+")[\\ufe0e\\ufe0f]?"+Te+")*",Ae="(?:"+[Oe+De+"?",De,Ce,ke,"[\\ud800-\\udfff]"].join("|")+")",Ee=RegExp(ze+"(?="+ze+")|"+Ae+Le,"g"),je=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Re="object"==typeof ge&&ge&&ge.Object===Object&&ge,Fe="object"==typeof self&&self&&self.Object===Object&&self,Ie=Re||Fe||Function("return this")(),E=function(he){return null==he?void 0:he.length},Pe=Function.prototype,Ne=Object.prototype,Be=Ie["__core-js_shared__"],qe=(me=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||""))?"Symbol(src)_1."+me:"",Ue=Pe.toString,He=Ne.hasOwnProperty,Ve=Ne.toString,Ye=RegExp("^"+Ue.call(He).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),We=(be=Object.keys,ve=Object,function(he){return be(ve(he))}),Ge=J(Ie,"DataView"),$e=J(Ie,"Map"),Xe=J(Ie,"Promise"),Ke=J(Ie,"Set"),Ze=J(Ie,"WeakMap"),Je=Z(Ge),Qe=Z($e),tn=Z(Xe),en=Z(Ke),nn=Z(Ze);function J(he,ge){var me=function(he,ge){return null==he?void 0:he[ge]}(he,ge);return function G(he){return!(!et(he)||qe&&qe in he)&&(tt(he)||function(he){var ge=!1;if(null!=he&&"function"!=typeof he.toString)try{ge=!!(he+"")}catch(he){}return ge}(he)?Ye:Se).test(Z(he))}(me)?me:void 0}var K=function(he){return Ve.call(he)};function Z(he){if(null!=he){try{return Ue.call(he)}catch(he){}try{return he+""}catch(he){}}return""}(Ge&&"[object DataView]"!=K(new Ge(new ArrayBuffer(1)))||$e&&K(new $e)!=we||Xe&&"[object Promise]"!=K(Xe.resolve())||Ke&&K(new Ke)!=Me||Ze&&"[object WeakMap]"!=K(new Ze))&&(K=function(he){var ge=Ve.call(he),me="[object Object]"==ge?he.constructor:void 0,be=me?Z(me):void 0;if(be)switch(be){case Je:return"[object DataView]";case Qe:return we;case tn:return"[object Promise]";case en:return Me;case nn:return"[object WeakMap]"}return ge});var sn=Array.isArray;function tt(he){var ge=et(he)?Ve.call(he):"";return ge==_e||ge==xe}function et(he){var ge=typeof he;return!!he&&("object"==ge||"function"==ge)}he.exports=function(he){if(null==he)return 0;if(null!=(ge=he)&&function(he){return"number"==typeof he&&he>-1&&he%1==0&&he<=9007199254740991}(ge.length)&&!tt(ge))return function(he){return"string"==typeof he||!sn(he)&&function(he){return!!he&&"object"==typeof he}(he)&&"[object String]"==Ve.call(he)}(he)?function S(he){return function(he){return je.test(he)}(he)?function(he){for(var ge=Ee.lastIndex=0;Ee.test(he);)ge++;return ge}(he):E(he)}(he):he.length;var ge,me=K(he);return me==we||me==Me?he.size:function Q(he){if(me=(ge=he)&&ge.constructor,ge!==("function"==typeof me&&me.prototype||Ne))return We(he);var ge,me,be=[];for(var ve in Object(he))He.call(he,ve)&&"constructor"!=ve&&be.push(ve);return be}(he).length}}).call(this,me(0))},function(he,ge){var me=Array.isArray;he.exports=me},function(he,ge,me){(function(he){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(5),ve=me(7),_e=me(16),xe=me(36),we=me(35),Me=(me(34),me(33)),Se=me(11),De=me(19),ze=(me(18),me(32)),Oe=me(20),Ce=me(10),ke=me(4),Te=me(31),Le=me(30),Ae=me(9),Ee=me(29),je=me(1),Re=me(28),Fe=me(3),Ie=me(17);function E(he){if(ve(he))return"'select' clause couldn't be empty"}function S(he){return _e(he)&&!xe(he)}function A(he){return Ee(he)||S(he)&&1===we(he)&&Fe.AVAILABLE_ORDER_BY_CLAUSE_VALUES.has(ze(Me(he)))}function R(he){return ke(he,"joinID",!1)?"join.".concat(he.joinID,"."):""}function k(he,ge){if(!xe(ge)&&!ve(ge))return"'select.value' clause for '".concat(he,"' queries should be array of strings or empty")}ge.validateQueryStructure=function O(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((me,Me)=>{const ze=[...function(he,ge){const me=[],be=ke(he,"dataset"),_e=ke(he,"branch"),xe=ke(he,"commit");return ve(be)||Ee(be)||me.push("'dataset' clause must be string only"),ve(_e)||Ee(_e)||me.push("'branch' clause must be string only"),ve(xe)||Ee(xe)||me.push("'commit' clause must be string only"),me}(he),...function(he,ge){const me=[],be=ke(he,"from",null);if(ve(be)&&me.push("'from' clause couldn't be empty"),Ee(be)||me.push("'from' clause must be string only"),!Fe.AVAILABLE_FROM_CLAUSE_VALUES.has(be)){const he=[...Fe.AVAILABLE_FROM_CLAUSE_VALUES];me.push("'from' clause must be one of the list: ".concat(he.join(", ")))}return me}(he),...function(he,ge){const me=[],be=ke(he,"select",null),ve=ke(he,"from",null),Me=ke(be,"key"),Se=ke(be,"value");switch(!0){case Fe.isSchemaQuery(he):me.push(E(be),function(he,ge){if(!xe(ge)||2!==we(ge))return"'select.key' clause for '".concat(he,"' queries must have exactly 2 items: 'key', 'value'")}(ve,Me),k(ve,Se));break;case Fe.isEntitiesQuery(he):case Fe.isConceptsQuery(he):me.push(E(be),function T(he,ge,me){if(!_e(he)||!xe(ge))return"'select' clause must have next structure: { key: [...], value: [...] }"}(be,Me),function C(he,ge){if(!xe(ge)||1!==we(ge))return"'select.key' clause for '".concat(he,"' queries must have only 1 item")}(ve,Me),k(ve,Se));break;case Fe.isDatapointsQuery(he):me.push(E(be),function(he,ge,me){if(!_e(he)||!xe(ge)||!xe(me))return"'select' clause must have next structure: { key: [...], value: [...] }"}(be,Me,Se),function(he,ge){if(we(ge)<2)return"'select.key' clause for '".concat(he,"' queries must have at least 2 items")}(ve,Me),function(he,ge){const me=Oe(ge,((he,ge,me)=>je(me,he,ge+1)));if(we(me)>0)return"'select.key' clause for '".concat(he,"' queries contains duplicates: ").concat(Re(me).join(","))}(ve,Me),function(he,ge){if(we(ge)<1)return"'select.value' clause for '".concat(he,"' queries must have at least 1 item")}(ve,Se));break;default:me.push(E(be))}return Ae(me)}(he),...function(he,ge){const me=[],_e=ke(he,"join",null),xe=ke(he,"where",null),we=function t(he){const ge=[];for(const me in he)Ce(me,"$")&&ge.push({name:me,isLeaf:!1}),Ie.isPrimitive(he[me])?Ce(he[me],"$")&&ge.push({name:he[me],isLeaf:!0}):ge.push(...t(he[me]));return ge}(xe);return me.push(function(he,ge){if(!ve(he)&&!S(he))return"'".concat(ge,"where' clause must be object only")}(xe,R(ge)),function(he,ge,me){const ve=Oe(ge,(ge=>!function(he,ge){return function(he){return!he.isLeaf&&Fe.AVAILABLE_QUERY_OPERATORS.has(he.name)}(ge)||function(he,ge){return ge.isLeaf&&Ce(ge.name,"$")&&Te(he,ge.name)}(he,ge)}(he,ge))).map((he=>he.name)),_e=[...Fe.AVAILABLE_QUERY_OPERATORS.values(),...Se(he)];if(!be(ve))return"'".concat(me,"where' clause has unknown operator(s) '").concat(ve.join(", "),"', replace it with allowed operators: ").concat(_e.join(", "))}(_e,we,R(ge))),Ae(me)}(he,ge),...function(he,ge){const me=[],be=ke(he,"language",null);switch(!0){case Fe.isSchemaQuery(he):me.push(function(he){if(Te(he,"language"))return"'language' clause for '*.schema' queries shouldn't be present in query"}(he));break;case Fe.isEntitiesQuery(he):case Fe.isConceptsQuery(he):case Fe.isDatapointsQuery(he):default:me.push(function(he){if(!ve(he)&&!Ee(he))return"'language' clause must be string only"}(be))}return Ae(me)}(he),...function(he,ge){const me=[],be=ke(he,"join",null);switch(!0){case Fe.isSchemaQuery(he):case Fe.isConceptsQuery(he):me.push(function(he){if(Te(he,"join"))return"'join' clause for '".concat(he.from,"' queries shouldn't be present in query")}(he));break;case Fe.isEntitiesQuery(he):case Fe.isDatapointsQuery(he):default:me.push(function(he){if(!ve(he)&&!S(he))return"'join' clause must be object only"}(be),...De(be,((he,ge)=>function(he,ge){if(!ve(he.key)&&!Ee(he.key))return"'".concat(ge,"key' clause must be string only")}(he,R({joinID:ge})))))}return Ae(me)}(he),...function(he,ge){const me=[],be=ke(he,"order_by",null);return me.push(function(he){if(!(ve(he)||Ee(he)||(ge=he,xe(ge)&&Le(ge,Ee))||function(he,ge){return xe(he)&&Le(he,ge)}(he,A)))return"'order_by' clause must be string or array of strings || objects only";var ge}(be)),Ae(me)}(he)];return be(ze)?me():Me("Too many query structure errors: \n* ".concat(ze.join("\n* ")))}))},ge.getVersion=function(){return he.env.npm_package_version}}).call(this,me(8))},function(he,ge){"function"==typeof Object.create?he.exports=function(he,ge){he.super_=ge,he.prototype=Object.create(ge.prototype,{constructor:{value:he,enumerable:!1,writable:!0,configurable:!0}})}:he.exports=function(he,ge){he.super_=ge;var r=function(){};r.prototype=ge.prototype,he.prototype=new r,he.prototype.constructor=he}},function(he,ge){he.exports=function(he){return he&&"object"==typeof he&&"function"==typeof he.copy&&"function"==typeof he.fill&&"function"==typeof he.readUInt8}},function(he,ge,me){(function(ge){var me=1/0,be="[object Symbol]",ve=/^\s+/,_e="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",xe="\\ud83c[\\udffb-\\udfff]",we="[^\\ud800-\\udfff]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",Se="[\\ud800-\\udbff][\\udc00-\\udfff]",De="(?:"+_e+"|"+xe+")?",ze="[\\ufe0e\\ufe0f]?"+De+"(?:\\u200d(?:"+[we,Me,Se].join("|")+")[\\ufe0e\\ufe0f]?"+De+")*",Oe="(?:"+[we+_e+"?",_e,Me,Se,"[\\ud800-\\udfff]"].join("|")+")",Ce=RegExp(xe+"(?="+xe+")|"+Oe+ze,"g"),ke=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Te="object"==typeof ge&&ge&&ge.Object===Object&&ge,Le="object"==typeof self&&self&&self.Object===Object&&self,Ae=Te||Le||Function("return this")();function b(he,ge,me){if(ge!=ge)return function(he,ge,me,be){for(var ve=he.length,_e=me+-1;++_e<ve;)if(ge(he[_e],_e,he))return _e;return-1}(he,m,me);for(var be=me-1,ve=he.length;++be<ve;)if(he[be]===ge)return be;return-1}function m(he){return he!=he}function j(he){return function(he){return ke.test(he)}(he)?function(he){return he.match(Ce)||[]}(he):function(he){return he.split("")}(he)}var Ee=Object.prototype.toString,je=Ae.Symbol,Re=je?je.prototype:void 0,Fe=Re?Re.toString:void 0;function A(he){if("string"==typeof he)return he;if(function(he){return"symbol"==typeof he||function(he){return!!he&&"object"==typeof he}(he)&&Ee.call(he)==be}(he))return Fe?Fe.call(he):"";var ge=he+"";return"0"==ge&&1/he==-me?"-0":ge}he.exports=function(he,ge,me){var be;if((he=null==(be=he)?"":A(be))&&(me||void 0===ge))return he.replace(ve,"");if(!he||!(ge=A(ge)))return he;var _e=j(he);return function R(he,ge,me){var be=he.length;return me=void 0===me?be:me,!ge&&me>=be?he:function(he,ge,me){var be=-1,ve=he.length;ge<0&&(ge=-ge>ve?0:ve+ge),(me=me>ve?ve:me)<0&&(me+=ve),ve=ge>me?0:me-ge>>>0,ge>>>=0;for(var _e=Array(ve);++be<ve;)_e[be]=he[be+ge];return _e}(he,ge,me)}(_e,function(he,ge){for(var me=-1,be=he.length;++me<be&&b(ge,he[me],0)>-1;);return me}(_e,j(ge))).join("")}}).call(this,me(0))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0});const be=me(5),ve=me(20),_e=me(19),xe=me(4),we=me(9),Me=me(1),Se=me(10),De=me(7),ze=me(40),Oe=(me(18),me(3)),Ce=me(17);function d(he,ge){return ve(he,(he=>!Me(ge,he)))}function y(he,ge){const me=ve([...ge.values()],(ge=>{let{concept_type:me}=ge;return Me(he,me)}));return _e(me,"concept")}ge.validateQueryDefinitions=function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((me,ve)=>{const _e=[...function(he,ge){const me=[],ve=xe(he,"from",null),_e=xe(he,"select",null),Me=xe(_e,"key"),Se=xe(_e,"value"),De=[],ze=[],{conceptsLookup:Ce}=ge;switch(!0){case Oe.isDatapointsQuery(he):const ge=[Oe.CONCEPT_TYPE_ENTITY_SET,Oe.CONCEPT_TYPE_ENTITY_DOMAIN,Oe.CONCEPT_TYPE_TIME];De.push(...y(ge,Ce)),ze.push(...Ce.keys());break;case Oe.isEntitiesQuery(he):const me=[Oe.CONCEPT_TYPE_ENTITY_SET,Oe.CONCEPT_TYPE_ENTITY_DOMAIN];De.push(...y(me,Ce)),ze.push(...Ce.keys());break;case Oe.isConceptsQuery(he):De.push(Oe.RESERVED_CONCEPT),ze.push(...Ce.keys(),Oe.RESERVED_CONCEPT,Oe.RESERVED_CONCEPT_TYPE,Oe.RESERVED_DOMAIN,Oe.RESERVED_UNIT,Oe.RESERVED_DRILL_UP);break;default:De.push(Oe.RESERVED_KEY,Oe.RESERVED_VALUE),ze.push(Oe.RESERVED_KEY,Oe.RESERVED_VALUE)}return me.push(function(he,ge,me){const ve=d(ge,me);if(!be(ve))return"'select.key' clause for '".concat(he,"' query contains unavailable item(s): ").concat(ve.join(", "))}(ve,Me,De),function(he,ge,me){if(!0!==he.debug)return;const ve=xe(he,"from",null),_e=d(ge,me);return be(ge)||be(_e)?void 0:"'select.value' clause for '".concat(ve,"' query contains unavailable item(s): ").concat(_e.join(", "))}(he,Se,ze)),we(me)}(he,ge),...function(he,ge){if(!0!==he.debug)return[];const me=[],ve=xe(he,"where",null),_e=(xe(he,"from",null),xe(he,"select",null));return xe(_e,"key"),xe(_e,"value"),function(he){!function t(he,ge,me){for(const ve in he){const _e=!!De(me)&&!Se(ve,"$")&&isNaN(+ve),[xe,...we]=ve.split(".");_e&&(De(ge[xe])&&(ge[ze(xe,"is--")]=[]),be(we)||ge[xe].push(ze(we.join("."),"is--"))),Ce.isPrimitive(he[ve])||t(he[ve],ge,_e?xe:me)}}(he,{})}(ve),!0===Oe.isDatapointsQuery(he)&&([].push(Oe.CONCEPT_TYPE_ENTITY_SET,Oe.CONCEPT_TYPE_ENTITY_DOMAIN,Oe.CONCEPT_TYPE_TIME),me.push()),we(me)}(he)];return be(_e)?me():ve("Too many query definition errors [repo: ".concat(ge.basePath,"]: \n* ").concat(_e.join("\n* ")))}))}},function(he,ge,me){function n(he){for(var me in he)ge.hasOwnProperty(me)||(ge[me]=he[me])}Object.defineProperty(ge,"__esModule",{value:!0}),n(me(3)),n(me(41)),n(me(37)),n(me(27)),n(me(26)),n(me(15))},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.InClauseUnderConjunction=void 0;const be=me(12),ve=me(11),_e=me(4),xe=me(5),we=me(10),Me=me(1),Se=me(9),De=me(6);ge.InClauseUnderConjunction=class{constructor(he,ge,me){this.parent=he,this.options=me,this.flow={},this.fileReader=me.fileReader,this.datasetPath=me.basePath,this.query=ge,this.datapackage=me.datapackage,this.conceptsLookup=me.conceptsLookup}isMatched(){return this.flow.joinObject=_e(this.query,"join"),"datapoints"===this.query.from&&this.flow.joinObject}async getRecommendedFilesSet(){const{debug:he,error:ge,warning:me}=this.options.diagnostic.prepareDiagnosticFor("getRecommendedFilesSet");if(this.isMatched()){let me;he("plugin matched");try{if(this.flow.processableClauses=await this.collectProcessableClauses(),!this.flow.processableClauses)return[];this.collectEntityFilesNames();const he=await this.collectEntities();this.fillEntityValuesHash(he),this.getFilesGroupsQueryClause(),me=this.getOptimalFilesGroup()}catch(he){return ge("wrong data processing",he),[]}return he("recommended files found",me),me}{const he='Plugin "InClauseUnderConjunction" is not matched!';throw me(he),new De.DdfCsvError(he,"InClauseUnderConjunction plugin")}}collectProcessableClauses(){const he=ve(this.flow.joinObject).filter((he=>{var ge;return["entity_domain","entity_set"].includes(null===(ge=this.options.conceptsLookup.get(he.slice(1)))||void 0===ge?void 0:ge.concept_type)}));return he.length?Promise.all(he.map((he=>{const ge=this.flow.joinObject[he].key,me=_e(this.flow.joinObject,"".concat(he,".").concat("where"),{});return this.parent.queryData({select:{key:[ge]},where:me,from:this.options.conceptsLookup.has(ge)?"entities":"concepts"},Object.assign({joinID:he},this.options)).then((he=>({key:ge,entities:new Set(he.map((he=>he[ge])))})))}))):Promise.resolve(!1)}collectEntityFilesNames(){this.flow.entityFilesNames=new Set,this.flow.entityResources=new Set,this.flow.fileNameToPrimaryKeyHash=new Map;for(const he of this.datapackage.ddfSchema.entities)for(const ge of this.flow.processableClauses){const me=ge.key;if(be(he.primaryKey)===me)for(const ge of he.resources){const he=this.options.resourcesLookup.get(ge);this.flow.entityResources.add(he),this.flow.entityFilesNames.add(he.path),this.flow.fileNameToPrimaryKeyHash.set(he.path,me)}}return this}collectEntities(){const he=this,ge=[...he.flow.entityResources].map((ge=>(ge.data||(ge.data=he.parent.loadFile(ge.path,he.options))).then((he=>({result:he,file:ge.path})))));return Promise.all(ge)}fillEntityValuesHash(he){const e=he=>Se(ve(he).filter((ge=>we(ge,"is--")&&!0===he[ge])).map((he=>he.replace(/^is--/,""))));this.flow.entityValueToFileHash=new Map,this.flow.entityValueToDomainHash=new Map;for(const ge of he)for(const he of ge.result.data){const me=this.flow.fileNameToPrimaryKeyHash.get(ge.file),be=[...e(he)];xe(be)&&be.push(me);const ve=he[me]||he[be[0]];this.flow.entityValueToDomainHash.set(ve,be),this.flow.entityValueToFileHash.set(ve,ge.file)}return this}getFilesGroupsQueryClause(){var he;const ge=new Map;for(const me of this.flow.processableClauses){const be={datapoints:new Set};for(const ge of me.entities){const me=this.flow.entityValueToDomainHash.get(ge);for(const ve of me)for(const me of this.datapackage.ddfSchema.datapoints)for(const _e of me.resources)if(Me(me.primaryKey,ve)){const me=this.options.resourcesLookup.get(_e),xe=null===(he=me.constraints)||void 0===he?void 0:he[ve];xe?xe.includes(ge)&&be.datapoints.add(me.path):be.datapoints.add(me.path)}}ge.set(me.key,be)}return this.flow.filesGroupsByClause=ge,this}getOptimalFilesGroup(){const he=this.flow.entityFilesNames,ge=new Set;for(const he of this.datapackage.ddfSchema.concepts)for(const me of he.resources)ge.add(this.options.resourcesLookup.get(me).path);const me=this.flow.filesGroupsByClause.keys();let be=Array.from(this.flow.filesGroupsByClause.get(me.next().value).datapoints);for(const he of me)be=this.intersectArray(be,Array.from(this.flow.filesGroupsByClause.get(he).datapoints));return[...Array.from(ge),...Array.from(he)].concat(be)}intersectArray(he,ge){return he.filter((he=>ge.includes(he)))}}},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.getAppropriatePlugin=function(he,ge,me){const _e=[new be.InClauseUnderConjunction(he,ge,me)];return ve(_e.filter((he=>he.isMatched())))};const be=me(43),ve=me(12)},function(he,ge,me){he.exports=he=>{if("string"!=typeof he)throw new TypeError("Expected a string, got "+typeof he);return 65279===he.charCodeAt(0)?he.slice(1):he}},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.ddfCsvReader=function(he){const ge=[{concept:"concept",concept_type:"string",domain:null},{concept:"concept_type",concept_type:"string",domain:null}],me=new Map([["$and",(he,ge)=>ge.every((ge=>w(he,ge)))],["$or",(he,ge)=>ge.some((ge=>w(he,ge)))],["$not",(he,ge)=>!w(he,ge)],["$nor",(he,ge)=>!ge.some((ge=>w(he,ge)))],["$eq",(he,ge)=>he==ge],["$ne",(he,ge)=>he!=ge],["$gt",(he,ge)=>l(he)&&he>ge],["$gte",(he,ge)=>l(he)&&he>=ge],["$lt",(he,ge)=>l(he)&&he<ge],["$lte",(he,ge)=>l(he)&&he<=ge],["$in",(he,ge)=>ge.has(he)],["$nin",(he,ge)=>!ge.has(he)]]),ze=new Map,Oe=new Map;let Ce,ke,Te=[],Le=!1;function _(he){const ge=(0,Me.getFilePath)(he.basePath),{debug:me,error:be}=he.diagnostic.prepareDiagnosticFor("loadDataPackage");return new Promise(((ve,xe)=>{if(Ce)return ve(Ce);he.fileReader.readText(ge,((he,Me)=>{if(he)return be("file reading",he),xe(new we.DdfCsvError(we.FILE_READING_ERROR,he,ge));try{Ce=JSON.parse(_e(Me)),Te=[],function(he){if(Oe.size>0)return Oe;he.resources.forEach((he=>{Array.isArray(he.schema.primaryKey)||(he.schema.primaryKey=[he.schema.primaryKey]);const ge=he.schema.fields.reduce(((he,ge)=>{var me;return(null===(me=ge.constraints)||void 0===me?void 0:me.enum)&&(Le||(Le=!0),he[ge.name]=ge.constraints.enum),he}),{});he.constraints=ge,he.translations={},Oe.set(he.name,he)}))}(Ce),function(he){if(ze.size>0)return ze;for(const ge in he.ddfSchema)he.ddfSchema[ge].map((he=>{const ge=C(he.primaryKey),me=he.resources.map((he=>Oe.get(he)));ze.has(ge)?ze.get(ge).set(he.value,me):ze.set(ge,new Map([[he.value,me]]))}))}(Ce)}catch(he){return be("json file parsing",he),xe(new we.DdfCsvError(we.JSON_PARSING_ERROR,he.message,ge))}me("datapackage content is ready"),ve(Ce)}))}))}async function b(he,me){const{error:be}=me.diagnostic.prepareDiagnosticFor("loadConcepts");m(ge,me);const ve={select:{key:["concept"],value:["concept_type","domain"]},from:"concepts"};let _e;try{!function(he,me){const be=he.filter((he=>"entity_set"===he.concept_type)).map((he=>({concept:"is--"+he.concept,concept_type:"boolean",domain:null})));m(he=he.concat(be).concat(ge),me)}(await j(ve,me),me),_e=await function(he){let{conceptsLookup:ge}=he;const me=new Map([["boolean",he=>"true"===he||"TRUE"===he],["measure",he=>parseFloat(he)]]),be=[...A(["concept"])].map((he=>he.data.then((he=>{const be=Object.keys(he.data[0]),ve=new Map;return be.forEach((he=>{const be=ge.get(he).concept_type,_e=me.get(be);_e&&ve.set(he,_e)})),he.data.forEach((he=>{for(const[ge,me]of ve)he[ge]=me(he[ge])}))}))));return Promise.all(be)}(me)}catch(he){throw be("concepts processing",he),he}return _e}function m(he,ge){ge.conceptsLookup.clear(),he.forEach((he=>ge.conceptsLookup.set(he.concept,he)))}function j(he,ge){const me=Object.assign({},ge),{debug:_e}=me.diagnostic.prepareDiagnosticFor("queryData"),{select:{key:xe=[],value:we=[]},from:Me="",where:Se={},join:ze={},order_by:Oe=[],language:Ce}=he,ke={key:xe,value:we};_e("start all data loading",he);const Te=new Set(ke.key.concat(ke.value)),Le=E(Se).filter((he=>"entities"===Me||!Te.has(he))),Ae=function(he,ge,me,ve,_e){const{debug:xe}=ve.diagnostic.prepareDiagnosticFor("loadResource"),we=A(he,ge);return xe("resources list by query",{queryParam:_e,resources:[...we]}),Promise.all([...we].map((he=>function(he,ge,me){const{warning:ve}=me.diagnostic.prepareDiagnosticFor("loadResource"),_e=[];void 0===he.data&&(he.data=D(he.path,me)),_e.push(he.data);const xe=void 0!==ge&&be(function(he){return he.datapackage.translations?he.datapackage.translations.map((he=>he.id)):[]}(me),ge),we=void 0!==he.translations[ge];if(xe){if(!we){const be="lang/".concat(ge,"/").concat(he.path);he.translations[ge]=D(be,me).catch((he=>(ve("translation file ".concat(be),he),Promise.resolve({}))))}_e.push(he.translations[ge])}return Promise.all(_e).then((ge=>{const me=ge.map((he=>he.data||[]));return{data:k(he.schema.primaryKey,"translation",...me),resource:he}}))}(he,me,ve))))}(ke.key,[...ke.value,...Le],Ce,me,he),Ee=function(he,ge,me){return Promise.all(Object.keys(he).map((ge=>function(he,ge,me,be){return"time"===be.conceptsLookup.get(ge.key).concept_type?Promise.resolve({[he]:ge.where}):j({select:{key:[ge.key]},where:ge.where,from:be.conceptsLookup.has(ge.key)?"entities":"concepts"},Object.assign({joinID:he},be)).then((me=>({[he]:{[ge.key]:{$in:new Set(me.map((he=>he[ge.key])))}}})))}(ge,he[ge],0,me)))).then((he=>he.reduce(O,{})))}(ze,0,me),je=function(he,ge,me){const be=S(["entity_set"],he,me).map((he=>j({select:{key:[he.domain],value:["is--"+he.concept]},from:"entities"},Object.assign({},me)).then((ge=>({[he.concept]:{$in:new Set(ge.filter((ge=>ge["is--"+he.concept])).map((ge=>ge[he.domain])))}})))));return Promise.all(be).then((he=>he.reduce(((he,ge)=>Object.assign(he,ge)),{})))}(ke.key,0,me);return Promise.all([Ae,je,Ee]).then((ge=>{let[xe,we,Me]=ge;_e("finish all data loading",he);const ze=function t(he,ge){const me={};for(const ve in he){const _e=he[ve];be(["$and","$or","$nor"],ve)?me[ve]=_e.map((he=>t(he,ge))):"$in"===ve||"$nin"===ve?me[ve]=new Set(_e):void 0!==ge[_e]?Object.assign(me,ge[_e]):me[ve]="object"==typeof _e?t(_e,ge):_e}return me}(Se,Me),Ce=function(){for(var he=arguments.length,ge=new Array(he),me=0;me<he;me++)ge[me]=arguments[me];return ge.reduce(((he,ge)=>(ve(ge)||(function(he){!function(he){const ge=Object.keys(he);for(const me of ge)"$or"==me&&(he[me]=he[me].reduce(((he,ge)=>{const me=Object.keys(ge);if(me.length>1)for(const be of me)he.push({[be]:ge[be]});else he.push(ge);return he}),[]))}(he)}(ge),he.$and.push(ge)),he)),{$and:[]})}(we,ze);_e("dataTables processing",he);const Ae=xe.map((he=>function(he,ge,me,be){const ve=he.resource.schema.primaryKey,_e=new Set([...ve,...ge.value,...me]),xe=function(he,ge,me){const be=new Set(ge),ve=["entity_set","entity_domain"],_e=S(ve,he,me);if(0===_e.length)return new Map;const xe=S(ve,null,me);return _e.map((he=>xe.filter((ge=>"entity_set"===he.concept_type?be.has(ge.concept)&&ge.concept!==he.concept&&(ge.domain===he.domain||ge.concept===he.domain):be.has(ge.concept)&&ge.concept!==he.concept&&ge.domain===he.concept)).reduce(((ge,me)=>ge.set(me.concept,he.concept)),new Map))).reduce(((he,ge)=>new Map([...he,...ge])),new Map)}(ge.key,ve,be);return he.data.map((he=>R(he,_e))).map((he=>function(he,ge){const me={};for(const be of Object.keys(he))me[ge.get(be)||be]=he[be];return me}(he,xe)))}(he,ke,Le,me)));_e("queryResult processing",he);const Ee=k(ke.key,"overwrite",...Ae).filter((he=>w(he,Ce))).map((he=>function(he,ge){for(const me of ge)void 0===he[me]&&(he[me]=null);return he}(he,Te))).map((he=>R(he,Te)));return _e("result ordering",he),function(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===ge.length)return;const me=ge.map((he=>{if("string"==typeof he)return{concept:he,direction:1};{const ge=Object.keys(he)[0];return{concept:ge,direction:"asc"===he[ge]?1:-1}}})),be=me.length;he.sort(((he,ge)=>{for(let ve=0;ve<be;ve++){const be=me[ve];if(he[be.concept]<ge[be.concept])return-1*be.direction;if(he[be.concept]>ge[be.concept])return 1*be.direction}return 0}))}(Ee,Oe),_e("final result is ready",he),function(he,ge){const me=ge.conceptsLookup;return Object.keys(he[0]||{}).map((he=>me.get(he)||{})).filter((he=>"time"==he.concept_type)).forEach((me=>{let{concept:be}=me;const ve=function(he,ge){const{error:me}=ge.diagnostic.prepareDiagnosticFor("queryData"),be={year:(0,De.utcParse)("%Y"),month:(0,De.utcParse)("%Y-%m"),day:(0,De.utcParse)("%Y%m%d"),hour:(0,De.utcParse)("%Y%m%dt%H"),minute:(0,De.utcParse)("%Y%m%dt%H%M"),second:(0,De.utcParse)("%Y%m%dt%H%M%S"),week:(0,De.utcParse)("%Yw%V"),quarter:(0,De.utcParse)("%Yq%q")};return"time"==he?function(he){for(const ge in be){const me=be[ge](he);if(me)return me}return me("Could not parse time string: "+he),null}:be[he]?be[he]:(me("No time parser found for time concept: "+he),he=>he)}(be,ge);he.forEach((he=>{he[be]=ve(he[be])}))})),he}(Ee,me)}))}function w(he,ge){return Object.keys(ge).every((be=>{const ve=me.get(be);return ve?ve(he,ge[be]):"object"!=typeof ge[be]?me.get("$eq")(he[be],ge[be]):w(he[be],ge[be])}))}function O(he,ge){return Object.assign(he,ge)}function E(he){const ge=[];for(const me in he)be(["$and","$or","$not","$nor"],me)?he[me].map(E).forEach((he=>ge.push(...he))):ge.push(me);return[...new Set(ge)]}function S(he,ge,me){const ve=ge||Array.from(me.conceptsLookup.keys()),_e=[];for(const ge of ve){const ve=me.conceptsLookup.get(ge);be(he,ve.concept_type)&&_e.push(ve)}return _e}function A(he,ge){if(!ge||0===ge.length||he[0]===ge)return new Set([...ze.get(C(he)).values()].reduce(((he,ge)=>he.concat(ge))));if(Array.isArray(ge))return ge.map((ge=>A(he,ge))).reduce(((he,ge)=>new Set([...he,...ge])),new Set);let me=ze.get(C(he)).get(ge);return me&&(me=me.filter((he=>ve(Te)||be(Te,he.path)))),new Set(me)}function R(he,ge){const me={};for(const be of Object.keys(he))ge.has(be)&&(me[be]=he[be]);return me}function k(he,ge){for(var me=arguments.length,be=new Array(me>2?me-2:0),ve=2;ve<me;ve++)be[ve-2]=arguments[ve];if(1===be.length)return be[0];const _e=he.slice(0).sort(),xe=be.reduce(((he,me)=>(me.forEach((me=>{const be=_e.map((he=>me[he])).join(",");he.has(be)?function(he,ge,me){switch(me){case"overwrite":Object.assign(he,ge);break;case"translation":for(const me in ge)""!==ge[me]&&(he[me]=ge[me]);break;case"overwriteWithError":for(const me in ge)if(void 0!==he[me]&&he[me]!==ge[me]){const be=JSON.stringify(ge),ve=JSON.stringify(he),_e='JOIN Error: two resources have different data for "'.concat(me,'": ').concat(be,",").concat(ve);T(new we.DdfCsvError(we.DDF_ERROR,_e))}else he[me]=ge[me]}}(he.get(be),me,ge):he.set(be,Object.assign({},me))})),he)),new Map);return[...xe.values()]}function T(ge){throw(he||console).error(ge.message),ge}function C(he){let ge=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const me=he.slice(0).sort();return ge?me.map((he=>ge[he])).join(","):me.join(",")}function D(he,ge){const{debug:me,error:ve}=ge.diagnostic.prepareDiagnosticFor("loadFile"),xe=(0,Me.getFilePath)(ge.basePath,he);return me('start reading "'.concat(he,'"')),new Promise(((Me,De)=>{ge.fileReader.readText(xe,((ze,Oe)=>{if(ze)return ve('fail "'.concat(he,'" reading'),ze),De(new we.DdfCsvError(we.FILE_READING_ERROR,ze,xe));Se.parse(_e(Oe),{header:!0,skipEmptyLines:!0,dynamicTyping:he=>{const me=ge.conceptsLookup.get(he)||{};return!be(["time","string","entity_domain","entity_set"],me.concept_type)},transform:he=>""===he?null:he,complete:ge=>{me('finish reading "'.concat(he,'"')),Me(ge)},error:ge=>{ve('fail "'.concat(he,'" parsing'),ge),De(new we.DdfCsvError(we.CSV_PARSING_ERROR,ge,he))}})}))}))}return{query:async function(he,ge){const me=Object.assign({},ge),{warning:be,error:ve}=me.diagnostic.prepareDiagnosticFor("query");let _e;if(function(he,ge){return"datapoints"==he.from&&0==he.select.value.length}(he))return Promise.resolve([]);try{if(await(0,Me.validateQueryStructure)(he,me),me.datapackage=await(ke||(ke=_(me))),me.resourcesLookup=Oe,await b(he,me),await(0,Me.validateQueryDefinitions)(he,me),(0,Me.isSchemaQuery)(he))_e=await function(he,ge){const{debug:me,error:be}=ge.diagnostic.prepareDiagnosticFor("query"),o=he=>(me("get schema for collection ".concat(he)),ge.datapackage.ddfSchema[he].map((he=>{let{primaryKey:ge,value:me}=he;return{key:ge,value:me}}))),ve=he.from.split(".")[0];if(ge.datapackage.ddfSchema[ve])return o(ve);if("*"===ve)return Object.keys(ge.datapackage.ddfSchema).map(o).reduce(((he,ge)=>he.concat(ge)));{const he="No valid collection (".concat(ve,") for schema query");be(he),T(new we.DdfCsvError(we.DDF_ERROR,he))}}(he,me);else{const ge=Le&&(0,xe.getAppropriatePlugin)(this,he,me);if(Te=[],ge){const me=await ge.getRecommendedFilesSet();Te=me,he.optimalFilesSet=[].concat(me,he.optimalFilesSet),be("get custom optimal files list by a plugin",Te)}_e=await j(he,me)}}catch(he){throw ve("general query error",he),he}return _e},queryData:j,loadFile:D,getDatasetInfo:function(he){return ke||_(he)}}};const be=me(1),ve=me(5),_e=me(45),xe=me(44),we=me(6),Me=me(42),Se=me(25),De=me(22),l=he=>!("number"!=typeof he&&!he)},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.prepareDDFCsvReaderObject=function(he){return function(ge,me){return{init(be){this._basePath=(0,Me.githubPathAdapter)(be.path||""),this._lastModified=be._lastModified,this.fileReader=ge||he,this.logger=me,this.resultTransformer=be.resultTransformer,this.readerOptions={basePath:this._basePath,fileReader:this.fileReader,logger:this.logger},this.reader=(0,ve.ddfCsvReader)(this.logger)},async getDatasetInfo(){const he=(0,xe.createDiagnosticManagerOn)(Se,De).forRequest("").withSeverityLevel(we.Level.OFF),ge=Object.assign({},this.readerOptions,{diagnostic:he});return this.reader.getDatasetInfo(ge).then((he=>{const ge=Object.assign({},he);return delete ge.ddfSchema,delete ge.resources,ge}))},async checkFile(he){return new Promise(((ge,me)=>ge({status:this.fileReader.checkFile(he),url:he})))},async getFile(he,ge,me){return new Promise(((be,ve)=>{this.fileReader.readText(he,((he,me)=>{if(he)return ve(he);try{return be(ge?JSON.parse(me):me)}catch(he){return ve(he)}}),me)}))},async checkIfAssetExists(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(be(ge)&&be(this._basePath))throw new _e.DdfCsvError("Neither initial 'path' nor 'repositoryPath' as a second param were found.","Happens in 'checkIfAssetExists' function",he);const me="".concat(ge||this._basePath,"/assets/").concat(he);return await this.checkFile(me)},async getAsset(he){let ge=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(be(ge)&&be(this._basePath))throw new _e.DdfCsvError("Neither initial 'path' nor 'repositoryPath' as a second param were found.","Happens in 'getAsset' function",he);const me="".concat(ge||this._basePath,"/").concat(he),ve=".json"===me.slice(-".json".length);return await this.getFile(me,ve)},async read(he,ge,ve){const Me=ve?(0,xe.createDiagnosticManagerOn)(Se,De).basedOn(ve):(0,xe.createDiagnosticManagerOn)(Se,De).forRequest("").withSeverityLevel(we.Level.OFF),{debug:ze,error:Oe,fatal:Ce}=Me.prepareDiagnosticFor("read");let ke;ze("start reading",he);try{if(be(he.repositoryPath)&&be(this._basePath)){const ge="Neither initial 'path' nor 'repositoryPath' in query were found.",me=new _e.DdfCsvError(ge,JSON.stringify(he));throw Oe(ge,me),me}ke=await this.reader.query(he,{basePath:he.repositoryPath||this._basePath,fileReader:this.fileReader,logger:this.logger,conceptsLookup:new Map,diagnostic:Me}),ke=ge?this._prettifyData(ke,ge):ke,this.resultTransformer&&(ke=this.resultTransformer(ke)),this.logger&&this.logger.log&&(me.log(JSON.stringify(he),ke.length),me.log(ke))}catch(he){throw Ce("global data reading error",he),he}return ke},_prettifyData:(he,ge)=>he.map((he=>(Object.keys(he).forEach((me=>{ge[me]&&(he[me]=ge[me](he[me]))})),he)))}}};const be=me(5),ve=me(46),_e=me(6),xe=me(14),we=me(14),Me=me(23),Se="@vizabi/reader-ddfcsv",De="4.5.2"},function(he,ge,me){Object.defineProperty(ge,"__esModule",{value:!0}),ge.version=ge.versionInfo=ge.getDDFCsvReaderObject=ge.DdfCsvError=ge.FrontendFileReader=void 0;const be=me(21);var ve=me(21);Object.defineProperty(ge,"FrontendFileReader",{enumerable:!0,get:function(){return ve.FrontendFileReader}});var _e=me(6);Object.defineProperty(ge,"DdfCsvError",{enumerable:!0,get:function(){return _e.DdfCsvError}});const xe=me(47);ge.getDDFCsvReaderObject=(0,xe.prepareDDFCsvReaderObject)(new be.FrontendFileReader),ge.versionInfo={version:"4.5.2",build:"1738169964853",package:{name:"@vizabi/reader-ddfcsv",description:"Vizabi DDFcsv reader"}},ge.version="4.5.2"},function(he,ge,me){he.exports=me(48)}])},"object"==typeof exports&&"object"==typeof module?module.exports=ve():"function"==typeof define&&define.amd?define([],ve):"object"==typeof exports?exports.DDFCsvReader=ve():be.DDFCsvReader=ve();
})();
//# sourceMappingURL=tools.min.js.map